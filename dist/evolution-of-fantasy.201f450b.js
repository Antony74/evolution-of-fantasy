function $parcel$export(e,t,i,s){Object.defineProperty(e,t,{get:i,set:s,enumerable:!0,configurable:!0})}var $parcel$global=globalThis,$parcel$modules={},$parcel$inits={},parcelRequire=$parcel$global.parcelRequirea518;null==parcelRequire&&((parcelRequire=function(e){if(e in $parcel$modules)return $parcel$modules[e].exports;if(e in $parcel$inits){var t=$parcel$inits[e];delete $parcel$inits[e];var i={id:e,exports:{}};return $parcel$modules[e]=i,t.call(i.exports,i,i.exports),i.exports}var s=Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}).register=function(e,t){$parcel$inits[e]=t},$parcel$global.parcelRequirea518=parcelRequire);var parcelRegister=parcelRequire.register;parcelRegister("6tZyV",function(module,exports){var RENDERING_HINT,DIALECT,NODETYPE,CURSOR,FONT,ARROW,ALIGN,DIRECTION,TEXT_DIRECTION,ELBOW,EDGESTYLE,PERIMETER,SHAPE,mimeDb,hasRequiredMimeDb,mimeScore,hasRequiredMimeScore,hasRequiredMimeTypes,$6ZWSX=parcelRequire("6ZWSX"),$4b85347d9a00227f$require$Buffer=$6ZWSX.Buffer;Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});var $kjyEk=parcelRequire("kjyEk"),$59kwG=parcelRequire("59kwG");class ImageBox{constructor(e,t,i){this.src=e,this.width=t,this.height=i}}class EventObject{constructor(e="",...t){if(this.consumed=!1,this.name=e,this.properties={},t[0]&&t[0].constructor===Object)for(let[e,i]of Object.entries(t[0]))this.properties[e]=i;else for(let e=0;e<t.length;e+=2)null!==t[e+1]&&(this.properties[t[e]]=t[e+1])}getName(){return this.name}getProperties(){return this.properties}getProperty(e){return this.properties[e]}isConsumed(){return this.consumed}consume(){this.consumed=!0}}class EventSource{constructor(e=null){this.eventListeners=[],this.eventsEnabled=!0,this.eventSource=null,this.eventSource=e}isEventsEnabled(){return this.eventsEnabled}setEventsEnabled(e){this.eventsEnabled=e}getEventSource(){return this.eventSource}setEventSource(e){this.eventSource=e}addListener(e,t){this.eventListeners.push({name:e,funct:t})}removeListener(e){let t=0;for(;t<this.eventListeners.length;)this.eventListeners[t].funct===e?this.eventListeners.splice(t,1):t+=1}fireEvent(e,t=null){if(this.isEventsEnabled())for(let i of(e||(e=new EventObject("")),t||(t=this.getEventSource()),t||(t=this),this.eventListeners))(null===i.name||i.name===e.getName())&&i.funct.apply(this,[t,e])}}let VERSION="0.17.0",DEFAULT_HOTSPOT=.3,MIN_HOTSPOT_SIZE=8,MAX_HOTSPOT_SIZE=0;!function(e){e.EXACT="exact",e.FASTER="faster",e.FASTEST="fastest"}(RENDERING_HINT||(RENDERING_HINT={})),function(e){e.SVG="svg",e.MIXEDHTML="mixedHtml",e.PREFERHTML="preferHtml",e.STRICTHTML="strictHtml"}(DIALECT||(DIALECT={}));let IDENTITY_FIELD_NAME="mxObjectId",NS_SVG="http://www.w3.org/2000/svg",NS_XLINK="http://www.w3.org/1999/xlink",SHADOWCOLOR="gray",SHADOW_OFFSET_X=2,SHADOW_OFFSET_Y=3,SHADOW_OPACITY=1;!function(e){e[e.ELEMENT=1]="ELEMENT",e[e.ATTRIBUTE=2]="ATTRIBUTE",e[e.TEXT=3]="TEXT",e[e.CDATA=4]="CDATA",e[e.ENTITY_REFERENCE=5]="ENTITY_REFERENCE",e[e.ENTITY=6]="ENTITY",e[e.PROCESSING_INSTRUCTION=7]="PROCESSING_INSTRUCTION",e[e.COMMENT=8]="COMMENT",e[e.DOCUMENT=9]="DOCUMENT",e[e.DOCUMENTTYPE=10]="DOCUMENTTYPE",e[e.DOCUMENT_FRAGMENT=11]="DOCUMENT_FRAGMENT",e[e.NOTATION=12]="NOTATION"}(NODETYPE||(NODETYPE={}));let TOOLTIP_VERTICAL_OFFSET=16,DEFAULT_VALID_COLOR="#00FF00",DEFAULT_INVALID_COLOR="#FF0000",OUTLINE_HIGHLIGHT_COLOR="#00FF00",OUTLINE_HIGHLIGHT_STROKEWIDTH=5,HIGHLIGHT_STROKEWIDTH=3,HIGHLIGHT_SIZE=2,HIGHLIGHT_OPACITY=100;!function(e){e.MOVABLE_VERTEX="move",e.MOVABLE_EDGE="move",e.LABEL_HANDLE="default",e.TERMINAL_HANDLE="pointer",e.BEND_HANDLE="crosshair",e.VIRTUAL_BEND_HANDLE="crosshair",e.CONNECT="pointer"}(CURSOR||(CURSOR={}));let HIGHLIGHT_COLOR="#00FF00",CONNECT_TARGET_COLOR="#0000FF",INVALID_CONNECT_TARGET_COLOR="#FF0000",DROP_TARGET_COLOR="#0000FF",VALID_COLOR="#00FF00",INVALID_COLOR="#FF0000",EDGE_SELECTION_COLOR="#00FF00",VERTEX_SELECTION_COLOR="#00FF00",VERTEX_SELECTION_STROKEWIDTH=1,EDGE_SELECTION_STROKEWIDTH=1,VERTEX_SELECTION_DASHED=!0,EDGE_SELECTION_DASHED=!0,GUIDE_COLOR="#FF0000",GUIDE_STROKEWIDTH=1,OUTLINE_COLOR="#0099FF",OUTLINE_STROKEWIDTH=3,HANDLE_SIZE=6,LABEL_HANDLE_SIZE=4,HANDLE_FILLCOLOR="#00FF00",HANDLE_STROKECOLOR="black",LABEL_HANDLE_FILLCOLOR="yellow",CONNECT_HANDLE_FILLCOLOR="#0000FF",LOCKED_HANDLE_FILLCOLOR="#FF0000",OUTLINE_HANDLE_FILLCOLOR="#00FFFF",OUTLINE_HANDLE_STROKECOLOR="#0033FF",DEFAULT_FONTFAMILY="Arial,Helvetica",DEFAULT_FONTSIZE=11,DEFAULT_TEXT_DIRECTION="",LINE_HEIGHT=1.2,WORD_WRAP="normal",ABSOLUTE_LINE_HEIGHT=!1,DEFAULT_FONTSTYLE=0,DEFAULT_STARTSIZE=40,DEFAULT_MARKERSIZE=6,DEFAULT_IMAGESIZE=24,ENTITY_SEGMENT=30,RECTANGLE_ROUNDING_FACTOR=.15,LINE_ARCSIZE=20,ARROW_SPACING=0,ARROW_WIDTH=30,ARROW_SIZE=30,PAGE_FORMAT_A4_PORTRAIT=[0,0,827,1169],PAGE_FORMAT_A4_LANDSCAPE=[0,0,1169,827],PAGE_FORMAT_LETTER_PORTRAIT=[0,0,850,1100],PAGE_FORMAT_LETTER_LANDSCAPE=[0,0,1100,850],NONE="none";!function(e){e[e.BOLD=1]="BOLD",e[e.ITALIC=2]="ITALIC",e[e.UNDERLINE=4]="UNDERLINE",e[e.STRIKETHROUGH=8]="STRIKETHROUGH"}(FONT||(FONT={})),function(e){e.CLASSIC="classic",e.CLASSIC_THIN="classicThin",e.BLOCK="block",e.BLOCK_THIN="blockThin",e.OPEN="open",e.OPEN_THIN="openThin",e.OVAL="oval",e.DIAMOND="diamond",e.DIAMOND_THIN="diamondThin"}(ARROW||(ARROW={})),function(e){e.LEFT="left",e.CENTER="center",e.RIGHT="right",e.TOP="top",e.MIDDLE="middle",e.BOTTOM="bottom"}(ALIGN||(ALIGN={})),function(e){e.NORTH="north",e.SOUTH="south",e.EAST="east",e.WEST="west"}(DIRECTION||(DIRECTION={})),function(e){e.DEFAULT="",e.AUTO="auto",e.LTR="ltr",e.RTL="rtl"}(TEXT_DIRECTION||(TEXT_DIRECTION={}));let DIRECTION_MASK={NONE:0,WEST:1,NORTH:2,SOUTH:4,EAST:8,ALL:15};!function(e){e.VERTICAL="vertical",e.HORIZONTAL="horizontal"}(ELBOW||(ELBOW={})),function(e){e.ELBOW="elbowEdgeStyle",e.ENTITY_RELATION="entityRelationEdgeStyle",e.LOOP="loopEdgeStyle",e.SIDETOSIDE="sideToSideEdgeStyle",e.TOPTOBOTTOM="topToBottomEdgeStyle",e.ORTHOGONAL="orthogonalEdgeStyle",e.SEGMENT="segmentEdgeStyle",e.MANHATTAN="manhattanEdgeStyle"}(EDGESTYLE||(EDGESTYLE={})),function(e){e.ELLIPSE="ellipsePerimeter",e.RECTANGLE="rectanglePerimeter",e.RHOMBUS="rhombusPerimeter",e.HEXAGON="hexagonPerimeter",e.TRIANGLE="trianglePerimeter"}(PERIMETER||(PERIMETER={})),function(e){e.RECTANGLE="rectangle",e.ELLIPSE="ellipse",e.DOUBLE_ELLIPSE="doubleEllipse",e.RHOMBUS="rhombus",e.LINE="line",e.IMAGE="image",e.ARROW="arrow",e.ARROW_CONNECTOR="arrowConnector",e.LABEL="label",e.CYLINDER="cylinder",e.SWIMLANE="swimlane",e.CONNECTOR="connector",e.ACTOR="actor",e.CLOUD="cloud",e.TRIANGLE="triangle",e.HEXAGON="hexagon"}(SHAPE||(SHAPE={}));let Constants=Object.freeze(Object.defineProperty({__proto__:null,ABSOLUTE_LINE_HEIGHT:ABSOLUTE_LINE_HEIGHT,get ALIGN(){return ALIGN},get ARROW(){return ARROW},ARROW_SIZE:ARROW_SIZE,ARROW_SPACING:ARROW_SPACING,ARROW_WIDTH:ARROW_WIDTH,CONNECT_HANDLE_FILLCOLOR:CONNECT_HANDLE_FILLCOLOR,CONNECT_TARGET_COLOR:CONNECT_TARGET_COLOR,get CURSOR(){return CURSOR},DEFAULT_FONTFAMILY:DEFAULT_FONTFAMILY,DEFAULT_FONTSIZE:DEFAULT_FONTSIZE,DEFAULT_FONTSTYLE:DEFAULT_FONTSTYLE,DEFAULT_HOTSPOT:DEFAULT_HOTSPOT,DEFAULT_IMAGESIZE:DEFAULT_IMAGESIZE,DEFAULT_INVALID_COLOR:DEFAULT_INVALID_COLOR,DEFAULT_MARKERSIZE:DEFAULT_MARKERSIZE,DEFAULT_STARTSIZE:DEFAULT_STARTSIZE,DEFAULT_TEXT_DIRECTION:DEFAULT_TEXT_DIRECTION,DEFAULT_VALID_COLOR:DEFAULT_VALID_COLOR,get DIALECT(){return DIALECT},get DIRECTION(){return DIRECTION},DIRECTION_MASK:DIRECTION_MASK,DROP_TARGET_COLOR:DROP_TARGET_COLOR,get EDGESTYLE(){return EDGESTYLE},EDGE_SELECTION_COLOR:EDGE_SELECTION_COLOR,EDGE_SELECTION_DASHED:EDGE_SELECTION_DASHED,EDGE_SELECTION_STROKEWIDTH:EDGE_SELECTION_STROKEWIDTH,get ELBOW(){return ELBOW},ENTITY_SEGMENT:ENTITY_SEGMENT,get FONT(){return FONT},GUIDE_COLOR:GUIDE_COLOR,GUIDE_STROKEWIDTH:GUIDE_STROKEWIDTH,HANDLE_FILLCOLOR:HANDLE_FILLCOLOR,HANDLE_SIZE:HANDLE_SIZE,HANDLE_STROKECOLOR:HANDLE_STROKECOLOR,HIGHLIGHT_COLOR:HIGHLIGHT_COLOR,HIGHLIGHT_OPACITY:HIGHLIGHT_OPACITY,HIGHLIGHT_SIZE:HIGHLIGHT_SIZE,HIGHLIGHT_STROKEWIDTH:HIGHLIGHT_STROKEWIDTH,IDENTITY_FIELD_NAME:IDENTITY_FIELD_NAME,INVALID_COLOR:INVALID_COLOR,INVALID_CONNECT_TARGET_COLOR:INVALID_CONNECT_TARGET_COLOR,LABEL_HANDLE_FILLCOLOR:LABEL_HANDLE_FILLCOLOR,LABEL_HANDLE_SIZE:LABEL_HANDLE_SIZE,LINE_ARCSIZE:LINE_ARCSIZE,LINE_HEIGHT:LINE_HEIGHT,LOCKED_HANDLE_FILLCOLOR:LOCKED_HANDLE_FILLCOLOR,MAX_HOTSPOT_SIZE:MAX_HOTSPOT_SIZE,MIN_HOTSPOT_SIZE:MIN_HOTSPOT_SIZE,get NODETYPE(){return NODETYPE},NONE:NONE,NS_SVG:NS_SVG,NS_XLINK:NS_XLINK,OUTLINE_COLOR:OUTLINE_COLOR,OUTLINE_HANDLE_FILLCOLOR:OUTLINE_HANDLE_FILLCOLOR,OUTLINE_HANDLE_STROKECOLOR:OUTLINE_HANDLE_STROKECOLOR,OUTLINE_HIGHLIGHT_COLOR:OUTLINE_HIGHLIGHT_COLOR,OUTLINE_HIGHLIGHT_STROKEWIDTH:OUTLINE_HIGHLIGHT_STROKEWIDTH,OUTLINE_STROKEWIDTH:OUTLINE_STROKEWIDTH,PAGE_FORMAT_A4_LANDSCAPE:PAGE_FORMAT_A4_LANDSCAPE,PAGE_FORMAT_A4_PORTRAIT:PAGE_FORMAT_A4_PORTRAIT,PAGE_FORMAT_LETTER_LANDSCAPE:PAGE_FORMAT_LETTER_LANDSCAPE,PAGE_FORMAT_LETTER_PORTRAIT:PAGE_FORMAT_LETTER_PORTRAIT,get PERIMETER(){return PERIMETER},RECTANGLE_ROUNDING_FACTOR:RECTANGLE_ROUNDING_FACTOR,get RENDERING_HINT(){return RENDERING_HINT},SHADOWCOLOR:SHADOWCOLOR,SHADOW_OFFSET_X:SHADOW_OFFSET_X,SHADOW_OFFSET_Y:SHADOW_OFFSET_Y,SHADOW_OPACITY:SHADOW_OPACITY,get SHAPE(){return SHAPE},get TEXT_DIRECTION(){return TEXT_DIRECTION},TOOLTIP_VERTICAL_OFFSET:TOOLTIP_VERTICAL_OFFSET,VALID_COLOR:VALID_COLOR,VERSION:VERSION,VERTEX_SELECTION_COLOR:VERTEX_SELECTION_COLOR,VERTEX_SELECTION_DASHED:VERTEX_SELECTION_DASHED,VERTEX_SELECTION_STROKEWIDTH:VERTEX_SELECTION_STROKEWIDTH,WORD_WRAP:WORD_WRAP},Symbol.toStringTag,{value:"Module"}));class Client{}Client.basePath=".",Client.setBasePath=e=>{void 0!==e&&e.length>0?("/"===e.substring(e.length-1)&&(e=e.substring(0,e.length-1)),Client.basePath=e):Client.basePath="."},Client.imageBasePath=".",Client.setImageBasePath=e=>{void 0!==e&&e.length>0?("/"===e.substring(e.length-1)&&(e=e.substring(0,e.length-1)),Client.imageBasePath=e):Client.imageBasePath=`${Client.basePath}/images`},Client.IS_EDGE="undefined"!=typeof window&&null!=navigator.userAgent&&!!navigator.userAgent.match(/Edge\//),Client.IS_NS="undefined"!=typeof window&&null!=navigator.userAgent&&navigator.userAgent.indexOf("Mozilla/")>=0&&0>navigator.userAgent.indexOf("MSIE")&&0>navigator.userAgent.indexOf("Edge/"),Client.IS_SF="undefined"!=typeof window&&/Apple Computer, Inc/.test(navigator.vendor),Client.IS_ANDROID="undefined"!=typeof window&&navigator.appVersion.indexOf("Android")>=0,Client.IS_IOS="undefined"!=typeof window&&/iP(hone|od|ad)/.test(navigator.platform),Client.IS_GC="undefined"!=typeof window&&/Google Inc/.test(navigator.vendor),Client.IS_CHROMEAPP="undefined"!=typeof window&&null!=window.chrome&&null!=chrome.app&&null!=chrome.app.runtime,Client.IS_FF=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,Client.IS_MT="undefined"!=typeof window&&(navigator.userAgent.indexOf("Firefox/")>=0&&0>navigator.userAgent.indexOf("Firefox/1.")&&0>navigator.userAgent.indexOf("Firefox/2.")||navigator.userAgent.indexOf("Iceweasel/")>=0&&0>navigator.userAgent.indexOf("Iceweasel/1.")&&0>navigator.userAgent.indexOf("Iceweasel/2.")||navigator.userAgent.indexOf("SeaMonkey/")>=0&&0>navigator.userAgent.indexOf("SeaMonkey/1.")||navigator.userAgent.indexOf("Iceape/")>=0&&0>navigator.userAgent.indexOf("Iceape/1.")),Client.IS_SVG="undefined"!=typeof window&&"MICROSOFT INTERNET EXPLORER"!==navigator.appName.toUpperCase(),Client.NO_FO="undefined"!=typeof window&&(!document.createElementNS||"[object SVGForeignObjectElement]"!==document.createElementNS(NS_SVG,"foreignObject").toString()||navigator.userAgent.indexOf("Opera/")>=0),Client.IS_WIN="undefined"!=typeof window&&navigator.appVersion.indexOf("Win")>0,Client.IS_MAC="undefined"!=typeof window&&navigator.appVersion.indexOf("Mac")>0,Client.IS_CHROMEOS="undefined"!=typeof window&&/\bCrOS\b/.test(navigator.appVersion),Client.IS_TOUCH="undefined"!=typeof window&&"ontouchstart"in document.documentElement,Client.IS_POINTER="undefined"!=typeof window&&null!=window.PointerEvent&&!(navigator.appVersion.indexOf("Mac")>0),Client.IS_LOCAL="undefined"!=typeof window&&0>document.location.href.indexOf("http://")&&0>document.location.href.indexOf("https://");let getMainEvent=e=>{let t=e;return("touchstart"===t.type||"touchmove"===t.type)&&t.touches&&t.touches[0]?t=t.touches[0]:"touchend"===t.type&&t.changedTouches&&t.changedTouches[0]&&(t=t.changedTouches[0]),t},getClientX=e=>getMainEvent(e).clientX,getClientY=e=>getMainEvent(e).clientY,getSource=e=>e.target,isConsumed=e=>{let t=e;return void 0!==t.isConsumed&&t.isConsumed},isTouchEvent=e=>{let t=e;return t.pointerType?"touch"===t.pointerType||t.pointerType===t.MSPOINTER_TYPE_TOUCH:void 0!==t.mozInputSource?5===t.mozInputSource:0===t.type.indexOf("touch")},isPenEvent=e=>{let t=e;return t.pointerType?"pen"==t.pointerType||t.pointerType===t.MSPOINTER_TYPE_PEN:void 0!==t.mozInputSource?2===t.mozInputSource:0===t.type.indexOf("pen")},isMultiTouchEvent=e=>{let t=e;return t.type&&0==t.type.indexOf("touch")&&void 0!==t.touches&&t.touches.length>1},isMouseEvent=e=>{let t=e;return t.pointerType?"mouse"==t.pointerType||t.pointerType===t.MSPOINTER_TYPE_MOUSE:void 0!==t.mozInputSource?1===t.mozInputSource:0===t.type.indexOf("mouse")},isLeftMouseButton=e=>"buttons"in e&&("mousedown"===e.type||"mousemove"===e.type)?1===e.buttons:void 0!==e.which?1===e.which:1===e.button,isMiddleMouseButton=e=>4===e.button,isRightMouseButton=e=>2===e.button,isPopupTrigger=e=>isRightMouseButton(e)||Client.IS_MAC&&isControlDown(e)&&!isShiftDown(e)&&!isMetaDown(e)&&!isAltDown(e),isShiftDown=e=>e.shiftKey,isAltDown=e=>e.altKey,isControlDown=e=>e.ctrlKey,isMetaDown=e=>e.metaKey,EventUtils=Object.freeze(Object.defineProperty({__proto__:null,getClientX:getClientX,getClientY:getClientY,getMainEvent:getMainEvent,getSource:getSource,isAltDown:isAltDown,isConsumed:isConsumed,isControlDown:isControlDown,isLeftMouseButton:isLeftMouseButton,isMetaDown:isMetaDown,isMiddleMouseButton:isMiddleMouseButton,isMouseEvent:isMouseEvent,isMultiTouchEvent:isMultiTouchEvent,isPenEvent:isPenEvent,isPopupTrigger:isPopupTrigger,isRightMouseButton:isRightMouseButton,isShiftDown:isShiftDown,isTouchEvent:isTouchEvent},Symbol.toStringTag,{value:"Module"})),extractTextWithWhitespace=e=>{let t=["BLOCKQUOTE","DIV","H1","H2","H3","H4","H5","H6","OL","P","PRE","TABLE","UL"],i=[];function s(e){if(1!=e.length||"BR"!=e[0].nodeName&&"\n"!=e[0].innerHTML)for(let n=0;n<e.length;n+=1){let a=e[n];"BR"==a.nodeName||"\n"==a.innerHTML||(1==e.length||0==n)&&"DIV"==a.nodeName&&"<br>"==a.innerHTML.toLowerCase()?i.push("\n"):(3===a.nodeType||4===a.nodeType?a.nodeValue&&a.nodeValue.length>0&&i.push(a.nodeValue):8!==a.nodeType&&a.childNodes.length>0&&s(Array.from(a.childNodes)),n<e.length-1&&t.indexOf(e[n+1].nodeName)>=0&&i.push("\n"))}}return s(e),i.join("")},getTextContent=e=>(null==e?void 0:e.textContent)??"",setTextContent=(e,t)=>{"innerText"in e?e.innerText=t:e.textContent=t},getInnerHtml=e=>null!=e?new XMLSerializer().serializeToString(e):"",getOuterHtml=e=>null!=e?new XMLSerializer().serializeToString(e):"",write=(e,t)=>{let i=e.ownerDocument.createTextNode(t);return null!=e&&e.appendChild(i),i},writeln=(e,t)=>{let i=e.ownerDocument.createTextNode(t);return null!=e&&(e.appendChild(i),e.appendChild(document.createElement("br"))),i},br=(e,t=1)=>{let i=null;for(let s=0;s<t;s+=1)null!=e&&(i=e.ownerDocument.createElement("br"),e.appendChild(i));return i},para=(e,t)=>{let i=document.createElement("p");return write(i,t),null!=e&&e.appendChild(i),i},isNode=(e,t=null,i,s)=>!(null==e||isNaN(e.nodeType))&&(null==t||e.nodeName.toLowerCase()==t.toLowerCase())&&(null==i||e.getAttribute(i)==s),isAncestorNode=(e,t)=>{let i=t;for(;null!=i;){if(i===e)return!0;i=i.parentNode}return!1},getChildNodes=(e,t=NODETYPE.ELEMENT)=>{t=t||NODETYPE.ELEMENT;let i=[],s=e.firstChild;for(;null!=s;)s.nodeType===t&&i.push(s),s=s.nextSibling;return i},importNode=(e,t,i)=>e.importNode(t,i),clearSelection=()=>{let e=window.getSelection?window.getSelection():document.selection;e&&(e.removeAllRanges?e.removeAllRanges():e.empty&&e.empty())},createImage=e=>{let t=null;return(t=document.createElement("img")).setAttribute("src",e),t.setAttribute("border","0"),t},addLinkToHead=(e,t,i=null,s=null)=>{let n=(i=i||document).createElement("link");n.setAttribute("rel",e),n.setAttribute("href",t),n.setAttribute("charset","UTF-8"),n.setAttribute("type","text/css"),s&&n.setAttribute("id",s),i.getElementsByTagName("head")[0].appendChild(n)},domUtils=Object.freeze(Object.defineProperty({__proto__:null,addLinkToHead:addLinkToHead,br:br,clearSelection:clearSelection,createImage:createImage,extractTextWithWhitespace:extractTextWithWhitespace,getChildNodes:getChildNodes,getInnerHtml:getInnerHtml,getOuterHtml:getOuterHtml,getTextContent:getTextContent,importNode:importNode,isAncestorNode:isAncestorNode,isNode:isNode,para:para,setTextContent:setTextContent,write:write,writeln:writeln},Symbol.toStringTag,{value:"Module"}));class InternalMouseEvent{constructor(e,t=null){this.consumed=!1,this.evt=e,this.state=t,this.sourceState=t,this.graphX=0,this.graphY=0}getEvent(){return this.evt}getSource(){return getSource(this.evt)}isSource(e){return!!e&&isAncestorNode(e.node,this.getSource())}getX(){return getClientX(this.getEvent())}getY(){return getClientY(this.getEvent())}getGraphX(){return this.graphX}getGraphY(){return this.graphY}getState(){return this.state}getCell(){let e=this.getState();return e?e.cell:null}isPopupTrigger(){return isPopupTrigger(this.getEvent())}isConsumed(){return this.consumed}consume(e){(e=e||window.TouchEvent&&this.evt instanceof TouchEvent||isMouseEvent(this.evt))&&this.evt.preventDefault&&this.evt.preventDefault(),this.consumed=!0}}let supportsPassive=!1;try{document.addEventListener("test",()=>{},Object.defineProperty&&Object.defineProperty({},"passive",{get:()=>{supportsPassive=!0}}))}catch(e){}class InternalEvent{static addListener(e,t,i){e.addEventListener(t,i,!!supportsPassive&&{passive:!1}),e.mxListenerList||(e.mxListenerList=[]);let s={name:t,f:i};e.mxListenerList.push(s)}static removeListener(e,t,i){if(e.removeEventListener(t,i,!1),e.mxListenerList){let t=e.mxListenerList.length;for(let s=0;s<t;s+=1)if(e.mxListenerList[s].f===i){e.mxListenerList.splice(s,1);break}}}static removeAllListeners(e){let t=e.mxListenerList;if(t)for(;t.length>0;){let i=t[0];InternalEvent.removeListener(e,i.name,i.f)}}static addGestureListeners(e,t=null,i=null,s=null){t&&InternalEvent.addListener(e,Client.IS_POINTER?"pointerdown":"mousedown",t),i&&InternalEvent.addListener(e,Client.IS_POINTER?"pointermove":"mousemove",i),s&&InternalEvent.addListener(e,Client.IS_POINTER?"pointerup":"mouseup",s),!Client.IS_POINTER&&Client.IS_TOUCH&&(t&&InternalEvent.addListener(e,"touchstart",t),i&&InternalEvent.addListener(e,"touchmove",i),s&&InternalEvent.addListener(e,"touchend",s))}static removeGestureListeners(e,t,i,s){t&&InternalEvent.removeListener(e,Client.IS_POINTER?"pointerdown":"mousedown",t),i&&InternalEvent.removeListener(e,Client.IS_POINTER?"pointermove":"mousemove",i),s&&InternalEvent.removeListener(e,Client.IS_POINTER?"pointerup":"mouseup",s),!Client.IS_POINTER&&Client.IS_TOUCH&&(t&&InternalEvent.removeListener(e,"touchstart",t),i&&InternalEvent.removeListener(e,"touchmove",i),s&&InternalEvent.removeListener(e,"touchend",s))}static redirectMouseEvents(e,t,i=null,s=null,n=null,a=null,l=null){let r=e=>"function"==typeof i?i(e):i;InternalEvent.addGestureListeners(e,e=>{s?s(e):isConsumed(e)||t.fireMouseEvent(InternalEvent.MOUSE_DOWN,new InternalMouseEvent(e,r(e)))},e=>{n?n(e):isConsumed(e)||t.fireMouseEvent(InternalEvent.MOUSE_MOVE,new InternalMouseEvent(e,r(e)))},e=>{a?a(e):isConsumed(e)||t.fireMouseEvent(InternalEvent.MOUSE_UP,new InternalMouseEvent(e,r(e)))}),InternalEvent.addListener(e,"dblclick",e=>{if(l)l(e);else if(!isConsumed(e)){let i=r(e);t.dblClick(e,null==i?void 0:i.cell)}})}static release(e){try{InternalEvent.removeAllListeners(e);let t=e.childNodes;if(void 0!==t){let e=t.length;for(let i=0;i<e;i+=1)InternalEvent.release(t[i])}}catch(e){}}static addMouseWheelListener(e,t){if(null!=e){let i=t=>{t.ctrlKey&&t.preventDefault(),(Math.abs(t.deltaX)>.5||Math.abs(t.deltaY)>.5)&&e(t,0==t.deltaY?-t.deltaX>0:-t.deltaY>0)};if(t=null!=t?t:window,Client.IS_SF&&!Client.IS_TOUCH){let i=1;InternalEvent.addListener(t,"gesturestart",e=>{InternalEvent.consume(e),i=1}),InternalEvent.addListener(t,"gesturechange",t=>{if(InternalEvent.consume(t),"number"==typeof t.scale){let s=i-t.scale;Math.abs(s)>.2&&(e(t,s<0,!0),i=t.scale)}}),InternalEvent.addListener(t,"gestureend",e=>{InternalEvent.consume(e)})}else{let i=[],s=0,n=0;InternalEvent.addGestureListeners(t,e=>{isMouseEvent(e)||null==e.pointerId||i.push(e)},t=>{if(!isMouseEvent(t)&&2==i.length){for(let e=0;e<i.length;e+=1)if(t.pointerId==i[e].pointerId){i[e]=t;break}let a=Math.abs(i[0].clientX-i[1].clientX),l=Math.abs(i[0].clientY-i[1].clientY),r=Math.abs(a-s),o=Math.abs(l-n);if(r>InternalEvent.PINCH_THRESHOLD||o>InternalEvent.PINCH_THRESHOLD){let t=i[0].clientX+(i[1].clientX-i[0].clientX)/2,h=i[0].clientY+(i[1].clientY-i[0].clientY)/2;e(i[0],r>o?a>s:l>n,!0,t,h),s=a,n=l}}},e=>{i=[],s=0,n=0})}InternalEvent.addListener(t,"wheel",i)}}static disableContextMenu(e){InternalEvent.addListener(e,"contextmenu",e=>(e.preventDefault&&e.preventDefault(),!1))}static consume(e,t=!0,i=!0){t&&(e.preventDefault?(i&&e.stopPropagation(),e.preventDefault()):i&&(e.cancelBubble=!0)),e.isConsumed=!0,e.preventDefault||(e.returnValue=!1)}}InternalEvent.LABEL_HANDLE=-1,InternalEvent.ROTATION_HANDLE=-2,InternalEvent.CUSTOM_HANDLE=-100,InternalEvent.VIRTUAL_HANDLE=-1e5,InternalEvent.MOUSE_DOWN="mouseDown",InternalEvent.MOUSE_MOVE="mouseMove",InternalEvent.MOUSE_UP="mouseUp",InternalEvent.ACTIVATE="activate",InternalEvent.RESIZE_START="resizeStart",InternalEvent.RESIZE="resize",InternalEvent.RESIZE_END="resizeEnd",InternalEvent.MOVE_START="moveStart",InternalEvent.MOVE="move",InternalEvent.MOVE_END="moveEnd",InternalEvent.PAN_START="panStart",InternalEvent.PAN="pan",InternalEvent.PAN_END="panEnd",InternalEvent.MINIMIZE="minimize",InternalEvent.NORMALIZE="normalize",InternalEvent.MAXIMIZE="maximize",InternalEvent.HIDE="hide",InternalEvent.SHOW="show",InternalEvent.CLOSE="close",InternalEvent.DESTROY="destroy",InternalEvent.REFRESH="refresh",InternalEvent.SIZE="size",InternalEvent.SELECT="select",InternalEvent.FIRED="fired",InternalEvent.FIRE_MOUSE_EVENT="fireMouseEvent",InternalEvent.GESTURE="gesture",InternalEvent.TAP_AND_HOLD="tapAndHold",InternalEvent.GET="get",InternalEvent.RECEIVE="receive",InternalEvent.CONNECT="connect",InternalEvent.DISCONNECT="disconnect",InternalEvent.SUSPEND="suspend",InternalEvent.RESUME="resume",InternalEvent.MARK="mark",InternalEvent.ROOT="root",InternalEvent.POST="post",InternalEvent.OPEN="open",InternalEvent.SAVE="save",InternalEvent.BEFORE_ADD_VERTEX="beforeAddVertex",InternalEvent.ADD_VERTEX="addVertex",InternalEvent.AFTER_ADD_VERTEX="afterAddVertex",InternalEvent.DONE="done",InternalEvent.EXECUTE="execute",InternalEvent.EXECUTED="executed",InternalEvent.BEGIN_UPDATE="beginUpdate",InternalEvent.START_EDIT="startEdit",InternalEvent.END_UPDATE="endUpdate",InternalEvent.END_EDIT="endEdit",InternalEvent.BEFORE_UNDO="beforeUndo",InternalEvent.UNDO="undo",InternalEvent.REDO="redo",InternalEvent.CHANGE="change",InternalEvent.NOTIFY="notify",InternalEvent.LAYOUT_CELLS="layoutCells",InternalEvent.CLICK="click",InternalEvent.SCALE="scale",InternalEvent.TRANSLATE="translate",InternalEvent.SCALE_AND_TRANSLATE="scaleAndTranslate",InternalEvent.UP="up",InternalEvent.DOWN="down",InternalEvent.ADD="add",InternalEvent.REMOVE="remove",InternalEvent.CLEAR="clear",InternalEvent.ADD_CELLS="addCells",InternalEvent.CELLS_ADDED="cellsAdded",InternalEvent.MOVE_CELLS="moveCells",InternalEvent.CELLS_MOVED="cellsMoved",InternalEvent.RESIZE_CELLS="resizeCells",InternalEvent.CELLS_RESIZED="cellsResized",InternalEvent.TOGGLE_CELLS="toggleCells",InternalEvent.CELLS_TOGGLED="cellsToggled",InternalEvent.ORDER_CELLS="orderCells",InternalEvent.CELLS_ORDERED="cellsOrdered",InternalEvent.REMOVE_CELLS="removeCells",InternalEvent.CELLS_REMOVED="cellsRemoved",InternalEvent.GROUP_CELLS="groupCells",InternalEvent.UNGROUP_CELLS="ungroupCells",InternalEvent.REMOVE_CELLS_FROM_PARENT="removeCellsFromParent",InternalEvent.FOLD_CELLS="foldCells",InternalEvent.CELLS_FOLDED="cellsFolded",InternalEvent.ALIGN_CELLS="alignCells",InternalEvent.LABEL_CHANGED="labelChanged",InternalEvent.CONNECT_CELL="connectCell",InternalEvent.CELL_CONNECTED="cellConnected",InternalEvent.SPLIT_EDGE="splitEdge",InternalEvent.FLIP_EDGE="flipEdge",InternalEvent.START_EDITING="startEditing",InternalEvent.EDITING_STARTED="editingStarted",InternalEvent.EDITING_STOPPED="editingStopped",InternalEvent.ADD_OVERLAY="addOverlay",InternalEvent.REMOVE_OVERLAY="removeOverlay",InternalEvent.UPDATE_CELL_SIZE="updateCellSize",InternalEvent.ESCAPE="escape",InternalEvent.DOUBLE_CLICK="doubleClick",InternalEvent.START="start",InternalEvent.RESET="reset",InternalEvent.PINCH_THRESHOLD=10;class Point{constructor(e=0,t=0){this._x=0,this._y=0,this.x=e,this.y=t}get x(){return this._x}set x(e){if(Number.isNaN(e))throw Error("Invalid x supplied.");this._x=e}get y(){return this._y}set y(e){if(Number.isNaN(e))throw Error("Invalid y supplied.");this._y=e}equals(e){return!!e&&e.x===this.x&&e.y===this.y}clone(){return new Point(this.x,this.y)}}class Rectangle extends Point{constructor(e=0,t=0,i=0,s=0){super(e,t),this._width=0,this._height=0,this.width=i,this.height=s}get width(){return this._width}set width(e){if(Number.isNaN(e))throw Error("Invalid width supplied.");this._width=e}get height(){return this._height}set height(e){if(Number.isNaN(e))throw Error("Invalid height supplied.");this._height=e}setRect(e,t,i,s){this.x=e,this.y=t,this.width=i,this.height=s}getCenterX(){return this.x+this.width/2}getCenterY(){return this.y+this.height/2}add(e){let t=Math.min(this.x,e.x),i=Math.min(this.y,e.y),s=Math.max(this.x+this.width,e.x+e.width),n=Math.max(this.y+this.height,e.y+e.height);this.x=t,this.y=i,this.width=s-t,this.height=n-i}intersect(e){let t=this.x+this.width,i=e.x+e.width,s=this.y+this.height,n=e.y+e.height;this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.width=Math.min(t,i)-this.x,this.height=Math.min(s,n)-this.y}grow(e){this.x-=e,this.y-=e,this.width+=2*e,this.height+=2*e}getPoint(){return new Point(this.x,this.y)}rotate90(){let e=(this.width-this.height)/2;this.x+=e,this.y-=e;let t=this.width;this.width=this.height,this.height=t}equals(e){return!!e&&e.x===this.x&&e.y===this.y&&e.width===this.width&&e.height===this.height}clone(){return new Rectangle(this.x,this.y,this.width,this.height)}}Rectangle.fromRectangle=e=>new Rectangle(e.x,e.y,e.width,e.height);let ltrim=(e,t="\\s")=>null!=e?e.replace(RegExp(`^[${t}]+`,"g"),""):null,rtrim=(e,t="\\s")=>null!=e?e.replace(RegExp(`[${t}]+$`,"g"),""):null,trim=(e,t)=>ltrim(rtrim(e,t),t),getFunctionName=e=>{let t=null;if(null!=e){if(null!=e.name)t=e.name;else if(null!==(t=trim(e.toString()))&&/^function\s/.test(t)&&null!==(t=ltrim(t.substring(9)))){let e=t.indexOf("(");e>0&&(t=t.substring(0,e))}}return t},replaceTrailingNewlines=(e,t)=>{let i="";for(;e.length>0&&"\n"==e.charAt(e.length-1);)e=e.substring(0,e.length-1),i+=t;return e+i},removeWhitespace=(e,t)=>{var i,s;let n=t?e.previousSibling:e.nextSibling;for(;null!=n&&n.nodeType===NODETYPE.TEXT;){let e=t?n.previousSibling:n.nextSibling;(null==(i=trim(getTextContent(n)))?void 0:i.length)===0&&(null==(s=n.parentNode)||s.removeChild(n)),n=e}},htmlEntities=(e,t=!0)=>(e=(e=(e=(e=(e=(e=String(e||"")).replace(/&/g,"&amp;")).replace(/"/g,"&quot;")).replace(/'/g,"&#39;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;"),t&&(e=e.replace(/\n/g,"&#xa;")),e),toString=e=>{let t="";for(let i in e)try{if(null==e[i])t+=`${i} = [null]
`;else if("function"==typeof e[i])t+=`${i} => [Function]
`;else if("object"==typeof e[i]){let s=getFunctionName(e[i].constructor);t+=`${i} => [${s}]
`}else t+=`${i} = ${e[i]}
`}catch(e){t+=`${i}=${e.message}`}return t},StringUtils=Object.freeze(Object.defineProperty({__proto__:null,getFunctionName:getFunctionName,htmlEntities:htmlEntities,ltrim:ltrim,removeWhitespace:removeWhitespace,replaceTrailingNewlines:replaceTrailingNewlines,rtrim:rtrim,toString:toString,trim:trim},Symbol.toStringTag,{value:"Module"}));class ObjectIdentity{static get(e){if(e){if(null===e[IDENTITY_FIELD_NAME]||void 0===e[IDENTITY_FIELD_NAME])if("object"==typeof e){let t=getFunctionName(e.constructor);e[IDENTITY_FIELD_NAME]=`${t}#${ObjectIdentity.counter++}`}else"function"==typeof e&&(e[IDENTITY_FIELD_NAME]=`Function#${ObjectIdentity.counter++}`);return e[IDENTITY_FIELD_NAME]}return null}static clear(e){delete e[IDENTITY_FIELD_NAME]}}ObjectIdentity.FIELD_NAME=IDENTITY_FIELD_NAME,ObjectIdentity.counter=0;class Dictionary{constructor(){this.map={},this.clear()}clear(){this.map={}}get(e){let t=ObjectIdentity.get(e);return this.map[t]??null}put(e,t){let i=ObjectIdentity.get(e),s=this.map[i];return this.map[i]=t,s??null}remove(e){let t=ObjectIdentity.get(e),i=this.map[t];return delete this.map[t],i??null}getKeys(){let e=[];for(let t in this.map)e.push(t);return e}getValues(){let e=[];for(let t in this.map)e.push(this.map[t]);return e}visit(e){for(let t in this.map)e(t,this.map[t])}}let getElapseMillisecondsMessage=e=>e?` (${new Date().getTime()-e} ms)`:"";class NoOpLogger{debug(e){}enter(e){}error(e,...t){}info(e){}leave(e,t){}show(){}trace(e){}warn(e){}}class ConsoleLogger{constructor(){this.debugEnabled=!1,this.infoEnabled=!1,this.traceEnabled=!1}enter(e){if(this.traceEnabled)return console.trace(`Entering ${e}`),new Date().getTime()}leave(e,t){if(this.traceEnabled){let i=getElapseMillisecondsMessage(t);console.trace(`Leaving ${e}${i}`)}}show(){}trace(e){this.traceEnabled&&console.trace(e)}debug(e){this.debugEnabled&&console.debug(e)}info(e){this.infoEnabled&&console.info(e)}warn(e){console.warn(e)}error(e,...t){console.error(e,...t)}}let shallowCopy=(e,t)=>{for(let i in e)if(Object.prototype.hasOwnProperty.call(e,i)){let s=e[i];Array.isArray(s)?t[i]=[...s]:t[i]=s}};class NoOpI18n{isEnabled(){return!1}get(){return null}addResource(){}}let GlobalConfig={i18n:new NoOpI18n,logger:new NoOpLogger},StyleDefaultsConfig={shadowColor:SHADOWCOLOR,shadowOffsetX:SHADOW_OFFSET_X,shadowOffsetY:SHADOW_OFFSET_Y,shadowOpacity:SHADOW_OPACITY},defaultStyleDefaultsConfig={...StyleDefaultsConfig},resetStyleDefaultsConfig=()=>{shallowCopy(defaultStyleDefaultsConfig,StyleDefaultsConfig)},doEval=expression=>eval(expression),isElement=e=>(null==e?void 0:e.nodeType)===NODETYPE.ELEMENT,isNullish=e=>null==e,mixInto=e=>t=>{let i=Reflect.ownKeys(t);try{for(let s of i)Object.defineProperty(e.prototype,s,{value:t[s],writable:!0})}catch(e){GlobalConfig.logger.error("Error while mixing",e)}},matchBinaryMask=(e,t)=>(e&t)===t,toRadians=e=>Math.PI*e/180,toDegree=e=>180*e/Math.PI,arcToCurves=(e,t,i,s,n,a,l,r,o)=>{let h;if(r-=e,o-=t,0===i||0===s)return[];let c=l,d=n,u=-r/2,p=-o/2,g=Math.cos(d*Math.PI/180),m=Math.sin(d*Math.PI/180),f=g*u+m*p,x=-1*m*u+g*p,v=f*f,b=x*x,y=(i=Math.abs(i))*i,w=(s=Math.abs(s))*s,C=v/y+b/w;if(C>1)i=Math.sqrt(C)*i,s=Math.sqrt(C)*s,h=0;else{let e=1;a===c&&(e=-1),h=e*Math.sqrt((y*w-y*b-w*v)/(y*b+w*v))}let E=h*i*x/s,S=-1*h*s*f/i,T=g*E-m*S+r/2,M=m*E+g*S+o/2,A=Math.atan2((x-S)/s,(f-E)/i)-Math.atan2(0,1),P=A>=0?A:2*Math.PI+A,L=(A=Math.atan2((-x-S)/s,(-f-E)/i)-Math.atan2((x-S)/s,(f-E)/i))>=0?A:2*Math.PI+A;!c&&L>0?L-=2*Math.PI:c&&L<0&&(L+=2*Math.PI);let k=2*L/Math.PI,H=Math.ceil(k<0?-1*k:k),O=L/H,R=8/3*Math.sin(O/4)*Math.sin(O/4)/Math.sin(O/2),I=g*i,D=g*s,N=m*i,V=m*s,B=Math.cos(P),z=Math.sin(P),G=-R*(I*z+V*B),F=-R*(N*z-D*B),U=0,_=0,j=[];for(let i=0;i<H;++i){P+=O,U=I*(B=Math.cos(P))-V*(z=Math.sin(P))+T,_=N*B+D*z+M;let s=-R*(I*z+V*B),n=-R*(N*z-D*B),a=6*i;j[a]=Number(G+e),j[a+1]=Number(F+t),j[a+2]=Number(U-s+e),j[a+3]=Number(_-n+t),j[a+4]=Number(U+e),j[a+5]=Number(_+t),G=U+s,F=_+n}return j},getBoundingBox=(e,t,i=null)=>{let s=null;if(e&&0!==t){let n=toRadians(t),a=Math.cos(n),l=Math.sin(n);i=null!=i?i:new Point(e.x+e.width/2,e.y+e.height/2);let r=new Point(e.x,e.y),o=new Point(e.x+e.width,e.y),h=new Point(o.x,e.y+e.height),c=new Point(e.x,h.y);r=getRotatedPoint(r,a,l,i),o=getRotatedPoint(o,a,l,i),h=getRotatedPoint(h,a,l,i),c=getRotatedPoint(c,a,l,i),(s=new Rectangle(r.x,r.y,0,0)).add(new Rectangle(o.x,o.y,0,0)),s.add(new Rectangle(h.x,h.y,0,0)),s.add(new Rectangle(c.x,c.y,0,0))}return s},getRotatedPoint=(e,t,i,s=new Point)=>{let n=e.x-s.x,a=e.y-s.y,l=n*t-a*i,r=a*t+n*i;return new Point(l+s.x,r+s.y)},getPortConstraints=(e,t,i,s)=>{let n=e.style.portConstraint??(i?t.style.sourcePortConstraint:t.style.targetPortConstraint);if(isNullish(n))return s;let a=n.toString(),l=DIRECTION_MASK.NONE,r=e.style.portConstraintRotation?e.style.rotation??0:0,o=0;if(r>45?(o=1,r>=135&&(o=2)):r<-45&&(o=3,r<=-135&&(o=2)),a.indexOf(DIRECTION.NORTH)>=0)switch(o){case 0:l|=DIRECTION_MASK.NORTH;break;case 1:l|=DIRECTION_MASK.EAST;break;case 2:l|=DIRECTION_MASK.SOUTH;break;case 3:l|=DIRECTION_MASK.WEST}if(a.indexOf(DIRECTION.WEST)>=0)switch(o){case 0:l|=DIRECTION_MASK.WEST;break;case 1:l|=DIRECTION_MASK.NORTH;break;case 2:l|=DIRECTION_MASK.EAST;break;case 3:l|=DIRECTION_MASK.SOUTH}if(a.indexOf(DIRECTION.SOUTH)>=0)switch(o){case 0:l|=DIRECTION_MASK.SOUTH;break;case 1:l|=DIRECTION_MASK.WEST;break;case 2:l|=DIRECTION_MASK.NORTH;break;case 3:l|=DIRECTION_MASK.EAST}if(a.indexOf(DIRECTION.EAST)>=0)switch(o){case 0:l|=DIRECTION_MASK.EAST;break;case 1:l|=DIRECTION_MASK.SOUTH;break;case 2:l|=DIRECTION_MASK.WEST;break;case 3:l|=DIRECTION_MASK.NORTH}return l},reversePortConstraints=e=>{let t=0;return(e&DIRECTION_MASK.WEST)<<3|(e&DIRECTION_MASK.NORTH)<<1|(e&DIRECTION_MASK.SOUTH)>>1|(e&DIRECTION_MASK.EAST)>>3},findNearestSegment=(e,t,i)=>{let s=-1;if(e.absolutePoints.length>0){let n=e.absolutePoints[0],a=null;for(let l=1;l<e.absolutePoints.length;l+=1){let r=e.absolutePoints[l];if(!n||!r)continue;let o=ptSegDistSq(n.x,n.y,r.x,r.y,t,i);(null==a||o<a)&&(a=o,s=l-1),n=r}}return s},getDirectedBounds=(e,t,i,s,n)=>{let a=(null==i?void 0:i.direction)??"east";if(s??(s=(null==i?void 0:i.flipH)??!1),n??(n=(null==i?void 0:i.flipV)??!1),t.x=Math.round(Math.max(0,Math.min(e.width,t.x))),t.y=Math.round(Math.max(0,Math.min(e.height,t.y))),t.width=Math.round(Math.max(0,Math.min(e.width,t.width))),t.height=Math.round(Math.max(0,Math.min(e.height,t.height))),n&&(a===DIRECTION.SOUTH||a===DIRECTION.NORTH)||s&&(a===DIRECTION.EAST||a===DIRECTION.WEST)){let e=t.x;t.x=t.width,t.width=e}if(s&&(a===DIRECTION.SOUTH||a===DIRECTION.NORTH)||n&&(a===DIRECTION.EAST||a===DIRECTION.WEST)){let e=t.y;t.y=t.height,t.height=e}let l=Rectangle.fromRectangle(t);return a===DIRECTION.SOUTH?(l.y=t.x,l.x=t.height,l.width=t.y,l.height=t.width):a===DIRECTION.WEST?(l.y=t.height,l.x=t.width,l.width=t.x,l.height=t.y):a===DIRECTION.NORTH&&(l.y=t.width,l.x=t.y,l.width=t.height,l.height=t.x),new Rectangle(e.x+l.x,e.y+l.y,e.width-l.width-l.x,e.height-l.height-l.y)},getPerimeterPoint=(e,t,i)=>{let s=null;for(let n=0;n<e.length-1;n+=1){let a=intersection(e[n].x,e[n].y,e[n+1].x,e[n+1].y,t.x,t.y,i.x,i.y);if(null!=a){let e=i.x-a.x,t=i.y-a.y,n={p:a,distSq:t*t+e*e};null!=n&&(null==s||s.distSq>n.distSq)&&(s=n)}}return null!=s?s.p:null},rectangleIntersectsSegment=(e,t,i)=>{let s=e.y,n=e.x,a=s+e.height,l=n+e.width,r=t.x,o=i.x;if(t.x>i.x&&(r=i.x,o=t.x),o>l&&(o=l),r<n&&(r=n),r>o)return!1;let h=t.y,c=i.y,d=i.x-t.x;if(Math.abs(d)>1e-7){let e=(i.y-t.y)/d,s=t.y-e*t.x;h=e*r+s,c=e*o+s}if(h>c){let e=c;c=h,h=e}return c>a&&(c=a),h<s&&(h=s),!(h>c)},contains=(e,t,i)=>e.x<=t&&e.x+e.width>=t&&e.y<=i&&e.y+e.height>=i,intersects$1=(e,t)=>{let i=e.width,s=e.height,n=t.width,a=t.height;if(n<=0||a<=0||i<=0||s<=0)return!1;let l=e.x,r=e.y,o=t.x,h=t.y;return n+=o,a+=h,i+=l,s+=r,(n<o||n>l)&&(a<h||a>r)&&(i<l||i>o)&&(s<r||s>h)},intersectsHotspot=(e,t,i,s,n,a)=>{if(n=null!=n?n:0,a=null!=a?a:0,(s=null!=s?s:1)>0){let l=e.getCenterX(),r=e.getCenterY(),o=e.width,h=e.height,c=e.style,d=((null==c?void 0:c.startSize)??0)*e.view.scale;d>0&&((null==c?void 0:c.horizontal)??!0?(r=e.y+d/2,h=d):(l=e.x+d/2,o=d)),o=Math.max(n,o*s),h=Math.max(n,h*s),a>0&&(o=Math.min(o,a),h=Math.min(h,a));let u=new Rectangle(l-o/2,r-h/2,o,h),p=toRadians((null==c?void 0:c.rotation)??0);if(0!=p){let s=Math.cos(-p),n=Math.sin(-p),a=new Point(e.getCenterX(),e.getCenterY()),l=getRotatedPoint(new Point(t,i),s,n,a);t=l.x,i=l.y}return contains(u,t,i)}return!0},isNumeric=e=>!Number.isNaN(parseFloat(e))&&isFinite(+e)&&("string"!=typeof e||0>e.toLowerCase().indexOf("0x")),isInteger=e=>String(parseInt(e))===String(e),mod=(e,t)=>(e%t+t)%t,intersection=(e,t,i,s,n,a,l,r)=>{let o=(r-a)*(i-e)-(l-n)*(s-t),h=((l-n)*(t-a)-(r-a)*(e-n))/o,c=((i-e)*(t-a)-(s-t)*(e-n))/o;return h>=0&&h<=1&&c>=0&&c<=1?new Point(e+h*(i-e),t+h*(s-t)):null},ptSegDistSq=(e,t,i,s,n,a)=>{let l;i-=e,s-=t;let r=(n-=e)*i+(a-=t)*s;l=r<=0||(r=(n=i-n)*i+(a=s-a)*s)<=0?0:r*r/(i*i+s*s);let o=n*n+a*a-l;return o<0&&(o=0),o},ptLineDist=(e,t,i,s,n,a)=>Math.abs((s-t)*n-(i-e)*a+i*t-s*e)/Math.sqrt((s-t)*(s-t)+(i-e)*(i-e)),relativeCcw=(e,t,i,s,n,a)=>{i-=e,s-=t;let l=(n-=e)*s-(a-=t)*i;return 0==l&&(l=n*i+a*s)>0&&(n-=i,a-=s,(l=n*i+a*s)<0&&(l=0)),l<0?-1:+(l>0)},mathUtils=Object.freeze(Object.defineProperty({__proto__:null,arcToCurves:arcToCurves,contains:contains,findNearestSegment:findNearestSegment,getBoundingBox:getBoundingBox,getDirectedBounds:getDirectedBounds,getPerimeterPoint:getPerimeterPoint,getPortConstraints:getPortConstraints,getRotatedPoint:getRotatedPoint,intersection:intersection,intersects:intersects$1,intersectsHotspot:intersectsHotspot,isInteger:isInteger,isNumeric:isNumeric,mod:mod,ptLineDist:ptLineDist,ptSegDistSq:ptSegDistSq,rectangleIntersectsSegment:rectangleIntersectsSegment,relativeCcw:relativeCcw,reversePortConstraints:reversePortConstraints,toDegree:toDegree,toRadians:toRadians},Symbol.toStringTag,{value:"Module"}));class CellPath{constructor(){throw Error("Static class can't be instantiated!")}static create(e){let t="",i=e.getParent();for(;i;)t=i.getIndex(e)+CellPath.PATH_SEPARATOR+t,i=(e=i).getParent();let s=t.length;return s>1&&(t=t.substring(0,s-1)),t}static getParentPath(e){let t=e.lastIndexOf(CellPath.PATH_SEPARATOR);return t>=0?e.substring(0,t):e.length>0?"":null}static resolve(e,t){let i=e,s=t.split(CellPath.PATH_SEPARATOR);for(let e=0;e<s.length;e+=1)i=i.getChildAt(parseInt(s[e]));return i}static compare(e,t){let i=Math.min(e.length,t.length),s=0;for(let n=0;n<i;n+=1)if(e[n]!==t[n]){if(0===e[n].length||0===t[n].length)s=e[n]===t[n]?0:e[n]>t[n]?1:-1;else{let i=parseInt(e[n]),a=parseInt(t[n]);s=i===a?0:i>a?1:-1}break}if(0===s){let i=e.length,n=t.length;i!==n&&(s=i>n?1:-1)}return s}}CellPath.PATH_SEPARATOR=".";let removeCursors=e=>{e.style&&(e.style.cursor="");let t=e.children;if(t){let e=t.length;for(let i=0;i<e;i+=1)removeCursors(t[i])}},getCurrentStyle=e=>e&&"[object ShadowRoot]"!==e.toString()?window.getComputedStyle(e,""):null,parseCssNumber=e=>{"thin"===e?e="2":"medium"===e?e="4":"thick"===e&&(e="6");let t=parseFloat(e);return Number.isNaN(t)&&(t=0),t},setPrefixedStyle=(e,t,i)=>{let s=null;Client.IS_SF||Client.IS_GC?s="Webkit":Client.IS_MT&&(s="Moz"),e.setProperty(t,i),null!==s&&t.length>0&&(t=s+t.substring(0,1).toUpperCase()+t.substring(1),e.setProperty(t,i))},hasScrollbars=e=>{let t=getCurrentStyle(e);return!!t&&("scroll"===t.overflow||"auto"===t.overflow)},getDocumentSize=()=>{let e=document.body,t=document.documentElement;try{return new Rectangle(0,0,e.clientWidth??t.clientWidth,Math.max(e.clientHeight??0,t.clientHeight))}catch(e){return new Rectangle}},fit=e=>{let t=getDocumentSize(),i=e.offsetLeft,s=e.offsetWidth,n=getDocumentScrollOrigin(e.ownerDocument),a=n.x,l=n.y,r=a+t.width;i+s>r&&(e.style.left=`${Math.max(a,r-s)}px`);let o=e.offsetTop,h=e.offsetHeight,c=l+t.height;o+h>c&&(e.style.top=`${Math.max(l,c-h)}px`)},getOffset=(e,t=!1)=>{let i=0,s=0,n=!1,a=e,l=document.body,r=document.documentElement;for(;null!=a&&a!=l&&a!=r&&!n;){let e=getCurrentStyle(a);null!=e&&(n=n||"fixed"==e.position),a=a.parentNode}if(!t&&!n){let t=getDocumentScrollOrigin(e.ownerDocument);i+=t.x,s+=t.y}let o=e.getBoundingClientRect();return null!=o&&(i+=o.left,s+=o.top),new Point(i,s)},getDocumentScrollOrigin=e=>{let t=e.defaultView||e.parentWindow;return new Point(null!=t&&void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,null!=t&&void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop)},getScrollOrigin=(e=null,t=!1,i=!0)=>{let s=null!=e?e.ownerDocument:document,n=s.body,a=s.documentElement,l=new Point,r=!1;for(;null!=e&&e!=n&&e!=a;){Number.isNaN(e.scrollLeft)||Number.isNaN(e.scrollTop)||(l.x+=e.scrollLeft,l.y+=e.scrollTop);let i=getCurrentStyle(e);null!=i&&(r=r||"fixed"==i.position),e=t?e.parentNode:null}if(!r&&i){let e=getDocumentScrollOrigin(s);l.x+=e.x,l.y+=e.y}return l},convertPoint=(e,t,i)=>{let s=getScrollOrigin(e,!1),n=getOffset(e);return n.x-=s.x,n.y-=s.y,new Point(t-n.x,i-n.y)},setCellStyles=(e,t,i,s)=>{t.length>0&&e.batchUpdate(()=>{for(let n=0;n<t.length;n+=1){let a=t[n];if(a){let t=a.getClonedStyle();t[i]=s,e.setStyle(a,t)}}})},setCellStyleFlags=(e,t,i,s,n)=>{t.length>0&&e.batchUpdate(()=>{for(let a=0;a<t.length;a+=1){let l=t[a];if(l){let t=setStyleFlag(l.getClonedStyle(),i,s,n);e.setStyle(l,t)}}})},setStyleFlag=(e,t,i,s)=>{let n=e[t];return void 0===n?e[t]=void 0===s||s?i:0:void 0===s?e[t]=n^i:s?e[t]=n|i:e[t]=n&~i,e},setOpacity=(e,t)=>{e.style.opacity=String(t/100)},getSizeForString=(e,t=DEFAULT_FONTSIZE,i=DEFAULT_FONTFAMILY,s=null,n=null)=>{let a=document.createElement("div");if(a.style.fontFamily=i,a.style.fontSize=`${Math.round(t)}px`,a.style.lineHeight=`${Math.round(t*LINE_HEIGHT)}px`,null!==n){matchBinaryMask(n,FONT.BOLD)&&(a.style.fontWeight="bold"),matchBinaryMask(n,FONT.ITALIC)&&(a.style.fontWeight="italic");let e=[];matchBinaryMask(n,FONT.UNDERLINE)&&e.push("underline"),matchBinaryMask(n,FONT.STRIKETHROUGH)&&e.push("line-through"),e.length>0&&(a.style.textDecoration=e.join(" "))}a.style.position="absolute",a.style.visibility="hidden",a.style.display="inline-block",null!==s?(a.style.width=`${s}px`,a.style.whiteSpace="normal"):a.style.whiteSpace="nowrap",a.innerHTML=e,document.body.appendChild(a);let l=new Rectangle(0,0,a.offsetWidth,a.offsetHeight);return document.body.removeChild(a),l},sortCells=(e,t=!0)=>{let i=new Dictionary;return e.sort((e,s)=>{let n=i.get(e);null==n&&(n=CellPath.create(e).split(CellPath.PATH_SEPARATOR),i.put(e,n));let a=i.get(s);null==a&&(a=CellPath.create(s).split(CellPath.PATH_SEPARATOR),i.put(s,a));let l=CellPath.compare(n,a);return 0==l?0:l>0==t?1:-1}),e},getAlignmentAsPoint=(e,t)=>{let i=-.5,s=-.5;return e===ALIGN.LEFT?i=0:e===ALIGN.RIGHT&&(i=-1),t===ALIGN.TOP?s=0:t===ALIGN.BOTTOM&&(s=-1),new Point(i,s)},styleUtils=Object.freeze(Object.defineProperty({__proto__:null,convertPoint:convertPoint,fit:fit,getAlignmentAsPoint:getAlignmentAsPoint,getCurrentStyle:getCurrentStyle,getDocumentScrollOrigin:getDocumentScrollOrigin,getDocumentSize:getDocumentSize,getOffset:getOffset,getScrollOrigin:getScrollOrigin,getSizeForString:getSizeForString,hasScrollbars:hasScrollbars,parseCssNumber:parseCssNumber,removeCursors:removeCursors,setCellStyleFlags:setCellStyleFlags,setCellStyles:setCellStyles,setOpacity:setOpacity,setPrefixedStyle:setPrefixedStyle,setStyleFlag:setStyleFlag,sortCells:sortCells},Symbol.toStringTag,{value:"Module"}));class UrlConverter{constructor(){this.enabled=!0,this.baseUrl=null,this.baseDomain=null}updateBaseUrl(){this.baseDomain=`${location.protocol}//${location.host}`,this.baseUrl=this.baseDomain+location.pathname;let e=this.baseUrl.lastIndexOf("/");e>0&&(this.baseUrl=this.baseUrl.substring(0,e+1))}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}getBaseUrl(){return this.baseUrl}setBaseUrl(e){this.baseUrl=e}getBaseDomain(){return this.baseDomain}setBaseDomain(e){this.baseDomain=e}isRelativeUrl(e){return e&&"//"!==e.substring(0,2)&&"http://"!==e.substring(0,7)&&"https://"!==e.substring(0,8)&&"data:image"!==e.substring(0,10)&&"file://"!==e.substring(0,7)}convert(e){return this.isEnabled()&&this.isRelativeUrl(e)&&(this.getBaseUrl()||this.updateBaseUrl(),e="/"===e.charAt(0)?this.getBaseDomain()+e:this.getBaseUrl()+e),e}}let clone=function e(t,i=null,s=!1){s=null!=s&&s;let n=null;if(null!=t&&"function"==typeof t.constructor)for(let a in n=new t.constructor,t)a!=ObjectIdentity.FIELD_NAME&&(null==i||0>i.indexOf(a))&&(s||"object"!=typeof t[a]?n[a]=t[a]:n[a]=e(t[a]));return n},cloneUtils=Object.freeze(Object.defineProperty({__proto__:null,clone:clone},Symbol.toStringTag,{value:"Module"}));class AbstractCanvas2D{constructor(){this.state=this.createState(),this.states=[],this.path=[],this.rotateHtml=!0,this.lastX=0,this.lastY=0,this.moveOp="M",this.lineOp="L",this.quadOp="Q",this.curveOp="C",this.closeOp="Z",this.pointerEvents=!1,this.pointerEventsValue=null,this.addOp=(e,...t)=>{if(this.path.push(e),t.length>1){let e=this.state;for(let i=1;i<t.length;i+=2)this.lastX=t[i-1],this.lastY=t[i],this.path.push(this.format((this.lastX+e.dx)*e.scale)),this.path.push(this.format((this.lastY+e.dy)*e.scale))}},this.converter=this.createUrlConverter(),this.reset()}createUrlConverter(){return new UrlConverter}reset(){this.state=this.createState(),this.states=[]}createState(){return{dx:0,dy:0,scale:1,alpha:1,fillAlpha:1,strokeAlpha:1,fillColor:NONE,gradientFillAlpha:1,gradientColor:NONE,gradientAlpha:1,gradientDirection:DIRECTION.EAST,strokeColor:NONE,strokeWidth:1,dashed:!1,dashPattern:"3 3",fixDash:!1,lineCap:"flat",lineJoin:"miter",miterLimit:10,fontColor:"#000000",fontBackgroundColor:NONE,fontBorderColor:NONE,fontSize:DEFAULT_FONTSIZE,fontFamily:DEFAULT_FONTFAMILY,fontStyle:0,shadow:!1,shadowColor:StyleDefaultsConfig.shadowColor,shadowAlpha:StyleDefaultsConfig.shadowOpacity,shadowDx:StyleDefaultsConfig.shadowOffsetX,shadowDy:StyleDefaultsConfig.shadowOffsetY,rotation:0,rotationCx:0,rotationCy:0}}format(e){return Math.round(e)}rotatePoint(e,t,i,s,n){let a=Math.PI/180*i;return getRotatedPoint(new Point(e,t),Math.cos(a),Math.sin(a),new Point(s,n))}save(){this.states.push(this.state),this.state=clone(this.state)}restore(){let e=this.states.pop();e&&(this.state=e)}setLink(e){}scale(e){this.state.scale*=e,null!==this.state.strokeWidth&&(this.state.strokeWidth*=e)}translate(e,t){this.state.dx+=e,this.state.dy+=t}rotate(e,t,i,s,n){}setAlpha(e){this.state.alpha=e}setFillAlpha(e){this.state.fillAlpha=e}setStrokeAlpha(e){this.state.strokeAlpha=e}setFillColor(e){this.state.fillColor=e??NONE,this.state.gradientColor=NONE}setGradient(e,t,i,s,n,a,l,r=1,o=1){let h=this.state;h.fillColor=e,h.gradientFillAlpha=r,h.gradientColor=t,h.gradientAlpha=o,h.gradientDirection=l}setStrokeColor(e){this.state.strokeColor=e??NONE}setStrokeWidth(e){this.state.strokeWidth=e}setDashed(e,t=!1){this.state.dashed=e,this.state.fixDash=t}setDashPattern(e){this.state.dashPattern=e}setLineCap(e){this.state.lineCap=e}setLineJoin(e){this.state.lineJoin=e}setMiterLimit(e){this.state.miterLimit=e}setFontColor(e){this.state.fontColor=e??NONE}setFontBackgroundColor(e){this.state.fontBackgroundColor=e??NONE}setFontBorderColor(e){this.state.fontBorderColor=e??NONE}setFontSize(e){this.state.fontSize=e}setFontFamily(e){this.state.fontFamily=e}setFontStyle(e){this.state.fontStyle=e}setShadow(e){this.state.shadow=e}setShadowColor(e){this.state.shadowColor=e??NONE}setShadowAlpha(e){this.state.shadowAlpha=e}setShadowOffset(e,t){this.state.shadowDx=e,this.state.shadowDy=t}begin(){this.lastX=0,this.lastY=0,this.path=[]}moveTo(e,t){this.addOp(this.moveOp,e,t)}lineTo(e,t){this.addOp(this.lineOp,e,t)}quadTo(e,t,i,s){this.addOp(this.quadOp,e,t,i,s)}curveTo(e,t,i,s,n,a){this.addOp(this.curveOp,e,t,i,s,n,a)}arcTo(e,t,i,s,n,a,l){let r=arcToCurves(this.lastX,this.lastY,e,t,i,s,n,a,l);if(null!=r)for(let e=0;e<r.length;e+=6)this.curveTo(r[e],r[e+1],r[e+2],r[e+3],r[e+4],r[e+5])}close(e,t,i,s,n,a){this.addOp(this.closeOp)}}class TemporaryCellStates{constructor(e,t=1,i,s=null,n=null){this.view=e,this.oldValidateCellState=e.validateCellState,this.oldBounds=e.getGraphBounds(),this.oldStates=e.getStates(),this.oldScale=e.getScale(),this.oldDoRedrawShape=e.graph.cellRenderer.doRedrawShape,null!=n&&(e.graph.cellRenderer.doRedrawShape=t=>{let i=null==t?void 0:t.shape,s=i.paint;i.paint=e=>{let a=n(t);null!=a&&e.setLink(a),s.apply(i,[e]),null!=a&&e.setLink(null)},this.oldDoRedrawShape.apply(e.graph.cellRenderer,[t]),i.paint=s}),e.validateCellState=(t,i)=>null==t||null==s||s(t)?this.oldValidateCellState.apply(e,[t,i]):null,e.setStates(new Dictionary),e.setScale(t),e.resetValidationState();let a=null;for(let t of i){let i=e.getBoundingBox(e.validateCellState(e.validateCell(t)));null==a?a=i:a.add(i)}e.setGraphBounds(a||new Rectangle)}destroy(){let e=this.view;e.setScale(this.oldScale),e.setStates(this.oldStates),e.setGraphBounds(this.oldBounds),e.validateCellState=this.oldValidateCellState,e.graph.cellRenderer.doRedrawShape=this.oldDoRedrawShape}}let remove=(e,t)=>{let i=null;if("object"==typeof t){let s=t.indexOf(e);for(;s>=0;)t.splice(s,1),i=e,s=t.indexOf(e)}for(let s in t)t[s]==e&&(delete t[s],i=e);return i},equalPoints=(e,t)=>{if(!e&&t||e&&!t||e&&t&&e.length!=t.length)return!1;if(e&&t)for(let i=0;i<e.length;i+=1){let s=e[i];if(!s||s&&!s.equals(t[i]))return!1}return!0},equalEntries=(e,t)=>{let i=0;if(!e&&t||e&&!t||e&&t&&e.length!=t.length)return!1;if(e&&t){for(let e in t)i++;for(let s in e)if(i--,(!Number.isNaN(e[s])||!Number.isNaN(t[s]))&&e[s]!==t[s])return!1}return 0===i},removeDuplicates=e=>{let t=new Dictionary,i=[];for(let s=0;s<e.length;s+=1)t.get(e[s])||(i.push(e[s]),t.put(e[s],!0));return i};class Geometry extends Rectangle{constructor(e=0,t=0,i=0,s=0){super(e,t,i,s),this.TRANSLATE_CONTROL_POINTS=!0,this.alternateBounds=null,this.sourcePoint=null,this.targetPoint=null,this.points=null,this.offset=null,this.relative=!1}setRelative(e){this.relative=e}swap(){if(this.alternateBounds){let e=new Rectangle(this.x,this.y,this.width,this.height);this.x=this.alternateBounds.x,this.y=this.alternateBounds.y,this.width=this.alternateBounds.width,this.height=this.alternateBounds.height,this.alternateBounds=e}}getTerminalPoint(e){return e?this.sourcePoint:this.targetPoint}setTerminalPoint(e,t){return t?this.sourcePoint=e:this.targetPoint=e,e}rotate(e,t){let i=toRadians(e),s=Math.cos(i),n=Math.sin(i);if(!this.relative){let e=getRotatedPoint(new Point(this.getCenterX(),this.getCenterY()),s,n,t);this.x=Math.round(e.x-this.width/2),this.y=Math.round(e.y-this.height/2)}if(this.sourcePoint){let e=getRotatedPoint(this.sourcePoint,s,n,t);this.sourcePoint.x=Math.round(e.x),this.sourcePoint.y=Math.round(e.y)}if(this.targetPoint){let e=getRotatedPoint(this.targetPoint,s,n,t);this.targetPoint.x=Math.round(e.x),this.targetPoint.y=Math.round(e.y)}if(this.points){for(let e=0;e<this.points.length;e+=1)if(this.points[e]){let i=getRotatedPoint(this.points[e],s,n,t);this.points[e].x=Math.round(i.x),this.points[e].y=Math.round(i.y)}}}translate(e,t){if(this.relative||(this.x+=e,this.y+=t),this.sourcePoint&&(this.sourcePoint.x=this.sourcePoint.x+e,this.sourcePoint.y=this.sourcePoint.y+t),this.targetPoint&&(this.targetPoint.x=this.targetPoint.x+e,this.targetPoint.y=this.targetPoint.y+t),this.TRANSLATE_CONTROL_POINTS&&this.points)for(let i=0;i<this.points.length;i+=1)this.points[i]&&(this.points[i].x=this.points[i].x+e,this.points[i].y=this.points[i].y+t)}scale(e,t,i){if(this.sourcePoint&&(this.sourcePoint.x=this.sourcePoint.x*e,this.sourcePoint.y=this.sourcePoint.y*t),this.targetPoint&&(this.targetPoint.x=this.targetPoint.x*e,this.targetPoint.y=this.targetPoint.y*t),this.points)for(let i=0;i<this.points.length;i+=1)this.points[i]&&(this.points[i].x=this.points[i].x*e,this.points[i].y=this.points[i].y*t);this.relative||(this.x*=e,this.y*=t,i&&(t=e=Math.min(e,t)),this.width*=e,this.height*=t)}equals(e){var t,i,s,n;return!!e&&super.equals(e)&&this.relative===e.relative&&(null===this.sourcePoint&&null===e.sourcePoint||!!(null==(t=this.sourcePoint)?void 0:t.equals(e.sourcePoint)))&&(null===this.targetPoint&&null===e.targetPoint||!!(null==(i=this.targetPoint)?void 0:i.equals(e.targetPoint)))&&equalPoints(this.points,e.points)&&(null===this.alternateBounds&&null===e.alternateBounds||!!(null==(s=this.alternateBounds)?void 0:s.equals(e.alternateBounds)))&&(null===this.offset&&null===e.offset||!!(null==(n=this.offset)?void 0:n.equals(e.offset)))}clone(){return clone(this)}}class MaxXmlRequest{constructor(e,t=null,i="POST",s=!0,n=null,a=null){this.binary=!1,this.withCredentials=!1,this.request=null,this.decodeSimulateValues=!1,this.url=e,this.params=t,this.method=i||"POST",this.async=s,this.username=n,this.password=a}isBinary(){return this.binary}setBinary(e){this.binary=e}getText(){return this.request.responseText}isReady(){return 4===this.request.readyState}getDocumentElement(){let e=this.getXml();return null!=e?e.documentElement:null}getXml(){let e=this.request.responseXML;return(null==e||null==e.documentElement)&&(e=new DOMParser().parseFromString(this.request.responseText,"text/xml")),e}getStatus(){var e;return null==(e=this.request)?void 0:e.status}create(){let e=new XMLHttpRequest;return this.isBinary()&&e.overrideMimeType&&e.overrideMimeType("text/plain; charset=x-user-defined"),e}send(e=null,t=null,i=null,s=null){this.request=this.create(),null!=this.request&&(null!=e&&(this.request.onreadystatechange=()=>{this.isReady()&&(e(this),this.request.onreadystatechange=null)}),this.request.open(this.method,this.url,this.async,this.username,this.password),this.setRequestHeaders(this.request,this.params),window.XMLHttpRequest&&this.withCredentials&&(this.request.withCredentials="true"),window.XMLHttpRequest&&null!=i&&null!=s&&(this.request.timeout=i,this.request.ontimeout=s),this.request.send(this.params))}setRequestHeaders(e,t){null!=t&&e.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}simulate(e,t=null){let i=null;(e=e||document)===document&&(i=window.onbeforeunload,window.onbeforeunload=null);let s=e.createElement("form");s.setAttribute("method",this.method),s.setAttribute("action",this.url),null!=t&&s.setAttribute("target",t),s.style.display="none",s.style.visibility="hidden";let n=this.params,a=n.indexOf("&")>0?n.split("&"):n.split(" ");for(let t=0;t<a.length;t+=1){let i=a[t].indexOf("=");if(i>0){let n=a[t].substring(0,i),l=a[t].substring(i+1);this.decodeSimulateValues&&(l=decodeURIComponent(l));let r=e.createElement("textarea");r.setAttribute("wrap","off"),r.setAttribute("name",n),write(r,l),s.appendChild(r)}}e.body.appendChild(s),s.submit(),null!=s.parentNode&&s.parentNode.removeChild(s),null!=i&&(window.onbeforeunload=i)}}let load=e=>{let t=new MaxXmlRequest(e,null,"GET",!1);return t.send(),t},get=(e,t=null,i=null,s=!1,n=null,a=null,l=null)=>{let r=new MaxXmlRequest(e,null,"GET"),{setRequestHeaders:o}=r;return l&&(r.setRequestHeaders=(e,t)=>{for(let i in o.apply(void 0,[e,t]),l)e.setRequestHeader(i,l[i])}),null!=s&&r.setBinary(s),r.send(t,i,n,a),r},getAll=(e,t,i)=>{let s=e.length,n=[],a=0,l=()=>{0==a&&null!=i&&i(),a++};for(let i=0;i<e.length;i+=1)((e,i)=>{get(e,e=>{let a=e.getStatus();a<200||a>299?l():(n[i]=e,0==--s&&t(n))},l)})(e[i],i);0==s&&t(n)},post=(e,t=null,i,s=null)=>new MaxXmlRequest(e,t).send(i,s),submit=(e,t,i,s)=>new MaxXmlRequest(e,t).simulate(i,s),requestUtils=Object.freeze(Object.defineProperty({__proto__:null,get:get,getAll:getAll,load:load,post:post,submit:submit},Symbol.toStringTag,{value:"Module"}));class ObjectCodec{constructor(e,t=[],i=[],s={}){for(let n in this.template=e,this.exclude=t,this.idrefs=i,this.mapping=s,this.reverse={},this.mapping)this.reverse[this.mapping[n]]=n}getName(){return this.name??this.template.constructor.name}setName(e){this.name=e}cloneTemplate(){return new this.template.constructor}getFieldName(e){if(null!=e){let t=this.reverse[e];null!=t&&(e=t)}return e}getAttributeName(e){if(null!=e){let t=this.mapping[e];null!=t&&(e=t)}return e}isExcluded(e,t,i,s){return t==ObjectIdentity.FIELD_NAME||this.exclude.indexOf(t)>=0}isReference(e,t,i,s){return this.idrefs.indexOf(t)>=0}encode(e,t){let i=e.document.createElement(this.getName());return t=this.beforeEncode(e,t,i),this.encodeObject(e,t,i),this.afterEncode(e,t,i)}encodeObject(e,t,i){for(let s in e.setAttribute(i,"id",e.getId(t)),t){let n=s,a=t[n];null==a||this.isExcluded(t,n,a,!0)||(isInteger(n)&&(n=null),this.encodeValue(e,t,n,a,i))}}encodeValue(e,t,i,s,n){if(null!=s){if(null!=i&&this.isReference(t,i,s,!0)){let t=e.getId(s);if(null==t){GlobalConfig.logger.warn(`ObjectCodec.encode: No ID for ${this.getName()}.${i}=${s}`);return}s=t}(null==i||e.encodeDefaults||this.template[i]!=s)&&(i=this.getAttributeName(i),this.writeAttribute(e,t,i,s,n))}}writeAttribute(e,t,i,s,n){"object"!=typeof s?this.writePrimitiveAttribute(e,t,i,s,n):this.writeComplexAttribute(e,t,i,s,n)}writePrimitiveAttribute(e,t,i,s,n){if(s=this.convertAttributeToXml(e,t,i,s,n),null==i){let t=e.document.createElement("add");"function"==typeof s?t.appendChild(e.document.createTextNode(s)):e.setAttribute(t,"value",s),n.appendChild(t)}else"function"!=typeof s&&e.setAttribute(n,i,s)}writeComplexAttribute(e,t,i,s,n){let a=e.encode(s);null!=a?(null!=i&&a.setAttribute("as",i),n.appendChild(a)):GlobalConfig.logger.warn(`ObjectCodec.encode: No node for ${this.getName()}.${i}: ${s}`)}convertAttributeToXml(e,t,i,s,n){return this.isBooleanAttribute(e,t,i,s)&&(s=!0==s?"1":"0"),s}isBooleanAttribute(e,t,i,s){return void 0===s.length&&(!0==s||!1==s)}convertAttributeFromXml(e,t,i){let{value:s}=t;return this.isNumericAttribute(e,t,i)&&(Number.isNaN(s=parseFloat(s))||!Number.isFinite(s))&&(s=0),s}isNumericAttribute(e,t,i){return i.constructor===Geometry&&("x"===t.name||"y"===t.name||"width"===t.name||"height"===t.name)||i.constructor===Point&&("x"===t.name||"y"===t.name)||isNumeric(t.value)}beforeEncode(e,t,i){return t}afterEncode(e,t,i){return i}decode(e,t,i){let s=t.getAttribute("id"),n=e.objects[s];null==n&&(n=i||this.cloneTemplate(),null!=s&&e.putObject(s,n));let a=this.beforeDecode(e,t,n);return this.decodeNode(e,a,n),this.afterDecode(e,a,n)}decodeNode(e,t,i){null!=t&&(this.decodeAttributes(e,t,i),this.decodeChildren(e,t,i))}decodeAttributes(e,t,i){let s=t.attributes;if(null!=s)for(let t=0;t<s.length;t+=1)this.decodeAttribute(e,s[t],i)}isIgnoredAttribute(e,t,i){return"as"===t.nodeName||"id"===t.nodeName}decodeAttribute(e,t,i){if(!this.isIgnoredAttribute(e,t,i)){let s=t.nodeName,n=this.convertAttributeFromXml(e,t,i),a=this.getFieldName(s);if(this.isReference(i,a,n,!1)){let t=e.getObject(n);if(null==t){GlobalConfig.logger.warn(`ObjectCodec.decode: No object for ${this.getName()}.${s}=${n}`);return}n=t}this.isExcluded(i,s,n,!1)||(i[s]=n)}}decodeChildren(e,t,i){let s=t.firstChild;for(;s;){let t=s.nextSibling;isElement(s)&&!this.processInclude(e,s,i)&&this.decodeChild(e,s,i),s=t}}decodeChild(e,t,i){let s=this.getFieldName(t.getAttribute("as"));if(null==s||!this.isExcluded(i,s,t,!1)){let n=this.getFieldTemplate(i,s,t),a=null;"add"===t.nodeName?null==(a=t.getAttribute("value"))&&ObjectCodec.allowEval&&(a=doEval(getTextContent(t))):a=e.decode(t,n);try{this.addObjectValue(i,s,a,n)}catch(e){throw Error(`${e.message} for ${t.nodeName}`)}}}getFieldTemplate(e,t,i){let s=e[t];return s instanceof Array&&s.length>0&&(s=null),s}addObjectValue(e,t,i,s){null!=i&&i!==s&&(null!=t&&t.length>0?e[t]=i:e.push(i))}processInclude(e,t,i){if("include"===t.nodeName){let s=t.getAttribute("name");if(null!=s)try{let t=load(s).getDocumentElement();null!=t&&e.decode(t,i)}catch(e){}return!0}return!1}beforeDecode(e,t,i){return t}afterDecode(e,t,i){return i}}ObjectCodec.allowEval=!1;class CodecRegistry{static register(e,t=!0){if(null!=e){let i=e.getName();CodecRegistry.codecs[i]=e;let s=e.template.constructor.name;t&&s!==i&&CodecRegistry.addAlias(s,i)}return e}static addAlias(e,t){CodecRegistry.aliases[e]=t}static getCodec(e){if(null==e)return null;let t=null,i="string"==typeof e?e:e.name,s=CodecRegistry.aliases[i];if(null!=s&&(i=s),null==(t=CodecRegistry.codecs[i]??null))try{t=new ObjectCodec(new e),CodecRegistry.register(t)}catch(e){}return t}static getCodecByName(e){let t=CodecRegistry.codecs[e];if(!t){let i=CodecRegistry.aliases[e];i&&(t=CodecRegistry.codecs[i])}return t??null}}CodecRegistry.codecs={},CodecRegistry.aliases={};class Cell{constructor(e=null,t=null,i={}){this.invalidating=!1,this.onInit=null,this.overlays=[],this.id=null,this.value=null,this.geometry=null,this.style={},this.vertex=!1,this.edge=!1,this.connectable=!0,this.visible=!0,this.collapsed=!1,this.parent=null,this.source=null,this.target=null,this.children=[],this.edges=[],this.mxTransient=["id","value","parent","source","target","children","edges"],this.value=e,this.setGeometry(t),this.setStyle(i),this.onInit&&this.onInit()}getChildren(){return this.children||[]}getId(){return this.id}setId(e){this.id=e}getValue(){return this.value}setValue(e){this.value=e}valueChanged(e){let t=this.getValue();return this.setValue(e),t}getGeometry(){return this.geometry}setGeometry(e){this.geometry=e}getStyle(){return this.style}getClonedStyle(){return clone(this.getStyle())}setStyle(e){this.style=e}isVertex(){return this.vertex}setVertex(e){this.vertex=e}isEdge(){return this.edge}setEdge(e){this.edge=e}isConnectable(){return this.connectable}setConnectable(e){this.connectable=e}isVisible(){return this.visible}setVisible(e){this.visible=e}isCollapsed(){return this.collapsed}setCollapsed(e){this.collapsed=e}getParent(){return this.parent}setParent(e){this.parent=e}getTerminal(e=!1){return e?this.source:this.target}setTerminal(e,t){return t?this.source=e:this.target=e,e}getChildCount(){return this.children.length}getIndex(e){return null===e?-1:this.children.indexOf(e)}getChildAt(e){return this.children[e]}insert(e,t){return void 0===t&&(t=this.getChildCount(),e.getParent()===this&&t--),e.removeFromParent(),e.setParent(this),this.children.splice(t,0,e),e}remove(e){let t=null;return e>=0&&(t=this.getChildAt(e))&&(this.children.splice(e,1),t.setParent(null)),t}removeFromParent(){if(this.parent){let e=this.parent.getIndex(this);this.parent.remove(e)}}getEdgeCount(){return this.edges.length}getEdgeIndex(e){return this.edges.indexOf(e)}getEdgeAt(e){return this.edges[e]}insertEdge(e,t=!1){return e.removeFromTerminal(t),e.setTerminal(this,t),(0===this.edges.length||e.getTerminal(!t)!==this||0>this.edges.indexOf(e))&&this.edges.push(e),e}removeEdge(e,t=!1){if(null!=e){if(e.getTerminal(!t)!==this&&null!=this.edges){let t=this.getEdgeIndex(e);t>=0&&this.edges.splice(t,1)}e.setTerminal(null,t)}return e}removeFromTerminal(e){let t=this.getTerminal(e);t&&t.removeEdge(this,e)}hasAttribute(e){var t;let i=this.getValue();return isElement(i)&&i.hasAttribute?i.hasAttribute(e):!isNullish(null==(t=i.getAttribute)?void 0:t.call(i,e))}getAttribute(e,t){var i;let s=this.getValue();return(isElement(s)?null==(i=s.getAttribute)?void 0:i.call(s,e):null)??t}setAttribute(e,t){var i;let s=this.getValue();isElement(s)&&(null==(i=s.setAttribute)||i.call(s,e,t))}clone(){let e=clone(this,this.mxTransient);return e.setValue(this.cloneValue()),e}cloneValue(){let e=this.getValue();return isNullish(e)||("function"==typeof e.clone?e=e.clone():!isNullish(e.nodeType)&&e.cloneNode&&(e=e.cloneNode(!0))),e}getNearestCommonAncestor(e){let t=CellPath.create(e);if(t.length>0){let i=this,s=CellPath.create(i);if(t.length<s.length){i=e;let n=s;s=t,t=n}for(;i&&s;){let e=i.getParent();if(0===t.indexOf(s+CellPath.PATH_SEPARATOR)&&e)return i;s=CellPath.getParentPath(s),i=e}}return null}isAncestor(e){for(;e&&e!==this;)e=e.getParent();return e===this}getChildVertices(){return this.getChildCells(!0,!1)}getChildEdges(){return this.getChildCells(!1,!0)}getChildCells(e=!1,t=!1){let i=this.getChildCount(),s=[];for(let n=0;n<i;n+=1){let i=this.getChildAt(n);(!t&&!e||t&&i.isEdge()||e&&i.isVertex())&&s.push(i)}return s}getDirectedEdgeCount(e,t=null){let i=0,s=this.getEdgeCount();for(let n=0;n<s;n+=1){let s=this.getEdgeAt(n);s!==t&&s&&s.getTerminal(e)===this&&(i+=1)}return i}getConnections(){return this.getEdges(!0,!0,!1)}getIncomingEdges(){return this.getEdges(!0,!1,!1)}getOutgoingEdges(){return this.getEdges(!1,!0,!1)}getEdges(e=!0,t=!0,i=!0){let s=this.getEdgeCount(),n=[];for(let a=0;a<s;a+=1){let s=this.getEdgeAt(a),l=s.getTerminal(!0),r=s.getTerminal(!1);(i&&l===r||l!==r&&(e&&r===this||t&&l===this))&&n.push(s)}return n}getOrigin(){let e=new Point,t=this.getParent();if(t&&(e=t.getOrigin(),!this.isEdge())){let t=this.getGeometry();t&&(e.x+=t.x,e.y+=t.y)}return e}getDescendants(){return this.filterDescendants(null)}filterDescendants(e){let t=[];(null===e||e(this))&&t.push(this);let i=this.getChildCount();for(let s=0;s<i;s+=1){let i=this.getChildAt(s);t=t.concat(i.filterDescendants(e))}return t}getRoot(){let e=this,t=e;for(;e;)t=e,e=e.getParent();return t}}let createXmlDocument$1=()=>document.implementation.createDocument("","",null);class Codec{constructor(e=createXmlDocument$1()){this.elements=null,this.encodeDefaults=!1,this.document=e,this.objects={}}putObject(e,t){return this.objects[e]=t,t}getObject(e){let t=null;if(null!=e&&null==(t=this.objects[e])&&null==(t=this.lookup(e))){let i=this.getElementById(e);null!=i&&(t=this.decode(i))}return t}lookup(e){return null}getElementById(e){return this.updateElements(),this.elements[e]}updateElements(){null==this.elements&&(this.elements={},null!=this.document.documentElement&&this.addElement(this.document.documentElement))}addElement(e){if(isElement(e)){let t=e.getAttribute("id");if(null!=t){if(null==this.elements[t])this.elements[t]=e;else if(this.elements[t]!==e)throw Error(`${t}: Duplicate ID`)}}let t=e.firstChild;for(;null!=t;)this.addElement(t),t=t.nextSibling}getId(e){let t=null;return null!=e&&null==(t=this.reference(e))&&e instanceof Cell&&null==(t=e.getId())&&0===(t=CellPath.create(e)).length&&(t="root"),t}reference(e){return null}encode(e){let t=null;if(null!=e&&null!=e.constructor){let i=CodecRegistry.getCodec(e.constructor);null!=i?t=i.encode(this,e):isNode(e)?t=importNode(this.document,e,!0):GlobalConfig.logger.warn(`Codec.encode: No codec for ${getFunctionName(e.constructor)}`)}return t}decode(e,t){this.updateElements();let i=null;if(isElement(e)){let s=CodecRegistry.getCodecByName(e.nodeName);null!=s?i=s.decode(this,e,t):(i=e.cloneNode(!0)).removeAttribute("as")}return i}encodeCell(e,t,i){let s=this.encode(e);if(s&&t.appendChild(s),null==i||i){let i=e.getChildCount();for(let s=0;s<i;s+=1)this.encodeCell(e.getChildAt(s),t)}}isCellCodec(e){return null!=e&&"isCellCodec"in e&&e.isCellCodec()}decodeCell(e,t=!0){if(!isElement(e))return null;let i=CodecRegistry.getCodec(e.nodeName);if(!this.isCellCodec(i)){let t=e.firstChild;for(;null!=t&&!this.isCellCodec(i);)i=CodecRegistry.getCodec(t.nodeName),t=t.nextSibling}this.isCellCodec(i)||(i=CodecRegistry.getCodec(Cell));let s=null==i?void 0:i.decode(this,e);return t&&this.insertIntoGraph(s),s}insertIntoGraph(e){let{parent:t}=e,i=e.getTerminal(!0),s=e.getTerminal(!1);if(e.setTerminal(null,!1),e.setTerminal(null,!0),e.parent=null,null!=t)if(t===e)throw Error(`${t.id}: Self Reference`);else t.insert(e);null!=i&&i.insertEdge(e,!0),null!=s&&s.insertEdge(e,!1)}setAttribute(e,t,i){null!=t&&null!=i&&e.setAttribute(t,i)}}let createXmlDocument=()=>document.implementation.createDocument("","",null),parseXml=e=>new DOMParser().parseFromString(e,"text/xml"),getViewXml=(e,t=1,i=null,s=0,n=0)=>{null==i&&(i=[e.getDataModel().getRoot()]);let a=e.getView(),l=null,r=a.isEventsEnabled();a.setEventsEnabled(!1);let{drawPane:o}=a,{overlayPane:h}=a;e.dialect===DIALECT.SVG?(a.drawPane=document.createElementNS(NS_SVG,"g"),a.canvas.appendChild(a.drawPane),a.overlayPane=document.createElementNS(NS_SVG,"g")):(a.drawPane=a.drawPane.cloneNode(!1),a.canvas.appendChild(a.drawPane),a.overlayPane=a.overlayPane.cloneNode(!1)),a.canvas.appendChild(a.overlayPane);let c=a.getTranslate();a.translate=new Point(s,n);let d=new TemporaryCellStates(e.getView(),t,i);try{l=new Codec().encode(e.getView())}finally{d.destroy(),a.translate=c,a.canvas.removeChild(a.drawPane),a.canvas.removeChild(a.overlayPane),a.drawPane=o,a.overlayPane=h,a.setEventsEnabled(r)}return l},getXml=(e,t="&#xa;")=>{let i=new XMLSerializer().serializeToString(e);return i.replace(/\n/g,t)},getPrettyXml=(e,t="  ",i="",s="\n",n=null)=>{let a=[];if(null!=e)if(null!=e.namespaceURI&&e.namespaceURI!==n&&(n=e.namespaceURI,null==e.getAttribute("xmlns")&&e.setAttribute("xmlns",e.namespaceURI)),e.nodeType===NODETYPE.DOCUMENT)a.push(getPrettyXml(e.documentElement,t,i,s,n));else if(e.nodeType===NODETYPE.DOCUMENT_FRAGMENT){let l=e.firstChild;if(null!=l)for(;null!=l;)a.push(getPrettyXml(l,t,i,s,n)),l=l.nextSibling}else if(e.nodeType===NODETYPE.COMMENT){let t=getTextContent(e);t.length>0&&a.push(`${i}<!--${t}-->${s}`)}else if(e.nodeType===NODETYPE.TEXT){let t=trim(getTextContent(e));t&&t.length>0&&a.push(i+htmlEntities(t,!1)+s)}else if(e.nodeType===NODETYPE.CDATA){let t=getTextContent(e);t.length>0&&a.push(`${i}<![CDATA[${t}]]${s}`)}else{a.push(`${i}<${e.nodeName}`);let l=e.attributes;if(null!=l)for(let e=0;e<l.length;e+=1){let t=htmlEntities(l[e].value);a.push(` ${l[e].nodeName}="${t}"`)}let r=e.firstChild;if(null!=r){for(a.push(`>${s}`);null!=r;)a.push(getPrettyXml(r,t,i+t,s,n)),r=r.nextSibling;a.push(`${i}</${e.nodeName}>${s}`)}else a.push(` />${s}`)}return a.join("")},findNode=(e,t,i)=>{if(isElement(e)){let s=e.getAttribute(t);if(s&&s===i)return e}for(e=e.firstChild;e;){let s=findNode(e,t,i);if(s)return s;e=e.nextSibling}return null},xmlUtils=Object.freeze(Object.defineProperty({__proto__:null,createXmlDocument:createXmlDocument,findNode:findNode,getPrettyXml:getPrettyXml,getViewXml:getViewXml,getXml:getXml,parseXml:parseXml},Symbol.toStringTag,{value:"Module"})),useAbsoluteIds="function"==typeof DOMParser&&!Client.IS_CHROMEAPP&&!Client.IS_EDGE&&document.getElementsByTagName("base").length>0;class SvgCanvas2D extends AbstractCanvas2D{constructor(e,t){super(),this.defs=null,this.styleEnabled=!0,this.node=null,this.matchHtmlAlignment=!0,this.textEnabled=!0,this.foEnabled=!0,this.foAltText="[Object]",this.foOffset=0,this.textOffset=0,this.imageOffset=0,this.strokeTolerance=0,this.minStrokeWidth=1,this.refCount=0,this.lineHeightCorrection=1,this.pointerEventsValue="all",this.fontMetricsPadding=10,this.cacheOffsetSize=!0,this.originalRoot=null,this.root=e,this.gradients={},this.defs=null,this.styleEnabled=null!=t&&t;let i=null;if(e.ownerDocument!==document){let t=e;for(;t&&"svg"!==t.nodeName;)t=t.parentElement;i=t}i&&(i.getElementsByTagName("defs").length>0&&(this.defs=i.getElementsByTagName("defs")[0]),this.defs||(this.defs=this.createElement("defs"),null!=i.firstChild?i.insertBefore(this.defs,i.firstChild):i.appendChild(this.defs)),this.styleEnabled&&this.defs.appendChild(this.createStyle()))}format(e){return parseFloat(e.toFixed(2))}getBaseUrl(){let{href:e}=window.location,t=e.lastIndexOf("#");return t>0&&(e=e.substring(0,t)),e}reset(){super.reset(),this.gradients={}}end(){}createStyle(){let e=this.createElement("style");return e.setAttribute("type","text/css"),write(e,`svg{font-family:${DEFAULT_FONTFAMILY};font-size:${DEFAULT_FONTSIZE};fill:none;stroke-miterlimit:10}`),e}createElement(e,t){var i;return null==(i=this.root)?void 0:i.ownerDocument.createElementNS(t||NS_SVG,e)}getAlternateText(e,t,i,s,n,a,l,r,o,h,c,d,u){return isNullish(a)?null:this.foAltText}createAlternateContent(e,t,i,s,n,a,l,r,o,h,c,d,u){let p=this.getAlternateText(e,t,i,s,n,a,l,r,o,h,c,d,u),g=this.state;if(!isNullish(p)&&g.fontSize>0){let e=r===ALIGN.TOP?1:.3*(r!==ALIGN.BOTTOM),s=l===ALIGN.RIGHT?"end":l===ALIGN.LEFT?"start":"middle",n=this.createElement("text");n.setAttribute("x",String(Math.round(t+g.dx))),n.setAttribute("y",String(Math.round(i+g.dy+e*g.fontSize))),n.setAttribute("fill",g.fontColor||"black"),n.setAttribute("font-family",g.fontFamily),n.setAttribute("font-size",`${Math.round(g.fontSize)}px`),"start"!==s&&n.setAttribute("text-anchor",s);let a=g.fontStyle;matchBinaryMask(a,FONT.BOLD)&&n.setAttribute("font-weight","bold"),matchBinaryMask(a,FONT.ITALIC)&&n.setAttribute("font-style","italic");let o=[];return matchBinaryMask(a,FONT.UNDERLINE)&&o.push("underline"),matchBinaryMask(a,FONT.STRIKETHROUGH)&&o.push("line-through"),o.length>0&&n.setAttribute("text-decoration",o.join(" ")),write(n,p),n}return null}createGradientId(e,t,i,s,n){"#"===e.charAt(0)&&(e=e.substring(1)),"#"===t.charAt(0)&&(t=t.substring(1)),e=`${e.toLowerCase()}-${i}`,t=`${t.toLowerCase()}-${s}`;let a=null;if(null==n||n===DIRECTION.SOUTH)a="s";else if(n===DIRECTION.EAST)a="e";else{let i=e;e=t,t=i,n===DIRECTION.NORTH?a="s":n===DIRECTION.WEST&&(a="e")}return`mx-gradient-${e}-${t}-${a}`}getSvgGradient(e,t,i,s,n){let a=this.createGradientId(e,t,i,s,n),l=this.gradients[a];if(!l){let r=this.root.ownerSVGElement,o=0,h=`${a}-${o}`;if(r)for(l=r.ownerDocument.getElementById(h);l&&l.ownerSVGElement!==r;)h=`${a}-${o++}`,l=r.ownerDocument.getElementById(h);else h=`id${++this.refCount}`;!l&&((l=this.createSvgGradient(e,t,i,s,n)).setAttribute("id",h),this.defs?this.defs.appendChild(l):r&&r.appendChild(l)),this.gradients[a]=l}return l.getAttribute("id")}createSvgGradient(e,t,i,s,n){let a=this.createElement("linearGradient");a.setAttribute("x1","0%"),a.setAttribute("y1","0%"),a.setAttribute("x2","0%"),a.setAttribute("y2","0%"),null==n||n===DIRECTION.SOUTH?a.setAttribute("y2","100%"):n===DIRECTION.EAST?a.setAttribute("x2","100%"):n===DIRECTION.NORTH?a.setAttribute("y1","100%"):n===DIRECTION.WEST&&a.setAttribute("x1","100%");let l=i<1?`;stop-opacity:${i}`:"",r=this.createElement("stop");return r.setAttribute("offset","0%"),r.setAttribute("style",`stop-color:${e}${l}`),a.appendChild(r),l=s<1?`;stop-opacity:${s}`:"",(r=this.createElement("stop")).setAttribute("offset","100%"),r.setAttribute("style",`stop-color:${t}${l}`),a.appendChild(r),a}addNode(e,t){let{node:i}=this,s=this.state;if(i){if("path"===i.nodeName)if(!this.path||!(this.path.length>0))return;else i.setAttribute("d",this.path.join(" "));e&&s.fillColor!==NONE?this.updateFill():this.styleEnabled||("ellipse"===i.nodeName&&Client.IS_FF?i.setAttribute("fill","transparent"):i.setAttribute("fill",NONE),e=!1),t&&s.strokeColor!==NONE?this.updateStroke():this.styleEnabled||i.setAttribute("stroke",NONE),s.transform&&s.transform.length>0&&i.setAttribute("transform",s.transform),s.shadow&&this.root.appendChild(this.createShadow(i)),this.strokeTolerance>0&&!e&&this.root.appendChild(this.createTolerance(i)),this.pointerEvents?i.setAttribute("pointer-events",this.pointerEventsValue):this.pointerEvents||this.originalRoot||i.setAttribute("pointer-events",NONE),("rect"!==i.nodeName&&"path"!==i.nodeName&&"ellipse"!==i.nodeName||i.getAttribute("fill")!==NONE&&"transparent"!==i.getAttribute("fill")||i.getAttribute("stroke")!==NONE||i.getAttribute("pointer-events")!==NONE)&&this.root.appendChild(i),this.node=null}}updateFill(){var e;let t=this.state;if((t.alpha<1||t.fillAlpha<1)&&this.node.setAttribute("fill-opacity",String(t.alpha*t.fillAlpha)),t.fillColor!==NONE)if(t.gradientColor!==NONE){let i=this.getSvgGradient(t.fillColor,t.gradientColor,t.gradientFillAlpha,t.gradientAlpha,t.gradientDirection);if((null==(e=this.root)?void 0:e.ownerDocument)===document&&useAbsoluteIds){let e=this.getBaseUrl().replace(/([()])/g,"\\$1");this.node.setAttribute("fill",`url(${e}#${i})`)}else this.node.setAttribute("fill",`url(#${i})`)}else this.node.setAttribute("fill",t.fillColor.toLowerCase())}getCurrentStrokeWidth(){return Math.max(this.minStrokeWidth,Math.max(.01,this.format(this.state.strokeWidth*this.state.scale)))}updateStroke(){let e=this.state;e.strokeColor&&e.strokeColor!==NONE&&this.node.setAttribute("stroke",e.strokeColor.toLowerCase()),(e.alpha<1||e.strokeAlpha<1)&&this.node.setAttribute("stroke-opacity",String(e.alpha*e.strokeAlpha));let t=this.getCurrentStrokeWidth();1!==t&&this.node.setAttribute("stroke-width",String(t)),"path"===this.node.nodeName&&this.updateStrokeAttributes(),e.dashed&&this.node.setAttribute("stroke-dasharray",this.createDashPattern((e.fixDash?1:e.strokeWidth)*e.scale))}updateStrokeAttributes(){let e=this.state;if(e.lineJoin&&"miter"!==e.lineJoin&&this.node.setAttribute("stroke-linejoin",e.lineJoin),e.lineCap){let t=e.lineCap;"flat"===t&&(t="butt"),"butt"!==t&&this.node.setAttribute("stroke-linecap",t)}null==e.miterLimit||this.styleEnabled&&10===e.miterLimit||this.node.setAttribute("stroke-miterlimit",String(e.miterLimit))}createDashPattern(e){let t=[];if("string"==typeof this.state.dashPattern){let i=this.state.dashPattern.split(" ");if(i.length>0)for(let s=0;s<i.length;s+=1)t[s]=Number(i[s])*e}return t.join(" ")}createTolerance(e){let t=e.cloneNode(!0),i=parseFloat(t.getAttribute("stroke-width")||"1")+this.strokeTolerance;return t.setAttribute("pointer-events","stroke"),t.setAttribute("visibility","hidden"),t.removeAttribute("stroke-dasharray"),t.setAttribute("stroke-width",String(i)),t.setAttribute("fill","none"),t.setAttribute("stroke","white"),t}createShadow(e){let t=e.cloneNode(!0),i=this.state;return"none"===t.getAttribute("fill")||Client.IS_FF&&"transparent"===t.getAttribute("fill")||t.setAttribute("fill",i.shadowColor),"none"!==t.getAttribute("stroke")&&i.shadowColor&&i.shadowColor!==NONE&&t.setAttribute("stroke",i.shadowColor),t.setAttribute("transform",`translate(${this.format(i.shadowDx*i.scale)},${this.format(i.shadowDy*i.scale)})${i.transform||""}`),t.setAttribute("opacity",String(i.shadowAlpha)),t}setLink(e){if(e){this.originalRoot=this.root;let t=this.createElement("a");null==t.setAttributeNS||this.root.ownerDocument!==document?t.setAttribute("xlink:href",e):t.setAttributeNS(NS_XLINK,"xlink:href",e),this.root.appendChild(t),this.root=t}else this.root=this.originalRoot}rotate(e,t,i,s,n){if(0!==e||t||i){let a=this.state;if(s+=a.dx,n+=a.dy,s*=a.scale,n*=a.scale,a.transform=a.transform||"",t&&i)e+=180;else if(t!==i){let e=t?s:0,l=t?-1:1,r=i?n:0,o=i?-1:1;a.transform+=`translate(${this.format(e)},${this.format(r)})scale(${this.format(l)},${this.format(o)})translate(${this.format(-e)},${this.format(-r)})`}(t?!i:i)&&(e*=-1),0!==e&&(a.transform+=`rotate(${this.format(e)},${this.format(s)},${this.format(n)})`),a.rotation+=e,a.rotationCx=s,a.rotationCy=n}}begin(){super.begin(),this.node=this.createElement("path")}rect(e,t,i,s){let n=this.state,a=this.createElement("rect");a.setAttribute("x",String(this.format((e+n.dx)*n.scale))),a.setAttribute("y",String(this.format((t+n.dy)*n.scale))),a.setAttribute("width",String(this.format(i*n.scale))),a.setAttribute("height",String(this.format(s*n.scale))),this.node=a}roundrect(e,t,i,s,n,a){this.rect(e,t,i,s),n>0&&this.node.setAttribute("rx",String(this.format(n*this.state.scale))),a>0&&this.node.setAttribute("ry",String(this.format(a*this.state.scale)))}ellipse(e,t,i,s){let n=this.state,a=this.createElement("ellipse");a.setAttribute("cx",String(this.format((e+i/2+n.dx)*n.scale))),a.setAttribute("cy",String(this.format((t+s/2+n.dy)*n.scale))),a.setAttribute("rx",String(i/2*n.scale)),a.setAttribute("ry",String(s/2*n.scale)),this.node=a}image(e,t,i,s,n,a=!0,l=!1,r=!1){n=this.converter.convert(n);let o=this.state;e+=o.dx,t+=o.dy;let h=this.createElement("image");h.setAttribute("x",String(this.format(e*o.scale)+this.imageOffset)),h.setAttribute("y",String(this.format(t*o.scale)+this.imageOffset)),h.setAttribute("width",String(this.format(i*o.scale))),h.setAttribute("height",String(this.format(s*o.scale))),h.setAttributeNS?h.setAttributeNS(NS_XLINK,"xlink:href",n):h.setAttribute("xlink:href",n),a||h.setAttribute("preserveAspectRatio","none"),(o.alpha<1||o.fillAlpha<1)&&h.setAttribute("opacity",String(o.alpha*o.fillAlpha));let c=this.state.transform||"";if(l||r){let n=1,a=1,h=0,d=0;l&&(n=-1,h=-i-2*e),r&&(a=-1,d=-s-2*t),c+=`scale(${n},${a})translate(${h*o.scale},${d*o.scale})`}c.length>0&&h.setAttribute("transform",c),this.pointerEvents||h.setAttribute("pointer-events","none"),this.root.appendChild(h)}convertHtml(e){let t=new DOMParser().parseFromString(e,"text/html");return null!=t&&("<body"===(e=new XMLSerializer().serializeToString(t.body)).substring(0,5)&&(e=e.substring(e.indexOf(">",5)+1)),"</body>"===e.substring(e.length-7,e.length)&&(e=e.substring(0,e.length-7))),e}createDiv(e){let t=e;if(isNode(t)||(t=`<div><div>${this.convertHtml(t)}</div></div>`),document.createElementNS){let e=document.createElementNS("http://www.w3.org/1999/xhtml","div");if(isNode(t)){let i=t,s=document.createElement("div"),n=s.cloneNode(!1);this.root.ownerDocument!==document?s.appendChild(i.cloneNode(!0)):s.appendChild(i),n.appendChild(s),e.appendChild(n)}else e.innerHTML=t;return e}return isNode(t)&&(t=`<div><div>${getXml(t)}</div></div>`),t=`<div xmlns="http://www.w3.org/1999/xhtml">${t}</div>`,new DOMParser().parseFromString(t,"text/xml").documentElement}updateText(e,t,i,s,n,a,l,r,o,h,c){c&&c.firstChild&&c.firstChild.firstChild&&this.updateTextNodes(e,t,i,s,n,a,l,r,o,h,c.firstChild)}addForeignObject(e,t,i,s,n,a,l,r,o,h,c,d,u,p,g){var m;let f=this.createElement("g"),x=this.createElement("foreignObject");if(x.setAttribute("style","overflow: visible; text-align: left;"),x.setAttribute("pointer-events","none"),x.appendChild(p),f.appendChild(x),this.updateTextNodes(e,t,i,s,a,l,r,h,c,d,f),(null==(m=this.root)?void 0:m.ownerDocument)!==document){let u=this.createAlternateContent(x,e,t,i,s,n,a,l,r,o,h,c,d);if(null!=u){x.setAttribute("requiredFeatures","http://www.w3.org/TR/SVG11/feature#Extensibility");let e=this.createElement("switch");e.appendChild(x),e.appendChild(u),f.appendChild(e)}}g.appendChild(f)}updateTextNodes(e,t,i,s,n,a,l,r,o,h,c){let d=this.state.scale;SvgCanvas2D.createCss(i+2,s,n,a,l,r,o,null!=this.state.fontBackgroundColor?this.state.fontBackgroundColor:null,null!=this.state.fontBorderColor?this.state.fontBorderColor:null,`display: flex; align-items: unsafe ${a===ALIGN.TOP?"flex-start":a===ALIGN.BOTTOM?"flex-end":"center"}; justify-content: unsafe ${n===ALIGN.LEFT?"flex-start":n===ALIGN.RIGHT?"flex-end":"center"}; `,this.getTextCss(),d,(i,s,n,a,l)=>{e+=this.state.dx,t+=this.state.dy;let r=c.firstChild,o=r.firstChild,u=o.firstChild,p=u.firstChild,g=(this.rotateHtml?this.state.rotation:0)+(null!=h?h:0),m=(0!==this.foOffset?`translate(${this.foOffset} ${this.foOffset})`:"")+(1!==d?`scale(${d})`:"");p.setAttribute("style",l),u.setAttribute("style",a),r.setAttribute("width",`${Math.ceil(1/Math.min(1,d)*100)}%`),r.setAttribute("height",`${Math.ceil(1/Math.min(1,d)*100)}%`);let f=Math.round(t+s);f<0?r.setAttribute("y",String(f)):(r.removeAttribute("y"),n+=`padding-top: ${f}px; `),o.setAttribute("style",`${n}margin-left: ${Math.round(e+i)}px;`),""!=(m+=0!==g?`rotate(${g} ${e} ${t})`:"")?c.setAttribute("transform",m):c.removeAttribute("transform"),1!==this.state.alpha?c.setAttribute("opacity",String(this.state.alpha)):c.removeAttribute("opacity")})}getTextCss(){let e=this.state,t=LINE_HEIGHT*this.lineHeightCorrection,i=`display: inline-block; font-size: ${e.fontSize}px; font-family: ${e.fontFamily}; color: ${e.fontColor}; line-height: ${t}; pointer-events: ${this.pointerEvents?this.pointerEventsValue:"none"}; `,s=e.fontStyle;matchBinaryMask(s,FONT.BOLD)&&(i+="font-weight: bold; "),matchBinaryMask(s,FONT.ITALIC)&&(i+="font-style: italic; ");let n=[];return matchBinaryMask(s,FONT.UNDERLINE)&&n.push("underline"),matchBinaryMask(s,FONT.STRIKETHROUGH)&&n.push("line-through"),n.length>0&&(i+=`text-decoration: ${n.join(" ")}; `),i}text(e,t,i,s,n,a,l,r,o,h,c,d=0,u){if(this.textEnabled&&null!=n)if(d=null!=d?d:0,this.foEnabled&&"html"===o){let p=this.createDiv(n);null!=p&&(null!=u&&p.setAttribute("dir",u),this.addForeignObject(e,t,i,s,n,a,l,r,o,h,c,d,u,p,this.root))}else this.plainText(e+this.state.dx,t+this.state.dy,i,s,n,a,l,r,h,c,d,u)}createClip(e,t,i,s){e=Math.round(e),t=Math.round(t),i=Math.round(i),s=Math.round(s);let n=`mx-clip-${e}-${t}-${i}-${s}`,a=0,l=`${n}-${a}`;for(;null!=document.getElementById(l);)l=`${n}-${++a}`;let r=this.createElement("clipPath");r.setAttribute("id",l);let o=this.createElement("rect");return o.setAttribute("x",String(e)),o.setAttribute("y",String(t)),o.setAttribute("width",String(i)),o.setAttribute("height",String(s)),r.appendChild(o),r}plainText(e,t,i,s,n,a,l,r,o,h,c=0,d){let u=this.state,p=u.fontSize,g=this.createElement("g"),m=u.transform||"";if(this.updateFont(g),this.pointerEvents||null!=this.originalRoot||g.setAttribute("pointer-events","none"),0!==c&&(m+=`rotate(${c},${this.format(e*u.scale)},${this.format(t*u.scale)})`),null!=d&&g.setAttribute("direction",d),h&&i>0&&s>0){let n=e,r=t;a===ALIGN.CENTER?n-=i/2:a===ALIGN.RIGHT&&(n-=i),"fill"!==o&&(l===ALIGN.MIDDLE?r-=s/2:l===ALIGN.BOTTOM&&(r-=s));let h=this.createClip(n*u.scale-2,r*u.scale-2,i*u.scale+4,s*u.scale+4);if(null!=this.defs?this.defs.appendChild(h):this.root.appendChild(h),Client.IS_CHROMEAPP||Client.IS_EDGE||this.root.ownerDocument!==document)g.setAttribute("clip-path",`url(#${h.getAttribute("id")})`);else{let e=this.getBaseUrl().replace(/([()])/g,"\\$1");g.setAttribute("clip-path",`url(${e}#${h.getAttribute("id")})`)}}let f=a===ALIGN.RIGHT?"end":a===ALIGN.CENTER?"middle":"start";"start"!==f&&g.setAttribute("text-anchor",f),this.styleEnabled&&p===DEFAULT_FONTSIZE||g.setAttribute("font-size",`${p*u.scale}px`),m.length>0&&g.setAttribute("transform",m),u.alpha<1&&g.setAttribute("opacity",String(u.alpha));let x=n.split("\n"),v=Math.round(p*LINE_HEIGHT),b=p+(x.length-1)*v,y=t+p-1;l===ALIGN.MIDDLE?"fill"===o?y-=s/2:y-=(this.matchHtmlAlignment&&h&&s>0?Math.min(b,s):b)/2:l===ALIGN.BOTTOM&&("fill"===o?y-=s:y-=(this.matchHtmlAlignment&&h&&s>0?Math.min(b,s):b)+1);for(let t=0;t<x.length;t+=1){let i=trim(x[t]);if(i){let t=this.createElement("text");t.setAttribute("x",String(this.format(e*u.scale)+this.textOffset)),t.setAttribute("y",String(this.format(y*u.scale)+this.textOffset)),write(t,i),g.appendChild(t)}y+=v}this.root.appendChild(g),this.addTextBackground(g,n,e,t,i,"fill"===o?s:b,a,l,o)}updateFont(e){let t=this.state;t.fontColor&&t.fontColor!==NONE&&e.setAttribute("fill",t.fontColor),this.styleEnabled&&t.fontFamily===DEFAULT_FONTFAMILY||e.setAttribute("font-family",t.fontFamily);let i=t.fontStyle;matchBinaryMask(i,FONT.BOLD)&&e.setAttribute("font-weight","bold"),matchBinaryMask(i,FONT.ITALIC)&&e.setAttribute("font-style","italic");let s=[];matchBinaryMask(i,FONT.UNDERLINE)&&s.push("underline"),matchBinaryMask(i,FONT.STRIKETHROUGH)&&s.push("line-through"),s.length>0&&e.setAttribute("text-decoration",s.join(" "))}addTextBackground(e,t,i,s,n,a,l,r,o){var h;let c=this.state;if(null!=c.fontBackgroundColor||null!=c.fontBorderColor){let d=null;if("fill"===o||"width"===o)l===ALIGN.CENTER?i-=n/2:l===ALIGN.RIGHT&&(i-=n),r===ALIGN.MIDDLE?s-=a/2:r===ALIGN.BOTTOM&&(s-=a),d=new Rectangle((i+1)*c.scale,s*c.scale,(n-2)*c.scale,(a+2)*c.scale);else if(null!=e.getBBox&&this.root.ownerDocument===document)try{d=e.getBBox(),d=new Rectangle(d.x,d.y+1,d.width,d.height+0)}catch(e){}if(null==d||0===d.width||0===d.height){let e=document.createElement("div");e.style.lineHeight=String(LINE_HEIGHT),e.style.fontSize=`${c.fontSize}px`,e.style.fontFamily=c.fontFamily,e.style.whiteSpace="nowrap",e.style.position="absolute",e.style.visibility="hidden",e.style.display="inline-block",matchBinaryMask(c.fontStyle,FONT.BOLD)&&(e.style.fontWeight="bold"),matchBinaryMask(c.fontStyle,FONT.ITALIC)&&(e.style.fontStyle="italic"),e.innerHTML=(t=htmlEntities(t,!1)).replace(/\n/g,"<br/>"),document.body.appendChild(e);let n=e.offsetWidth,a=e.offsetHeight;document.body.removeChild(e),l===ALIGN.CENTER?i-=n/2:l===ALIGN.RIGHT&&(i-=n),r===ALIGN.MIDDLE?s-=a/2:r===ALIGN.BOTTOM&&(s-=a),d=new Rectangle((i+1)*c.scale,(s+2)*c.scale,n*c.scale,(a+1)*c.scale)}if(null!=d){let t=this.createElement("rect");t.setAttribute("fill",c.fontBackgroundColor||"none"),t.setAttribute("stroke",c.fontBorderColor||"none"),t.setAttribute("x",String(Math.floor(d.x-1))),t.setAttribute("y",String(Math.floor(d.y-1))),t.setAttribute("width",String(Math.ceil(d.width+2))),t.setAttribute("height",String(Math.ceil(d.height)));let i=c.fontBorderColor?Math.max(1,this.format(c.scale)):0;t.setAttribute("stroke-width",String(i)),(null==(h=this.root)?void 0:h.ownerDocument)===document&&1===mod(i,2)&&t.setAttribute("transform","translate(0.5, 0.5)"),e.insertBefore(t,e.firstChild)}}}stroke(){this.addNode(!1,!0)}fill(){this.addNode(!0,!1)}fillAndStroke(){this.addNode(!0,!0)}}SvgCanvas2D.createCss=(e,t,i,s,n,a,l,r,o,h,c,d,u)=>{let p=`box-sizing: border-box; font-size: 0; text-align: ${i===ALIGN.LEFT?"left":i===ALIGN.RIGHT?"right":"center"}; `,g=getAlignmentAsPoint(i,s),m="overflow: hidden; ",f="width: 1px; ",x="height: 1px; ",v=g.x*e,b=g.y*t;l?(f=`width: ${Math.round(e)}px; `,p+=`max-height: ${Math.round(t)}px; `,b=0):"fill"===a?(c+="width: 100%; height: 100%; ",p+=(f=`width: ${Math.round(e)}px; `)+(x=`height: ${Math.round(t)}px; `)):"width"===a?(c+="width: 100%; ",p+=f=`width: ${Math.round(e)}px; `,b=0,t>0&&(p+=`max-height: ${Math.round(t)}px; `)):(m="",b=0);let y="";r&&(y+=`background-color: ${r}; `),o&&(y+=`border: 1px solid ${o}; `),""==m||l?c+=y:p+=y,n&&e>0?(c+=`white-space: normal; word-wrap: ${WORD_WRAP}; `,f=`width: ${Math.round(e)}px; `,""!==m&&"fill"!==a&&(b=0)):(c+="white-space: nowrap; ",""===m&&(v=0)),u(v,b,h+f+x,p+m,c,m)};class Shape{constructor(e=null){this.preserveImageAspect=!1,this.overlay=null,this.indicator=null,this.indicatorShape=null,this.opacity=100,this.isDashed=!1,this.fill=NONE,this.gradient=NONE,this.gradientDirection=DIRECTION.EAST,this.fillOpacity=100,this.strokeOpacity=100,this.stroke=NONE,this.strokeWidth=1,this.spacing=0,this.startSize=1,this.endSize=1,this.startArrow=NONE,this.endArrow=NONE,this.direction=DIRECTION.EAST,this.flipH=!1,this.flipV=!1,this.isShadow=!1,this.isRounded=!1,this.rotation=0,this.cursor="",this.verticalTextRotation=0,this.oldGradients={},this.glass=!1,this.dialect=null,this.scale=1,this.antiAlias=!0,this.minSvgStrokeWidth=1,this.bounds=null,this.points=[],this.state=null,this.style=null,this.boundingBox=null,this.stencil=null,this.svgStrokeTolerance=8,this.pointerEvents=!0,this.originalPointerEvents=null,this.svgPointerEvents="all",this.shapePointerEvents=!1,this.stencilPointerEvents=!1,this.outline=!1,this.visible=!0,this.useSvgBoundingBox=!0,this.image=null,this.imageSrc=null,this.indicatorColor=NONE,this.indicatorStrokeColor=NONE,this.indicatorGradientColor=NONE,this.indicatorDirection=DIRECTION.EAST,this.indicatorImageSrc=null,e&&(this.stencil=e),this.node=this.create()}init(e){this.node.parentNode||e.appendChild(this.node)}initStyles(){this.strokeWidth=1,this.rotation=0,this.opacity=100,this.fillOpacity=100,this.strokeOpacity=100,this.flipH=!1,this.flipV=!1}isHtmlAllowed(){return!1}getSvgScreenOffset(){return .5*(1===mod(Math.max(1,Math.round((this.stencil&&"inherit"!==this.stencil.strokeWidthValue?Number(this.stencil.strokeWidthValue):this.strokeWidth??0)*this.scale)),2))}create(){return document.createElementNS(NS_SVG,"g")}redraw(){this.updateBoundsFromPoints(),this.visible&&this.checkBounds()?(this.node.style.visibility="visible",this.clear(),this.redrawShape(),this.updateBoundingBox()):(this.node.style.visibility="hidden",this.boundingBox=null)}clear(){for(;this.node.lastChild;)this.node.removeChild(this.node.lastChild)}updateBoundsFromPoints(){let e=this.points;if(e.length>0&&e[0])for(let t of(this.bounds=new Rectangle(Math.round(e[0].x),Math.round(e[0].y),1,1),e))t&&this.bounds.add(new Rectangle(Math.round(t.x),Math.round(t.y),1,1))}getLabelBounds(e){var t,i,s;let n=(null==(t=this.style)?void 0:t.direction)??DIRECTION.EAST,a=e.clone();n!==DIRECTION.SOUTH&&n!==DIRECTION.NORTH&&this.state&&this.state.text&&this.state.text.isPaintBoundsInverted()&&(a=a.clone(),[a.width,a.height]=[a.height,a.width]);let l=this.getLabelMargins(a);if(l){l=l.clone();let t=(null==(i=this.style)?void 0:i.flipH)??!1,n=(null==(s=this.style)?void 0:s.flipV)??!1;if(this.state&&this.state.text&&this.state.text.isPaintBoundsInverted()){let e=l.x;l.x=l.height,l.height=l.width,l.width=l.y,l.y=e,[t,n]=[n,t]}return getDirectedBounds(e,l,this.style,t,n)}return e}getLabelMargins(e){return null}checkBounds(){return!Number.isNaN(this.scale)&&Number.isFinite(this.scale)&&this.scale>0&&this.bounds&&!Number.isNaN(this.bounds.x)&&!Number.isNaN(this.bounds.y)&&!Number.isNaN(this.bounds.width)&&!Number.isNaN(this.bounds.height)&&this.bounds.width>0&&this.bounds.height>0}redrawShape(){let e=this.createCanvas();e&&(e.pointerEvents=this.pointerEvents,this.beforePaint(e),this.paint(e),this.afterPaint(e),this.node!==e.root&&e.root&&this.node.insertAdjacentHTML("beforeend",e.root.outerHTML),this.destroyCanvas(e))}createCanvas(){let e=this.createSvgCanvas();return e&&this.outline&&(e.setStrokeWidth(this.strokeWidth),e.setStrokeColor(this.stroke),this.isDashed&&e.setDashed(this.isDashed),e.setStrokeWidth=()=>{},e.setStrokeColor=()=>{},e.setFillColor=()=>{},e.setGradient=()=>{},e.setDashed=()=>{},e.text=()=>{}),e}createSvgCanvas(){if(!this.node)return null;let e=new SvgCanvas2D(this.node,!1);e.strokeTolerance=this.pointerEvents?this.svgStrokeTolerance:0,e.pointerEventsValue=this.svgPointerEvents;let t=this.getSvgScreenOffset();return 0!==t?this.node.setAttribute("transform",`translate(${t},${t})`):this.node.removeAttribute("transform"),e.minStrokeWidth=this.minSvgStrokeWidth,this.antiAlias||(e.format=e=>Math.round(e)),e}destroyCanvas(e){if(e instanceof SvgCanvas2D){for(let t in e.gradients){let i=e.gradients[t];i&&(i.mxRefCount=(i.mxRefCount||0)+1)}this.releaseSvgGradients(this.oldGradients),this.oldGradients=e.gradients}}beforePaint(e){}afterPaint(e){}paint(e){let t=!1;if(e&&this.outline){let{stroke:i}=e;e.stroke=(...s)=>{t=!0,i.apply(e,s)};let{fillAndStroke:s}=e;e.fillAndStroke=(...i)=>{t=!0,s.apply(e,i)}}let i=this.scale,s=this.bounds;if(s){let n=s.x/i,a=s.y/i,l=s.width/i,r=s.height/i;if(this.isPaintBoundsInverted()){let e=(l-r)/2;n+=e,a-=e;let t=l;l=r,r=t}this.updateTransform(e,n,a,l,r),this.configureCanvas(e,n,a,l,r);let o=null;if(!this.stencil&&0===this.points.length&&this.shapePointerEvents||this.stencil&&this.stencilPointerEvents){let e=this.createBoundingBox();e&&this.node&&(o=this.createTransparentSvgRectangle(e.x,e.y,e.width,e.height),this.node.appendChild(o))}if(this.stencil)this.stencil.drawShape(e,this,n,a,l,r);else if(e.setStrokeWidth(this.strokeWidth),this.points.length>0){let t=[];for(let e=0;e<this.points.length;e+=1){let s=this.points[e];s&&t.push(new Point(s.x/i,s.y/i))}this.paintEdgeShape(e,t)}else this.paintVertexShape(e,n,a,l,r);o&&e.state&&!isNullish(e.state.transform)&&o.setAttribute("transform",e.state.transform),e&&this.outline&&!t&&(e.rect(n,a,l,r),e.stroke())}}configureCanvas(e,t,i,s,n){var a;let l=null;if(this.style&&null!=this.style.dashPattern&&(l=this.style.dashPattern),e.setAlpha(this.opacity/100),e.setFillAlpha(this.fillOpacity/100),e.setStrokeAlpha(this.strokeOpacity/100),this.isShadow&&e.setShadow(this.isShadow),this.isDashed&&e.setDashed(this.isDashed,(null==(a=this.style)?void 0:a.fixDash)??!1),l&&e.setDashPattern(l),this.fill!==NONE&&this.gradient!==NONE){let a=this.getGradientBounds(e,t,i,s,n);e.setGradient(this.fill,this.gradient,a.x,a.y,a.width,a.height,this.gradientDirection)}else e.setFillColor(this.fill);e.setStrokeColor(this.stroke)}getGradientBounds(e,t,i,s,n){return new Rectangle(t,i,s,n)}updateTransform(e,t,i,s,n){e.scale(this.scale),e.rotate(this.getShapeRotation(),this.flipH,this.flipV,t+s/2,i+n/2)}paintVertexShape(e,t,i,s,n){this.paintBackground(e,t,i,s,n),this.outline&&this.style&&this.style.backgroundOutline||(e.setShadow(!1),this.paintForeground(e,t,i,s,n))}paintBackground(e,t,i,s,n){}paintForeground(e,t,i,s,n){}paintEdgeShape(e,t){}getArcSize(e,t){var i,s,n;let a=0;if(null==(i=this.style)?void 0:i.absoluteArcSize)a=Math.min(e/2,Math.min(t/2,((null==(s=this.style)?void 0:s.arcSize)??LINE_ARCSIZE)/2));else{let i=((null==(n=this.style)?void 0:n.arcSize)??100*RECTANGLE_ROUNDING_FACTOR)/100;a=Math.min(e*i,t*i)}return a}paintGlassEffect(e,t,i,s,n,a){let l=Math.ceil((this.strokeWidth??0)/2),r=.4;e.setGradient("#ffffff","#ffffff",t,i,s,.6*n,"south",.9,.1),e.begin(),a+=2*l,this.isRounded?(e.moveTo(t-l+a,i-l),e.quadTo(t-l,i-l,t-l,i-l+a),e.lineTo(t-l,i+n*r),e.quadTo(t+.5*s,i+.7*n,t+s+l,i+n*r),e.lineTo(t+s+l,i-l+a),e.quadTo(t+s+l,i-l,t+s+l-a,i-l)):(e.moveTo(t-l,i-l),e.lineTo(t-l,i+n*r),e.quadTo(t+.5*s,i+.7*n,t+s+l,i+n*r),e.lineTo(t+s+l,i-l)),e.close(),e.fill()}addPoints(e,t,i=!1,s,n=!1,a=[],l=!0){if(t.length>0){let r=t[t.length-1];if(n&&i){let e=(t=t.slice())[0],i=new Point(r.x+(e.x-r.x)/2,r.y+(e.y-r.y)/2);t.splice(0,0,i)}let o=t[0],h=1;for(l?e.moveTo(o.x,o.y):e.lineTo(o.x,o.y);h<(n?t.length:t.length-1);){let n=t[mod(h,t.length)],l=o.x-n.x,r=o.y-n.y;if(i&&(0!==l||0!==r)&&0>a.indexOf(h-1)){let i=Math.sqrt(l*l+r*r),a=l*Math.min(s,i/2)/i,o=r*Math.min(s,i/2)/i,c=n.x+a,d=n.y+o;e.lineTo(c,d);let u=t[mod(h+1,t.length)];for(;h<t.length-2&&0===Math.round(u.x-n.x)&&0===Math.round(u.y-n.y);)u=t[mod(h+2,t.length)],h++;i=Math.max(1,Math.sqrt((l=u.x-n.x)*l+(r=u.y-n.y)*r));let p=l*Math.min(s,i/2)/i,g=r*Math.min(s,i/2)/i,m=n.x+p,f=n.y+g;e.quadTo(n.x,n.y,m,f),n=new Point(m,f)}else e.lineTo(n.x,n.y);o=n,h+=1}n?e.close():e.lineTo(r.x,r.y)}}resetStyles(){this.initStyles(),this.spacing=0,this.fill=NONE,this.gradient=NONE,this.gradientDirection=DIRECTION.EAST,this.stroke=NONE,this.startSize=1,this.endSize=1,this.startArrow=NONE,this.endArrow=NONE,this.direction=DIRECTION.EAST,this.isShadow=!1,this.isDashed=!1,this.isRounded=!1,this.glass=!1}apply(e){if(this.state=e,this.style=e.style,this.style){if(this.fill=this.style.fillColor??this.fill,this.gradient=this.style.gradientColor??this.gradient,this.gradientDirection=this.style.gradientDirection??this.gradientDirection,this.opacity=this.style.opacity??this.opacity,this.fillOpacity=this.style.fillOpacity??this.fillOpacity,this.strokeOpacity=this.style.strokeOpacity??this.strokeOpacity,this.stroke=this.style.strokeColor??this.stroke,this.strokeWidth=this.style.strokeWidth??this.strokeWidth,this.spacing=this.style.spacing??this.spacing,this.startSize=this.style.startSize??this.startSize,this.endSize=this.style.endSize??this.endSize,this.startArrow=this.style.startArrow??this.startArrow,this.endArrow=this.style.endArrow??this.endArrow,this.rotation=this.style.rotation??this.rotation,this.direction=this.style.direction??this.direction,this.flipH=!!this.style.flipH,this.flipV=!!this.style.flipV,this.direction===DIRECTION.NORTH||this.direction===DIRECTION.SOUTH){let e=this.flipH;this.flipH=this.flipV,this.flipV=e}this.isShadow=this.style.shadow??this.isShadow,this.isDashed=this.style.dashed??this.isDashed,this.isRounded=this.style.rounded??this.isRounded,this.glass=this.style.glass??this.glass}}setCursor(e){this.cursor=e,this.node.style.cursor=e}getCursor(){return this.cursor}isRoundable(e,t,i,s,n){return!1}updateBoundingBox(){if(this.useSvgBoundingBox&&this.node.ownerSVGElement)try{let e=this.node.getBBox();if(e.width>0&&e.height>0){this.boundingBox=new Rectangle(e.x,e.y,e.width,e.height),this.boundingBox.grow((this.strokeWidth??0)*this.scale/2);return}}catch(e){}if(this.bounds){let e=this.createBoundingBox();if(e){this.augmentBoundingBox(e);let t=this.getShapeRotation();0!==t&&(e=getBoundingBox(e,t))}this.boundingBox=e}}createBoundingBox(){if(!this.bounds)return null;let e=this.bounds.clone();return(this.stencil&&(this.direction===DIRECTION.NORTH||this.direction===DIRECTION.SOUTH)||this.isPaintBoundsInverted())&&e.rotate90(),e}augmentBoundingBox(e){this.isShadow&&(e.width+=Math.ceil(StyleDefaultsConfig.shadowOffsetX*this.scale),e.height+=Math.ceil(StyleDefaultsConfig.shadowOffsetX*this.scale)),e.grow((this.strokeWidth??0)*this.scale/2)}isPaintBoundsInverted(){return!this.stencil&&(this.direction===DIRECTION.NORTH||this.direction===DIRECTION.SOUTH)}getRotation(){return this.rotation??0}getTextRotation(){var e;let t=this.getRotation();return((null==(e=this.style)?void 0:e.horizontal)??!0)||(t+=this.verticalTextRotation||-90),t}getShapeRotation(){let e=this.getRotation();return this.direction===DIRECTION.NORTH?e+=270:this.direction===DIRECTION.WEST?e+=180:this.direction===DIRECTION.SOUTH&&(e+=90),e}createTransparentSvgRectangle(e,t,i,s){let n=document.createElementNS(NS_SVG,"rect");return n.setAttribute("x",String(e)),n.setAttribute("y",String(t)),n.setAttribute("width",String(i)),n.setAttribute("height",String(s)),n.setAttribute("fill",NONE),n.setAttribute("stroke",NONE),n.setAttribute("pointer-events","all"),n}redrawHtmlShape(){}setTransparentBackgroundImage(e){e.style.backgroundImage=`url('${Client.imageBasePath}/transparent.gif')`}releaseSvgGradients(e){for(let t in e){let i=e[t];i&&(i.mxRefCount=(i.mxRefCount||0)-1,0===i.mxRefCount&&i.parentNode&&i.parentNode.removeChild(i))}}destroy(){InternalEvent.release(this.node),this.node.parentNode&&this.node.parentNode.removeChild(this.node),this.node.innerHTML="",this.releaseSvgGradients(this.oldGradients),this.oldGradients={}}}class RectangleShape extends Shape{constructor(e,t,i,s=1){super(),this.bounds=e,this.fill=t,this.stroke=i,this.strokeWidth=s}isHtmlAllowed(){let e=!0;return this.style&&null!=this.style.pointerEvents&&(e=this.style.pointerEvents),!this.isRounded&&!this.glass&&0===this.rotation&&(e||this.fill!==NONE)}paintBackground(e,t,i,s,n){var a,l,r;let o=!0;if(this.style&&null!=this.style.pointerEvents&&(o=this.style.pointerEvents),o||this.fill!==NONE||this.stroke!==NONE){if(o||this.fill!==NONE||(e.pointerEvents=!1),this.isRounded){let o=0;if(null==(a=this.style)?void 0:a.absoluteArcSize)o=Math.min(s/2,Math.min(n/2,((null==(l=this.style)?void 0:l.arcSize)??LINE_ARCSIZE)/2));else{let e=((null==(r=this.style)?void 0:r.arcSize)??100*RECTANGLE_ROUNDING_FACTOR)/100;o=Math.min(s*e,n*e)}e.roundrect(t,i,s,n,o,o)}else e.rect(t,i,s,n);e.fillAndStroke()}}isRoundable(e,t,i,s,n){return!0}paintForeground(e,t,i,s,n){this.glass&&!this.outline&&this.fill!==NONE&&this.paintGlassEffect(e,t,i,s,n,this.getArcSize(s+this.strokeWidth,n+this.strokeWidth))}}class CellState extends Rectangle{constructor(e=null,t=null,i=null){super(),this.node=null,this.cellBounds=null,this.paintBounds=null,this.boundingBox=null,this.control=null,this.overlays=new Dictionary,this.invalidStyle=!1,this.invalid=!0,this.absolutePoints=[],this.visibleSourceState=null,this.visibleTargetState=null,this.terminalDistance=0,this.length=0,this.segments=[],this.shape=null,this.text=null,this.unscaledWidth=0,this.unscaledHeight=0,this.parentHighlight=null,this.point=null,e&&(this.view=e),t&&(this.cell=t),this.style=i??{},this.origin=new Point,this.absoluteOffset=new Point}getPerimeterBounds(e=0,t=new Rectangle(this.x,this.y,this.width,this.height)){var i,s;if((null==(s=null==(i=this.shape)?void 0:i.stencil)?void 0:s.aspect)==="fixed"){let e=this.shape.stencil.computeAspect(this.shape,t.x,t.y,t.width,t.height);t.x=e.x,t.y=e.y,t.width=this.shape.stencil.w0*e.width,t.height=this.shape.stencil.h0*e.height}return 0!==e&&t.grow(e),t}setAbsoluteTerminalPoint(e,t=!1){t?0===this.absolutePoints.length?this.absolutePoints.push(e):this.absolutePoints[0]=e:0===this.absolutePoints.length?(this.absolutePoints.push(null),this.absolutePoints.push(e)):1===this.absolutePoints.length?this.absolutePoints.push(e):this.absolutePoints[this.absolutePoints.length-1]=e}setCursor(e){this.shape&&this.shape.setCursor(e),this.text&&this.text.setCursor(e)}getVisibleTerminal(e=!1){var t;return(null==(t=this.getVisibleTerminalState(e))?void 0:t.cell)??null}getVisibleTerminalState(e=!1){return e?this.visibleSourceState:this.visibleTargetState}setVisibleTerminalState(e,t=!1){t?this.visibleSourceState=e:this.visibleTargetState=e}getCellBounds(){return this.cellBounds}getPaintBounds(){return this.paintBounds}updateCachedBounds(){let e=this.view,t=e.translate,i=e.scale;this.cellBounds=new Rectangle(this.x/i-t.x,this.y/i-t.y,this.width/i,this.height/i),this.paintBounds=Rectangle.fromRectangle(this.cellBounds),this.shape&&this.shape.isPaintBoundsInverted()&&this.paintBounds.rotate90()}setState(e){this.view=e.view,this.cell=e.cell,this.style=e.style,this.absolutePoints=e.absolutePoints,this.origin=e.origin,this.absoluteOffset=e.absoluteOffset,this.boundingBox=e.boundingBox,this.terminalDistance=e.terminalDistance,this.segments=e.segments,this.length=e.length,this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this.unscaledWidth=e.unscaledWidth,this.unscaledHeight=e.unscaledHeight}clone(){let e=new CellState(this.view,this.cell,this.style);for(let t=0;t<this.absolutePoints.length;t+=1){let i=this.absolutePoints[t];e.absolutePoints[t]=i?i.clone():null}return this.origin&&(e.origin=this.origin.clone()),this.absoluteOffset&&(e.absoluteOffset=this.absoluteOffset.clone()),this.boundingBox&&(e.boundingBox=this.boundingBox.clone()),e.terminalDistance=this.terminalDistance,e.segments=this.segments,e.length=this.length,e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e.unscaledWidth=this.unscaledWidth,e.unscaledHeight=this.unscaledHeight,e}destroy(){this.view.graph.cellRenderer.destroy(this)}isLoop(e){let t=this.getVisibleTerminalState(!0);return t&&t===this.getVisibleTerminalState(!1)}getVerticalAlign(){return this.style.verticalAlign??ALIGN.MIDDLE}isTransparentState(){return(this.style.strokeColor??NONE)===NONE&&(this.style.fillColor??NONE)===NONE&&!this.getImageSrc()}getImageSrc(){return this.style.image||null}getIndicatorColor(){return this.style.indicatorColor||null}getIndicatorGradientColor(){return this.style.gradientColor||null}getIndicatorShape(){return this.style.indicatorShape||null}getIndicatorImageSrc(){return this.style.indicatorImage||null}}class UndoableEdit{constructor(e,t=!0){this.changes=[],this.significant=!0,this.undone=!1,this.redone=!1,this.source=e,this.changes=[],this.significant=t}isEmpty(){return 0===this.changes.length}isSignificant(){return this.significant}add(e){this.changes.push(e)}notify(){}die(){}undo(){if(!this.undone){this.source.fireEvent(new EventObject(InternalEvent.START_EDIT));let e=this.changes.length;for(let t=e-1;t>=0;t--){let e=this.changes[t];e.execute?e.execute():e.undo&&e.undo(),this.source.fireEvent(new EventObject(InternalEvent.EXECUTED,{change:e}))}this.undone=!0,this.redone=!1,this.source.fireEvent(new EventObject(InternalEvent.END_EDIT))}this.notify()}redo(){if(!this.redone){this.source.fireEvent(new EventObject(InternalEvent.START_EDIT));let e=this.changes.length;for(let t=0;t<e;t+=1){let e=this.changes[t];null!=e.execute?e.execute():null!=e.redo&&e.redo(),this.source.fireEvent(new EventObject(InternalEvent.EXECUTED,{change:e}))}this.undone=!1,this.redone=!0,this.source.fireEvent(new EventObject(InternalEvent.END_EDIT))}this.notify()}}class ImageShape extends RectangleShape{constructor(e,t,i="#FFFFFF",s="#000000",n=1){super(e,i,s,n),this.imageSrc=t,this.shadow=!1,this.preserveImageAspect=!0}getSvgScreenOffset(){return 0}apply(e){super.apply(e),this.fill=NONE,this.stroke=NONE,this.gradient=NONE,this.style&&null!=this.style.imageAspect&&(this.preserveImageAspect=this.style.imageAspect)}isHtmlAllowed(){return!this.preserveImageAspect}isRoundable(e,t,i,s,n){return!1}paintVertexShape(e,t,i,s,n){var a,l;if(this.imageSrc){let r=(null==(a=this.style)?void 0:a.imageBackground)??NONE,o=(null==(l=this.style)?void 0:l.imageBorder)??NONE;r!==NONE&&(e.setFillColor(r),e.setStrokeColor(o),e.rect(t,i,s,n),e.fillAndStroke()),e.image(t,i,s,n,this.imageSrc,this.preserveImageAspect,!1,!1),o!==NONE&&(e.setShadow(!1),e.setStrokeColor(o),e.rect(t,i,s,n),e.stroke())}else this.paintBackground(e,t,i,s,n)}}class CurrentRootChange{constructor(e,t){if(this.view=e,this.root=t,this.previous=t,this.isUp=null===t,!this.isUp){let e=this.view.currentRoot;for(;e;){if(e===t){this.isUp=!0;break}e=e.getParent()}}}execute(){let e=this.view.currentRoot;this.view.currentRoot=this.previous,this.previous=e;let t=this.view.graph.getTranslateForRoot(this.view.currentRoot);t&&(this.view.translate=new Point(-t.x,-t.y)),this.isUp?(this.view.clear(this.view.currentRoot,!0,!0),this.view.validate(null)):this.view.refresh();let i=this.isUp?InternalEvent.UP:InternalEvent.DOWN;this.view.fireEvent(new EventObject(i,{root:this.view.currentRoot,previous:this.previous})),this.isUp=!this.isUp}}class StyleRegistry{static putValue(e,t){StyleRegistry.values[e]=t}static getValue(e){return StyleRegistry.values[e]}static getName(e){for(let t in StyleRegistry.values)if(StyleRegistry.values[t]===e)return t;return null}}function isI18nEnabled(){return GlobalConfig.i18n.isEnabled()}function translate(e,t,i){return GlobalConfig.i18n.get(e,t,i)}StyleRegistry.values={};class GraphView extends EventSource{constructor(e){super(),this.backgroundImage=null,this.backgroundPageShape=null,this.EMPTY_POINT=new Point,this.doneResource=isI18nEnabled()?"done":"",this.updatingDocumentResource=isI18nEnabled()?"updatingDocument":"",this.allowEval=!1,this.captureDocumentGesture=!0,this.rendering=!0,this.currentRoot=null,this.graphBounds=new Rectangle,this.scale=1,this.translate=new Point,this.states=new Dictionary,this.updateStyle=!1,this.lastNode=null,this.lastHtmlNode=null,this.lastForegroundNode=null,this.lastForegroundHtmlNode=null,this.endHandler=null,this.moveHandler=null,this.graph=e}getGraphBounds(){return this.graphBounds}setGraphBounds(e){this.graphBounds=e}getScale(){return this.scale}setScale(e){let t=this.scale;t!==e&&(this.scale=e,this.isEventsEnabled()&&this.viewStateChanged()),this.fireEvent(new EventObject(InternalEvent.SCALE,{scale:e,previousScale:t}))}getTranslate(){return this.translate}isRendering(){return this.rendering}setRendering(e){this.rendering=e}setTranslate(e,t){let i=new Point(this.translate.x,this.translate.y);(this.translate.x!==e||this.translate.y!==t)&&(this.translate.x=e,this.translate.y=t,this.isEventsEnabled()&&this.viewStateChanged()),this.fireEvent(new EventObject(InternalEvent.TRANSLATE,{translate:this.translate,previousTranslate:i}))}isAllowEval(){return this.allowEval}setAllowEval(e){this.allowEval=e}getStates(){return this.states}setStates(e){this.states=e}getCanvas(){return this.canvas}getBackgroundPane(){return this.backgroundPane}getDrawPane(){return this.drawPane}getOverlayPane(){return this.overlayPane}getDecoratorPane(){return this.decoratorPane}getBounds(e){let t=null;if(e.length>0){for(let i=0;i<e.length;i+=1)if(e[i].isVertex()||e[i].isEdge()){let s=this.getState(e[i]);s&&(t?t.add(s):t=Rectangle.fromRectangle(s))}}return t}setCurrentRoot(e){if(this.currentRoot!==e){let t=new CurrentRootChange(this,e);t.execute();let i=new UndoableEdit(this,!0);i.add(t),this.fireEvent(new EventObject(InternalEvent.UNDO,{edit:i})),this.graph.sizeDidChange(),this.currentRoot=e}return e}scaleAndTranslate(e,t,i){let s=this.scale,n=new Point(this.translate.x,this.translate.y);(this.scale!==e||this.translate.x!==t||this.translate.y!==i)&&(this.scale=e,this.translate.x=t,this.translate.y=i,this.isEventsEnabled()&&this.viewStateChanged()),this.fireEvent(new EventObject(InternalEvent.SCALE_AND_TRANSLATE,{scale:e,previousScale:s,translate:this.translate,previousTranslate:n}))}viewStateChanged(){this.revalidate(),this.graph.sizeDidChange()}refresh(){this.currentRoot&&this.clear(),this.revalidate()}revalidate(){this.invalidate(),this.validate()}clear(e,t=!1,i=!0){if(e||(e=this.graph.getDataModel().getRoot()),e)if(this.removeState(e),i&&(t||e!==this.currentRoot)){let i=e.getChildCount();for(let s=0;s<i;s+=1)this.clear(e.getChildAt(s),t)}else this.invalidate(e)}invalidate(e=null,t=!0,i=!0){let s=this.graph.getDataModel();if(e=e??s.getRoot()){let s=this.getState(e);if(s&&(s.invalid=!0),!e.invalidating){if(e.invalidating=!0,t){let s=e.getChildCount();for(let n=0;n<s;n+=1){let s=e.getChildAt(n);this.invalidate(s,t,i)}}if(i){let s=e.getEdgeCount();for(let n=0;n<s;n+=1)this.invalidate(e.getEdgeAt(n),t,i)}e.invalidating=!1}}}validate(e=null){let t=GlobalConfig.logger.enter("GraphView.validate");this.resetValidationState();let i=e||(this.currentRoot??this.graph.getDataModel().getRoot());if(i){let e=this.getBoundingBox(this.validateCellState(i?this.validateCell(i):null));this.setGraphBounds(e??this.getEmptyBounds()),this.validateBackground(),this.resetValidationState()}GlobalConfig.logger.leave("GraphView.validate",t)}getEmptyBounds(){return new Rectangle(this.translate.x*this.scale,this.translate.y*this.scale)}getBoundingBox(e=null,t=!0){let i=null;if(e&&(e.shape&&e.shape.boundingBox&&(i=e.shape.boundingBox.clone()),e.text&&e.text.boundingBox&&(i?i.add(e.text.boundingBox):i=e.text.boundingBox.clone()),t)){let t=e.cell.getChildCount();for(let s=0;s<t;s+=1){let t=this.getBoundingBox(this.getState(e.cell.getChildAt(s)));t&&(i?i.add(t):i=t)}}return i}createBackgroundPageShape(e){return new RectangleShape(e,"white","black")}validateBackground(){this.validateBackgroundImage(),this.validateBackgroundPage()}validateBackgroundImage(){let e=this.graph.getBackgroundImage();if(e){if(!this.backgroundImage||this.backgroundImage.imageSrc!==e.src){this.backgroundImage&&this.backgroundImage.destroy();let t=new Rectangle(0,0,1,1);this.backgroundImage=new ImageShape(t,e.src),this.backgroundImage.dialect=this.graph.dialect,this.backgroundImage.init(this.backgroundPane),this.backgroundImage.redraw()}this.redrawBackgroundImage(this.backgroundImage,e)}else this.backgroundImage&&(this.backgroundImage.destroy(),this.backgroundImage=null)}validateBackgroundPage(){let e=this.graph;if(e.pageVisible){let t=this.getBackgroundPageBounds();null==this.backgroundPageShape?(this.backgroundPageShape=this.createBackgroundPageShape(t),this.backgroundPageShape.scale=this.scale,this.backgroundPageShape.isShadow=!0,this.backgroundPageShape.dialect=this.graph.dialect,this.backgroundPageShape.init(this.backgroundPane),this.backgroundPageShape.redraw(),this.backgroundPageShape.node&&(e.isNativeDblClickEnabled()&&InternalEvent.addListener(this.backgroundPageShape.node,"dblclick",t=>{e.dblClick(t)}),InternalEvent.addGestureListeners(this.backgroundPageShape.node,t=>{e.fireMouseEvent(InternalEvent.MOUSE_DOWN,new InternalMouseEvent(t))},t=>{let i=e.getPlugin("TooltipHandler");i&&i.isHideOnHover()&&i.hide(),e.isMouseDown&&!isConsumed(t)&&e.fireMouseEvent(InternalEvent.MOUSE_MOVE,new InternalMouseEvent(t))},t=>{e.fireMouseEvent(InternalEvent.MOUSE_UP,new InternalMouseEvent(t))}))):(this.backgroundPageShape.scale=this.scale,this.backgroundPageShape.bounds=t,this.backgroundPageShape.redraw())}else this.backgroundPageShape&&(this.backgroundPageShape.destroy(),this.backgroundPageShape=null)}getBackgroundPageBounds(){let e=this.graph.pageFormat,t=this.scale*this.graph.pageScale;return new Rectangle(this.scale*this.translate.x,this.scale*this.translate.y,e.width*t,e.height*t)}redrawBackgroundImage(e,t){if(e.scale=this.scale,e.bounds){let i=e.bounds;i.x=this.scale*this.translate.x,i.y=this.scale*this.translate.y,i.width=this.scale*t.width,i.height=this.scale*t.height}e.redraw()}validateCell(e,t=!0){if(t=t&&e.isVisible(),this.getState(e,t)&&!t)this.removeState(e);else{let i=e.getChildCount();for(let s=0;s<i;s+=1)this.validateCell(e.getChildAt(s),t&&(!e.isCollapsed()||e===this.currentRoot))}return e}validateCellState(e,t=!0){let i=null;if(e&&(i=this.getState(e))&&(i.invalid&&(i.invalid=!1,(!i.style||i.invalidStyle)&&(i.style=this.graph.getCellStyle(i.cell),i.invalidStyle=!1),e!==this.currentRoot&&this.validateCellState(e.getParent(),!1),i.setVisibleTerminalState(this.validateCellState(this.getVisibleTerminal(e,!0),!1),!0),i.setVisibleTerminalState(this.validateCellState(this.getVisibleTerminal(e,!1),!1),!1),this.updateCellState(i),e===this.currentRoot||i.invalid||(this.graph.cellRenderer.redraw(i,!1,this.isRendering()),i.updateCachedBounds())),t&&!i.invalid)){i.shape&&this.stateValidated(i);let t=e.getChildCount();for(let i=0;i<t;i+=1)this.validateCellState(e.getChildAt(i))}return i}updateCellState(e){let t=e.absoluteOffset,i=e.origin;if(t.x=0,t.y=0,i.x=0,i.y=0,e.length=0,e.cell!==this.currentRoot){let s=e.cell.getParent(),n=s?this.getState(s):null;n&&n.cell!==this.currentRoot&&(i.x+=n.origin.x,i.y+=n.origin.y);let a=this.graph.getChildOffsetForCell(e.cell);a&&(i.x+=a.x,i.y+=a.y);let l=e.cell.getGeometry();if(l){if(!e.cell.isEdge())if(a=l.offset?l.offset:this.EMPTY_POINT,l.relative&&n)if(n.cell.isEdge()){let e=this.getPoint(n,l);e&&(i.x+=e.x/this.scale-n.origin.x-this.translate.x,i.y+=e.y/this.scale-n.origin.y-this.translate.y)}else i.x+=l.x*n.unscaledWidth+a.x,i.y+=l.y*n.unscaledHeight+a.y;else t.x=this.scale*a.x,t.y=this.scale*a.y,i.x+=l.x,i.y+=l.y;e.x=this.scale*(this.translate.x+i.x),e.y=this.scale*(this.translate.y+i.y),e.width=this.scale*l.width,e.unscaledWidth=l.width,e.height=this.scale*l.height,e.unscaledHeight=l.height,e.cell.isVertex()&&this.updateVertexState(e,l),e.cell.isEdge()&&this.updateEdgeState(e,l)}}e.updateCachedBounds()}updateVertexState(e,t){let i=e.cell.getParent(),s=i?this.getState(i):null;if(t.relative&&s&&!s.cell.isEdge()){let t=toRadians(s.style.rotation??0);if(0!==t){let i=Math.cos(t),n=Math.sin(t),a=getRotatedPoint(new Point(e.getCenterX(),e.getCenterY()),i,n,new Point(s.getCenterX(),s.getCenterY()));e.x=a.x-e.width/2,e.y=a.y-e.height/2}}this.updateVertexLabelOffset(e)}updateEdgeState(e,t){let i=e.getVisibleTerminalState(!0),s=e.getVisibleTerminalState(!1);if(!(e.cell.getTerminal(!0)&&!i||!i&&!t.getTerminalPoint(!0)||e.cell.getTerminal(!1)&&!s)&&(s||t.getTerminalPoint(!1))){this.updateFixedTerminalPoints(e,i,s),this.updatePoints(e,t.points,i,s),this.updateFloatingTerminalPoints(e,i,s);let n=e.absolutePoints;e.cell!==this.currentRoot&&(null==n||n.length<2||null==n[0]||null==n[n.length-1])?this.clear(e.cell,!0):(this.updateEdgeBounds(e),this.updateEdgeLabelOffset(e))}else this.clear(e.cell,!0)}updateVertexLabelOffset(e){let t=e.style.labelPosition??ALIGN.CENTER;if(t===ALIGN.LEFT){let t=e.style.labelWidth??null;null!=t?t*=this.scale:t=e.width,e.absoluteOffset.x-=t}else if(t===ALIGN.RIGHT)e.absoluteOffset.x+=e.width;else if(t===ALIGN.CENTER){let t=e.style.labelWidth??null;if(null!=t){let i=e.style.align??ALIGN.CENTER,s=0;i===ALIGN.CENTER?s=.5:i===ALIGN.RIGHT&&(s=1),0!==s&&(e.absoluteOffset.x-=(t*this.scale-e.width)*s)}}let i=e.style.verticalLabelPosition??ALIGN.MIDDLE;i===ALIGN.TOP?e.absoluteOffset.y-=e.height:i===ALIGN.BOTTOM&&(e.absoluteOffset.y+=e.height)}resetValidationState(){this.lastNode=null,this.lastHtmlNode=null,this.lastForegroundNode=null,this.lastForegroundHtmlNode=null}stateValidated(e){let t=this.graph,i=e.cell.isEdge()&&t.keepEdgesInForeground||e.cell.isVertex()&&t.keepEdgesInBackground,s=i&&this.lastForegroundHtmlNode||this.lastHtmlNode,n=i&&this.lastForegroundNode||this.lastNode,a=t.cellRenderer.insertStateAfter(e,n,s);i?(this.lastForegroundHtmlNode=a[1],this.lastForegroundNode=a[0]):(this.lastHtmlNode=a[1],this.lastNode=a[0])}updateFixedTerminalPoints(e,t,i){this.updateFixedTerminalPoint(e,t,!0,this.graph.getConnectionConstraint(e,t,!0)),this.updateFixedTerminalPoint(e,i,!1,this.graph.getConnectionConstraint(e,i,!1))}updateFixedTerminalPoint(e,t,i,s){e.setAbsoluteTerminalPoint(this.getFixedTerminalPoint(e,t,i,s),i)}getFixedTerminalPoint(e,t,i,s){let n=null;if(s&&t&&(n=this.graph.getConnectionPoint(t,s,!1)),!n&&!t){let t=this.scale,s=this.translate,a=e.origin;(n=e.cell.getGeometry().getTerminalPoint(i))&&(n=new Point(t*(s.x+n.x+a.x),t*(s.y+n.y+a.y)))}return n}updateBoundsFromStencil(e){let t=null;if(e&&e.shape&&e.shape.stencil&&"fixed"===e.shape.stencil.aspect){t=Rectangle.fromRectangle(e);let i=e.shape.stencil.computeAspect(null,e.x,e.y,e.width,e.height);e.setRect(i.x,i.y,e.shape.stencil.w0*i.width,e.shape.stencil.h0*i.height)}return t}updatePoints(e,t,i,s){let n=[];n.push(e.absolutePoints[0]);let a=this.getEdgeStyle(e,t,i,s);if(a&&i){let l=this.getTerminalPort(e,i,!0),r=s?this.getTerminalPort(e,s,!1):null,o=this.updateBoundsFromStencil(l),h=this.updateBoundsFromStencil(r);a(e,l,r,t,n),l&&o&&l.setRect(o.x,o.y,o.width,o.height),r&&h&&r.setRect(h.x,h.y,h.width,h.height)}else if(t){for(let i=0;i<t.length;i+=1)if(t[i]){let s=clone(t[i]);n.push(this.transformControlPoint(e,s))}}let l=e.absolutePoints;n.push(l[l.length-1]),e.absolutePoints=n}transformControlPoint(e,t,i=!1){if(e&&t){let s=e.origin,n=i?1:this.scale;return new Point(n*(t.x+this.translate.x+s.x),n*(t.y+this.translate.y+s.y))}return null}isLoopStyleEnabled(e,t=[],i=null,s=null){let n=this.graph.getConnectionConstraint(e,i,!0),a=this.graph.getConnectionConstraint(e,s,!1);return(null==t||t.length<2)&&!e.style.orthogonalLoop&&(null!=n&&null!=n.point||null!=a&&null!=a.point)&&null!=i&&i===s}getEdgeStyle(e,t=[],i=null,s=null){let n=this.isLoopStyleEnabled(e,t,i,s)?e.style.loopStyle??this.graph.defaultLoopStyle:e.style.noEdgeStyle?null:e.style.edgeStyle;if("string"==typeof n){let e=StyleRegistry.getValue(n);!e&&this.isAllowEval()&&(e=doEval(n)),n=e}return"function"==typeof n?n:null}updateFloatingTerminalPoints(e,t,i){let s=e.absolutePoints,n=s[0];!s[s.length-1]&&i&&this.updateFloatingTerminalPoint(e,i,t,!1),!n&&t&&this.updateFloatingTerminalPoint(e,t,i,!0)}updateFloatingTerminalPoint(e,t,i,s){e.setAbsoluteTerminalPoint(this.getFloatingTerminalPoint(e,t,i,s),s)}getFloatingTerminalPoint(e,t,i,s){t=this.getTerminalPort(e,t,s);let n=this.getNextPoint(e,i,s),a=this.graph.isOrthogonal(e),l=toRadians(t.style.rotation??0),r=new Point(t.getCenterX(),t.getCenterY());0!==l&&(n=getRotatedPoint(n,Math.cos(-l),Math.sin(-l),r));let o=e.style.perimeterSpacing??0;o+=e.style[s?"sourcePerimeterSpacing":"targetPerimeterSpacing"]??0;let h=this.getPerimeterPoint(t,n,0===l&&a,o);return h&&0!==l&&(h=getRotatedPoint(h,Math.cos(l),Math.sin(l),r)),h}getTerminalPort(e,t,i=!1){let s=i?"sourcePort":"targetPort",n=e.style[s];if(n){let e=this.graph.getDataModel().getCell(n);if(e){let i=this.getState(e,!1);i&&(t=i)}}return t}getPerimeterPoint(e,t,i,s=0){let n=null;if(null!=e){let a=this.getPerimeterFunction(e);if(null!=a&&null!=t){let l=this.getPerimeterBounds(e,s);if(l.width>0||l.height>0){n=new Point(t.x,t.y);let s=!1,r=!1;e.cell.isVertex()&&(s=!!e.style.flipH,r=!!e.style.flipV,s&&(n.x=2*l.getCenterX()-n.x),r&&(n.y=2*l.getCenterY()-n.y)),null!=(n=a(l,e,n,i))&&(s&&(n.x=2*l.getCenterX()-n.x),r&&(n.y=2*l.getCenterY()-n.y))}}null==n&&(n=this.getPoint(e))}return n}getRoutingCenterX(e){let t=e.style?e.style.routingCenterX??0:0;return e.getCenterX()+t*e.width}getRoutingCenterY(e){let t=e.style?e.style.routingCenterY??0:0;return e.getCenterY()+t*e.height}getPerimeterBounds(e,t=0){return t+=e.style.perimeterSpacing??0,e.getPerimeterBounds(t*this.scale)}getPerimeterFunction(e){let t=e.style.perimeter;if("string"==typeof t){let e=StyleRegistry.getValue(t);null==e&&this.isAllowEval()&&(e=doEval(t)),t=e}return"function"==typeof t?t:null}getNextPoint(e,t,i=!1){let s=e.absolutePoints,n=null;if(s.length>=2){let e=s.length;n=s[i?Math.min(1,e-1):Math.max(0,e-2)]}return!n&&t&&(n=new Point(t.getCenterX(),t.getCenterY())),n}getVisibleTerminal(e,t){let i=this.graph.getDataModel(),s=e.getTerminal(t),n=s;for(;s&&s!==this.currentRoot;)(n&&!n.isVisible()||s.isCollapsed())&&(n=s),s=s.getParent();return n&&(!i.contains(n)||n.getParent()===i.getRoot()||n===this.currentRoot)&&(n=null),n}updateEdgeBounds(e){let t=e.absolutePoints,i=t[0],s=t[t.length-1];if(i&&s&&(i.x!==s.x||i.y!==s.y)){let t=s.x-i.x,n=s.y-i.y;e.terminalDistance=Math.sqrt(t*t+n*n)}else e.terminalDistance=0;let n=0,a=[],l=i;if(l){let i=l.x,s=l.y,r=i,o=s;for(let e=1;e<t.length;e+=1){let h=t[e];if(h){let e=l.x-h.x,t=l.y-h.y,c=Math.sqrt(e*e+t*t);a.push(c),n+=c,i=Math.min((l=h).x,i),s=Math.min(l.y,s),r=Math.max(l.x,r),o=Math.max(l.y,o)}}e.length=n,e.segments=a;let h=1;e.x=i,e.y=s,e.width=Math.max(h,r-i),e.height=Math.max(h,o-s)}}getPoint(e,t=null){let i=e.getCenterX(),s=e.getCenterY();if(null!=e.segments&&(null==t||t.relative)){let n=null!=t?t.x/2:0,a=e.absolutePoints.length,l=Math.round((n+.5)*e.length),r=e.segments[0],o=0,h=1;for(;l>=Math.round(o+r)&&h<a-1;)o+=r,r=e.segments[h++];let c=0===r?0:(l-o)/r,d=e.absolutePoints[h-1],u=e.absolutePoints[h];if(null!=d&&null!=u){let e=0,n=0,a=0;if(null!=t){e=t.y;let{offset:i}=t;null!=i&&(n=i.x,a=i.y)}let l=u.x-d.x,o=u.y-d.y,h=0===r?0:o/r,p=0===r?0:l/r;i=d.x+l*c+(h*e+n)*this.scale,s=d.y+o*c-(p*e-a)*this.scale}}else if(null!=t){let{offset:e}=t;null!=e&&(i+=e.x,s+=e.y)}return new Point(i,s)}getRelativePoint(e,t,i){let s=e.cell.getGeometry();if(s){let n=e.absolutePoints,a=n.length;if(s.relative&&a>1){let s=e.length,{segments:l}=e,r=n[0],o=n[1],h=ptSegDistSq(r.x,r.y,o.x,o.y,t,i),c=0,d=0,u=0;for(let e=2;e<a;e+=1){r=o,o=n[e];let s=ptSegDistSq(r.x,r.y,o.x,o.y,t,i);u+=l[e-2],s<=h&&(h=s,d=e-1,c=u)}let p=l[d];r=n[d],o=n[d+1];let g=r.x,m=r.y,f=o.x,x=o.y,v=t,b=i,y=g-f,w=m-x;v-=f,b-=x;let C=0,E=(v=y-v)*y+(b=w-b)*w,S=Math.sqrt(C=E<=0?0:E*E/(y*y+w*w));S>p&&(S=p);let T=Math.sqrt(ptSegDistSq(r.x,r.y,o.x,o.y,t,i));return -1===relativeCcw(r.x,r.y,o.x,o.y,t,i)&&(T=-T),new Point(-((s/2-c-S)/s*2),T/this.scale)}}return new Point}updateEdgeLabelOffset(e){let t=e.absolutePoints,i=e.absoluteOffset;if(i.x=e.getCenterX(),i.y=e.getCenterY(),t.length>0&&e.segments){let s=e.cell.getGeometry();if(s)if(s.relative){let t=this.getPoint(e,s);e.absoluteOffset=t}else{let e=t[0],n=t[t.length-1];if(e&&n){let t=n.x-e.x,a=n.y-e.y,l=0,r=0,o=s.offset;o&&(l=o.x,r=o.y);let h=e.x+t/2+l*this.scale,c=e.y+a/2+r*this.scale;i.x=h,i.y=c}}}}getState(e,t=!1){let i=this.states.get(e);return t&&(!i||this.updateStyle)&&e.isVisible()&&(i?i.style=this.graph.getCellStyle(e):(i=this.createState(e),this.states.put(e,i))),i}getCellStates(e=null){if(!e)return this.states.getValues();let t=[];for(let i of e){let e=this.getState(i);e&&t.push(e)}return t}removeState(e){let t=this.states.remove(e);return t&&(this.graph.cellRenderer.destroy(t),t.invalid=!0,t.destroy()),t}createState(e){return new CellState(this,e,this.graph.getCellStyle(e))}isContainerEvent(e){let t=getSource(e);return t&&(t===this.graph.container||t.parentNode===this.backgroundPane||t.parentNode&&t.parentNode.parentNode===this.backgroundPane||t===this.canvas.parentNode||t===this.canvas||t===this.backgroundPane||t===this.drawPane||t===this.overlayPane||t===this.decoratorPane)}isScrollEvent(e){let t=this.graph,i=getOffset(t.container),s=e instanceof MouseEvent?[e.clientX,e.clientY]:[e.touches[0].clientX,e.touches[0].clientY],n=new Point(s[0]-i.x,s[1]-i.y),a=t.container,l=a.offsetWidth,r=a.clientWidth;if(l>r&&n.x>r+2&&n.x<=l)return!0;let o=a.offsetHeight,h=a.clientHeight;return o>h&&n.y>h+2&&n.y<=o}init(){this.installListeners(),this.createSvg()}installListeners(){let e=this.graph,{container:t}=e;Client.IS_TOUCH&&(InternalEvent.addListener(t,"gesturestart",t=>{e.fireGestureEvent(t),InternalEvent.consume(t)}),InternalEvent.addListener(t,"gesturechange",t=>{e.fireGestureEvent(t),InternalEvent.consume(t)}),InternalEvent.addListener(t,"gestureend",t=>{e.fireGestureEvent(t),InternalEvent.consume(t)}));let i=null;InternalEvent.addGestureListeners(t,t=>{!this.isContainerEvent(t)||(Client.IS_GC||Client.IS_SF)&&this.isScrollEvent(t)||(e.fireMouseEvent(InternalEvent.MOUSE_DOWN,new InternalMouseEvent(t)),i=t.pointerId)},t=>{this.isContainerEvent(t)&&(null===i||t.pointerId===i)&&e.fireMouseEvent(InternalEvent.MOUSE_MOVE,new InternalMouseEvent(t))},t=>{this.isContainerEvent(t)&&e.fireMouseEvent(InternalEvent.MOUSE_UP,new InternalMouseEvent(t)),i=null}),InternalEvent.addListener(t,"dblclick",t=>{this.isContainerEvent(t)&&e.dblClick(t)});let s=i=>{let s=null;if(Client.IS_TOUCH){let n=convertPoint(t,getClientX(i),getClientY(i)),a=e.getCellAt(n.x,n.y);a&&(s=e.view.getState(a))}return s};e.addMouseListener({mouseDown:(t,i)=>{let s=e.getPlugin("PopupMenuHandler");null==s||s.hideMenu()},mouseMove:()=>{},mouseUp:()=>{}}),this.moveHandler=t=>{let i=e.getPlugin("TooltipHandler");i&&i.isHideOnHover()&&i.hide(),this.captureDocumentGesture&&e.isMouseDown&&null!=e.container&&!this.isContainerEvent(t)&&"none"!==e.container.style.display&&"hidden"!==e.container.style.visibility&&!isConsumed(t)&&e.fireMouseEvent(InternalEvent.MOUSE_MOVE,new InternalMouseEvent(t,s(t)))},this.endHandler=t=>{this.captureDocumentGesture&&e.isMouseDown&&null!=e.container&&!this.isContainerEvent(t)&&"none"!==e.container.style.display&&"hidden"!==e.container.style.visibility&&e.fireMouseEvent(InternalEvent.MOUSE_UP,new InternalMouseEvent(t))},InternalEvent.addGestureListeners(document,null,this.moveHandler,this.endHandler)}createSvg(){let{container:e}=this.graph,t=this.canvas=document.createElementNS(NS_SVG,"g");this.backgroundPane=document.createElementNS(NS_SVG,"g"),t.appendChild(this.backgroundPane),this.drawPane=document.createElementNS(NS_SVG,"g"),t.appendChild(this.drawPane),this.overlayPane=document.createElementNS(NS_SVG,"g"),t.appendChild(this.overlayPane),this.decoratorPane=document.createElementNS(NS_SVG,"g"),t.appendChild(this.decoratorPane);let i=document.createElementNS(NS_SVG,"svg");i.style.left="0px",i.style.top="0px",i.style.width="100%",i.style.height="100%",i.style.display="block",i.appendChild(this.canvas),null!=e&&(e.appendChild(i),this.updateContainerStyle(e))}createHtml(){let e=this.graph.container;null!=e&&(this.canvas=this.createHtmlPane("100%","100%"),this.canvas.style.overflow="hidden",this.backgroundPane=this.createHtmlPane("1px","1px"),this.drawPane=this.createHtmlPane("1px","1px"),this.overlayPane=this.createHtmlPane("1px","1px"),this.decoratorPane=this.createHtmlPane("1px","1px"),this.canvas.appendChild(this.backgroundPane),this.canvas.appendChild(this.drawPane),this.canvas.appendChild(this.overlayPane),this.canvas.appendChild(this.decoratorPane),e.appendChild(this.canvas),this.updateContainerStyle(e))}updateHtmlCanvasSize(e,t){if(null!=this.graph.container){let i=this.graph.container.offsetWidth,s=this.graph.container.offsetHeight;i<e?this.canvas.style.width=e+"px":this.canvas.style.width="100%",s<t?this.canvas.style.height=t+"px":this.canvas.style.height="100%"}}createHtmlPane(e,t){let i=document.createElement("DIV");return null!=e&&null!=t?(i.style.position="absolute",i.style.left="0px",i.style.top="0px",i.style.width=e,i.style.height=t):i.style.position="relative",i}updateContainerStyle(e){let t=getCurrentStyle(e);null!=t&&"static"==t.position&&(e.style.position="relative"),Client.IS_POINTER&&(e.style.touchAction="none")}destroy(){let e=null;this.canvas&&this.canvas instanceof SVGElement&&(e=this.canvas.ownerSVGElement),e||(e=this.canvas),e&&e.parentNode&&(this.clear(this.currentRoot,!0),InternalEvent.removeGestureListeners(document,null,this.moveHandler,this.endHandler),InternalEvent.release(this.graph.container),e.parentNode.removeChild(e),this.moveHandler=null,this.endHandler=null,this.canvas=null,this.backgroundPane=null,this.drawPane=null,this.overlayPane=null,this.decoratorPane=null)}}class PolylineShape extends Shape{constructor(e,t,i=1){super(),this.points=e,this.stroke=t,this.strokeWidth=i}getRotation(){return 0}getShapeRotation(){return 0}isPaintBoundsInverted(){return!1}paintEdgeShape(e,t){var i;let s=e.pointerEventsValue;e.pointerEventsValue="stroke",(null==(i=this.style)?void 0:i.curved)?this.paintCurvedLine(e,t):this.paintLine(e,t,this.isRounded),e.pointerEventsValue=s}paintLine(e,t,i){var s;let n=(null==(s=this.style)?void 0:s.arcSize)??LINE_ARCSIZE;e.begin(),this.addPoints(e,t,i,n,!1),e.stroke()}paintCurvedLine(e,t){e.begin();let i=t[0],s=t.length;e.moveTo(i.x,i.y);for(let i=1;i<s-2;i+=1){let s=t[i],n=t[i+1],a=(s.x+n.x)/2,l=(s.y+n.y)/2;e.quadTo(s.x,s.y,a,l)}let n=t[s-2],a=t[s-1];e.quadTo(n.x,n.y,a.x,a.y),e.stroke()}}class MarkerShape{static addMarker(e,t){MarkerShape.markers[e]=t}static createMarker(e,t,i,s,n,a,l,r,o,h){let c=MarkerShape.markers[i];return c?c(e,t,i,s,n,a,l,r,o,h):null}}function createArrow(e){return(t,i,s,n,a,l,r,o,h,c)=>{let d=a*h*1.118,u=l*h*1.118;a*=r+h,l*=r+h;let p=n.clone();p.x-=d,p.y-=u;let g=s!==ARROW.CLASSIC&&s!==ARROW.CLASSIC_THIN?1:3/4;return n.x+=-a*g-d,n.y+=-l*g-u,()=>{t.begin(),t.moveTo(p.x,p.y),t.lineTo(p.x-a-l/e,p.y-l+a/e),(s===ARROW.CLASSIC||s===ARROW.CLASSIC_THIN)&&t.lineTo(p.x-3*a/4,p.y-3*l/4),t.lineTo(p.x+l/e-a,p.y-l-a/e),t.close(),c?t.fillAndStroke():t.stroke()}}}function createOpenArrow(e){return(t,i,s,n,a,l,r,o,h,c)=>{let d=a*h*1.118,u=l*h*1.118;a*=r+h,l*=r+h;let p=n.clone();return p.x-=d,p.y-=u,n.x+=-(2*d),n.y+=-(2*u),()=>{t.begin(),t.moveTo(p.x-a-l/e,p.y-l+a/e),t.lineTo(p.x,p.y),t.lineTo(p.x+l/e-a,p.y-l-a/e),t.stroke()}}}MarkerShape.markers={};let oval=(e,t,i,s,n,a,l,r,o,h)=>{let c=l/2,d=s.clone();return s.x-=n*c,s.y-=a*c,()=>{e.ellipse(d.x-c,d.y-c,l,l),h?e.fillAndStroke():e.stroke()}};function diamond(e,t,i,s,n,a,l,r,o,h){let c=i===ARROW.DIAMOND?.7071:.9862,d=n*o*c,u=a*o*c;n*=l+o,a*=l+o;let p=s.clone();p.x-=d,p.y-=u,s.x+=-n-d,s.y+=-a-u;let g=i===ARROW.DIAMOND?2:3.4;return()=>{e.begin(),e.moveTo(p.x,p.y),e.lineTo(p.x-n/2-a/g,p.y+n/g-a/2),e.lineTo(p.x-n,p.y-a),e.lineTo(p.x-n/2+a/g,p.y-a/2-n/g),e.close(),h?e.fillAndStroke():e.stroke()}}let isDefaultMarkersRegistered=!1,registerDefaultEdgeMarkers=()=>{isDefaultMarkersRegistered||(MarkerShape.addMarker("classic",createArrow(2)),MarkerShape.addMarker("classicThin",createArrow(3)),MarkerShape.addMarker("block",createArrow(2)),MarkerShape.addMarker("blockThin",createArrow(3)),MarkerShape.addMarker("open",createOpenArrow(2)),MarkerShape.addMarker("openThin",createOpenArrow(3)),MarkerShape.addMarker("oval",oval),MarkerShape.addMarker("diamond",diamond),MarkerShape.addMarker("diamondThin",diamond),isDefaultMarkersRegistered=!0)};class ConnectorShape extends PolylineShape{constructor(e,t,i){super(e,t,i)}updateBoundingBox(){var e;this.useSvgBoundingBox=(null==(e=this.style)?void 0:e.curved)??!1,super.updateBoundingBox()}paintEdgeShape(e,t){var i,s,n,a;let l=this.createMarker(e,t,!0),r=this.createMarker(e,t,!1);if(super.paintEdgeShape(e,t),e.setShadow(!1),e.setDashed(!1),l){let t=(null==(i=this.style)?void 0:i.startStrokeColor)??this.stroke;e.setStrokeColor(t),e.setFillColor((null==(s=this.style)?void 0:s.startFillColor)??t),l()}if(r){let t=(null==(n=this.style)?void 0:n.endStrokeColor)??this.stroke;e.setStrokeColor(t),e.setFillColor((null==(a=this.style)?void 0:a.endFillColor)??t),r()}}createMarker(e,t,i){if(!this.style)return null;let s=null,n=t.length,a=(i?this.style.startArrow:this.style.endArrow)||NONE,l=i?t[1]:t[n-2],r=i?t[0]:t[n-1];if(a!==NONE&&null!==l&&null!==r){let o=1;for(;o<n-1&&0===Math.round(l.x-r.x)&&0===Math.round(l.y-r.y);)l=i?t[1+o]:t[n-2-o],o++;let h=r.x-l.x,c=r.y-l.y,d=Math.max(1,Math.sqrt(h*h+c*c)),u=h/d,p=c/d,g=(i?this.style.startSize:this.style.endSize)??DEFAULT_MARKERSIZE,m=(i?this.style.startFill:this.style.endFill)??!0;s=MarkerShape.createMarker(e,this,a,r,u,p,g,i,this.strokeWidth,m)}return s}augmentBoundingBox(e){if(super.augmentBoundingBox(e),!this.style)return;let t=0;this.style.startArrow!==NONE&&(t=(this.style.startSize??DEFAULT_MARKERSIZE)+1),this.style.endArrow!==NONE&&(t=Math.max(t,this.style.endSize??DEFAULT_MARKERSIZE)+1),e.grow(t*this.scale)}}class TextShape extends Shape{constructor(e,t,i=ALIGN.CENTER,s=ALIGN.MIDDLE,n="black",a=DEFAULT_FONTFAMILY,l=DEFAULT_FONTSIZE,r=DEFAULT_FONTSTYLE,o=2,h=0,c=0,d=0,u=0,p=!0,g=NONE,m=NONE,f=!1,x=!1,v="visible",b=0,y=DEFAULT_TEXT_DIRECTION){super(),this.margin=null,this.unrotatedBoundingBox=null,this.flipH=!1,this.flipV=!1,this.baseSpacingTop=0,this.baseSpacingBottom=0,this.baseSpacingLeft=0,this.baseSpacingRight=0,this.replaceLinefeeds=!0,this.verticalTextRotation=-90,this.ignoreClippedStringSize=!0,this.ignoreStringSize=!1,this.lastValue=null,this.cacheEnabled=!0,this.value=e,this.bounds=t,this.color=n??"black",this.align=i??ALIGN.CENTER,this.valign=s??ALIGN.MIDDLE,this.family=a??DEFAULT_FONTFAMILY,this.size=l??DEFAULT_FONTSIZE,this.fontStyle=r??DEFAULT_FONTSTYLE,this.spacing=o??2,this.spacingTop=this.spacing+(h??0),this.spacingRight=this.spacing+(c??0),this.spacingBottom=this.spacing+(d??0),this.spacingLeft=this.spacing+(u??0),this.horizontal=p??!0,this.background=g,this.border=m,this.wrap=f??!1,this.clipped=x??!1,this.overflow=v??"visible",this.labelPadding=b??0,this.textDirection=y,this.rotation=0,this.updateMargin()}getSvgScreenOffset(){return 0}checkBounds(){return!isNaN(this.scale)&&isFinite(this.scale)&&this.scale>0&&this.bounds&&!isNaN(this.bounds.x)&&!isNaN(this.bounds.y)&&!isNaN(this.bounds.width)&&!isNaN(this.bounds.height)}paint(e,t=!1){let i=this.scale,s=this.bounds.x/i,n=this.bounds.y/i,a=this.bounds.width/i,l=this.bounds.height/i;if(this.updateTransform(e,s,n,a,l),this.configureCanvas(e,s,n,a,l),t)e.updateText(s,n,a,l,this.align,this.valign,this.wrap,this.overflow,this.clipped,this.getTextRotation(),this.node);else{let t=isNode(this.value)||this.dialect===DIALECT.STRICTHTML,i=t?"html":"",r=this.value;t||"html"!==i||(r=htmlEntities(r,!1)),"html"!==i||isNode(this.value)||(r=replaceTrailingNewlines(r,"<div><br></div>")),r=!isNode(this.value)&&this.replaceLinefeeds&&"html"===i?r.replace(/\n/g,"<br/>"):r;let o=this.textDirection;o!==TEXT_DIRECTION.AUTO||t||(o=this.getAutoDirection()),o!==TEXT_DIRECTION.LTR&&o!==TEXT_DIRECTION.RTL&&(o=TEXT_DIRECTION.DEFAULT),e.text(s,n,a,l,r,this.align,this.valign,this.wrap,i,this.overflow,this.clipped,this.getTextRotation(),o)}}redraw(){if(this.visible&&this.checkBounds()&&this.cacheEnabled&&this.lastValue===this.value&&(isNode(this.value)||this.dialect===DIALECT.STRICTHTML))if("DIV"===this.node.nodeName)this.redrawHtmlShape(),this.updateBoundingBox();else{let e=this.createCanvas();e&&(e.pointerEvents=this.pointerEvents,this.paint(e,!0),this.destroyCanvas(e),this.updateBoundingBox())}else super.redraw(),isNode(this.value)||this.dialect===DIALECT.STRICTHTML?this.lastValue=this.value:this.lastValue=null}resetStyles(){super.resetStyles(),this.color="black",this.align=ALIGN.CENTER,this.valign=ALIGN.MIDDLE,this.family=DEFAULT_FONTFAMILY,this.size=DEFAULT_FONTSIZE,this.fontStyle=DEFAULT_FONTSTYLE,this.spacing=2,this.spacingTop=2,this.spacingRight=2,this.spacingBottom=2,this.spacingLeft=2,this.horizontal=!0,this.background=NONE,this.border=NONE,this.textDirection=DEFAULT_TEXT_DIRECTION,this.margin=null}apply(e){let t=this.spacing;super.apply(e),this.style&&(this.fontStyle=this.style.fontStyle??this.fontStyle,this.family=this.style.fontFamily??this.family,this.size=this.style.fontSize??this.size,this.color=this.style.fontColor??this.color,this.align=this.style.align??this.align,this.valign=this.style.verticalAlign??this.valign,this.spacing=this.style.spacing??this.spacing,this.spacingTop=(this.style.spacingTop??this.spacingTop-t)+this.spacing,this.spacingRight=(this.style.spacingRight??this.spacingRight-t)+this.spacing,this.spacingBottom=(this.style.spacingBottom??this.spacingBottom-t)+this.spacing,this.spacingLeft=(this.style.spacingLeft??this.spacingLeft-t)+this.spacing,this.horizontal=this.style.horizontal??this.horizontal,this.background=this.style.labelBackgroundColor??this.background,this.border=this.style.labelBorderColor??this.border,this.textDirection=this.style.textDirection??DEFAULT_TEXT_DIRECTION,this.opacity=this.style.textOpacity??100,this.updateMargin()),this.flipV=!1,this.flipH=!1}getAutoDirection(){let e=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(String(this.value));return e&&e.length>0&&e[0]>"z"?TEXT_DIRECTION.RTL:TEXT_DIRECTION.LTR}getContentNode(){let e=this.node;return e&&(e=e.ownerSVGElement?e.firstChild.firstChild.firstChild.firstChild.firstChild:this.node.firstChild.firstChild),e}updateBoundingBox(){var e,t,i;let{node:s}=this;this.boundingBox=this.bounds.clone();let n=this.getTextRotation(),a=(null==(e=this.style)?void 0:e.labelPosition)??ALIGN.CENTER,l=(null==(t=this.style)?void 0:t.verticalLabelPosition)??ALIGN.MIDDLE;if(!this.ignoreStringSize&&s&&"fill"!==this.overflow&&(!this.clipped||!this.ignoreClippedStringSize||a!==ALIGN.CENTER||l!==ALIGN.MIDDLE)){let e=null,t=null;if(s.firstChild&&s.firstChild.firstChild&&"foreignObject"===s.firstChild.firstChild.nodeName)t=(s=s.firstChild.firstChild.firstChild.firstChild).offsetHeight*this.scale,e="width"===this.overflow?this.boundingBox.width:s.offsetWidth*this.scale;else try{let e=s.getBBox();"string"==typeof this.value&&(null==(i=trim(this.value))?void 0:i.length)===0||0===e.width&&0===e.height?this.boundingBox=null:this.boundingBox=new Rectangle(e.x,e.y,e.width,e.height);return}catch(e){}e&&t&&(this.boundingBox=new Rectangle(this.bounds.x,this.bounds.y,e,t))}if(this.boundingBox){let e=this.margin;if(0!==n){let t=getBoundingBox(new Rectangle(e.x*this.boundingBox.width,e.y*this.boundingBox.height,this.boundingBox.width,this.boundingBox.height),n,new Point(0,0));this.unrotatedBoundingBox=Rectangle.fromRectangle(this.boundingBox),this.unrotatedBoundingBox.x+=e.x*this.unrotatedBoundingBox.width,this.unrotatedBoundingBox.y+=e.y*this.unrotatedBoundingBox.height,this.boundingBox.x+=t.x,this.boundingBox.y+=t.y,this.boundingBox.width=t.width,this.boundingBox.height=t.height}else this.boundingBox.x+=e.x*this.boundingBox.width,this.boundingBox.y+=e.y*this.boundingBox.height,this.unrotatedBoundingBox=null}}getShapeRotation(){return 0}getTextRotation(){return this.state&&this.state.shape?this.state.shape.getTextRotation():0}isPaintBoundsInverted(){return!this.horizontal&&!!this.state&&this.state.cell.isVertex()}configureCanvas(e,t,i,s,n){super.configureCanvas(e,t,i,s,n),e.setFontColor(this.color),e.setFontBackgroundColor(this.background),e.setFontBorderColor(this.border),e.setFontFamily(this.family),e.setFontSize(this.size),e.setFontStyle(this.fontStyle)}getHtmlValue(){let e=this.value;return this.dialect!==DIALECT.STRICTHTML&&(e=htmlEntities(e,!1)),e=replaceTrailingNewlines(e,"<div><br></div>"),e=this.replaceLinefeeds?e.replace(/\n/g,"<br/>"):e}getTextCss(){let e=LINE_HEIGHT,t=`display: inline-block; font-size: ${this.size}px; font-family: ${this.family}; color: ${this.color}; line-height: ${e}; pointer-events: ${this.pointerEvents?"all":"none"}; `;matchBinaryMask(this.fontStyle,FONT.BOLD)&&(t+="font-weight: bold; "),matchBinaryMask(this.fontStyle,FONT.ITALIC)&&(t+="font-style: italic; ");let i=[];return matchBinaryMask(this.fontStyle,FONT.UNDERLINE)&&i.push("underline"),matchBinaryMask(this.fontStyle,FONT.STRIKETHROUGH)&&i.push("line-through"),i.length>0&&(t+=`text-decoration: ${i.join(" ")}; `),t}redrawHtmlShape(){let e=Math.max(0,Math.round(this.bounds.width/this.scale)),t=Math.max(0,Math.round(this.bounds.height/this.scale)),i=`position: absolute; left: ${Math.round(this.bounds.x)}px; top: ${Math.round(this.bounds.y)}px; pointer-events: none; `,s=this.getTextCss(),n=this.margin,a=this.node;SvgCanvas2D.createCss(e+2,t,this.align,this.valign,this.wrap,this.overflow,this.clipped,this.background!==NONE?htmlEntities(this.background,!0):null,this.border!==NONE?htmlEntities(this.border,!0):null,i,s,this.scale,(e,t,i,s,l,r)=>{let o=this.getTextRotation(),h=(1!==this.scale?`scale(${this.scale}) `:"")+(0!==o?`rotate(${o}deg) `:"")+(0!==n.x||0!==n.y?`translate(${100*n.x}%,${100*n.y}%)`:"");""!==h&&(h=`transform-origin: 0 0; transform: ${h}; `),""===r?(i+=s,s=`display:inline-block; min-width: 100%; ${h}`):(s+=h,Client.IS_SF&&(s+="-webkit-clip-path: content-box;")),this.opacity<100&&(l+=`opacity: ${this.opacity/100}; `),a.setAttribute("style",i);let c=isNode(this.value)?this.value.outerHTML:this.getHtmlValue();a.firstChild||(a.innerHTML=`<div><div>${c}</div></div>`),a.firstChild.firstChild.setAttribute("style",l),a.firstChild.setAttribute("style",s)})}updateInnerHtml(e){if(isNode(this.value))e.innerHTML=this.value.outerHTML;else{let t=this.value;this.dialect!==DIALECT.STRICTHTML&&(t=htmlEntities(t,!1)),t=replaceTrailingNewlines(t,"<div>&nbsp;</div>"),t=this.replaceLinefeeds?t.replace(/\n/g,"<br/>"):t,e.innerHTML=t=`<div style="display:inline-block;_display:inline;">${t}</div>`}}updateValue(){let e=this.node;if(isNode(this.value))e.innerHTML="",e.appendChild(this.value);else{let t=this.value;this.dialect!==DIALECT.STRICTHTML&&(t=htmlEntities(t,!1)),t=replaceTrailingNewlines(t,"<div><br></div>"),t=this.replaceLinefeeds?t.replace(/\n/g,"<br/>"):t;let i=this.background!==NONE?this.background:null,s=this.border!==NONE?this.border:null;if("fill"===this.overflow||"width"===this.overflow)i&&(e.style.backgroundColor=i),s&&(e.style.border=`1px solid ${s}`);else{let e="";i&&(e+=`background-color:${htmlEntities(i,!0)};`),s&&(e+=`border:1px solid ${htmlEntities(s,!0)};`);let n=LINE_HEIGHT;t=`<div style="zoom:1;${e}display:inline-block;_display:inline;text-decoration:inherit;padding-bottom:1px;padding-right:1px;line-height:${n}">${t}</div>`}e.innerHTML=t;let n=e.getElementsByTagName("div");if(n.length>0){let e=this.textDirection;e===TEXT_DIRECTION.AUTO&&this.dialect!==DIALECT.STRICTHTML&&(e=this.getAutoDirection()),e===TEXT_DIRECTION.LTR||e===TEXT_DIRECTION.RTL?n[n.length-1].setAttribute("dir",e):n[n.length-1].removeAttribute("dir")}}}updateFont(e){let{style:t}=e;t.lineHeight=LINE_HEIGHT,t.fontSize=`${this.size}px`,t.fontFamily=this.family,t.verticalAlign="top",t.color=this.color,matchBinaryMask(this.fontStyle,FONT.BOLD)?t.fontWeight="bold":t.fontWeight="",matchBinaryMask(this.fontStyle,FONT.ITALIC)?t.fontStyle="italic":t.fontStyle="";let i=[];matchBinaryMask(this.fontStyle,FONT.UNDERLINE)&&i.push("underline"),matchBinaryMask(this.fontStyle,FONT.STRIKETHROUGH)&&i.push("line-through"),i.length>0&&(t.textDecoration=i.join(" ")),this.align===ALIGN.CENTER?t.textAlign="center":this.align===ALIGN.RIGHT?t.textAlign="right":t.textAlign="left"}updateSize(e,t=!1){let i=Math.max(0,Math.round(this.bounds.width/this.scale)),s=Math.max(0,Math.round(this.bounds.height/this.scale)),{style:n}=e;if(this.clipped?(n.overflow="hidden",n.maxHeight=`${s}px`,n.maxWidth=`${i}px`):"fill"===this.overflow?(n.width=`${i+1}px`,n.height=`${s+1}px`,n.overflow="hidden"):"width"===this.overflow&&(n.width=`${i+1}px`,n.maxHeight=`${s+1}px`,n.overflow="hidden"),this.wrap&&i>0){if(n.wordWrap=WORD_WRAP,n.whiteSpace="normal",n.width=`${i}px`,t&&"fill"!==this.overflow&&"width"!==this.overflow){let t=e;null!=t.firstChild&&"DIV"===t.firstChild.nodeName&&(t=t.firstChild,"break-word"===e.style.wordWrap&&(t.style.width="100%"));let s=t.offsetWidth;if(0===s){let i=e.parentNode;e.style.visibility="hidden",document.body.appendChild(e),s=t.offsetWidth,e.style.visibility="",i.appendChild(e)}s+=3,this.clipped&&(s=Math.min(s,i)),n.width=`${s}px`}}else n.whiteSpace="nowrap"}updateMargin(){this.margin=getAlignmentAsPoint(this.align,this.valign)}getSpacing(){let e=0,t=0;return new Point(e=this.align===ALIGN.CENTER?(this.spacingLeft-this.spacingRight)/2:this.align===ALIGN.RIGHT?-this.spacingRight-this.baseSpacingRight:this.spacingLeft+this.baseSpacingLeft,t=this.valign===ALIGN.MIDDLE?(this.spacingTop-this.spacingBottom)/2:this.valign===ALIGN.BOTTOM?-this.spacingBottom-this.baseSpacingBottom:this.spacingTop+this.baseSpacingTop)}}class StencilShapeRegistry{static addStencil(e,t){StencilShapeRegistry.stencils[e]=t}static getStencil(e){return StencilShapeRegistry.stencils[e]}}StencilShapeRegistry.stencils={};let placeholderStyleValues=["inherit","swimlane","indicated"],placeholderStyleProperties=["fillColor","strokeColor","gradientColor","fontColor"];class CellRenderer{constructor(){this.defaultEdgeShape=ConnectorShape,this.defaultVertexShape=RectangleShape,this.defaultTextShape=TextShape,this.legacyControlPosition=!0,this.legacySpacing=!0,this.antiAlias=!0,this.minSvgStrokeWidth=1,this.forceControlClickHandler=!1}static registerShape(e,t){CellRenderer.defaultShapes[e]=t}initializeShape(e){e.shape&&(e.shape.dialect=e.view.graph.dialect,this.configureShape(e),e.shape.init(e.view.getDrawPane()))}createShape(e){let t=StencilShapeRegistry.getStencil(e.style.shape);return t?new Shape(t):new(this.getShapeConstructor(e))}createIndicatorShape(e){e.shape&&(e.shape.indicatorShape=this.getShape(e.getIndicatorShape()))}getShape(e){return e?CellRenderer.defaultShapes[e]:null}getShapeConstructor(e){let t=this.getShape(e.style.shape||null);return t||(t=e.cell.isEdge()?this.defaultEdgeShape:this.defaultVertexShape),t}configureShape(e){let t=e.shape;t&&(t.apply(e),t.imageSrc=e.getImageSrc()||null,t.indicatorColor=e.getIndicatorColor()||NONE,t.indicatorStrokeColor=e.style.indicatorStrokeColor||NONE,t.indicatorGradientColor=e.getIndicatorGradientColor()||NONE,e.style.indicatorDirection&&(t.indicatorDirection=e.style.indicatorDirection),t.indicatorImageSrc=e.getIndicatorImageSrc()||null,this.postConfigureShape(e))}postConfigureShape(e){e.shape&&(this.resolveColor(e,"indicatorGradientColor","gradientColor"),this.resolveColor(e,"indicatorColor","fillColor"),this.resolveColor(e,"gradient","gradientColor"),this.resolveColor(e,"stroke","strokeColor"),this.resolveColor(e,"fill","fillColor"))}checkPlaceholderStyles(e){for(let t of placeholderStyleProperties)if(placeholderStyleValues.includes(e.style[t]))return!0;return!1}resolveColor(e,t,i){let s="fontColor"===i?e.text:e.shape;if(s){let n=e.view.graph,a=s[t],l=null;if("inherit"===a?l=e.cell.getParent():"swimlane"===a?(s[t]="strokeColor"===i||"fontColor"===i?"#000000":"#ffffff",l=e.cell.getTerminal(!1)?e.cell.getTerminal(!1):e.cell,l=n.getSwimlane(l),i=n.swimlaneIndicatorColorAttribute):"indicated"===a&&e.shape?s[t]=e.shape.indicatorColor:"fillColor"!==i&&"fillColor"===a&&e.shape?s[t]=e.style.fillColor:"strokeColor"!==i&&"strokeColor"===a&&e.shape&&(s[t]=e.style.strokeColor),l){let e=n.getView().getState(l);if(s[t]=null,e){let n="fontColor"===i?e.text:e.shape;n&&"indicatorColor"!==t?s[t]=n[t]:s[t]=e.style[i]}}}}getLabelValue(e){return e.view.graph.getLabel(e.cell)}createLabel(e,t){let i=e.view.graph;if((e.style.fontSize||0)>0||null==e.style.fontSize){let s=i.isHtmlLabel(e.cell)||isNode(t);e.text=new this.defaultTextShape(t,new Rectangle,e.style.align??ALIGN.CENTER,e.getVerticalAlign(),e.style.fontColor,e.style.fontFamily,e.style.fontSize,e.style.fontStyle,e.style.spacing,e.style.spacingTop,e.style.spacingRight,e.style.spacingBottom,e.style.spacingLeft,e.style.horizontal,e.style.labelBackgroundColor,e.style.labelBorderColor,i.isWrapping(e.cell)&&i.isHtmlLabel(e.cell),i.isLabelClipped(e.cell),e.style.overflow,e.style.labelPadding,e.style.textDirection??DEFAULT_TEXT_DIRECTION),e.text.opacity=e.style.textOpacity??100,e.text.dialect=s?DIALECT.STRICTHTML:i.dialect,e.text.style=e.style,e.text.state=e,this.initializeLabel(e,e.text);let n=!1,a=t=>{let s=e;if(Client.IS_TOUCH||n){let e=getClientX(t),n=getClientY(t),a=convertPoint(i.container,e,n);s=i.view.getState(i.getCellAt(a.x,a.y))}return s};InternalEvent.addGestureListeners(e.text.node,t=>{if(this.isLabelEvent(e,t)){i.fireMouseEvent(InternalEvent.MOUSE_DOWN,new InternalMouseEvent(t,e));let s=getSource(t);n=i.dialect!==DIALECT.SVG&&"IMG"===s.nodeName}},t=>{this.isLabelEvent(e,t)&&i.fireMouseEvent(InternalEvent.MOUSE_MOVE,new InternalMouseEvent(t,a(t)))},t=>{this.isLabelEvent(e,t)&&(i.fireMouseEvent(InternalEvent.MOUSE_UP,new InternalMouseEvent(t,a(t))),n=!1)}),i.isNativeDblClickEnabled()&&InternalEvent.addListener(e.text.node,"dblclick",t=>{this.isLabelEvent(e,t)&&(i.dblClick(t,e.cell),InternalEvent.consume(t))})}}initializeLabel(e,t){if(Client.IS_SVG&&Client.NO_FO&&t.dialect!==DIALECT.SVG){let i=e.view.graph;t.init(i.container)}else t.init(e.view.getDrawPane())}createCellOverlays(e){let t=e.view.graph,i=t.getCellOverlays(e.cell),s=new Dictionary;for(let n of i){let i=e.overlays.remove(n);if(i){s.put(n,i);continue}let a=this.createOverlayShape(e,n);a.dialect=t.dialect,a.overlay=n,this.initializeOverlay(e,a),this.installCellOverlayListeners(e,n,a),this.configureOverlayShape(e,n,a),s.put(n,a)}e.overlays.visit((e,t)=>{t.destroy()}),e.overlays=s}createOverlayShape(e,t){let i=new ImageShape(new Rectangle,t.image.src);return i.preserveImageAspect=!1,i}initializeOverlay(e,t){t.init(e.view.getOverlayPane())}installCellOverlayListeners(e,t,i){let s=e.view.graph;InternalEvent.addListener(i.node,"click",i=>{s.isEditing()&&s.stopEditing(!s.isInvokesStopCellEditing()),t.fireEvent(new EventObject(InternalEvent.CLICK,{event:i,cell:e.cell}))}),InternalEvent.addGestureListeners(i.node,e=>{InternalEvent.consume(e)},t=>{s.fireMouseEvent(InternalEvent.MOUSE_MOVE,new InternalMouseEvent(t,e))}),Client.IS_TOUCH&&InternalEvent.addListener(i.node,"touchend",i=>{t.fireEvent(new EventObject(InternalEvent.CLICK,{event:i,cell:e.cell}))})}configureOverlayShape(e,t,i){t.cursor&&(i.node.style.cursor=t.cursor)}createControl(e){let t=e.view.graph,i=t.getFoldingImage(e);t.isFoldingEnabled()&&i?e.control||(e.control=new ImageShape(new Rectangle(0,0,i.width,i.height),i.src),e.control.preserveImageAspect=!1,e.control.dialect=t.dialect,this.initControl(e,e.control,!0,this.createControlClickHandler(e))):e.control&&(e.control.destroy(),e.control=null)}createControlClickHandler(e){let t=e.view.graph;return i=>{if(this.forceControlClickHandler||t.isEnabled()){let s=!e.cell.isCollapsed();t.foldCells(s,!1,[e.cell],!1,i),InternalEvent.consume(i)}}}initControl(e,t,i,s){let n=e.view.graph;n.isHtmlLabel(e.cell)&&Client.NO_FO&&n.dialect===DIALECT.SVG?(t.dialect=DIALECT.PREFERHTML,t.init(n.container),t.node.style.zIndex=String(1)):t.init(e.view.getOverlayPane());let a=t.node;if(s&&!Client.IS_IOS&&(n.isEnabled()&&(a.style.cursor="pointer"),InternalEvent.addListener(a,"click",s)),i){let t=null;InternalEvent.addGestureListeners(a,i=>{t=new Point(getClientX(i),getClientY(i)),n.fireMouseEvent(InternalEvent.MOUSE_DOWN,new InternalMouseEvent(i,e)),InternalEvent.consume(i)},t=>{n.fireMouseEvent(InternalEvent.MOUSE_MOVE,new InternalMouseEvent(t,e))},t=>{n.fireMouseEvent(InternalEvent.MOUSE_UP,new InternalMouseEvent(t,e)),InternalEvent.consume(t)}),s&&Client.IS_IOS&&a.addEventListener("touchend",e=>{if(t){let i=n.getEventTolerance();Math.abs(t.x-getClientX(e))<i&&Math.abs(t.y-getClientY(e))<i&&(s.call(s,e),InternalEvent.consume(e))}},!0)}return a}isShapeEvent(e,t){return!0}isLabelEvent(e,t){return!0}installListeners(e){let t=e.view.graph,i=i=>{let s=e,n=getSource(i);if(n&&t.dialect!==DIALECT.SVG&&"IMG"===n.nodeName||Client.IS_TOUCH){let e=getClientX(i),n=getClientY(i),a=convertPoint(t.container,e,n),l=t.getCellAt(a.x,a.y);s=l?t.view.getState(l):null}return s};e.shape&&(InternalEvent.addGestureListeners(e.shape.node,i=>{this.isShapeEvent(e,i)&&t.fireMouseEvent(InternalEvent.MOUSE_DOWN,new InternalMouseEvent(i,e))},s=>{this.isShapeEvent(e,s)&&t.fireMouseEvent(InternalEvent.MOUSE_MOVE,new InternalMouseEvent(s,i(s)))},s=>{this.isShapeEvent(e,s)&&t.fireMouseEvent(InternalEvent.MOUSE_UP,new InternalMouseEvent(s,i(s)))}),t.isNativeDblClickEnabled()&&InternalEvent.addListener(e.shape.node,"dblclick",i=>{this.isShapeEvent(e,i)&&(t.dblClick(i,e.cell),InternalEvent.consume(i))}))}redrawLabel(e,t){let i=e.view.graph,s=this.getLabelValue(e),n=i.isWrapping(e.cell),a=i.isLabelClipped(e.cell),l=i.isHtmlLabel(e.cell)||s&&isNode(s)?DIALECT.STRICTHTML:i.dialect,r=e.style.overflow??"visible";if(e.text&&(e.text.wrap!==n||e.text.clipped!==a||e.text.overflow!==r||e.text.dialect!==l)&&(e.text.destroy(),e.text=null),null==e.text&&null!=s&&(isNode(s)||s.length>0)?this.createLabel(e,s):null!=e.text&&(null==s||0==s.length)&&(e.text.destroy(),e.text=null),null!=e.text){t&&(null!=e.text.lastValue&&this.isTextShapeInvalid(e,e.text)&&(e.text.lastValue=null),e.text.resetStyles(),e.text.apply(e),e.text.valign=e.getVerticalAlign());let i=this.getLabelBounds(e),o=this.getTextScale(e);if(this.resolveColor(e,"color","fontColor"),t||e.text.value!==s||e.text.wrap!==n||e.text.overflow!==r||e.text.clipped!==a||e.text.scale!==o||e.text.dialect!==l||null==e.text.bounds||!e.text.bounds.equals(i)){e.text.dialect=l,e.text.value=s,e.text.bounds=i,e.text.scale=o,e.text.wrap=n,e.text.clipped=a,e.text.overflow=r;let t=e.text.node.style.visibility;this.redrawLabelShape(e.text),e.text.node.style.visibility=t}}}isTextShapeInvalid(e,t){function i(i,s,n){let a=!1;return"spacingTop"===s||"spacingRight"===s||"spacingBottom"===s||"spacingLeft"===s?parseFloat(String(t[i]))-parseFloat(String(t.spacing))!==(e.style[s]||n):t[i]!==(e.style[s]||n)}return i("fontStyle","fontStyle",DEFAULT_FONTSTYLE)||i("family","fontFamily",DEFAULT_FONTFAMILY)||i("size","fontSize",DEFAULT_FONTSIZE)||i("color","fontColor","black")||i("align","align","")||i("valign","verticalAlign","")||i("spacing","spacing",2)||i("spacingTop","spacingTop",0)||i("spacingRight","spacingRight",0)||i("spacingBottom","spacingBottom",0)||i("spacingLeft","spacingLeft",0)||i("horizontal","horizontal",!0)||i("background","labelBackgroundColor",null)||i("border","labelBorderColor",null)||i("opacity","textOpacity",100)||i("textDirection","textDirection",DEFAULT_TEXT_DIRECTION)}redrawLabelShape(e){e.redraw()}getTextScale(e){return e.view.scale}getLabelBounds(e){let{scale:t}=e.view,i=e.cell.isEdge(),s=new Rectangle(e.absoluteOffset.x,e.absoluteOffset.y);if(i){let i=e.text.getSpacing();s.x+=i.x*t,s.y+=i.y*t;let n=e.cell.getGeometry();null!=n&&(s.width=Math.max(0,n.width*t),s.height=Math.max(0,n.height*t))}else{if(e.text.isPaintBoundsInverted()){let e=s.x;s.x=s.y,s.y=e}s.x+=e.x,s.y+=e.y,s.width=Math.max(1,e.width),s.height=Math.max(1,e.height)}if(e.text.isPaintBoundsInverted()){let t=(e.width-e.height)/2;s.x+=t,s.y-=t;let i=s.width;s.width=s.height,s.height=i}if(null!=e.shape){let t=e.style.labelPosition??ALIGN.CENTER,i=e.style.verticalLabelPosition??ALIGN.MIDDLE;t===ALIGN.CENTER&&i===ALIGN.MIDDLE&&(s=e.shape.getLabelBounds(s))}let n=e.style.labelWidth??null;return null!=n&&(s.width=n*t),i||this.rotateLabelBounds(e,s),s}rotateLabelBounds(e,t){if(t.y-=e.text.margin.y*t.height,t.x-=e.text.margin.x*t.width,!this.legacySpacing||"fill"!==e.style.overflow&&"width"!==e.style.overflow){let i=e.view.scale,s=e.text.getSpacing();t.x+=s.x*i,t.y+=s.y*i;let n=e.style.labelPosition??ALIGN.CENTER,a=e.style.verticalLabelPosition??ALIGN.MIDDLE,l=e.style.labelWidth??null;t.width=Math.max(0,t.width-(n===ALIGN.CENTER&&null==l?e.text.spacingLeft*i+e.text.spacingRight*i:0)),t.height=Math.max(0,t.height-(a===ALIGN.MIDDLE?e.text.spacingTop*i+e.text.spacingBottom*i:0))}let i=e.text.getTextRotation();if(0!==i&&null!=e&&e.cell.isVertex()){let s=e.getCenterX(),n=e.getCenterY();if(t.x!==s||t.y!==n){let e=Math.PI/180*i,a=getRotatedPoint(new Point(t.x,t.y),Math.cos(e),Math.sin(e),new Point(s,n));t.x=a.x,t.y=a.y}}}redrawCellOverlays(e,t=!1){if(this.createCellOverlays(e),null!=e.overlays){let i=mod(e.style.rotation??0,90),s=toRadians(i),n=Math.cos(s),a=Math.sin(s);e.overlays.visit((s,l)=>{let r=l.overlay.getBounds(e);if(!e.cell.isEdge()&&null!=e.shape&&0!==i){let t=r.getCenterX(),i=r.getCenterY(),s=getRotatedPoint(new Point(t,i),n,a,new Point(e.getCenterX(),e.getCenterY()));t=s.x,i=s.y,r.x=Math.round(t-r.width/2),r.y=Math.round(i-r.height/2)}(t||null==l.bounds||l.scale!==e.view.scale||!l.bounds.equals(r))&&(l.bounds=r,l.scale=e.view.scale,l.redraw())})}}redrawControl(e,t=!1){let i=e.view.graph.getFoldingImage(e);if(null!=e.control&&null!=i){let s=this.getControlBounds(e,i.width,i.height),n=this.legacyControlPosition?e.style.rotation??0:e.shape.getTextRotation(),a=e.view.scale;(t||e.control.scale!==a||!e.control.bounds.equals(s)||e.control.rotation!==n)&&(e.control.rotation=n,e.control.bounds=s,e.control.scale=a,e.control.redraw())}}getControlBounds(e,t,i){if(null!=e.control){let s=e.view.scale,n=e.getCenterX(),a=e.getCenterY();if(!e.cell.isEdge()&&(n=e.x+t*s,a=e.y+i*s,null!=e.shape)){let t=e.shape.getShapeRotation();if(this.legacyControlPosition)t=e.style.rotation??0;else if(e.shape.isPaintBoundsInverted()){let t=(e.width-e.height)/2;n+=t,a-=t}if(0!==t){let i=toRadians(t),s=Math.cos(i),l=Math.sin(i),r=getRotatedPoint(new Point(n,a),s,l,new Point(e.getCenterX(),e.getCenterY()));n=r.x,a=r.y}}return e.cell.isEdge(),new Rectangle(Math.round(n-t/2*s),Math.round(a-i/2*s),Math.round(t*s),Math.round(i*s))}return null}insertStateAfter(e,t,i){let s=e.view.graph,n=this.getShapesForState(e);for(let a=0;a<n.length;a+=1)if(null!=n[a]&&null!=n[a].node){let l=n[a].node.parentNode!==e.view.getDrawPane()&&n[a].node.parentNode!==e.view.getOverlayPane(),r=l?i:t;if(null!=r&&r.nextSibling!==n[a].node)null==r.nextSibling?r.parentNode.appendChild(n[a].node):r.parentNode.insertBefore(n[a].node,r.nextSibling);else if(null==r){let t=n[a].node;if(t.parentNode===s.container){let{canvas:i}=e.view;for(;null!=i&&i.parentNode!==s.container;)i=i.parentNode;null!=i&&null!=i.nextSibling?i.nextSibling!==t&&t.parentNode.insertBefore(t,i.nextSibling):t.parentNode.appendChild(t)}else null!=t.parentNode&&null!=t.parentNode.firstChild&&t.parentNode.firstChild!=t&&t.parentNode.insertBefore(t,t.parentNode.firstChild)}l?i=n[a].node:t=n[a].node}return[t,i]}getShapesForState(e){return[e.shape,e.text,e.control]}redraw(e,t=!1,i=!0){let s=this.redrawShape(e,t,i);null!=e.shape&&i&&(this.redrawLabel(e,s),this.redrawCellOverlays(e,s),this.redrawControl(e,s))}redrawShape(e,t=!1,i=!0){let s=!1,n=e.view.graph;null!=e.shape&&null!=e.shape.style&&null!=e.style&&e.shape.style.shape!==e.style.shape&&(e.shape.destroy(),e.shape=null);let a=n.getPlugin("SelectionCellsHandler");return null==e.shape&&null!=n.container&&e.cell!==e.view.currentRoot&&(e.cell.isVertex()||e.cell.isEdge())?(e.shape=this.createShape(e),null!=e.shape&&(e.shape.minSvgStrokeWidth=this.minSvgStrokeWidth,e.shape.antiAlias=this.antiAlias,this.createIndicatorShape(e),this.initializeShape(e),this.createCellOverlays(e),this.installListeners(e),null==a||a.updateHandler(e))):!t&&null!=e.shape&&(!equalEntries(e.shape.style,e.style)||this.checkPlaceholderStyles(e))&&(e.shape.resetStyles(),this.configureShape(e),null==a||a.updateHandler(e),t=!0),null!=e.shape&&e.shape.indicatorShape!=this.getShape(e.getIndicatorShape())&&(null!=e.shape.indicator&&(e.shape.indicator.destroy(),e.shape.indicator=null),this.createIndicatorShape(e),null!=e.shape.indicatorShape&&(e.shape.indicator=new e.shape.indicatorShape,e.shape.indicator.dialect=e.shape.dialect,e.shape.indicator.init(e.node),t=!0)),e.shape&&(this.createControl(e),(t||this.isShapeInvalid(e,e.shape))&&(e.absolutePoints.length>0?(e.shape.points=e.absolutePoints.slice(),e.shape.bounds=null):(e.shape.points=[],e.shape.bounds=new Rectangle(e.x,e.y,e.width,e.height)),e.shape.scale=e.view.scale,null==i||i?this.doRedrawShape(e):e.shape.updateBoundingBox(),s=!0)),s}doRedrawShape(e){var t;null==(t=e.shape)||t.redraw()}isShapeInvalid(e,t){return null==t.bounds||t.scale!==e.view.scale||0===e.absolutePoints.length&&!t.bounds.equals(e)||e.absolutePoints.length>0&&!equalPoints(t.points,e.absolutePoints)}destroy(e){e.shape&&(e.text&&(e.text.destroy(),e.text=null),e.overlays.visit((e,t)=>{t.destroy()}),e.overlays=new Dictionary,e.control&&(e.control.destroy(),e.control=null),e.shape.destroy(),e.shape=null)}}CellRenderer.defaultShapes={};class ChildChange{constructor(e,t,i,s=0){this.model=e,this.parent=t,this.previous=t,this.child=i,this.index=s,this.previousIndex=s}execute(){let e=this.child.getParent(),t=e?e.getIndex(this.child):0;this.previous||this.connect(this.child,!1),e=this.model.parentForCellChanged(this.child,this.previous,this.previousIndex),this.previous&&this.connect(this.child,!0),this.parent=this.previous,this.previous=e,this.index=this.previousIndex,this.previousIndex=t}connect(e,t=!0){let i=e.getTerminal(!0),s=e.getTerminal(!1);i&&(t?this.model.terminalForCellChanged(e,i,!0):this.model.terminalForCellChanged(e,null,!0)),s&&(t?this.model.terminalForCellChanged(e,s,!1):this.model.terminalForCellChanged(e,null,!1)),e.setTerminal(i,!0),e.setTerminal(s,!1);let n=e.getChildCount();for(let i=0;i<n;i+=1)this.connect(e.getChildAt(i),t)}}class CollapseChange{constructor(e,t,i){this.model=e,this.cell=t,this.collapsed=i,this.previous=i}execute(){this.collapsed=this.previous,this.previous=this.model.collapsedStateForCellChanged(this.cell,this.previous)}}class GeometryChange{constructor(e,t,i){this.model=e,this.cell=t,this.geometry=i,this.previous=i}execute(){this.geometry=this.previous,this.previous=this.model.geometryForCellChanged(this.cell,this.previous)}}class RootChange{constructor(e,t){this.model=e,this.root=t,this.previous=t}execute(){this.root=this.previous,this.previous=this.model.rootChanged(this.previous)}}class StyleChange{constructor(e,t,i){this.model=e,this.cell=t,this.style=i,this.previous=i}execute(){this.style=this.previous,this.previous=this.model.styleForCellChanged(this.cell,this.previous)}}class TerminalChange{constructor(e,t,i,s){this.model=e,this.cell=t,this.terminal=i,this.previous=i,this.source=s}execute(){this.terminal=this.previous,this.previous=this.model.terminalForCellChanged(this.cell,this.previous,this.source)}}class ValueChange{constructor(e,t,i){this.model=e,this.cell=t,this.value=i,this.previous=i}execute(){this.value=this.previous,this.previous=this.model.valueForCellChanged(this.cell,this.previous)}}class VisibleChange{constructor(e,t,i){this.model=e,this.cell=t,this.visible=i,this.previous=i}execute(){this.visible=this.previous,this.previous=this.model.visibleStateForCellChanged(this.cell,this.previous)}}class GraphDataModel extends EventSource{constructor(e=null){super(),this.root=null,this.cells={},this.maintainEdgeParent=!0,this.ignoreRelativeEdgeParent=!0,this.createIds=!0,this.prefix="",this.postfix="",this.nextId=0,this.currentEdit=null,this.updateLevel=0,this.endingUpdate=!1,this.currentEdit=this.createUndoableEdit(),null!=e?this.setRoot(e):this.clear()}clear(){this.setRoot(this.createRoot())}isCreateIds(){return this.createIds}setCreateIds(e){this.createIds=e}createRoot(){let e=new Cell;return e.insert(new Cell),e}getCell(e){return this.cells?this.cells[e]:null}filterCells(e,t){return e.filter(t)}getRoot(e=null){return e?e.getRoot():this.root}setRoot(e){return this.execute(new RootChange(this,e)),e}rootChanged(e){let t=this.root;return this.root=e,this.nextId=0,this.cells=null,this.cellAdded(e),t}isRoot(e=null){return null!=e&&this.root===e}isLayer(e){return!!e&&this.isRoot(e.getParent())}contains(e){return this.root.isAncestor(e)}add(e,t,i=null){if(t!==e&&null!=e&&null!=t){null==i&&(i=e.getChildCount());let s=e!==t.getParent();this.execute(new ChildChange(this,e,t,i)),this.maintainEdgeParent&&s&&this.updateEdgeParents(t)}return t}cellAdded(e){if(null!=e){if(null==e.getId()&&this.createIds&&e.setId(this.createId(e)),null!=e.getId()){let t=this.getCell(e.getId());if(t!==e){for(;null!=t;)e.setId(this.createId(e)),t=this.getCell(e.getId());null==this.cells&&(this.cells={}),this.cells[e.getId()]=e}}for(let t of(isNumeric(String(e.getId()))&&(this.nextId=Math.max(this.nextId,parseInt(e.getId()))),e.getChildren()))this.cellAdded(t)}}createId(e){let t=this.nextId;return this.nextId++,this.prefix+t+this.postfix}updateEdgeParents(e,t=this.getRoot(e)){let i=e.getChildCount();for(let s=0;s<i;s+=1){let i=e.getChildAt(s);this.updateEdgeParents(i,t)}let s=e.getEdgeCount(),n=[];for(let t=0;t<s;t+=1)n.push(e.getEdgeAt(t));for(let e=0;e<n.length;e+=1){let i=n[e];t.isAncestor(i)&&this.updateEdgeParent(i,t)}}updateEdgeParent(e,t){let i=e.getTerminal(!0),s=e.getTerminal(!1),n=null;for(;null!=i&&!i.isEdge()&&null!=i.geometry&&i.geometry.relative;)i=i.getParent();for(;null!=s&&this.ignoreRelativeEdgeParent&&!s.isEdge()&&null!=s.geometry&&s.geometry.relative;)s=s.getParent();if(t.isAncestor(i)&&t.isAncestor(s)&&(i===s?n=i?i.getParent():null:i&&(n=i.getNearestCommonAncestor(s)),null!=n&&(n.getParent()!==this.root||n.isAncestor(e))&&e&&e.getParent()!==n)){let t=e.getGeometry();if(null!=t){let i=e.getParent().getOrigin(),s=n.getOrigin(),a=s.x-i.x,l=s.y-i.y;(t=t.clone()).translate(-a,-l),this.setGeometry(e,t)}this.add(n,e,n.getChildCount())}}remove(e){return e===this.root?this.setRoot(null):null!=e.getParent()&&this.execute(new ChildChange(this,null,e)),e}cellRemoved(e){if(null!=e&&null!=this.cells){let t=e.getChildCount();for(let i=t-1;i>=0;i--)this.cellRemoved(e.getChildAt(i));null!=this.cells&&null!=e.getId()&&delete this.cells[e.getId()]}}parentForCellChanged(e,t,i){let s=e.getParent();if(null!=t)(t!==s||s.getIndex(e)!==i)&&t.insert(e,i);else if(null!=s){let t=s.getIndex(e);s.remove(t)}let n=t?this.contains(t):null,a=this.contains(s);return n&&!a?this.cellAdded(e):a&&!n&&this.cellRemoved(e),s}setTerminal(e,t,i){let s=t!==e.getTerminal(i);return this.execute(new TerminalChange(this,e,t,i)),this.maintainEdgeParent&&s&&this.updateEdgeParent(e,this.getRoot()),t}setTerminals(e,t,i){this.beginUpdate();try{this.setTerminal(e,t,!0),this.setTerminal(e,i,!1)}finally{this.endUpdate()}}terminalForCellChanged(e,t,i=!1){let s=e.getTerminal(i);return null!=t?t.insertEdge(e,i):null!=s&&s.removeEdge(e,i),s}getEdgesBetween(e,t,i=!1){let s=e.getEdgeCount(),n=t.getEdgeCount(),a=e,l=s;n<s&&(l=n,a=t);let r=[];for(let s=0;s<l;s+=1){let n=a.getEdgeAt(s),l=n.getTerminal(!0),o=n.getTerminal(!1),h=l===e&&o===t,c=o===e&&l===t;(h||!i&&c)&&r.push(n)}return r}setValue(e,t){return this.execute(new ValueChange(this,e,t)),t}valueForCellChanged(e,t){return e.valueChanged(t)}setGeometry(e,t){return t!==e.getGeometry()&&this.execute(new GeometryChange(this,e,t)),t}geometryForCellChanged(e,t){let i=e.getGeometry();return e.setGeometry(t),i}setStyle(e,t){t!==e.getStyle()&&this.execute(new StyleChange(this,e,t))}styleForCellChanged(e,t){let i=e.getStyle();return e.setStyle(t),i}setCollapsed(e,t){return t!==e.isCollapsed()&&this.execute(new CollapseChange(this,e,t)),t}collapsedStateForCellChanged(e,t){let i=e.isCollapsed();return e.setCollapsed(t),i}setVisible(e,t){return t!==e.isVisible()&&this.execute(new VisibleChange(this,e,t)),t}visibleStateForCellChanged(e,t){let i=e.isVisible();return e.setVisible(t),i}execute(e){e.execute(),this.beginUpdate(),this.currentEdit.add(e),this.fireEvent(new EventObject(InternalEvent.EXECUTE,{change:e})),this.fireEvent(new EventObject(InternalEvent.EXECUTED,{change:e})),this.endUpdate()}batchUpdate(e){this.beginUpdate();try{e()}finally{this.endUpdate()}}beginUpdate(){this.updateLevel+=1,this.fireEvent(new EventObject(InternalEvent.BEGIN_UPDATE)),1===this.updateLevel&&this.fireEvent(new EventObject(InternalEvent.START_EDIT))}endUpdate(){if(this.updateLevel-=1,0===this.updateLevel&&this.fireEvent(new EventObject(InternalEvent.END_EDIT)),!this.endingUpdate){this.endingUpdate=0===this.updateLevel,this.fireEvent(new EventObject(InternalEvent.END_UPDATE,{edit:this.currentEdit}));try{if(this.endingUpdate&&!this.currentEdit.isEmpty()){this.fireEvent(new EventObject(InternalEvent.BEFORE_UNDO,{edit:this.currentEdit}));let e=this.currentEdit;this.currentEdit=this.createUndoableEdit(),e.notify(),this.fireEvent(new EventObject(InternalEvent.UNDO,{edit:e}))}}finally{this.endingUpdate=!1}}}createUndoableEdit(e=!0){let t=new UndoableEdit(this,e);return t.notify=()=>{t.source.fireEvent(new EventObject(InternalEvent.CHANGE,{edit:t,changes:t.changes})),t.source.fireEvent(new EventObject(InternalEvent.NOTIFY,{edit:t,changes:t.changes}))},t}mergeChildren(e,t,i=!0){this.beginUpdate();try{let s={};for(let n in this.mergeChildrenImpl(e,t,i,s),s){let e=s[n],t=e.getTerminal(!0);null!=t&&(t=s[CellPath.create(t)],this.setTerminal(e,t,!0)),t=e.getTerminal(!1),null!=t&&(t=s[CellPath.create(t)],this.setTerminal(e,t,!1))}}finally{this.endUpdate()}}mergeChildrenImpl(e,t,i,s={}){this.beginUpdate();try{let n=e.getChildCount();for(let a=0;a<n;a+=1){let n=e.getChildAt(a);if("function"==typeof n.getId){let e=n.getId(),a=null==e||n.isEdge()&&i?null:this.getCell(e);if(null==a){let i=n.clone();i.setId(e),i.setTerminal(n.getTerminal(!0),!0),i.setTerminal(n.getTerminal(!1),!1),a=t.insert(i),this.cellAdded(a)}s[CellPath.create(n)]=a,this.mergeChildrenImpl(n,a,i,s)}}}finally{this.endUpdate()}}}class Stylesheet{constructor(){this.styles=new Map,this.putDefaultVertexStyle(this.createDefaultVertexStyle()),this.putDefaultEdgeStyle(this.createDefaultEdgeStyle())}createDefaultVertexStyle(){let e={};return e.shape=SHAPE.RECTANGLE,e.perimeter="rectanglePerimeter",e.verticalAlign=ALIGN.MIDDLE,e.align=ALIGN.CENTER,e.fillColor="#C3D9FF",e.strokeColor="#6482B9",e.fontColor="#774400",e}createDefaultEdgeStyle(){let e={};return e.shape=SHAPE.CONNECTOR,e.endArrow=ARROW.CLASSIC,e.verticalAlign=ALIGN.MIDDLE,e.align=ALIGN.CENTER,e.strokeColor="#6482B9",e.fontColor="#446299",e}putDefaultVertexStyle(e){this.putCellStyle("defaultVertex",e)}putDefaultEdgeStyle(e){this.putCellStyle("defaultEdge",e)}getDefaultVertexStyle(){return this.styles.get("defaultVertex")}getDefaultEdgeStyle(){return this.styles.get("defaultEdge")}putCellStyle(e,t){this.styles.set(e,t)}getCellStyle(e,t){let i=e.ignoreDefaultStyle?{}:{...t};for(let t of(e.baseStyleNames&&(i=e.baseStyleNames.reduce((e,t)=>({...e,...this.styles.get(t)}),i)),Object.keys(e)))void 0!==e[t]&&(e[t]==NONE?delete i[t]:i[t]=e[t]);return"baseStyleNames"in i&&delete i.baseStyleNames,"ignoreDefaultStyle"in i&&delete i.ignoreDefaultStyle,i}}let SideToSide=(e,t,i,s,n)=>{let{view:a}=e,l=null!=s&&s.length>0?s[0]:null,r=e.absolutePoints,o=r[0],h=r[r.length-1];if(null!=l&&(l=a.transformControlPoint(e,l)),null!=o&&((t=new CellState).x=o.x,t.y=o.y),null!=h&&((i=new CellState).x=h.x,i.y=h.y),null!=t&&null!=i){let e=Math.max(t.x,i.x),s=Math.min(t.x+t.width,i.x+i.width),r=null!=l?l.x:Math.round(s+(e-s)/2),o=a.getRoutingCenterY(t),h=a.getRoutingCenterY(i);if(null!=l&&(l.y>=t.y&&l.y<=t.y+t.height&&(o=l.y),l.y>=i.y&&l.y<=i.y+i.height&&(h=l.y)),contains(i,r,o)||contains(t,r,o)||n.push(new Point(r,o)),contains(i,r,h)||contains(t,r,h)||n.push(new Point(r,h)),1===n.length)if(null!=l)contains(i,r,l.y)||contains(t,r,l.y)||n.push(new Point(r,l.y));else{let e=Math.max(t.y,i.y),s=Math.min(t.y+t.height,i.y+i.height);n.push(new Point(r,e+(s-e)/2))}}},TopToBottom=(e,t,i,s,n)=>{let{view:a}=e,l=null!=s&&s.length>0?s[0]:null,r=e.absolutePoints,o=r[0],h=r[r.length-1];if(null!=l&&(l=a.transformControlPoint(e,l)),null!=o&&((t=new CellState).x=o.x,t.y=o.y),null!=h&&((i=new CellState).x=h.x,i.y=h.y),null!=t&&null!=i){let e=Math.max(t.y,i.y),s=Math.min(t.y+t.height,i.y+i.height),r=a.getRoutingCenterX(t);null!=l&&l.x>=t.x&&l.x<=t.x+t.width&&(r=l.x);let o=null!=l?l.y:Math.round(s+(e-s)/2);if(contains(i,r,o)||contains(t,r,o)||n.push(new Point(r,o)),r=null!=l&&l.x>=i.x&&l.x<=i.x+i.width?l.x:a.getRoutingCenterX(i),contains(i,r,o)||contains(t,r,o)||n.push(new Point(r,o)),1===n.length)if(null!=l&&1===n.length)contains(i,l.x,o)||contains(t,l.x,o)||n.push(new Point(l.x,o));else{let e=Math.max(t.x,i.x),s=Math.min(t.x+t.width,i.x+i.width);n.push(new Point(e+(s-e)/2,o))}}},ElbowConnector=(e,t,i,s,n)=>{let a=null!=s&&s.length>0?s[0]:null,l=!1,r=!1;if(null!=t&&null!=i)if(null!=a){let s=Math.min(t.x,i.x),n=Math.max(t.x+t.width,i.x+i.width),o=Math.min(t.y,i.y),h=Math.max(t.y+t.height,i.y+i.height);l=(a=e.view.transformControlPoint(e,a)).y<o||a.y>h,r=a.x<s||a.x>n}else(l=Math.max(t.x,i.x)===Math.min(t.x+t.width,i.x+i.width))||(r=Math.max(t.y,i.y)===Math.min(t.y+t.height,i.y+i.height));!r&&(l||e.style.elbow===ELBOW.VERTICAL)?TopToBottom(e,t,i,s,n):SideToSide(e,t,i,s,n)},EntityRelationConnectorConfig={segment:ENTITY_SEGMENT},resetEntityRelationConnectorConfig=()=>{EntityRelationConnectorConfig.segment=ENTITY_SEGMENT},OrthogonalConnectorConfig={buffer:10,pointsFallback:!0},originalOrthogonalConnectorConfig={...OrthogonalConnectorConfig},resetOrthogonalConnectorConfig=()=>{shallowCopy(originalOrthogonalConnectorConfig,OrthogonalConnectorConfig)},ManhattanConnectorConfig={maxAllowedDirectionChange:90,maxLoops:2e3,endDirections:Object.values(DIRECTION),startDirections:Object.values(DIRECTION),step:12},originalManhattanConnectorConfig={};shallowCopy(ManhattanConnectorConfig,originalManhattanConnectorConfig);let resetManhattanConnectorConfig=()=>{shallowCopy(originalManhattanConnectorConfig,ManhattanConnectorConfig)},EntityRelation=(e,t,i,s,n)=>{var a;let{view:l}=e,r=((null==(a=e.style)?void 0:a.segment)??EntityRelationConnectorConfig.segment)*l.scale,o=e.absolutePoints,h=o[0],c=o[o.length-1],d=!1;if(null!=t){let e=t.cell.getGeometry();e.relative?d=e.x<=.5:null!=i&&(d=(null!=c?c.x:i.x+i.width)<(null!=h?h.x:t.x))}if(null!=h)(t=new CellState).x=h.x,t.y=h.y;else{if(null==t)return;let i=getPortConstraints(t,e,!0,DIRECTION_MASK.NONE);i!==DIRECTION_MASK.NONE&&i!==DIRECTION_MASK.WEST+DIRECTION_MASK.EAST&&(d=i===DIRECTION_MASK.WEST)}let u=!0;if(null!=i){let e=i.cell.getGeometry();e.relative?u=e.x<=.5:null!=t&&(u=(null!=h?h.x:t.x+t.width)<(null!=c?c.x:i.x))}if(null!=c)(i=new CellState).x=c.x,i.y=c.y;else if(null!=i){let t=getPortConstraints(i,e,!1,DIRECTION_MASK.NONE);t!==DIRECTION_MASK.NONE&&t!=DIRECTION_MASK.WEST+DIRECTION_MASK.EAST&&(u=t===DIRECTION_MASK.WEST)}if(null!=t&&null!=i){let e=d?t.x:t.x+t.width,s=l.getRoutingCenterY(t),a=u?i.x:i.x+i.width,o=l.getRoutingCenterY(i),h=r,c=d?-h:h,p=new Point(e+c,s),g=new Point(a+(c=u?-h:h),o);if(d===u){let t=d?Math.min(e,a)-r:Math.max(e,a)+r;n.push(new Point(t,s)),n.push(new Point(t,o))}else if(p.x<g.x===d){let e=s+(o-s)/2;n.push(p),n.push(new Point(p.x,e)),n.push(new Point(g.x,e)),n.push(g)}else n.push(p),n.push(g)}},Loop=(e,t,i,s,n)=>{var a;let l=e.absolutePoints,r=l[0],o=l[l.length-1];if(null!=r&&null!=o){if(null!=s&&s.length>0)for(let t=0;t<s.length;t+=1){let i=s[t];i=e.view.transformControlPoint(e,i),n.push(new Point(i.x,i.y))}return}if(null!=t){let{view:i}=e,{graph:l}=i,r=null!=s&&s.length>0?s[0]:null;null!=r&&contains(t,(r=i.transformControlPoint(e,r)).x,r.y)&&(r=null);let o=0,h=0,c=0,d=0,u=(e.style.segment??l.gridSize)*i.scale,p=(null==(a=e.style)?void 0:a.direction)??DIRECTION.WEST;p===DIRECTION.NORTH||p===DIRECTION.SOUTH?(o=i.getRoutingCenterX(t),h=u):(c=i.getRoutingCenterY(t),d=u),null==r||r.x<t.x||r.x>t.x+t.width?null!=r?(o=r.x,d=Math.max(Math.abs(c-r.y),d)):p===DIRECTION.NORTH?c=t.y-2*h:p===DIRECTION.SOUTH?c=t.y+t.height+2*h:o=p===DIRECTION.EAST?t.x-2*d:t.x+t.width+2*d:null!==r&&(h=Math.max(Math.abs((o=i.getRoutingCenterX(t))-r.x),d),c=r.y,d=0),n.push(new Point(o-h,c-d)),n.push(new Point(o+h,c+d))}};function scalePointArray(e,t){let i=[];if(null!=e)for(let s=0;s<e.length;s+=1)null!=e[s]?i[s]=new Point(Math.round(e[s].x/t*10)/10,Math.round(e[s].y/t*10)/10):i[s]=null;else i=null;return i}function scaleCellState(e,t){let i=null;return null!=e&&(i=e.clone()).setRect(Math.round(e.x/t*10)/10,Math.round(e.y/t*10)/10,Math.round(e.width/t*10)/10,Math.round(e.height/t*10)/10),i}let SegmentConnector=(e,t,i,s,n)=>{let a=scalePointArray(e.absolutePoints,e.view.scale),l=scaleCellState(t,e.view.scale),r=scaleCellState(i,e.view.scale),o=1,h=n.length>0?n[0]:null,c=!0,d=null;function u(t){return t.x=Math.round(t.x*e.view.scale*10)/10,t.y=Math.round(t.y*e.view.scale*10)/10,(null==h||Math.abs(h.x-t.x)>=o||Math.abs(h.y-t.y)>=Math.max(1,e.view.scale))&&(n.push(t),h=t),h}let p=a[0];null==p&&null!=l?p=new Point(e.view.getRoutingCenterX(l),e.view.getRoutingCenterY(l)):null!=p&&(p=p.clone());let g=a.length-1,m=null;if(null!=s&&s.length>0){let t=[];for(let i=0;i<s.length;i+=1){let n=e.view.transformControlPoint(e,s[i],!0);null!=n&&t.push(n)}if(0===t.length)return;null!=p&&null!=t[0]&&(Math.abs(t[0].x-p.x)<o&&(t[0].x=p.x),Math.abs(t[0].y-p.y)<o&&(t[0].y=p.y)),null!=(m=a[g])&&null!=t[t.length-1]&&(Math.abs(t[t.length-1].x-m.x)<o&&(t[t.length-1].x=m.x),Math.abs(t[t.length-1].y-m.y)<o&&(t[t.length-1].y=m.y)),d=t[0];let i=l,n=a[0],h=!1,f=!1,x=d;null!=n&&(i=null);for(let e=0;e<2;e+=1){let s=null!=n&&n.x===x.x,l=null!=n&&n.y===x.y,o=null!=i&&x.y>=i.y&&x.y<=i.y+i.height,d=null!=i&&x.x>=i.x&&x.x<=i.x+i.width;if(h=l||null==n&&o,f=s||null==n&&d,!(0==e&&(h&&f||s&&l))){if(null!=n&&!l&&!s&&(o||d)){c=!o;break}if(f||h){c=h,1===e&&(c=t.length%2==0?h:f);break}}i=r,null!=(n=a[g])&&(i=null),x=t[t.length-1],s&&l&&(t=t.slice(1))}c&&(null!=a[0]&&a[0].y!==d.y||null==a[0]&&null!=l&&(d.y<l.y||d.y>l.y+l.height))?u(new Point(p.x,d.y)):!c&&(null!=a[0]&&a[0].x!==d.x||null==a[0]&&null!=l&&(d.x<l.x||d.x>l.x+l.width))&&u(new Point(d.x,p.y)),c?p.y=d.y:p.x=d.x;for(let e=0;e<t.length;e+=1)c=!c,d=t[e],c?p.y=d.y:p.x=d.x,u(p.clone())}else d=p,c=!0;if(null==(p=a[g])&&null!=r&&(p=new Point(e.view.getRoutingCenterX(r),e.view.getRoutingCenterY(r))),null!=p&&null!=d&&(c&&(null!=a[g]&&a[g].y!==d.y||null==a[g]&&null!=r&&(d.y<r.y||d.y>r.y+r.height))?u(new Point(p.x,d.y)):!c&&(null!=a[g]&&a[g].x!==d.x||null==a[g]&&null!=r&&(d.x<r.x||d.x>r.x+r.width))&&u(new Point(d.x,p.y))),null==a[0]&&null!=l)for(;n.length>1&&null!=n[1]&&contains(l,n[1].x,n[1].y);)n.splice(1,1);if(null==a[g]&&null!=r)for(;n.length>1&&null!=n[n.length-1]&&contains(r,n[n.length-1].x,n[n.length-1].y);)n.splice(n.length-1,1);null!=m&&null!=n[n.length-1]&&Math.abs(m.x-n[n.length-1].x)<=o&&Math.abs(m.y-n[n.length-1].y)<=o&&(n.splice(n.length-1,1),null!=n[n.length-1]&&(Math.abs(n[n.length-1].x-m.x)<o&&(n[n.length-1].x=m.x),Math.abs(n[n.length-1].y-m.y)<o&&(n[n.length-1].y=m.y)))},dirVectors=[[-1,0],[0,-1],[1,0],[0,1],[-1,0],[0,-1],[1,0]],wayPoints1=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],routePatterns=[[[513,2308,2081,2562],[513,1090,514,2184,2114,2561],[513,1090,514,2564,2184,2562],[513,2308,2561,1090,514,2568,2308]],[[514,1057,513,2308,2081,2562],[514,2184,2114,2561],[514,2184,2562,1057,513,2564,2184],[514,1057,513,2568,2308,2561]],[[1090,514,1057,513,2308,2081,2562],[2114,2561],[1090,2562,1057,513,2564,2184],[1090,514,1057,513,2308,2561,2568]],[[2081,2562],[1057,513,1090,514,2184,2114,2561],[1057,513,1090,514,2184,2562,2564],[1057,2561,1090,514,2568,2308]]],vertexSeparations=[],limits=[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]],SIDE_MASK=480,CENTER_MASK=512,SOURCE_MASK=1024,TARGET_MASK=2048;function getJettySize(e,t){let i=OrthogonalConnectorConfig.buffer,s=(t?e.style.sourceJettySize:e.style.targetJettySize)??e.style.jettySize??i;return"auto"===s&&(s=((t?e.style.startArrow:e.style.endArrow)??NONE)!==NONE?Math.max(2,Math.ceil((((t?e.style.startSize:e.style.endSize)??DEFAULT_MARKERSIZE)+i)/i))*i:2*i),s}let OrthogonalConnector=(e,t,i,s,n)=>{let a=scalePointArray(e.absolutePoints,e.view.scale),l=scaleCellState(t,e.view.scale),r=scaleCellState(i,e.view.scale),o=null!=l&&l.cell.isEdge(),h=null!=r&&r.cell.isEdge(),c=a[0],d=a[a.length-1],u=null!=l?l.x:c.x,p=null!=l?l.y:c.y,g=null!=l?l.width:0,m=null!=l?l.height:0,f=null!=r?r.x:d.x,x=null!=r?r.y:d.y,v=null!=r?r.width:0,b=null!=r?r.height:0,y=getJettySize(e,!0),w=getJettySize(e,!1);null!=l&&r===l&&(y=w=Math.max(y,w));let C=w+y,E=!1;if(null!=c&&null!=d){let e=d.x-c.x,t=d.y-c.y;E=e*e+t*t<C*C}if(E||OrthogonalConnectorConfig.pointsFallback&&null!=s&&s.length>0||o||h){SegmentConnector(e,t,i,s,n);return}let S=[DIRECTION_MASK.ALL,DIRECTION_MASK.ALL],T=0;if(null!=l&&(S[0]=getPortConstraints(l,e,!0,DIRECTION_MASK.ALL),0!==(T=l.style.rotation??0))){let e=getBoundingBox(new Rectangle(u,p,g,m),T);u=e.x,p=e.y,g=e.width,m=e.height}if(null!=r&&(S[1]=getPortConstraints(r,e,!1,DIRECTION_MASK.ALL),0!==(T=r.style.rotation??0))){let e=getBoundingBox(new Rectangle(f,x,v,b),T);f=e.x,x=e.y,v=e.width,b=e.height}let M=[0,0],A=[[u,p,g,m],[f,x,v,b]],P=[y,w];for(let e=0;e<2;e+=1)limits[e][1]=A[e][0]-P[e],limits[e][2]=A[e][1]-P[e],limits[e][4]=A[e][0]+A[e][2]+P[e],limits[e][8]=A[e][1]+A[e][3]+P[e];let L=A[0][0]+A[0][2]/2,k=A[0][1]+A[0][3]/2,H=A[1][0]+A[1][2]/2,O=A[1][1]+A[1][3]/2,R=L-H,I=k-O,D=0;R<0?D=I<0?2:1:I<=0&&(D=3,0===R&&(D=2));let N=null;null!=l&&(N=c);let V=[[.5,.5],[.5,.5]];for(let e=0;e<2;e+=1)null!=N&&(V[e][0]=(N.x-A[e][0])/A[e][2],1>=Math.abs(N.x-A[e][0])?M[e]=DIRECTION_MASK.WEST:1>=Math.abs(N.x-A[e][0]-A[e][2])&&(M[e]=DIRECTION_MASK.EAST),V[e][1]=(N.y-A[e][1])/A[e][3],1>=Math.abs(N.y-A[e][1])?M[e]=DIRECTION_MASK.NORTH:1>=Math.abs(N.y-A[e][1]-A[e][3])&&(M[e]=DIRECTION_MASK.SOUTH)),N=null,null!=r&&(N=d);let B=A[0][1]-(A[1][1]+A[1][3]),z=A[0][0]-(A[1][0]+A[1][2]),G=A[1][1]-(A[0][1]+A[0][3]),F=A[1][0]-(A[0][0]+A[0][2]);vertexSeparations[1]=Math.max(z-C,0),vertexSeparations[2]=Math.max(B-C,0),vertexSeparations[4]=Math.max(G-C,0),vertexSeparations[3]=Math.max(F-C,0);let U=[],_=[],j=[];_[0]=z>=F?DIRECTION_MASK.WEST:DIRECTION_MASK.EAST,j[0]=B>=G?DIRECTION_MASK.NORTH:DIRECTION_MASK.SOUTH,_[1]=reversePortConstraints(_[0]),j[1]=reversePortConstraints(j[0]);let X=z>=F?z:F,$=B>=G?B:G,W=[[0,0],[0,0]],Y=!1;for(let e=0;e<2;e+=1)0===M[e]&&((_[e]&S[e])==0&&(_[e]=reversePortConstraints(_[e])),(j[e]&S[e])==0&&(j[e]=reversePortConstraints(j[e])),W[e][0]=j[e],W[e][1]=_[e]);$>0&&X>0&&((_[0]&S[0])>0&&(j[1]&S[1])>0?(W[0][0]=_[0],W[0][1]=j[0],W[1][0]=j[1],W[1][1]=_[1],Y=!0):(j[0]&S[0])>0&&(_[1]&S[1])>0&&(W[0][0]=j[0],W[0][1]=_[0],W[1][0]=_[1],W[1][1]=j[1],Y=!0)),$>0&&!Y&&(W[0][0]=j[0],W[0][1]=_[0],W[1][0]=j[1],W[1][1]=_[1],Y=!0),X>0&&!Y&&(W[0][0]=_[0],W[0][1]=j[0],W[1][0]=_[1],W[1][1]=j[1],Y=!0);for(let e=0;e<2;e+=1)0===M[e]&&((W[e][0]&S[e])==0&&(W[e][0]=W[e][1]),U[e]=W[e][0]&S[e],U[e]|=(W[e][1]&S[e])<<8,U[e]|=(W[1-e][e]&S[e])<<16,U[e]|=(W[1-e][1-e]&S[e])<<24,(15&U[e])==0&&(U[e]=U[e]<<8),(3840&U[e])==0&&(U[e]=15&U[e]|U[e]>>8),(983040&U[e])==0&&(U[e]=65535&U[e]|(0xf000000&U[e])>>8),M[e]=15&U[e],(S[e]===DIRECTION_MASK.WEST||S[e]===DIRECTION_MASK.NORTH||S[e]===DIRECTION_MASK.EAST||S[e]===DIRECTION_MASK.SOUTH)&&(M[e]=S[e]));let q=M[0]===DIRECTION_MASK.EAST?3:M[0],K=M[1]===DIRECTION_MASK.EAST?3:M[1];(q-=D)<1&&(q+=4),(K-=D)<1&&(K+=4);let Z=routePatterns[q-1][K-1];switch(wayPoints1[0][0]=A[0][0],wayPoints1[0][1]=A[0][1],M[0]){case DIRECTION_MASK.WEST:wayPoints1[0][0]-=y,wayPoints1[0][1]+=V[0][1]*A[0][3];break;case DIRECTION_MASK.SOUTH:wayPoints1[0][0]+=V[0][0]*A[0][2],wayPoints1[0][1]+=A[0][3]+y;break;case DIRECTION_MASK.EAST:wayPoints1[0][0]+=A[0][2]+y,wayPoints1[0][1]+=V[0][1]*A[0][3];break;case DIRECTION_MASK.NORTH:wayPoints1[0][0]+=V[0][0]*A[0][2],wayPoints1[0][1]-=y}let J=0,Q=(M[0]&(DIRECTION_MASK.EAST|DIRECTION_MASK.WEST))>0?0:1,ee=Q,et=0;for(let e=0;e<Z.length;e+=1){let t=15&Z[e],i=t===DIRECTION_MASK.EAST?3:t;(i+=D)>4&&(i-=4);let s=dirVectors[i-1];(et=i%2>0?0:1)!==Q&&(wayPoints1[++J][0]=wayPoints1[J-1][0],wayPoints1[J][1]=wayPoints1[J-1][1]);let n=(Z[e]&TARGET_MASK)>0,a=(Z[e]&SOURCE_MASK)>0,l=(Z[e]&SIDE_MASK)>>5;(l<<=D)>15&&(l>>=4);let r=(Z[e]&CENTER_MASK)>0;if((a||n)&&l<9){let e=0,t=+!a;if(e=r&&0===et?A[t][0]+V[t][0]*A[t][2]:r?A[t][1]+V[t][1]*A[t][3]:limits[t][l],0===et){let t=(e-wayPoints1[J][0])*s[0];t>0&&(wayPoints1[J][0]+=s[0]*t)}else{let t=(e-wayPoints1[J][1])*s[1];t>0&&(wayPoints1[J][1]+=s[1]*t)}}else r&&(wayPoints1[J][0]+=s[0]*Math.abs(vertexSeparations[i]/2),wayPoints1[J][1]+=s[1]*Math.abs(vertexSeparations[i]/2));J>0&&wayPoints1[J][et]===wayPoints1[J-1][et]?J--:Q=et}for(let t=0;t<=J&&(t!==J||+(((M[1]&(DIRECTION_MASK.EAST|DIRECTION_MASK.WEST))>0?0:1)!==ee)==(J+1)%2);t+=1)n.push(new Point(Math.round(wayPoints1[t][0]*e.view.scale*10)/10,Math.round(wayPoints1[t][1]*e.view.scale*10)/10));let ei=1;for(;ei<n.length;)null==n[ei-1]||null==n[ei]||n[ei-1].x!==n[ei].x||n[ei-1].y!==n[ei].y?ei++:n.splice(ei,1)},ManhattanConnector=(e,t,i,s,n)=>{function a(e,t){return e.x+=t.x||0,e.y+=t.y||0,e.width+=t.width||0,e.height+=t.height||0,e}function l(e,t){return t*Math.round(e/t)}function r(e,t,i){return e.x=l(e.x,t),e.y=l(e.y,t),e}function o(e,t){return t.x>=e.x&&t.x<=e.x+e.width&&t.y>=e.y&&t.y<=e.y+e.height}function h(e){return new Point(e.x+e.width/2,e.y+e.height/2)}function c(e,t){return new Point(e.x-t.x,e.y-t.y)}function d(e,t,i){return e.x+=t||0,e.y+=i||0,e}function u(e,t){let i=t.clone(),s=-(i.y-e.y),n=i.x-e.x,a=10;return 180*("0"==s.toFixed(a)&&"0"==n.toFixed(a)?0:Math.atan2(s,n))/Math.PI}function p(e){return new Point(0===e.x?0:Math.abs(e.x)/e.x,0===e.y?0:Math.abs(e.y)/e.y)}function g(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}function m(e){let t=e.split(-1===e.indexOf("@")?" ":"@");return new Point(parseInt(t[0],10),parseInt(t[1],10))}function f(e){return`${e.x}@${e.y}`}function x(e){var t;let i=e.view.graph,s=null==(t=i.getCellBounds(e.cell,!1,!1))?void 0:t.clone();if(!s)return;let{scale:n,translate:a}=i.view,{x:l,y:r}=a,o=e=>Math.round(10*e)/10;return new Rectangle(o(s.x/n-l),o(s.y/n-r),o(s.width/n),o(s.height/n))}let v=ManhattanConnectorConfig.step,b={paddingBox:new Geometry(-v,-v,2*v,2*v),directions:[{offsetX:v,offsetY:0,cost:v,angle:S(u(new Point(0,0),new Point(v,0)))},{offsetX:0,offsetY:v,cost:v,angle:S(u(new Point(0,0),new Point(0,v)))},{offsetX:-v,offsetY:0,cost:v,angle:S(u(new Point(0,0),new Point(-v,0)))},{offsetX:0,offsetY:-v,cost:v,angle:S(u(new Point(0,0),new Point(0,-v)))}],directionMap:{east:{x:1,y:0},south:{x:0,y:1},west:{x:-1,y:0},north:{x:0,y:-1}},penaltiesGenerator:e=>45==e||90==e||180==e?v/2:0,draggingRoute:null,previousDirAngle:0};class y{constructor(e){this.options=e,this.mapGridSize=100,this.map=new Map}build(e,t){let i=(null==e?void 0:e.view.graph)||(null==t?void 0:t.view.graph);if(i)return Array.from(i.getView().getCellStates()).filter(e=>e.cell&&e.cell.isVertex()&&!e.cell.isEdge()).map(e=>x(e)).map(e=>e?a(e,this.options.paddingBox):null).forEach(e=>{if(!e)return;let t=r(new Point(e.x,e.y),this.mapGridSize),i=r(new Point(e.x+e.width,e.y+e.height),this.mapGridSize);for(let s=t.x;s<=i.x;s+=this.mapGridSize)for(let n=t.y;n<=i.y;n+=this.mapGridSize){let t=s+"@"+n,i=this.map.get(t)||[];this.map.has(t)||this.map.set(t,i),i.push(e)}})}isPointAccessible(e){let t=f(r(e.clone(),this.mapGridSize)),i=this.map.get(t);return!i||i.every(t=>!o(t,e))}}class w{constructor(){this.items=[],this.hash=new Map}add(e,t){let i=this.hash.get(e);i?(i.value=t,this.items.splice(this.items.indexOf(e),1)):this.hash.set(e,{value:t,open:!0}),this.items.push(e),this.items.sort((e,t)=>{let i=this.hash.get(e),s=this.hash.get(t);return i&&s?i.value-s.value:0})}remove(e){let t=this.hash.get(e);t&&(t.open=!1)}isOpen(e){let t=this.hash.get(e);return t&&!0==t.open}isClose(e){let t=this.hash.get(e);return t&&!1==t.open}isEmpty(){return 0==this.items.length}pop(){let e=this.items.shift();return e&&this.remove(e),e}}function C(e,t,i,s){let n,a=[],l=p(c(s,t)),r=t;for(;e[f(r)];){if(!(n=e[f(r)]))continue;let t=p(c(r,n));t.equals(l)||(a.unshift(r),l=t),r=n}return p(c(r,i)).equals(l)||a.unshift(r),a}function E(e,t,i){let s=ManhattanConnectorConfig.step,n=h(e),a=[];for(let l of t){let t=i.directionMap[l],h=t.x*e.width/2,c=t.y*e.height/2,u=d(n.clone(),h,c);o(e,u)&&d(u,t.x*s,t.y*s),a.push(r(u,s))}return a}function S(e){return e%360+360*(e<0)}function T(e,t,i){let s=360/i;return Math.floor(S(u(e,t)+s/2)/s)*s}function M(e,t){let i=Math.abs(e-t);return i>180?360-i:i}function A(e,t){let i=1/0;for(let s=0,n=t.length;s<n;s++){let n=g(e,t[s]);n<i&&(i=n)}return i}function P(e,t,i,s){let n=x(i),a=s?t.style.exitY:t.style.entryY,l=s?ManhattanConnectorConfig.startDirections.every(e=>e!=DIRECTION.NORTH&&e!=DIRECTION.SOUTH):ManhattanConnectorConfig.endDirections.every(e=>e!=DIRECTION.NORTH&&e!=DIRECTION.SOUTH);if(void 0!=a&&l){let t=(null==n?void 0:n.height)||0;e.y=(null==n?void 0:n.y)!=void 0?(null==n?void 0:n.y)+t*a:e.y-t/2+t*a}let r=s?t.style.exitX:t.style.entryX,o=s?ManhattanConnectorConfig.startDirections.every(e=>e!=DIRECTION.WEST&&e!=DIRECTION.EAST):ManhattanConnectorConfig.endDirections.every(e=>e!=DIRECTION.WEST&&e!=DIRECTION.EAST);if(void 0!=r&&o){let t=(null==n?void 0:n.width)||0;e.x=(null==n?void 0:n.x)!=void 0?(null==n?void 0:n.x)+t*r:e.x-t/2+t*(r||0)}}function L(e,t,i,s){let n=ManhattanConnectorConfig.step,a=E(e,ManhattanConnectorConfig.startDirections,s).filter(e=>i.isPointAccessible(e)),l=r(h(e),n),o=E(t,ManhattanConnectorConfig.endDirections,s).filter(e=>i.isPointAccessible(e)),c=r(h(t),n);if(a.length>0&&o.length>0){let e,t,n=new w,r={},h={};a.forEach(e=>{let t=f(e);n.add(t,A(e,o)),h[t]=0});let u=ManhattanConnectorConfig.maxLoops,p=o.map(e=>f(e));for(;!n.isEmpty()&&u>0;){let a=n.pop();if(void 0==a)continue;let g=m(a),x=h[a];if(t=e,e=r[a]?T(r[a],g,s.directions.length):0!=s.previousDirAngle?s.previousDirAngle:T(l,g,s.directions.length),p.indexOf(a)>=0){let t=M(e,T(g,c,s.directions.length));if(g.equals(c)||t<180)return s.previousDirAngle=e,C(r,g,l,c)}for(let a=0;a<s.directions.length;a++){let l=s.directions[a],c=M(e,l.angle);if(t&&c>ManhattanConnectorConfig.maxAllowedDirectionChange)continue;let u=d(g.clone(),l.offsetX,l.offsetY),p=f(u);if(n.isClose(p)||!i.isPointAccessible(u))continue;let m=x+l.cost+s.penaltiesGenerator(c);(!n.isOpen(p)||m<h[p])&&(r[p]=g,h[p]=m,n.add(p,m+A(u,o)))}u--}}return null}!function(e,t,i,s,n,l){if(null!=s&&s.length>0||null==t||null==i){SegmentConnector(e,t,i,s,n);return}let r=x(t);r=r?a(r,l.paddingBox):void 0;let o=x(i);o=o?a(o,l.paddingBox):void 0;let h=new y(l);if(h.build(t,i),!r||!o)return OrthogonalConnector(e,t,i,s,n);let c=L(r,o,h,l);if(null==c||0==c.length)return OrthogonalConnector(e,t,i,s,n);e.style&&(e.visibleSourceState&&c.length>0&&P(c[0],e,e.visibleSourceState,!0),e.visibleTargetState&&c.length>1&&P(c[c.length-1],e,e.visibleTargetState,!1));let d=e.view.scale;c.forEach(t=>n.push(new Point(Math.round((t.x+e.view.translate.x)*d*10)/10,Math.round((t.y+e.view.translate.y)*d*10)/10)))}(e,t,i,s,n,b)};class EdgeStyle{}EdgeStyle.EntityRelation=EntityRelation,EdgeStyle.Loop=Loop,EdgeStyle.ElbowConnector=ElbowConnector,EdgeStyle.SideToSide=SideToSide,EdgeStyle.TopToBottom=TopToBottom,EdgeStyle.SegmentConnector=SegmentConnector,EdgeStyle.OrthConnector=OrthogonalConnector,EdgeStyle.ManhattanConnector=ManhattanConnector;class CellHighlight{constructor(e,t,i,s){this.strokeWidth=0,this.dashed=!1,this.opacity=100,this.shape=null,this.keepOnTop=!1,this.state=null,this.spacing=2,this.graph=e,this.highlightColor=t??DEFAULT_VALID_COLOR,this.strokeWidth=i??HIGHLIGHT_STROKEWIDTH,this.dashed=s??!1,this.opacity=HIGHLIGHT_OPACITY,this.repaintHandler=()=>{if(this.state){let e=this.graph.view.getState(this.state.cell);e?(this.state=e,this.repaint()):this.hide()}},this.graph.getView().addListener(InternalEvent.SCALE,this.repaintHandler),this.graph.getView().addListener(InternalEvent.TRANSLATE,this.repaintHandler),this.graph.getView().addListener(InternalEvent.SCALE_AND_TRANSLATE,this.repaintHandler),this.graph.getDataModel().addListener(InternalEvent.CHANGE,this.repaintHandler),this.resetHandler=()=>{this.hide()},this.graph.getView().addListener(InternalEvent.DOWN,this.resetHandler),this.graph.getView().addListener(InternalEvent.UP,this.resetHandler)}setHighlightColor(e){this.highlightColor=e,this.shape&&(this.shape.stroke=e)}drawHighlight(){var e;if(this.shape=this.createShape(),this.repaint(),this.shape){let t=this.shape.node;!this.keepOnTop&&(null==(e=null==t?void 0:t.parentNode)?void 0:e.firstChild)!==t&&t.parentNode&&t.parentNode.insertBefore(t,t.parentNode.firstChild)}}createShape(){if(!this.state)return null;let e=this.graph.cellRenderer.createShape(this.state);return e.svgStrokeTolerance=this.graph.getEventTolerance(),e.points=this.state.absolutePoints,e.apply(this.state),e.stroke=this.highlightColor,e.opacity=this.opacity,e.isDashed=this.dashed,e.isShadow=!1,e.dialect=DIALECT.SVG,e.init(this.graph.getView().getOverlayPane()),InternalEvent.redirectMouseEvents(e.node,this.graph,this.state),this.graph.dialect!==DIALECT.SVG?e.pointerEvents=!1:e.svgPointerEvents="stroke",e}getStrokeWidth(e=null){return this.strokeWidth}repaint(){this.state&&this.shape&&(this.shape.scale=this.state.view.scale,this.state.cell.isEdge()?(this.shape.strokeWidth=this.getStrokeWidth(),this.shape.points=this.state.absolutePoints,this.shape.outline=!1):(this.shape.bounds=new Rectangle(this.state.x-this.spacing,this.state.y-this.spacing,this.state.width+2*this.spacing,this.state.height+2*this.spacing),this.shape.rotation=this.state.style.rotation??0,this.shape.strokeWidth=this.getStrokeWidth()/this.state.view.scale,this.shape.outline=!0),this.state.shape&&this.shape.setCursor(this.state.shape.getCursor()),this.shape.redraw())}hide(){this.highlight(null)}highlight(e=null){this.state!==e&&(this.shape&&(this.shape.destroy(),this.shape=null),this.state=e,this.state&&this.drawHighlight())}isHighlightAt(e,t){let i=!1;if(this.shape&&document.elementFromPoint){let s=document.elementFromPoint(e,t);for(;s;){if(s===this.shape.node){i=!0;break}s=s.parentNode}}return i}destroy(){let e=this.graph;e.getView().removeListener(this.resetHandler),e.getView().removeListener(this.repaintHandler),e.getDataModel().removeListener(this.repaintHandler),this.shape&&(this.shape.destroy(),this.shape=null)}}class CellMarker extends EventSource{constructor(e,t=DEFAULT_VALID_COLOR,i=DEFAULT_INVALID_COLOR,s=DEFAULT_HOTSPOT){super(),this.enabled=!0,this.hotspot=DEFAULT_HOTSPOT,this.hotspotEnabled=!1,this.currentColor=NONE,this.validState=null,this.markedState=null,this.graph=e,this.validColor=t,this.invalidColor=i,this.hotspot=s,this.highlight=new CellHighlight(e)}setEnabled(e){this.enabled=e}isEnabled(){return this.enabled}setHotspot(e){this.hotspot=e}getHotspot(){return this.hotspot}setHotspotEnabled(e){this.hotspotEnabled=e}isHotspotEnabled(){return this.hotspotEnabled}hasValidState(){return!!this.validState}getValidState(){return this.validState}getMarkedState(){return this.markedState}reset(){this.validState=null,this.markedState&&(this.markedState=null,this.unmark())}process(e){let t=null;return this.isEnabled()&&(t=this.getState(e),this.setCurrentState(t,e)),t}setCurrentState(e,t,i){let s=!!e&&this.isValidState(e);i=i??this.getMarkerColor(t.getEvent(),e,s),s?this.validState=e:this.validState=null,(e!==this.markedState||i!==this.currentColor)&&(this.currentColor=i,e&&this.currentColor!==NONE?(this.markedState=e,this.mark()):this.markedState&&(this.markedState=null,this.unmark()))}markCell(e,t){let i=this.graph.getView().getState(e);i&&(this.currentColor=t??this.validColor,this.markedState=i,this.mark())}mark(){this.highlight.setHighlightColor(this.currentColor),this.highlight.highlight(this.markedState),this.fireEvent(new EventObject(InternalEvent.MARK,"state",this.markedState))}unmark(){this.mark()}isValidState(e){return!0}getMarkerColor(e,t,i){return i?this.validColor:this.invalidColor}getState(e){let t=this.graph.getView(),i=this.getCell(e);if(!i)return null;let s=this.getStateToMark(t.getState(i));return s&&this.intersects(s,e)?s:null}getCell(e){return e.getCell()}getStateToMark(e){return e}intersects(e,t){let i=t.getGraphX(),s=t.getGraphY();return!this.hotspotEnabled||intersectsHotspot(e,i,s,this.hotspot,MIN_HOTSPOT_SIZE,MAX_HOTSPOT_SIZE)}destroy(){this.highlight.destroy()}}class EllipseShape extends Shape{constructor(e,t,i,s=1){super(),this.bounds=e,this.fill=t,this.stroke=i,this.strokeWidth=s}paintVertexShape(e,t,i,s,n){e.ellipse(t,i,s,n),e.fillAndStroke()}}class ConnectionConstraint{constructor(e,t=!0,i=null,s=0,n=0){this.perimeter=!0,this.name=null,this.dx=0,this.dy=0,this.point=e,this.perimeter=t,this.name=i,this.dx=s,this.dy=n}}class ConstraintHandler{constructor(e){this.pointImage=new ImageBox(`${Client.imageBasePath}/point.gif`,5,5),this.currentFocus=null,this.currentFocusArea=null,this.focusIcons=[],this.constraints=null,this.currentConstraint=null,this.focusHighlight=null,this.focusPoints=[],this.currentPoint=null,this.enabled=!0,this.highlightColor=DEFAULT_VALID_COLOR,this.mouseleaveHandler=null,this.graph=e,this.resetHandler=()=>{this.currentFocus&&!this.graph.view.getState(this.currentFocus.cell)?this.reset():this.redraw()},this.graph.model.addListener(InternalEvent.CHANGE,this.resetHandler),this.graph.view.addListener(InternalEvent.SCALE_AND_TRANSLATE,this.resetHandler),this.graph.view.addListener(InternalEvent.TRANSLATE,this.resetHandler),this.graph.view.addListener(InternalEvent.SCALE,this.resetHandler),this.graph.addListener(InternalEvent.ROOT,this.resetHandler)}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}reset(){for(let e=0;e<this.focusIcons.length;e+=1)this.focusIcons[e].destroy();this.focusIcons=[],this.focusHighlight&&(this.focusHighlight.destroy(),this.focusHighlight=null),this.currentConstraint=null,this.currentFocusArea=null,this.currentPoint=null,this.currentFocus=null,this.focusPoints=[]}getTolerance(e){return this.graph.getEventTolerance()}getImageForConstraint(e,t,i){return this.pointImage}isEventIgnored(e,t=!1){return!1}isStateIgnored(e,t=!1){return!1}destroyIcons(){for(let e=0;e<this.focusIcons.length;e+=1)this.focusIcons[e].destroy();this.focusIcons=[],this.focusPoints=[]}destroyFocusHighlight(){this.focusHighlight&&(this.focusHighlight.destroy(),this.focusHighlight=null)}isKeepFocusEvent(e){return isShiftDown(e.getEvent())}getCellForEvent(e,t){let i=e.getCell();if(!i&&t&&(e.getGraphX()!==t.x||e.getGraphY()!==t.y)&&(i=this.graph.getCellAt(t.x,t.y)),i&&!i.isConnectable()){let e=i.getParent();e&&e.isVertex()&&e.isConnectable()&&(i=e)}return i?this.graph.isCellLocked(i)?null:i:null}update(e,t,i,s){if(this.isEnabled()&&!this.isEventIgnored(e)){let n;!this.mouseleaveHandler&&this.graph.container&&(this.mouseleaveHandler=()=>{this.reset()},InternalEvent.addListener(this.graph.container,"mouseleave",this.resetHandler));let a=this.getTolerance(e),l=new Rectangle((s?s.x:e.getGraphX())-a,(s?s.y:e.getGraphY())-a,2*a,2*a),r=new Rectangle(e.getGraphX()-a,e.getGraphY()-a,2*a,2*a),o=this.graph.view.getState(this.getCellForEvent(e,s));this.isKeepFocusEvent(e)||this.currentFocusArea&&this.currentFocus&&!o&&this.currentFocus.cell.isVertex()&&intersects$1(this.currentFocusArea,r)||o===this.currentFocus||(this.currentFocusArea=null,this.currentFocus=null,this.setFocus(e,o,t)),this.currentConstraint=null,this.currentPoint=null;let h=null;if(this.focusIcons.length>0&&this.constraints&&(!o||this.currentFocus===o)){let e=r.getCenterX(),a=r.getCenterY();for(let c=0;c<this.focusIcons.length;c+=1){let d=e-this.focusIcons[c].bounds.getCenterX(),u=a-this.focusIcons[c].bounds.getCenterY();if(n=d*d+u*u,(this.intersects(this.focusIcons[c],r,t,i)||s&&this.intersects(this.focusIcons[c],l,t,i))&&(null===h||n<h)){if(this.currentConstraint=this.constraints[c],this.currentPoint=this.focusPoints[c],h=n,(n=this.focusIcons[c].bounds.clone()).grow(HIGHLIGHT_SIZE+1),n.width-=1,n.height-=1,!this.focusHighlight){let e=this.createHighlightShape();e.dialect=DIALECT.SVG,e.pointerEvents=!1,e.init(this.graph.getView().getOverlayPane()),this.focusHighlight=e;let t=()=>this.currentFocus?this.currentFocus:o;InternalEvent.redirectMouseEvents(e.node,this.graph,t)}this.focusHighlight.bounds=n,this.focusHighlight.redraw()}}}this.currentConstraint||this.destroyFocusHighlight()}else this.currentConstraint=null,this.currentFocus=null,this.currentPoint=null}redraw(){if(this.currentFocus&&this.constraints&&this.focusIcons.length>0){let e=this.graph.view.getState(this.currentFocus.cell);this.currentFocus=e,this.currentFocusArea=new Rectangle(e.x,e.y,e.width,e.height);for(let t=0;t<this.constraints.length;t+=1){let i=this.graph.getConnectionPoint(e,this.constraints[t]),s=this.getImageForConstraint(e,this.constraints[t],i),n=new Rectangle(Math.round(i.x-s.width/2),Math.round(i.y-s.height/2),s.width,s.height);this.focusIcons[t].bounds=n,this.focusIcons[t].redraw(),this.currentFocusArea.add(this.focusIcons[t].bounds),this.focusPoints[t]=i}}}setFocus(e,t,i){var s;if(this.constraints=t&&!this.isStateIgnored(t,i)&&t.cell.isConnectable()?this.isEnabled()?this.graph.getAllConnectionConstraints(t,i)??[]:[]:null,this.constraints&&t){this.currentFocus=t,this.currentFocusArea=new Rectangle(t.x,t.y,t.width,t.height);for(let e=0;e<this.focusIcons.length;e+=1)this.focusIcons[e].destroy();this.focusIcons=[],this.focusPoints=[];for(let e=0;e<this.constraints.length;e+=1){let i=this.graph.getConnectionPoint(t,this.constraints[e]),n=this.getImageForConstraint(t,this.constraints[e],i),{src:a}=n,l=new ImageShape(new Rectangle(Math.round(i.x-n.width/2),Math.round(i.y-n.height/2),n.width,n.height),a);l.dialect=this.graph.dialect!==DIALECT.SVG?DIALECT.MIXEDHTML:DIALECT.SVG,l.preserveImageAspect=!1,l.init(this.graph.getView().getDecoratorPane()),l.node.previousSibling&&(null==(s=l.node.parentNode)||s.insertBefore(l.node,l.node.parentNode.firstChild));let r=()=>this.currentFocus?this.currentFocus:t;l.redraw(),InternalEvent.redirectMouseEvents(l.node,this.graph,r),this.currentFocusArea.add(l.bounds),this.focusIcons.push(l),this.focusPoints.push(i)}this.currentFocusArea.grow(this.getTolerance(e))}else this.destroyIcons(),this.destroyFocusHighlight()}createHighlightShape(){let e=new RectangleShape(new Rectangle,this.highlightColor,this.highlightColor,HIGHLIGHT_STROKEWIDTH);return e.opacity=HIGHLIGHT_OPACITY,e}intersects(e,t,i,s){return intersects$1(e.bounds,t)}onDestroy(){this.reset(),this.graph.model.removeListener(this.resetHandler),this.graph.view.removeListener(this.resetHandler),this.graph.removeListener(this.resetHandler),this.mouseleaveHandler&&this.graph.container&&(InternalEvent.removeListener(this.graph.container,"mouseleave",this.mouseleaveHandler),this.mouseleaveHandler=null)}}let EdgeHandlerConfig={addBendOnShiftClickEnabled:!1,connectFillColor:CONNECT_HANDLE_FILLCOLOR,handleShape:"square",removeBendOnShiftClickEnabled:!1,selectionColor:EDGE_SELECTION_COLOR,selectionDashed:EDGE_SELECTION_DASHED,selectionStrokeWidth:EDGE_SELECTION_STROKEWIDTH,virtualBendOpacity:20,virtualBendsEnabled:!1},defaultEdgeHandlerConfig={...EdgeHandlerConfig},resetEdgeHandlerConfig=()=>{shallowCopy(defaultEdgeHandlerConfig,EdgeHandlerConfig)},HandleConfig={fillColor:HANDLE_FILLCOLOR,labelFillColor:LABEL_HANDLE_FILLCOLOR,labelSize:LABEL_HANDLE_SIZE,size:HANDLE_SIZE,strokeColor:HANDLE_STROKECOLOR},defaultHandleConfig={...HandleConfig},resetHandleConfig=()=>{shallowCopy(defaultHandleConfig,HandleConfig)},VertexHandlerConfig={rotationEnabled:!1,selectionColor:VERTEX_SELECTION_COLOR,selectionStrokeWidth:VERTEX_SELECTION_STROKEWIDTH,selectionDashed:VERTEX_SELECTION_DASHED},defaultVertexHandlerConfig={...VertexHandlerConfig},resetVertexHandlerConfig=()=>{shallowCopy(defaultVertexHandlerConfig,VertexHandlerConfig)};class EdgeHandler{constructor(e){if(this.error=null,this.bends=[],this.cloneEnabled=!0,this.dblClickRemoveEnabled=!1,this.mergeRemoveEnabled=!1,this.straightRemoveEnabled=!1,this.parentHighlightEnabled=!1,this.preferHtml=!1,this.allowHandleBoundsCheck=!0,this.snapToTerminals=!1,this.handleImage=null,this.labelHandleImage=null,this.tolerance=0,this.outlineConnect=!1,this.manageLabelHandle=!1,this.currentPoint=null,this.parentHighlight=null,this.index=null,this.isSource=!1,this.isTarget=!1,this.isLabel=!1,this.points=[],this.snapPoint=null,this.abspoints=[],this.startX=0,this.startY=0,this.outline=!0,this.active=!0,this.state=e,this.graph=this.state.view.graph,this.marker=this.createMarker(),this.constraintHandler=new ConstraintHandler(this.graph),this.points=[],this.abspoints=this.getSelectionPoints(this.state),this.shape=this.createSelectionShape(this.abspoints),this.shape.dialect=this.graph.dialect!==DIALECT.SVG?DIALECT.MIXEDHTML:DIALECT.SVG,this.shape.init(this.graph.getView().getOverlayPane()),this.shape.pointerEvents=!1,this.shape.setCursor(CURSOR.MOVABLE_EDGE),InternalEvent.redirectMouseEvents(this.shape.node,this.graph,this.state),this.preferHtml=null!=this.state.text&&this.state.text.node.parentNode===this.graph.container,!this.preferHtml){let e=this.state.getVisibleTerminalState(!0);if(null!=e&&(this.preferHtml=null!=e.text&&e.text.node.parentNode===this.graph.container),!this.preferHtml){let e=this.state.getVisibleTerminalState(!1);null!=e&&(this.preferHtml=null!=e.text&&e.text.node.parentNode===this.graph.container)}}let t=this.graph.getPlugin("SelectionHandler");t&&(this.graph.getSelectionCount()<t.maxCells||t.maxCells<=0)&&(this.bends=this.createBends(),this.isVirtualBendsEnabled()&&(this.virtualBends=this.createVirtualBends())),this.label=new Point(this.state.absoluteOffset.x,this.state.absoluteOffset.y),this.labelShape=this.createLabelHandleShape(),this.initBend(this.labelShape),this.labelShape.setCursor(CURSOR.LABEL_HANDLE),this.customHandles=this.createCustomHandles(),this.updateParentHighlight(),this.redraw(),this.escapeHandler=(t,i)=>{let s=null!=this.index;this.reset(),s&&this.graph.cellRenderer.redraw(this.state,!1,e.view.isRendering())},this.state.view.graph.addListener(InternalEvent.ESCAPE,this.escapeHandler)}isParentHighlightVisible(){let e=this.state.cell.getParent();return e?!this.graph.isCellSelected(e):null}updateParentHighlight(){if(!this.isDestroyed()){let e=this.isParentHighlightVisible(),t=this.state.cell.getParent(),i=t?this.graph.view.getState(t):null;if(this.parentHighlight)if(t&&t.isVertex()&&e){let e=this.parentHighlight.bounds;i&&e&&(e.x!==i.x||e.y!==i.y||e.width!==i.width||e.height!==i.height)&&(this.parentHighlight.bounds=Rectangle.fromRectangle(i),this.parentHighlight.redraw())}else i&&i.parentHighlight===this.parentHighlight&&(i.parentHighlight=null),this.parentHighlight.destroy(),this.parentHighlight=null;else this.parentHighlightEnabled&&e&&t&&t.isVertex()&&i&&!i.parentHighlight&&(this.parentHighlight=this.createParentHighlightShape(i),this.parentHighlight.dialect=DIALECT.SVG,this.parentHighlight.pointerEvents=!1,i.style.rotation&&(this.parentHighlight.rotation=i.style.rotation),this.parentHighlight.init(this.graph.getView().getOverlayPane()),this.parentHighlight.redraw(),i.parentHighlight=this.parentHighlight)}}createCustomHandles(){return[]}isVirtualBendsEnabled(e){return EdgeHandlerConfig.virtualBendsEnabled&&(null==this.state.style.edgeStyle||this.state.style.edgeStyle===NONE||this.state.style.noEdgeStyle)&&"arrow"!==this.state.style.shape}isCellEnabled(e){return!0}isAddPointEvent(e){return isShiftDown(e)}isRemovePointEvent(e){return isShiftDown(e)}getSelectionPoints(e){return e.absolutePoints}createParentHighlightShape(e){let t=new RectangleShape(Rectangle.fromRectangle(e),NONE,this.getSelectionColor());return t.strokeWidth=this.getSelectionStrokeWidth(),t.isDashed=this.isSelectionDashed(),t}createSelectionShape(e){let t=new this.state.shape.constructor;return t.outline=!0,t.apply(this.state),t.isDashed=this.isSelectionDashed(),t.stroke=this.getSelectionColor(),t.isShadow=!1,t}getSelectionColor(){return EdgeHandlerConfig.selectionColor}getSelectionStrokeWidth(){return EdgeHandlerConfig.selectionStrokeWidth}isSelectionDashed(){return EdgeHandlerConfig.selectionDashed}isConnectableCell(e){return!0}getCellAt(e,t){return this.outlineConnect?null:this.graph.getCellAt(e,t)}createMarker(){return new EdgeHandlerCellMarker(this.graph,this)}validateConnection(e,t){return this.graph.getEdgeValidationError(this.state.cell,e,t)}createBends(){let{cell:e}=this.state,t=[];for(let i=0;i<this.abspoints.length;i+=1)if(this.isHandleVisible(i)){let s=0===i,n=i===this.abspoints.length-1,a=s||n;(a||this.graph.isCellBendable(e))&&(e=>{let s=this.createHandleShape(e);this.initBend(s,()=>{this.dblClickRemoveEnabled&&this.removePoint(this.state,e)}),this.isHandleEnabled(i)&&s.setCursor(a?CURSOR.TERMINAL_HANDLE:CURSOR.BEND_HANDLE),t.push(s),a||(this.points.push(new Point(0,0)),s.node.style.visibility="hidden")})(i)}return t}createVirtualBends(){let{cell:e}=this.state;this.abspoints[0];let t=[];if(this.graph.isCellBendable(e))for(let e=1;e<this.abspoints.length;e+=1)(e=>{this.initBend(e),e.setCursor(CURSOR.VIRTUAL_BEND_HANDLE),t.push(e)})(this.createHandleShape());return t}isHandleEnabled(e){return!0}isHandleVisible(e){let t=this.state.getVisibleTerminalState(!0),i=this.state.getVisibleTerminalState(!1),s=this.state.cell.getGeometry();return(s?this.graph.view.getEdgeStyle(this.state,s.points||void 0,t,i):null)!==EdgeStyle.EntityRelation||0===e||e===this.abspoints.length-1}createHandleShape(e){if(this.handleImage){let e=new ImageShape(new Rectangle(0,0,this.handleImage.width,this.handleImage.height),this.handleImage.src);return e.preserveImageAspect=!1,e}let t=HandleConfig.size;return this.preferHtml&&(t-=1),new("circle"===EdgeHandlerConfig.handleShape?EllipseShape:RectangleShape)(new Rectangle(0,0,t,t),HandleConfig.fillColor,HandleConfig.strokeColor)}createLabelHandleShape(){if(this.labelHandleImage){let e=new ImageShape(new Rectangle(0,0,this.labelHandleImage.width,this.labelHandleImage.height),this.labelHandleImage.src);return e.preserveImageAspect=!1,e}let e=HandleConfig.labelSize;return new RectangleShape(new Rectangle(0,0,e,e),HandleConfig.labelFillColor,HandleConfig.strokeColor)}initBend(e,t){this.preferHtml?(e.dialect=DIALECT.STRICTHTML,e.init(this.graph.container)):(e.dialect=this.graph.dialect!==DIALECT.SVG?DIALECT.MIXEDHTML:DIALECT.SVG,e.init(this.graph.getView().getOverlayPane())),InternalEvent.redirectMouseEvents(e.node,this.graph,this.state,null,null,null,t),Client.IS_TOUCH&&e.node.setAttribute("pointer-events","none")}getHandleForEvent(e){let t=null,i=isMouseEvent(e.getEvent())?1:this.tolerance,s=this.allowHandleBoundsCheck&&i>0?new Rectangle(e.getGraphX()-i,e.getGraphY()-i,2*i,2*i):null,n=Number.POSITIVE_INFINITY;function a(t){if(t&&t.bounds&&t.node&&"none"!==t.node.style.display&&"hidden"!==t.node.style.visibility&&(e.isSource(t)||s&&intersects$1(t.bounds,s))){let i=e.getGraphX()-t.bounds.getCenterX(),s=e.getGraphY()-t.bounds.getCenterY(),a=i*i+s*s;if(a<=n)return n=a,!0}return!1}if(this.isCustomHandleEvent(e)&&this.customHandles){for(let e=this.customHandles.length-1;e>=0;e--)if(a(this.customHandles[e].shape))return InternalEvent.CUSTOM_HANDLE-e}(e.isSource(this.state.text)||a(this.labelShape))&&(t=InternalEvent.LABEL_HANDLE);for(let e=0;e<this.bends.length;e+=1)a(this.bends[e])&&(t=e);if(this.virtualBends&&this.isAddVirtualBendEvent(e))for(let e=0;e<this.virtualBends.length;e+=1)a(this.virtualBends[e])&&(t=InternalEvent.VIRTUAL_HANDLE-e);return t}isAddVirtualBendEvent(e){return!0}isCustomHandleEvent(e){return!0}mouseDown(e,t){let i=this.getHandleForEvent(t);if(null!==i&&this.bends[i]){let e=this.bends[i].bounds;e&&(this.snapPoint=new Point(e.getCenterX(),e.getCenterY()))}if(EdgeHandlerConfig.addBendOnShiftClickEnabled&&null===i&&this.isAddPointEvent(t.getEvent()))this.addPoint(this.state,t.getEvent()),t.consume();else if(null!==i&&!t.isConsumed()&&this.graph.isEnabled()){let e=t.getCell();EdgeHandlerConfig.removeBendOnShiftClickEnabled&&this.isRemovePointEvent(t.getEvent())?this.removePoint(this.state,i):(i!==InternalEvent.LABEL_HANDLE||e&&this.graph.isLabelMovable(e))&&(this.virtualBends&&i<=InternalEvent.VIRTUAL_HANDLE&&setOpacity(this.virtualBends[InternalEvent.VIRTUAL_HANDLE-i].node,100),this.start(t.getX(),t.getY(),i)),t.consume()}}start(e,t,i){if(this.startX=e,this.startY=t,this.isSource=0!==this.bends.length&&0===i,this.isTarget=0!==this.bends.length&&i===this.bends.length-1,this.isLabel=i===InternalEvent.LABEL_HANDLE,this.isSource||this.isTarget){let{cell:e}=this.state,t=e.getTerminal(this.isSource);(null==t&&this.graph.isTerminalPointMovable(e,this.isSource)||null!=t&&this.graph.isCellDisconnectable(e,t,this.isSource))&&(this.index=i)}else this.index=i;if(null!==this.index&&this.index<=InternalEvent.CUSTOM_HANDLE&&this.index>InternalEvent.VIRTUAL_HANDLE&&null!=this.customHandles)for(let e=0;e<this.customHandles.length;e+=1)e!==InternalEvent.CUSTOM_HANDLE-this.index&&this.customHandles[e].setVisible(!1)}clonePreviewState(e,t){return this.state.clone()}getSnapToTerminalTolerance(){return this.graph.getGridSize()*this.graph.getView().scale/2}updateHint(e,t){}removeHint(){}roundLength(e){return Math.round(e)}isSnapToTerminalsEvent(e){return this.snapToTerminals&&!isAltDown(e.getEvent())}getPointForEvent(e){let t=this.graph.getView(),{scale:i}=t,s=new Point(this.roundLength(e.getGraphX()/i)*i,this.roundLength(e.getGraphY()/i)*i),n=this.getSnapToTerminalTolerance(),a=!1,l=!1;if(n>0&&this.isSnapToTerminalsEvent(e)){let e=e=>{if(e){let{x:t}=e;Math.abs(s.x-t)<n&&(s.x=t,a=!0);let{y:i}=e;Math.abs(s.y-i)<n&&(s.y=i,l=!0)}},i=i=>{i&&e(new Point(t.getRoutingCenterX(i),t.getRoutingCenterY(i)))};i(this.state.getVisibleTerminalState(!0)),i(this.state.getVisibleTerminalState(!1));for(let t=0;t<this.state.absolutePoints.length;t+=1)e(this.state.absolutePoints[t])}if(this.graph.isGridEnabledEvent(e.getEvent())){let e=t.translate;a||(s.x=(this.graph.snap(s.x/i-e.x)+e.x)*i),l||(s.y=(this.graph.snap(s.y/i-e.y)+e.y)*i)}return s}getPreviewTerminalState(e){if(this.constraintHandler.update(e,this.isSource,!0,e.isSource(this.marker.highlight.shape)?null:this.currentPoint),this.constraintHandler.currentFocus&&this.constraintHandler.currentConstraint){this.marker.highlight&&this.marker.highlight.shape&&this.marker.highlight.state&&this.marker.highlight.state.cell===this.constraintHandler.currentFocus.cell?"transparent"!==this.marker.highlight.shape.stroke&&(this.marker.highlight.shape.stroke="transparent",this.marker.highlight.repaint()):this.marker.markCell(this.constraintHandler.currentFocus.cell,"transparent");let e=this.graph.view.getTerminalPort(this.state,this.graph.view.getState(this.state.cell.getTerminal(!this.isSource)),!this.isSource),t=e?e.cell:null,i=this.isSource?this.constraintHandler.currentFocus.cell:t,s=this.isSource?t:this.constraintHandler.currentFocus.cell;this.error=this.validateConnection(i,s);let n=null;return null===this.error&&(n=this.constraintHandler.currentFocus),(null!==this.error||n&&!this.isCellEnabled(n.cell))&&this.constraintHandler.reset(),n}if(!this.graph.isIgnoreTerminalEvent(e.getEvent())){this.marker.process(e);let t=this.marker.getValidState();return t&&!this.isCellEnabled(t.cell)&&(this.constraintHandler.reset(),this.marker.reset()),this.marker.getValidState()}return this.marker.reset(),null}getPreviewPoints(e,t){let i=this.state.cell.getGeometry();if(!i)return null;let s=(i.points||[]).slice(),n=new Point(e.x,e.y),a=null;if(this.isSource||this.isTarget||null===this.index)this.graph.isResetEdgesOnConnect()&&(s=[]);else{if(this.convertPoint(n,!1),this.index<=InternalEvent.VIRTUAL_HANDLE&&s.splice(InternalEvent.VIRTUAL_HANDLE-this.index,0,n),!this.isSource&&!this.isTarget){for(let t=0;t<this.bends.length;t+=1)if(t!==this.index){let i=this.bends[t];i&&contains(i.bounds,e.x,e.y)&&(this.index<=InternalEvent.VIRTUAL_HANDLE?s.splice(InternalEvent.VIRTUAL_HANDLE-this.index,1):s.splice(this.index-1,1),a=s)}if(!a&&this.straightRemoveEnabled&&(!t||!isAltDown(t.getEvent()))){let t=this.graph.getEventTolerance()*this.graph.getEventTolerance(),i=this.state.absolutePoints.slice();i[this.index]=e;let n=this.state.getVisibleTerminalState(!0);if(null!=n){let e=this.graph.getConnectionConstraint(this.state,n,!0);(null==e||null==this.graph.getConnectionPoint(n,e))&&(i[0]=new Point(n.view.getRoutingCenterX(n),n.view.getRoutingCenterY(n)))}let l=this.state.getVisibleTerminalState(!1);if(null!=l){let e=this.graph.getConnectionConstraint(this.state,l,!1);(null==e||null==this.graph.getConnectionPoint(l,e))&&(i[i.length-1]=new Point(l.view.getRoutingCenterX(l),l.view.getRoutingCenterY(l)))}((e,n)=>{e>0&&e<i.length-1&&ptSegDistSq(i[e-1].x,i[e-1].y,i[e+1].x,i[e+1].y,n.x,n.y)<t&&(s.splice(e-1,1),a=s)})(this.index,e)}}null==a&&this.index>InternalEvent.VIRTUAL_HANDLE&&(s[this.index-1]=n)}return null!=a?a:s}isOutlineConnectEvent(e){if(!this.currentPoint)return!1;let t=getOffset(this.graph.container),i=e.getEvent(),s=getClientX(i),n=getClientY(i),a=document.documentElement,l=(window.pageXOffset||a.scrollLeft)-(a.clientLeft||0),r=(window.pageYOffset||a.scrollTop)-(a.clientTop||0),o=this.currentPoint.x-this.graph.container.scrollLeft+t.x-l,h=this.currentPoint.y-this.graph.container.scrollTop+t.y-r;return this.outlineConnect&&!isShiftDown(e.getEvent())&&(e.isSource(this.marker.highlight.shape)||isAltDown(e.getEvent())&&null!=e.getState()||this.marker.highlight.isHighlightAt(s,n)||(o!==s||h!==n)&&null==e.getState()&&this.marker.highlight.isHighlightAt(o,h))}updatePreviewState(e,t,i,s,n=!1){let a=this.isSource?i:this.state.getVisibleTerminalState(!0),l=this.isTarget?i:this.state.getVisibleTerminalState(!1),r=this.graph.getConnectionConstraint(e,a,!0),o=this.graph.getConnectionConstraint(e,l,!1),h=this.constraintHandler.currentConstraint;if(null==h&&n&&(null!=i?(s.isSource(this.marker.highlight.shape)&&(t=new Point(s.getGraphX(),s.getGraphY())),h=this.graph.getOutlineConstraint(t,i,s),this.constraintHandler.setFocus(s,i,this.isSource),this.constraintHandler.currentConstraint=h,this.constraintHandler.currentPoint=t):h=new ConnectionConstraint(null)),this.outlineConnect&&null!=this.marker.highlight&&null!=this.marker.highlight.shape){let e=this.graph.view.scale;if(null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus)this.marker.highlight.shape.stroke=n?OUTLINE_HIGHLIGHT_COLOR:"transparent",this.marker.highlight.shape.strokeWidth=OUTLINE_HIGHLIGHT_STROKEWIDTH/e/e,this.marker.highlight.repaint();else if(this.marker.hasValidState()){let t=s.getCell();this.marker.highlight.shape.stroke=t&&t.isConnectable()&&this.marker.getValidState()!==s.getState()?"transparent":DEFAULT_VALID_COLOR,this.marker.highlight.shape.strokeWidth=HIGHLIGHT_STROKEWIDTH/e/e,this.marker.highlight.repaint()}}this.isSource?r=h:this.isTarget&&(o=h),(this.isSource||this.isTarget)&&(null!=h&&null!=h.point?(e.style[this.isSource?"exitX":"entryX"]=h.point.x,e.style[this.isSource?"exitY":"entryY"]=h.point.y):(delete e.style[this.isSource?"exitX":"entryX"],delete e.style[this.isSource?"exitY":"entryY"])),e.setVisibleTerminalState(a,!0),e.setVisibleTerminalState(l,!1),this.isSource&&null==a||e.view.updateFixedTerminalPoint(e,a,!0,r),this.isTarget&&null==l||e.view.updateFixedTerminalPoint(e,l,!1,o),(this.isSource||this.isTarget)&&null==i&&(e.setAbsoluteTerminalPoint(t,this.isSource),null==this.marker.getMarkedState()&&(this.error=this.graph.isAllowDanglingEdges()?null:"")),e.view.updatePoints(e,this.points,a,l),e.view.updateFloatingTerminalPoints(e,a,l)}mouseMove(e,t){var i;if(null!=this.index&&null!=this.marker){if(this.currentPoint=this.getPointForEvent(t),this.error=null,!this.graph.isIgnoreTerminalEvent(t.getEvent())&&isShiftDown(t.getEvent())&&null!=this.snapPoint&&(Math.abs(this.snapPoint.x-this.currentPoint.x)<Math.abs(this.snapPoint.y-this.currentPoint.y)?this.currentPoint.x=this.snapPoint.x:this.currentPoint.y=this.snapPoint.y),this.index<=InternalEvent.CUSTOM_HANDLE&&this.index>InternalEvent.VIRTUAL_HANDLE)null!=this.customHandles&&(this.customHandles[InternalEvent.CUSTOM_HANDLE-this.index].processEvent(t),this.customHandles[InternalEvent.CUSTOM_HANDLE-this.index].positionChanged(),null!=this.shape&&null!=this.shape.node&&(this.shape.node.style.display="none"));else if(this.isLabel&&this.label)this.label.x=this.currentPoint.x,this.label.y=this.currentPoint.y;else{this.points=this.getPreviewPoints(this.currentPoint,t);let e=this.isSource||this.isTarget?this.getPreviewTerminalState(t):null;if(null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus&&null!=this.constraintHandler.currentPoint?this.currentPoint=this.constraintHandler.currentPoint.clone():this.outlineConnect&&((this.isSource||this.isTarget)&&this.isOutlineConnectEvent(t)?e=this.marker.highlight.state:null!=e&&e!==t.getState()&&(null==(i=t.getCell())?void 0:i.isConnectable())&&null!=this.marker.highlight.shape&&(this.marker.highlight.shape.stroke="transparent",this.marker.highlight.repaint(),e=null)),null==e||this.isCellEnabled(e.cell)||(e=null,this.marker.reset()),this.currentPoint){let i=this.clonePreviewState(this.currentPoint,null!=e?e.cell:null);this.updatePreviewState(i,this.currentPoint,e,t,this.outline);let s=null==this.error?this.marker.validColor:this.marker.invalidColor;this.setPreviewColor(s),this.abspoints=i.absolutePoints,this.active=!0,this.updateHint(t,this.currentPoint)}}this.drawPreview(),InternalEvent.consume(t.getEvent()),t.consume()}}mouseUp(e,t){if(null!=this.index&&null!=this.marker){null!=this.shape&&null!=this.shape.node&&(this.shape.node.style.display="");let e=this.state.cell,{index:i}=this;if(this.index=null,t.getX()!==this.startX||t.getY()!==this.startY){let s=!this.graph.isIgnoreTerminalEvent(t.getEvent())&&this.graph.isCloneEvent(t.getEvent())&&this.cloneEnabled&&this.graph.isCellsCloneable();if(null!=this.error)this.error.length>0&&this.graph.validationAlert(this.error);else if(i<=InternalEvent.CUSTOM_HANDLE&&i>InternalEvent.VIRTUAL_HANDLE){if(null!=this.customHandles){let e=this.graph.getDataModel();e.beginUpdate();try{this.customHandles[InternalEvent.CUSTOM_HANDLE-i].execute(t),null!=this.shape&&null!=this.shape.node&&(this.shape.apply(this.state),this.shape.redraw())}finally{e.endUpdate()}}}else if(this.isLabel&&this.label)this.moveLabel(this.state,this.label.x,this.label.y);else if(this.isSource||this.isTarget){let i=null;if(null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus&&(i=this.constraintHandler.currentFocus.cell),!i&&this.marker.hasValidState()&&null!=this.marker.highlight&&null!=this.marker.highlight.shape&&"transparent"!==this.marker.highlight.shape.stroke&&"white"!==this.marker.highlight.shape.stroke&&(i=this.marker.validState.cell),i){let n=this.graph.getDataModel(),a=e.getParent();n.beginUpdate();try{if(s){let t=e.getGeometry(),i=this.graph.cloneCell(e);n.add(a,i,a.getChildCount()),null!=t&&(t=t.clone(),n.setGeometry(i,t));let s=e.getTerminal(!this.isSource);this.graph.connectCell(i,s,!this.isSource),e=i}e=this.connect(e,i,this.isSource,s,t)}finally{n.endUpdate()}}else if(this.graph.isAllowDanglingEdges()){let t=this.abspoints[this.isSource?0:this.abspoints.length-1];t.x=this.roundLength(t.x/this.graph.view.scale-this.graph.view.translate.x),t.y=this.roundLength(t.y/this.graph.view.scale-this.graph.view.translate.y);let i=e.getParent(),n=i?this.graph.getView().getState(i):null;null!=n&&(t.x-=n.origin.x,t.y-=n.origin.y),t.x-=this.graph.getPanDx()/this.graph.view.scale,t.y-=this.graph.getPanDy()/this.graph.view.scale,e=this.changeTerminalPoint(e,t,this.isSource,s)}}else this.active?e=this.changePoints(e,this.points,s):(this.graph.getView().invalidate(this.state.cell),this.graph.getView().validate(this.state.cell))}else this.graph.isToggleEvent(t.getEvent())&&this.graph.selectCellForEvent(this.state.cell,t.getEvent());null!=this.marker&&(this.reset(),e!==this.state.cell&&this.graph.setSelectionCell(e)),t.consume()}}reset(){if(this.active&&this.refresh(),this.error=null,this.index=null,this.points=[],this.snapPoint=null,this.isLabel=!1,this.isSource=!1,this.isTarget=!1,this.active=!1,this.marker&&this.marker.reset(),this.constraintHandler.reset(),this.customHandles)for(let e=0;e<this.customHandles.length;e+=1)this.customHandles[e].reset();this.setPreviewColor(EdgeHandlerConfig.selectionColor),this.removeHint(),this.redraw()}setPreviewColor(e){this.shape.stroke=e}convertPoint(e,t){let i=this.graph.getView().getScale(),s=this.graph.getView().getTranslate();t&&(e.x=this.graph.snap(e.x),e.y=this.graph.snap(e.y)),e.x=Math.round(e.x/i-s.x),e.y=Math.round(e.y/i-s.y);let n=this.state.cell.getParent(),a=n?this.graph.getView().getState(n):n;return a&&(e.x-=a.origin.x,e.y-=a.origin.y),e}moveLabel(e,t,i){let s=this.graph.getDataModel(),n=e.cell.getGeometry();if(null!=n){let{scale:a}=this.graph.getView();if((n=n.clone()).relative){let s=this.graph.getView().getRelativePoint(e,t,i);n.x=Math.round(1e4*s.x)/1e4,n.y=Math.round(s.y),n.offset=new Point(0,0),s=this.graph.view.getPoint(e,n),n.offset=new Point(Math.round((t-s.x)/a),Math.round((i-s.y)/a))}else{let s=e.absolutePoints,l=s[0],r=s[s.length-1];if(null!=l&&null!=r){let e=l.x+(r.x-l.x)/2,s=l.y+(r.y-l.y)/2;n.offset=new Point(Math.round((t-e)/a),Math.round((i-s)/a)),n.x=0,n.y=0}}s.setGeometry(e.cell,n)}}connect(e,t,i,s,n){return e.getParent(),this.graph.batchUpdate(()=>{let s=this.constraintHandler.currentConstraint;null==s&&(s=new ConnectionConstraint(null)),this.graph.connectCell(e,t,i,s)}),e}changeTerminalPoint(e,t,i,s){let n=this.graph.getDataModel();return n.batchUpdate(()=>{if(s){let t=e.getParent(),s=e.getTerminal(!i);e=this.graph.cloneCell(e),n.add(t,e,t.getChildCount()),n.setTerminal(e,s,!i)}let a=e.getGeometry();null!=a&&((a=a.clone()).setTerminalPoint(t,i),n.setGeometry(e,a),this.graph.connectCell(e,null,i,new ConnectionConstraint(null)))}),e}changePoints(e,t,i){let s=this.graph.getDataModel();return s.batchUpdate(()=>{if(i){let t=e.getParent(),i=e.getTerminal(!0),n=e.getTerminal(!1);e=this.graph.cloneCell(e),s.add(t,e,t.getChildCount()),s.setTerminal(e,i,!0),s.setTerminal(e,n,!1)}let n=e.getGeometry();null!=n&&((n=n.clone()).points=t,s.setGeometry(e,n))}),e}addPoint(e,t){let i=convertPoint(this.graph.container,getClientX(t),getClientY(t)),s=this.graph.isGridEnabledEvent(t);this.convertPoint(i,s),this.addPointAt(e,i.x,i.y),InternalEvent.consume(t)}addPointAt(e,t,i){let s=e.cell.getGeometry(),n=new Point(t,i);if(null!=s){s=s.clone();let t=this.graph.view.translate,i=this.graph.view.scale,a=new Point(t.x*i,t.y*i),l=this.state.cell.getParent();if(l&&l.isVertex()){let e=this.graph.view.getState(l);e&&(a=new Point(e.x,e.y))}let r=findNearestSegment(e,n.x*i+a.x,n.y*i+a.y);null==s.points?s.points=[n]:s.points.splice(r,0,n),this.graph.getDataModel().setGeometry(e.cell,s),this.refresh(),this.redraw()}}removePoint(e,t){if(t>0&&t<this.abspoints.length-1){let i=this.state.cell.getGeometry();null!=i&&null!=i.points&&(((i=i.clone()).points||[]).splice(t-1,1),this.graph.getDataModel().setGeometry(e.cell,i),this.refresh(),this.redraw())}}getHandleFillColor(e){let t=0===e,{cell:i}=this.state,s=i.getTerminal(t),n=HandleConfig.fillColor;return(null==s||this.graph.isCellDisconnectable(i,s,t))&&(null!=s||this.graph.isTerminalPointMovable(i,t))?null!=s&&this.graph.isCellDisconnectable(i,s,t)&&(n=EdgeHandlerConfig.connectFillColor):n=LOCKED_HANDLE_FILLCOLOR,n}redraw(e){this.abspoints=this.state.absolutePoints.slice();let t=this.state.cell.getGeometry();if(t){let e=t.points;if(null!=this.bends&&this.bends.length>0&&null!=e){null==this.points&&(this.points=[]);for(let t=1;t<this.bends.length-1;t+=1)null!=this.bends[t]&&null!=this.abspoints[t]&&(this.points[t-1]=e[t-1])}}this.drawPreview(),e||this.redrawHandles()}redrawHandles(){let{cell:e}=this.state,t=this.labelShape.bounds;this.label=new Point(this.state.absoluteOffset.x,this.state.absoluteOffset.y),this.labelShape.bounds=new Rectangle(Math.round(this.label.x-t.width/2),Math.round(this.label.y-t.height/2),t.width,t.height);let i=this.graph.getLabel(e);if(this.labelShape.visible=null!=i&&i.length>0&&this.graph.isLabelMovable(e),null!=this.bends&&this.bends.length>0){let e=this.abspoints.length-1,i=this.abspoints[0],s=i.x,n=i.y;t=this.bends[0].bounds,this.bends[0].bounds=new Rectangle(Math.floor(s-t.width/2),Math.floor(n-t.height/2),t.width,t.height),this.bends[0].fill=this.getHandleFillColor(0),this.bends[0].redraw(),this.manageLabelHandle&&this.checkLabelHandle(this.bends[0].bounds);let a=this.abspoints[e],l=a.x,r=a.y,o=this.bends.length-1;t=this.bends[o].bounds,this.bends[o].bounds=new Rectangle(Math.floor(l-t.width/2),Math.floor(r-t.height/2),t.width,t.height),this.bends[o].fill=this.getHandleFillColor(o),this.bends[o].redraw(),this.manageLabelHandle&&this.checkLabelHandle(this.bends[o].bounds),this.redrawInnerBends(i,a)}if(this.virtualBends&&this.virtualBends.length>0){let e=this.abspoints[0];for(let t=0;t<this.virtualBends.length;t+=1)if(null!=this.virtualBends[t]&&null!=this.abspoints[t+1]){let i=this.abspoints[t+1],s=this.virtualBends[t],n=e.x+(i.x-e.x)/2,a=e.y+(i.y-e.y)/2;s.bounds&&(s.bounds=new Rectangle(Math.floor(n-s.bounds.width/2),Math.floor(a-s.bounds.height/2),s.bounds.width,s.bounds.height),s.redraw()),setOpacity(s.node,EdgeHandlerConfig.virtualBendOpacity),e=i,this.manageLabelHandle&&this.checkLabelHandle(s.bounds)}}if(this.labelShape.redraw(),this.customHandles)for(let e=0;e<this.customHandles.length;e+=1){let t=this.customHandles[e].shape;if(t){let i=t.node.style.display;this.customHandles[e].redraw(),t.node.style.display=i,t.node.style.visibility=this.isCustomHandleVisible(this.customHandles[e])?"":"hidden"}}}isCustomHandleVisible(e){return!this.graph.isEditing()&&1===this.state.view.graph.getSelectionCount()}setHandlesVisible(e){for(let t=0;t<this.bends.length;t+=1)this.bends[t].node.style.display=e?"":"none";if(this.virtualBends)for(let t=0;t<this.virtualBends.length;t+=1)this.virtualBends[t].node.style.display=e?"":"none";if(this.labelShape.node.style.display=e?"":"none",this.customHandles)for(let t=0;t<this.customHandles.length;t+=1)this.customHandles[t].setVisible(e)}redrawInnerBends(e,t){for(let e=1;e<this.bends.length-1;e+=1)if(null!=this.bends[e])if(null!=this.abspoints[e]){let{x:t}=this.abspoints[e],{y:i}=this.abspoints[e],s=this.bends[e].bounds;if(this.bends[e].node.style.visibility="visible",this.bends[e].bounds=new Rectangle(Math.round(t-s.width/2),Math.round(i-s.height/2),s.width,s.height),this.manageLabelHandle)this.checkLabelHandle(this.bends[e].bounds);else if(null==this.handleImage&&this.labelShape.visible&&intersects$1(this.bends[e].bounds,this.labelShape.bounds)){let s=HandleConfig.size+3,n=s;this.bends[e].bounds=new Rectangle(Math.round(t-s/2),Math.round(i-n/2),s,n)}this.bends[e].redraw()}else this.bends[e].destroy()}checkLabelHandle(e){let t=this.labelShape.bounds;intersects$1(e,t)&&(e.getCenterY()<t.getCenterY()?t.y=e.y+e.height:t.y=e.y-t.height)}drawPreview(){try{if(this.isLabel){let e=this.labelShape.bounds,t=new Rectangle(Math.round(this.label.x-e.width/2),Math.round(this.label.y-e.height/2),e.width,e.height);e.equals(t)||(this.labelShape.bounds=t,this.labelShape.redraw())}null==this.shape||equalPoints(this.shape.points,this.abspoints)||(this.shape.apply(this.state),this.shape.points=this.abspoints.slice(),this.shape.scale=this.state.view.scale,this.shape.isDashed=this.isSelectionDashed(),this.shape.stroke=this.getSelectionColor(),this.shape.strokeWidth=this.getSelectionStrokeWidth()/this.shape.scale/this.shape.scale,this.shape.isShadow=!1,this.shape.redraw()),this.updateParentHighlight()}catch(e){}}refresh(){null!=this.state&&(this.abspoints=this.getSelectionPoints(this.state),this.points=[],this.destroyBends(this.bends),this.bends=this.createBends(),this.virtualBends&&(this.destroyBends(this.virtualBends),this.virtualBends=this.createVirtualBends()),this.customHandles&&(this.destroyBends(this.customHandles),this.customHandles=this.createCustomHandles()),null!=this.labelShape&&null!=this.labelShape.node&&null!=this.labelShape.node.parentNode&&this.labelShape.node.parentNode.appendChild(this.labelShape.node))}isDestroyed(){return null==this.shape}destroyBends(e){if(null!=e)for(let t=0;t<e.length;t+=1)null!=e[t]&&e[t].destroy()}onDestroy(){if(this.state.view.graph.removeListener(this.escapeHandler),this.marker.destroy(),this.marker=null,this.shape.destroy(),this.shape=null,this.parentHighlight){let e=this.state.cell.getParent(),t=e?this.graph.view.getState(e):null;t&&t.parentHighlight===this.parentHighlight&&(t.parentHighlight=null),this.parentHighlight.destroy(),this.parentHighlight=null}this.labelShape.destroy(),this.labelShape=null,this.constraintHandler.onDestroy(),this.constraintHandler=null,this.virtualBends&&(this.destroyBends(this.virtualBends),this.virtualBends=[]),this.customHandles&&(this.destroyBends(this.customHandles),this.customHandles=[]),this.destroyBends(this.bends),this.bends=[],this.removeHint()}}class EdgeHandlerCellMarker extends CellMarker{constructor(e,t,i=DEFAULT_VALID_COLOR,s=DEFAULT_INVALID_COLOR,n=DEFAULT_HOTSPOT){super(e,i,s,n),this.getCell=e=>{let t=super.getCell(e);if((t===this.edgeHandler.state.cell||!t)&&this.edgeHandler.currentPoint&&(t=this.edgeHandler.graph.getCellAt(this.edgeHandler.currentPoint.x,this.edgeHandler.currentPoint.y)),t&&!t.isConnectable()){let e=t.getParent();e&&e.isVertex()&&e.isConnectable()&&(t=e)}return t&&(this.graph.isSwimlane(t)&&this.edgeHandler.currentPoint&&this.graph.hitsSwimlaneContent(t,this.edgeHandler.currentPoint.x,this.edgeHandler.currentPoint.y)||!this.edgeHandler.isConnectableCell(t)||t===this.edgeHandler.state.cell||t&&!this.edgeHandler.graph.connectableEdges&&t.isEdge()||this.edgeHandler.state.cell.isAncestor(t))&&(t=null),t&&!t.isConnectable()&&(t=null),t},this.isValidState=e=>{let t=this.edgeHandler.state.cell.getTerminal(!this.edgeHandler.isSource),i=this.edgeHandler.graph.view.getState(t),s=this.edgeHandler.graph.view.getTerminalPort(e,i,!this.edgeHandler.isSource),n=s?s.cell:null,a=this.edgeHandler.isSource?e.cell:n,l=this.edgeHandler.isSource?n:e.cell;return this.edgeHandler.error=this.edgeHandler.validateConnection(a,l),!this.edgeHandler.error},this.edgeHandler=t}}class VertexHandler{isRotationEnabled(){return VertexHandlerConfig.rotationEnabled}constructor(e){this.sizers=[],this.singleSizer=!1,this.index=null,this.allowHandleBoundsCheck=!0,this.handleImage=null,this.handlesVisible=!0,this.tolerance=0,this.parentHighlightEnabled=!1,this.rotationRaster=!0,this.rotationCursor="crosshair",this.livePreview=!1,this.movePreviewToFront=!1,this.manageSizers=!1,this.constrainGroupByChildren=!1,this.rotationHandleVSpacing=-16,this.horizontalOffset=0,this.verticalOffset=0,this.minBounds=null,this.x0=0,this.y0=0,this.customHandles=[],this.inTolerance=!1,this.startX=0,this.startY=0,this.rotationShape=null,this.currentAlpha=null,this.startAngle=0,this.startDist=0,this.ghostPreview=null,this.livePreviewActive=!1,this.childOffsetX=0,this.childOffsetY=0,this.parentState=null,this.parentHighlight=null,this.unscaledBounds=null,this.preview=null,this.labelShape=null,this.edgeHandlers=[],this.EMPTY_POINT=new Point,this.state=e,this.graph=this.state.view.graph,this.selectionBounds=this.getSelectionBounds(this.state),this.bounds=new Rectangle(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height),this.selectionBorder=this.createSelectionShape(this.bounds),this.selectionBorder.dialect=DIALECT.SVG,this.selectionBorder.pointerEvents=!1,this.selectionBorder.rotation=this.state.style.rotation??0,this.selectionBorder.init(this.graph.getView().getOverlayPane()),InternalEvent.redirectMouseEvents(this.selectionBorder.node,this.graph,this.state),this.graph.isCellMovable(this.state.cell)&&this.selectionBorder.setCursor(CURSOR.MOVABLE_VERTEX);let t=this.getSelectionHandler();if(t&&(t.maxCells<=0||this.graph.getSelectionCount()<t.maxCells)){let e=this.graph.isCellResizable(this.state.cell);if(this.sizers=[],e||this.graph.isLabelMovable(this.state.cell)&&this.state.width>=2&&this.state.height>=2){let t=0;e&&(this.singleSizer||(this.sizers.push(this.createSizer("nw-resize",t++)),this.sizers.push(this.createSizer("n-resize",t++)),this.sizers.push(this.createSizer("ne-resize",t++)),this.sizers.push(this.createSizer("w-resize",t++)),this.sizers.push(this.createSizer("e-resize",t++)),this.sizers.push(this.createSizer("sw-resize",t++)),this.sizers.push(this.createSizer("s-resize",t++))),this.sizers.push(this.createSizer("se-resize",t++)));let i=this.state.cell.getGeometry();null!=i&&!i.relative&&!this.graph.isSwimlane(this.state.cell)&&this.graph.isLabelMovable(this.state.cell)&&(this.labelShape=this.createSizer(CURSOR.LABEL_HANDLE,InternalEvent.LABEL_HANDLE,HandleConfig.labelSize,HandleConfig.labelFillColor),this.sizers.push(this.labelShape))}else this.graph.isCellMovable(this.state.cell)&&!this.graph.isCellResizable(this.state.cell)&&this.state.width<2&&this.state.height<2&&(this.labelShape=this.createSizer(CURSOR.MOVABLE_VERTEX,InternalEvent.LABEL_HANDLE,void 0,HandleConfig.labelFillColor),this.sizers.push(this.labelShape))}this.isRotationHandleVisible()&&(this.rotationShape=this.createSizer(this.rotationCursor,InternalEvent.ROTATION_HANDLE,HandleConfig.size+3,HandleConfig.fillColor),this.sizers.push(this.rotationShape)),this.customHandles=this.createCustomHandles(),this.redraw(),this.constrainGroupByChildren&&this.updateMinBounds(),this.escapeHandler=(e,t)=>{this.livePreview&&null!=this.index&&(this.state.view.graph.cellRenderer.redraw(this.state,!0),this.state.view.invalidate(this.state.cell),this.state.invalid=!1,this.state.view.validate()),this.reset()},this.state.view.graph.addListener(InternalEvent.ESCAPE,this.escapeHandler)}getSelectionHandler(){return this.graph.getPlugin("SelectionHandler")}isRotationHandleVisible(){let e=this.getSelectionHandler(),t=!e||e.maxCells<=0||this.graph.getSelectionCount()<e.maxCells;return this.graph.isEnabled()&&this.isRotationEnabled()&&this.graph.isCellRotatable(this.state.cell)&&t}isConstrainedEvent(e){return isShiftDown(e.getEvent())||"fixed"===this.state.style.aspect}isCenteredEvent(e,t){return!1}createCustomHandles(){return[]}updateMinBounds(){let e=this.graph.getChildCells(this.state.cell);if(e.length>0&&(this.minBounds=this.graph.view.getBounds(e),this.minBounds)){let e=this.state.view.scale,t=this.state.view.translate;this.minBounds.x-=this.state.x,this.minBounds.y-=this.state.y,this.minBounds.x/=e,this.minBounds.y/=e,this.minBounds.width/=e,this.minBounds.height/=e,this.x0=this.state.x/e-t.x,this.y0=this.state.y/e-t.y}}getSelectionBounds(e){return new Rectangle(Math.round(e.x),Math.round(e.y),Math.round(e.width),Math.round(e.height))}createParentHighlightShape(e){return this.createSelectionShape(e)}createSelectionShape(e){let t=new RectangleShape(Rectangle.fromRectangle(e),NONE,this.getSelectionColor());return t.strokeWidth=this.getSelectionStrokeWidth(),t.isDashed=this.isSelectionDashed(),t}getSelectionColor(){return VertexHandlerConfig.selectionColor}getSelectionStrokeWidth(){return VertexHandlerConfig.selectionStrokeWidth}isSelectionDashed(){return VertexHandlerConfig.selectionDashed}createSizer(e,t,i=HandleConfig.size,s=HandleConfig.fillColor){let n=new Rectangle(0,0,i,i),a=this.createSizerShape(n,t,s);return a.bounds&&a.isHtmlAllowed()&&this.state.text&&this.state.text.node.parentNode===this.graph.container?(a.bounds.height-=1,a.bounds.width-=1,a.dialect=DIALECT.STRICTHTML,a.init(this.graph.container)):(a.dialect=this.graph.dialect!==DIALECT.SVG?DIALECT.MIXEDHTML:DIALECT.SVG,a.init(this.graph.getView().getOverlayPane())),InternalEvent.redirectMouseEvents(a.node,this.graph,this.state),this.graph.isEnabled()&&a.setCursor(e),this.isSizerVisible(t)||(a.visible=!1),a}isSizerVisible(e){return!0}createSizerShape(e,t,i=HandleConfig.fillColor){if(this.handleImage){let t=new ImageShape(e=new Rectangle(e.x,e.y,this.handleImage.width,this.handleImage.height),this.handleImage.src);return t.preserveImageAspect=!1,t}let s=HandleConfig.strokeColor;return t===InternalEvent.ROTATION_HANDLE?new EllipseShape(e,i,s):new RectangleShape(e,i,s)}moveSizerTo(e,t,i){e&&e.bounds&&(e.bounds.x=Math.floor(t-e.bounds.width/2),e.bounds.y=Math.floor(i-e.bounds.height/2),e.node&&"none"!==e.node.style.display&&e.redraw())}getHandleForEvent(e){let t=isMouseEvent(e.getEvent())?1:this.tolerance,i=this.allowHandleBoundsCheck&&t>0?new Rectangle(e.getGraphX()-t,e.getGraphY()-t,2*t,2*t):null,s=t=>{let s=t&&t.constructor!==ImageShape&&this.allowHandleBoundsCheck?t.strokeWidth+t.svgStrokeTolerance:null,n=s?new Rectangle(e.getGraphX()-Math.floor(s/2),e.getGraphY()-Math.floor(s/2),s,s):i;return t&&t.bounds&&(e.isSource(t)||n&&intersects$1(t.bounds,n)&&"none"!==t.node.style.display&&"hidden"!==t.node.style.visibility)};if(s(this.rotationShape))return InternalEvent.ROTATION_HANDLE;if(s(this.labelShape))return InternalEvent.LABEL_HANDLE;for(let e=0;e<this.sizers.length;e+=1)if(s(this.sizers[e]))return e;if(null!=this.customHandles&&this.isCustomHandleEvent(e)){for(let e=this.customHandles.length-1;e>=0;e--)if(s(this.customHandles[e].shape))return InternalEvent.CUSTOM_HANDLE-e}return null}isCustomHandleEvent(e){return!0}mouseDown(e,t){if(!t.isConsumed()&&this.graph.isEnabled()){let e=this.getHandleForEvent(t);e&&(this.start(t.getGraphX(),t.getGraphY(),e),t.consume())}}isLivePreviewBorder(){return this.state.shape&&this.state.shape.fill===NONE&&this.state.shape.stroke===NONE}start(e,t,i){if(this.livePreviewActive=this.livePreview&&0===this.state.cell.getChildCount(),this.inTolerance=!0,this.childOffsetX=0,this.childOffsetY=0,this.index=i,this.startX=e,this.startY=t,this.index<=InternalEvent.CUSTOM_HANDLE&&this.isGhostPreview())this.ghostPreview=this.createGhostPreview();else{let e=this.state.cell.getParent();if(this.state.view.currentRoot!==e&&e&&(e.isVertex()||e.isEdge())&&(this.parentState=this.state.view.graph.view.getState(e)),this.selectionBorder.node.style.display=i===InternalEvent.ROTATION_HANDLE?"inline":"none",(!this.livePreviewActive||this.isLivePreviewBorder())&&(this.preview=this.createSelectionShape(this.bounds),Client.IS_SVG&&(this.state.style.rotation??0)!=0||null==this.state.text||this.state.text.node.parentNode!==this.graph.container?(this.preview.dialect=DIALECT.SVG,this.preview.init(this.graph.view.getOverlayPane())):(this.preview.dialect=DIALECT.STRICTHTML,this.preview.init(this.graph.container))),i===InternalEvent.ROTATION_HANDLE){let e=this.getRotationHandlePosition(),t=e.x-this.state.getCenterX(),i=e.y-this.state.getCenterY();this.startAngle=0!==t?180*Math.atan(i/t)/Math.PI+90:0,this.startDist=Math.sqrt(t*t+i*i)}if(this.livePreviewActive){this.hideSizers(),i===InternalEvent.ROTATION_HANDLE&&this.rotationShape?this.rotationShape.node.style.display="":i===InternalEvent.LABEL_HANDLE&&this.labelShape?this.labelShape.node.style.display="":this.sizers[i]?this.sizers[i].node.style.display="":i<=InternalEvent.CUSTOM_HANDLE&&this.customHandles[InternalEvent.CUSTOM_HANDLE-i].setVisible(!0);let e=this.state.cell.getEdges();this.edgeHandlers=[];let t=this.graph.getPlugin("SelectionCellsHandler");for(let i=0;i<e.length;i+=1){let s=null==t?void 0:t.getHandler(e[i]);s&&this.edgeHandlers.push(s)}}}}createGhostPreview(){let e=this.graph.cellRenderer.createShape(this.state);return e.init(this.graph.view.getOverlayPane()),e.scale=this.state.view.scale,e.bounds=this.bounds,e.outline=!0,e}setHandlesVisible(e){this.handlesVisible=e;for(let t=0;t<this.sizers.length;t+=1)this.sizers[t].node.style.display=e?"":"none";for(let t=0;t<this.customHandles.length;t+=1)this.customHandles[t].setVisible(e)}hideSizers(){this.setHandlesVisible(!1)}checkTolerance(e){this.inTolerance&&null!==this.startX&&null!==this.startY&&(isMouseEvent(e.getEvent())||Math.abs(e.getGraphX()-this.startX)>this.graph.getEventTolerance()||Math.abs(e.getGraphY()-this.startY)>this.graph.getEventTolerance())&&(this.inTolerance=!1)}updateHint(e){}removeHint(){}roundAngle(e){return Math.round(10*e)/10}roundLength(e){return Math.round(100*e)/100}mouseMove(e,t){t.isConsumed()||null==this.index?!this.graph.isMouseDown&&this.getHandleForEvent(t)&&t.consume(!1):(this.checkTolerance(t),this.inTolerance||(this.index<=InternalEvent.CUSTOM_HANDLE?null!=this.customHandles&&(this.customHandles[InternalEvent.CUSTOM_HANDLE-this.index].processEvent(t),this.customHandles[InternalEvent.CUSTOM_HANDLE-this.index].active=!0,null!=this.ghostPreview?(this.ghostPreview.apply(this.state),this.ghostPreview.strokeWidth=this.getSelectionStrokeWidth()/this.ghostPreview.scale/this.ghostPreview.scale,this.ghostPreview.isDashed=this.isSelectionDashed(),this.ghostPreview.stroke=this.getSelectionColor(),this.ghostPreview.redraw(),null!=this.selectionBounds&&(this.selectionBorder.node.style.display="none")):(this.movePreviewToFront&&this.moveToFront(),this.customHandles[InternalEvent.CUSTOM_HANDLE-this.index].positionChanged())):this.index===InternalEvent.LABEL_HANDLE?this.moveLabel(t):(this.index===InternalEvent.ROTATION_HANDLE?this.rotateVertex(t):this.resizeVertex(t),this.updateHint(t))),t.consume())}isGhostPreview(){return this.state.cell.getChildCount()>0}moveLabel(e){let t=new Point(e.getGraphX(),e.getGraphY()),i=this.graph.view.translate,{scale:s}=this.graph.view;this.graph.isGridEnabledEvent(e.getEvent())&&(t.x=(this.graph.snap(t.x/s-i.x)+i.x)*s,t.y=(this.graph.snap(t.y/s-i.y)+i.y)*s);let n=this.rotationShape?this.sizers.length-2:this.sizers.length-1;this.moveSizerTo(this.sizers[n],t.x,t.y)}rotateVertex(e){let t=new Point(e.getGraphX(),e.getGraphY()),i=this.state.x+this.state.width/2-t.x,s=this.state.y+this.state.height/2-t.y;if(this.currentAlpha=0!==i?180*Math.atan(s/i)/Math.PI+90:180*(s<0),i>0&&(this.currentAlpha-=180),this.currentAlpha-=this.startAngle,this.rotationRaster&&this.graph.isGridEnabledEvent(e.getEvent())){let e,n=Math.sqrt((i=t.x-this.state.getCenterX())*i+(s=t.y-this.state.getCenterY())*s);e=n-this.startDist<2?15:n-this.startDist<25?5:1,this.currentAlpha=Math.round(this.currentAlpha/e)*e}else this.currentAlpha=this.roundAngle(this.currentAlpha);this.selectionBorder.rotation=this.currentAlpha,this.selectionBorder.redraw(),this.livePreviewActive&&this.redrawHandles()}resizeVertex(e){let t=new Point(this.state.getCenterX(),this.state.getCenterY()),i=toRadians(this.state.style.rotation??0),s=new Point(e.getGraphX(),e.getGraphY()),n=this.graph.view.translate,{scale:a}=this.graph.view,l=Math.cos(-i),r=Math.sin(-i),o=s.x-this.startX,h=s.y-this.startY,c=l*o-r*h,d=r*o+l*h;o=c,h=d;let u=this.state.cell.getGeometry();if(u&&null!==this.index&&(this.unscaledBounds=this.union(u,o/a,h/a,this.index,this.graph.isGridEnabledEvent(e.getEvent()),1,new Point(0,0),this.isConstrainedEvent(e),this.isCenteredEvent(this.state,e))),u&&!u.relative){let e=this.graph.getMaximumGraphBounds();if(null!=e&&null!=this.parentState&&(e=Rectangle.fromRectangle(e),e.x-=(this.parentState.x-n.x*a)/a,e.y-=(this.parentState.y-n.y*a)/a),this.graph.isConstrainChild(this.state.cell)){let t=this.graph.getCellContainmentArea(this.state.cell);if(null!=t){let i=this.graph.getOverlap(this.state.cell);i>0&&(t=Rectangle.fromRectangle(t),t.x-=t.width*i,t.y-=t.height*i,t.width+=2*t.width*i,t.height+=2*t.height*i),e?(e=Rectangle.fromRectangle(e)).intersect(t):e=t}}e&&this.unscaledBounds&&(this.unscaledBounds.x<e.x&&(this.unscaledBounds.width-=e.x-this.unscaledBounds.x,this.unscaledBounds.x=e.x),this.unscaledBounds.y<e.y&&(this.unscaledBounds.height-=e.y-this.unscaledBounds.y,this.unscaledBounds.y=e.y),this.unscaledBounds.x+this.unscaledBounds.width>e.x+e.width&&(this.unscaledBounds.width-=this.unscaledBounds.x+this.unscaledBounds.width-e.x-e.width),this.unscaledBounds.y+this.unscaledBounds.height>e.y+e.height&&(this.unscaledBounds.height-=this.unscaledBounds.y+this.unscaledBounds.height-e.y-e.height))}if(this.unscaledBounds){let s=this.bounds;this.bounds=new Rectangle((this.parentState?this.parentState.x:n.x*a)+this.unscaledBounds.x*a,(this.parentState?this.parentState.y:n.y*a)+this.unscaledBounds.y*a,this.unscaledBounds.width*a,this.unscaledBounds.height*a),u&&u.relative&&this.parentState&&(this.bounds.x+=this.state.x-this.parentState.x,this.bounds.y+=this.state.y-this.parentState.y),l=Math.cos(i),r=Math.sin(i);let c=new Point(this.bounds.getCenterX(),this.bounds.getCenterY()),d=l*(o=c.x-t.x)-r*(h=c.y-t.y),p=r*o+l*h,g=d-o,m=p-h,f=this.bounds.x-this.state.x,x=this.bounds.y-this.state.y,v=l*f-r*x,b=r*f+l*x;this.bounds.x+=g,this.bounds.y+=m,this.unscaledBounds.x=this.roundLength(this.unscaledBounds.x+g/a),this.unscaledBounds.y=this.roundLength(this.unscaledBounds.y+m/a),this.unscaledBounds.width=this.roundLength(this.unscaledBounds.width),this.unscaledBounds.height=this.roundLength(this.unscaledBounds.height),this.state.cell.isCollapsed()||0===g&&0===m?(this.childOffsetX=0,this.childOffsetY=0):(this.childOffsetX=this.state.x-this.bounds.x+v,this.childOffsetY=this.state.y-this.bounds.y+b),s.equals(this.bounds)||(this.livePreviewActive&&this.updateLivePreview(e),null!=this.preview?this.drawPreview():this.updateParentHighlight())}}updateLivePreview(e){let{scale:t}=this.graph.view,i=this.graph.view.translate,s=this.state.clone();this.state.x=this.bounds.x,this.state.y=this.bounds.y,this.state.origin=new Point(this.state.x/t-i.x,this.state.y/t-i.y),this.state.width=this.bounds.width,this.state.height=this.bounds.height;let n=this.state.absoluteOffset;n=new Point(n.x,n.y),this.state.absoluteOffset.x=0,this.state.absoluteOffset.y=0;let a=this.state.cell.getGeometry();if(null!=a){let e=a.offset||this.EMPTY_POINT;null==e||a.relative||(this.state.absoluteOffset.x=this.state.view.scale*e.x,this.state.absoluteOffset.y=this.state.view.scale*e.y),this.state.view.updateVertexLabelOffset(this.state)}this.state.view.graph.cellRenderer.redraw(this.state,!0),this.state.view.invalidate(this.state.cell),this.state.invalid=!1,this.state.view.validate(),this.redrawHandles(),this.movePreviewToFront&&this.moveToFront(),null!=this.state.control&&null!=this.state.control.node&&(this.state.control.node.style.visibility="hidden"),this.state.setState(s)}moveToFront(){(this.state.text&&this.state.text.node&&this.state.text.node.nextSibling||this.state.shape&&this.state.shape.node&&this.state.shape.node.nextSibling&&(!this.state.text||this.state.shape.node.nextSibling!==this.state.text.node))&&(this.state.shape&&this.state.shape.node&&this.state.shape.node.parentNode&&this.state.shape.node.parentNode.appendChild(this.state.shape.node),this.state.text&&this.state.text.node&&this.state.text.node.parentNode&&this.state.text.node.parentNode.appendChild(this.state.text.node))}mouseUp(e,t){if(null!=this.index&&null!=this.state){let e=new Point(t.getGraphX(),t.getGraphY()),{index:i}=this;this.index=null,null==this.ghostPreview&&(this.state.view.invalidate(this.state.cell,!1,!1),this.state.view.validate()),this.graph.batchUpdate(()=>{if(i<=InternalEvent.CUSTOM_HANDLE){if(null!=this.customHandles){let e=this.state.view.graph.getCellStyle(this.state.cell);this.customHandles[InternalEvent.CUSTOM_HANDLE-i].active=!1,this.customHandles[InternalEvent.CUSTOM_HANDLE-i].execute(t),null!=this.customHandles&&null!=this.customHandles[InternalEvent.CUSTOM_HANDLE-i]&&(this.state.style=e,this.customHandles[InternalEvent.CUSTOM_HANDLE-i].positionChanged())}}else if(i===InternalEvent.ROTATION_HANDLE)if(null!=this.currentAlpha){let e=this.currentAlpha-(this.state.style.rotation??0);0!==e&&this.rotateCell(this.state.cell,e)}else this.rotateClick();else{let s=this.graph.isGridEnabledEvent(t.getEvent()),n=toRadians(this.state.style.rotation??0),a=Math.cos(-n),l=Math.sin(-n),r=e.x-this.startX,o=e.y-this.startY,h=a*r-l*o,c=l*r+a*o;r=h,o=c;let d=this.graph.view.scale,u=this.isRecursiveResize(this.state,t);this.resizeCell(this.state.cell,this.roundLength(r/d),this.roundLength(o/d),i,s,this.isConstrainedEvent(t),u)}}),t.consume(),this.reset(),this.redrawHandles()}}isRecursiveResize(e,t){return this.graph.isRecursiveResize(this.state)}rotateClick(){}rotateCell(e,t,i){if(0!==t){let s=this.graph.getDataModel();if(e.isVertex()||e.isEdge()){if(!e.isEdge()){let i=(this.graph.getCurrentCellStyle(e).rotation??0)+t;this.graph.setCellStyles("rotation",i,[e])}let n=e.getGeometry();if(n&&i){let a=i.getGeometry();if(null==a||i.isEdge()||((n=n.clone()).rotate(t,new Point(a.width/2,a.height/2)),s.setGeometry(e,n)),e.isVertex()&&!n.relative||e.isEdge()){let i=e.getChildCount();for(let s=0;s<i;s+=1)this.rotateCell(e.getChildAt(s),t,e)}}}}}reset(){if(null!==this.index&&"none"===this.sizers[this.index].node.style.display&&(this.sizers[this.index].node.style.display=""),this.index=null,this.currentAlpha=null,this.preview&&(this.preview.destroy(),this.preview=null),this.ghostPreview&&(this.ghostPreview.destroy(),this.ghostPreview=null),this.livePreviewActive){for(let e=0;e<this.sizers.length;e+=1)this.sizers[e].node.style.display="";this.state.control&&this.state.control.node&&(this.state.control.node.style.visibility="")}for(let e=0;e<this.customHandles.length;e+=1)this.customHandles[e].active?(this.customHandles[e].active=!1,this.customHandles[e].reset()):this.customHandles[e].setVisible(!0);this.selectionBorder.node.style.display="inline",this.selectionBounds=this.getSelectionBounds(this.state),this.bounds=new Rectangle(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height),this.drawPreview(),this.removeHint(),this.redrawHandles(),this.edgeHandlers=[],this.handlesVisible=!0,this.unscaledBounds=null}resizeCell(e,t,i,s,n,a,l){let r=e.getGeometry();if(r){if(s===InternalEvent.LABEL_HANDLE&&this.labelShape&&this.labelShape.bounds){let t=-toRadians(this.state.style.rotation??0),i=Math.cos(t),s=Math.sin(t),{scale:n}=this.graph.view,a=getRotatedPoint(new Point(Math.round((this.labelShape.bounds.getCenterX()-this.startX)/n),Math.round((this.labelShape.bounds.getCenterY()-this.startY)/n)),i,s);null==(r=r.clone()).offset?r.offset=a:(r.offset.x+=a.x,r.offset.y+=a.y),this.graph.model.setGeometry(e,r)}else if(this.unscaledBounds){let{scale:t}=this.graph.view;(0!==this.childOffsetX||0!==this.childOffsetY)&&this.moveChildren(e,Math.round(this.childOffsetX/t),Math.round(this.childOffsetY/t)),this.graph.resizeCell(e,this.unscaledBounds,l)}}}moveChildren(e,t,i){let s=this.graph.getDataModel(),n=e.getChildCount();for(let a=0;a<n;a+=1){let n=e.getChildAt(a),l=n.getGeometry();null!=l&&((l=l.clone()).translate(t,i),s.setGeometry(n,l))}}union(e,t,i,s,n,a,l,r,o){if(n=n&&this.graph.isGridEnabled(),this.singleSizer){let s=e.x+e.width+t,l=e.y+e.height+i;n&&(s=this.graph.snap(s/a)*a,l=this.graph.snap(l/a)*a);let r=new Rectangle(e.x,e.y,0,0);return r.add(new Rectangle(s,l,0,0)),r}let h=e.width,c=e.height,d=e.x-l.x*a,u=d+h,p=e.y-l.y*a,g=p+c,m=d+h/2,f=p+c/2;s>4?(g+=i,g=n?this.graph.snap(g/a)*a:Math.round(g/a)*a):s<3&&(p+=i,p=n?this.graph.snap(p/a)*a:Math.round(p/a)*a),0===s||3===s||5===s?(d+=t,d=n?this.graph.snap(d/a)*a:Math.round(d/a)*a):(2===s||4===s||7===s)&&(u+=t,u=n?this.graph.snap(u/a)*a:Math.round(u/a)*a);let x=u-d,v=g-p;if(r){let e=this.state.cell.getGeometry();if(null!=e){let t=e.width/e.height;1===s||2===s||7===s||6===s?x=v*t:v=x/t,0===s&&(d=u-x,p=g-v)}}if(o){x+=x-h,v+=v-c;let e=m-(d+x/2),t=f-(p+v/2);d+=e,p+=t,u+=e,g+=t}x<0&&(d+=x,x=Math.abs(x)),v<0&&(p+=v,v=Math.abs(v));let b=new Rectangle(d+l.x*a,p+l.y*a,x,v);return null!=this.minBounds&&(b.width=Math.max(b.width,this.minBounds.x*a+this.minBounds.width*a+Math.max(0,this.x0*a-b.x)),b.height=Math.max(b.height,this.minBounds.y*a+this.minBounds.height*a+Math.max(0,this.y0*a-b.y))),b}redraw(e){this.selectionBounds=this.getSelectionBounds(this.state),this.bounds=new Rectangle(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height),this.drawPreview(),e||this.redrawHandles()}getHandlePadding(){let e=new Point(0,0),t=this.tolerance;return this.sizers.length>0&&this.sizers[0].bounds&&(this.bounds.width<2*this.sizers[0].bounds.width+2*t||this.bounds.height<2*this.sizers[0].bounds.height+2*t)&&(t/=2,e.x=this.sizers[0].bounds.width+t,e.y=this.sizers[0].bounds.height+t),e}getSizerBounds(){return this.bounds}redrawHandles(){let e=this.getSizerBounds(),t=this.tolerance;this.horizontalOffset=0,this.verticalOffset=0;for(let e=0;e<this.customHandles.length;e+=1){let t=this.customHandles[e].shape;if(t){let i=t.node.style.display;this.customHandles[e].redraw(),t.node.style.display=i,t.node.style.visibility=this.handlesVisible&&this.isCustomHandleVisible(this.customHandles[e])?"":"hidden"}}if(this.sizers.length>0&&this.sizers[0]){if(null===this.index&&this.manageSizers&&this.sizers.length>=8){let i=this.getHandlePadding();this.horizontalOffset=i.x,this.verticalOffset=i.y,(0!==this.horizontalOffset||0!==this.verticalOffset)&&(e=new Rectangle(e.x,e.y,e.width,e.height),e.x-=this.horizontalOffset/2,e.width+=this.horizontalOffset,e.y-=this.verticalOffset/2,e.height+=this.verticalOffset),this.sizers.length>=8&&(this.sizers[0].bounds&&(e.width<2*this.sizers[0].bounds.width+2*t||e.height<2*this.sizers[0].bounds.height+2*t)?(this.sizers[0].node.style.display="none",this.sizers[2].node.style.display="none",this.sizers[5].node.style.display="none",this.sizers[7].node.style.display="none"):this.handlesVisible&&(this.sizers[0].node.style.display="",this.sizers[2].node.style.display="",this.sizers[5].node.style.display="",this.sizers[7].node.style.display=""))}let i=e.x+e.width,s=e.y+e.height;if(this.singleSizer)this.moveSizerTo(this.sizers[0],i,s);else{let t=e.x+e.width/2,n=e.y+e.height/2;if(this.sizers.length>=8){let a=["nw-resize","n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize"],l=toRadians(this.state.style.rotation??0),r=Math.cos(l),o=Math.sin(l),h=Math.round(4*l/Math.PI),c=new Point(e.getCenterX(),e.getCenterY()),d=getRotatedPoint(new Point(e.x,e.y),r,o,c);this.moveSizerTo(this.sizers[0],d.x,d.y),this.sizers[0].setCursor(a[mod(0+h,a.length)]),d.x=t,d.y=e.y,d=getRotatedPoint(d,r,o,c),this.moveSizerTo(this.sizers[1],d.x,d.y),this.sizers[1].setCursor(a[mod(1+h,a.length)]),d.x=i,d.y=e.y,d=getRotatedPoint(d,r,o,c),this.moveSizerTo(this.sizers[2],d.x,d.y),this.sizers[2].setCursor(a[mod(2+h,a.length)]),d.x=e.x,d.y=n,d=getRotatedPoint(d,r,o,c),this.moveSizerTo(this.sizers[3],d.x,d.y),this.sizers[3].setCursor(a[mod(7+h,a.length)]),d.x=i,d.y=n,d=getRotatedPoint(d,r,o,c),this.moveSizerTo(this.sizers[4],d.x,d.y),this.sizers[4].setCursor(a[mod(3+h,a.length)]),d.x=e.x,d.y=s,d=getRotatedPoint(d,r,o,c),this.moveSizerTo(this.sizers[5],d.x,d.y),this.sizers[5].setCursor(a[mod(6+h,a.length)]),d.x=t,d.y=s,d=getRotatedPoint(d,r,o,c),this.moveSizerTo(this.sizers[6],d.x,d.y),this.sizers[6].setCursor(a[mod(5+h,a.length)]),d.x=i,d.y=s,d=getRotatedPoint(d,r,o,c),this.moveSizerTo(this.sizers[7],d.x,d.y),this.sizers[7].setCursor(a[mod(4+h,a.length)]),d.x=t+this.state.absoluteOffset.x,d.y=n+this.state.absoluteOffset.y,d=getRotatedPoint(d,r,o,c),this.moveSizerTo(this.sizers[8],d.x,d.y)}else this.state.width>=2&&this.state.height>=2?this.moveSizerTo(this.sizers[0],t+this.state.absoluteOffset.x,n+this.state.absoluteOffset.y):this.moveSizerTo(this.sizers[0],this.state.x,this.state.y)}}if(this.rotationShape){let e=toRadians(this.currentAlpha??this.state.style.rotation??0),t=Math.cos(e),i=Math.sin(e),s=new Point(this.state.getCenterX(),this.state.getCenterY()),n=getRotatedPoint(this.getRotationHandlePosition(),t,i,s);null!=this.rotationShape.node&&(this.moveSizerTo(this.rotationShape,n.x,n.y),this.rotationShape.node.style.visibility=this.state.view.graph.isEditing()||!this.handlesVisible?"hidden":"")}if(null!=this.selectionBorder&&(this.selectionBorder.rotation=this.state.style.rotation??0),null!=this.edgeHandlers)for(let e=0;e<this.edgeHandlers.length;e+=1)this.edgeHandlers[e].redraw()}isCustomHandleVisible(e){return!this.graph.isEditing()&&1===this.state.view.graph.getSelectionCount()}getRotationHandlePosition(){return new Point(this.bounds.x+this.bounds.width/2,this.bounds.y+this.rotationHandleVSpacing)}isParentHighlightVisible(){let e=this.state.cell.getParent();return!!e&&!this.graph.isCellSelected(e)}updateParentHighlight(){if(!this.isDestroyed()){let e=this.isParentHighlightVisible(),t=this.state.cell.getParent(),i=t?this.graph.view.getState(t):null;if(this.parentHighlight)if(t&&t.isVertex()&&e){let e=this.parentHighlight.bounds;i&&e&&(e.x!==i.x||e.y!==i.y||e.width!==i.width||e.height!==i.height)&&(this.parentHighlight.bounds=Rectangle.fromRectangle(i),this.parentHighlight.redraw())}else null!=i&&i.parentHighlight===this.parentHighlight&&(i.parentHighlight=null),this.parentHighlight.destroy(),this.parentHighlight=null;else this.parentHighlightEnabled&&e&&t&&t.isVertex()&&null!=i&&null==i.parentHighlight&&(this.parentHighlight=this.createParentHighlightShape(i),this.parentHighlight.dialect=DIALECT.SVG,this.parentHighlight.pointerEvents=!1,this.parentHighlight.rotation=i.style.rotation??0,this.parentHighlight.init(this.graph.getView().getOverlayPane()),this.parentHighlight.redraw(),i.parentHighlight=this.parentHighlight)}}drawPreview(){null!=this.preview&&(this.preview.bounds=this.bounds,this.preview.node.parentNode===this.graph.container&&(this.preview.bounds.width=Math.max(0,this.preview.bounds.width-1),this.preview.bounds.height=Math.max(0,this.preview.bounds.height-1)),this.preview.rotation=this.state.style.rotation??0,this.preview.redraw()),this.selectionBorder.bounds=this.getSelectionBorderBounds(),this.selectionBorder.redraw(),this.updateParentHighlight()}getSelectionBorderBounds(){return this.bounds}isDestroyed(){return null==this.selectionBorder}onDestroy(){if(this.state.view.graph.removeListener(this.escapeHandler),this.escapeHandler=()=>{},this.preview&&(this.preview.destroy(),this.preview=null),this.parentHighlight){let e=this.state.cell.getParent(),t=e?this.graph.view.getState(e):null;t&&t.parentHighlight===this.parentHighlight&&(t.parentHighlight=null),this.parentHighlight.destroy(),this.parentHighlight=null}this.ghostPreview&&(this.ghostPreview.destroy(),this.ghostPreview=null),this.selectionBorder&&this.selectionBorder.destroy(),this.labelShape=null,this.removeHint();for(let e=0;e<this.sizers.length;e+=1)this.sizers[e].destroy();this.sizers=[];for(let e=0;e<this.customHandles.length;e+=1)this.customHandles[e].destroy();this.customHandles=[]}}class ElbowEdgeHandler extends EdgeHandler{constructor(e){super(e),this.flipEnabled=!0,this.doubleClickOrientationResource=isI18nEnabled()?"doubleClickOrientation":""}createBends(){let e=[],t=this.createHandleShape(0);return this.initBend(t),t.setCursor(CURSOR.TERMINAL_HANDLE),e.push(t),e.push(this.createVirtualBend(e=>{!isConsumed(e)&&this.flipEnabled&&(this.graph.flipEdge(this.state.cell),InternalEvent.consume(e))})),this.points.push(new Point(0,0)),t=this.createHandleShape(2),this.initBend(t),t.setCursor(CURSOR.TERMINAL_HANDLE),e.push(t),e}createVirtualBend(e){let t=this.createHandleShape();return this.initBend(t,e),t.setCursor(this.getCursorForBend()),this.graph.isCellBendable(this.state.cell)||(t.node.style.display="none"),t}getCursorForBend(){return this.state.style.edgeStyle===EDGESTYLE.TOPTOBOTTOM||this.state.style.edgeStyle===EDGESTYLE.ELBOW&&this.state.style.elbow===ELBOW.VERTICAL?"row-resize":"col-resize"}getTooltipForNode(e){let t=null;return null!=this.bends&&null!=this.bends[1]&&(e===this.bends[1].node||e.parentNode===this.bends[1].node)&&(t=translate(t=this.doubleClickOrientationResource)||t),t}convertPoint(e,t){let i=this.graph.getView().getScale(),s=this.graph.getView().getTranslate(),{origin:n}=this.state;return t&&(e.x=this.graph.snap(e.x),e.y=this.graph.snap(e.y)),e.x=Math.round(e.x/i-s.x-n.x),e.y=Math.round(e.y/i-s.y-n.y),e}redrawInnerBends(e,t){let i=this.state.cell.getGeometry(),s=this.state.absolutePoints,n=null;s.length>1?(e=s[1],t=s[s.length-2]):null!=i.points&&i.points.length>0&&(n=s[0]),n=null==n?new Point(e.x+(t.x-e.x)/2,e.y+(t.y-e.y)/2):new Point(this.graph.getView().scale*(n.x+this.graph.getView().translate.x+this.state.origin.x),this.graph.getView().scale*(n.y+this.graph.getView().translate.y+this.state.origin.y));let a=this.bends[1].bounds,l=a.width,r=a.height,o=new Rectangle(Math.round(n.x-l/2),Math.round(n.y-r/2),l,r);this.manageLabelHandle?this.checkLabelHandle(o):null==this.handleImage&&this.labelShape.visible&&this.labelShape.bounds&&intersects$1(o,this.labelShape.bounds)&&(r=l=HandleConfig.size+3,o=new Rectangle(Math.floor(n.x-l/2),Math.floor(n.y-r/2),l,r)),this.bends[1].bounds=o,this.bends[1].redraw(),this.manageLabelHandle&&this.checkLabelHandle(this.bends[1].bounds)}}class EdgeSegmentHandler extends ElbowEdgeHandler{constructor(e){super(e),this.points=[]}getCurrentPoints(){let e=this.state.absolutePoints,t=Math.max(1,this.graph.view.scale);if(2===e.length&&e[0]&&e[1]||3===e.length&&e[0]&&e[1]&&e[2]&&(Math.abs(e[0].x-e[1].x)<t&&Math.abs(e[1].x-e[2].x)<t||Math.abs(e[0].y-e[1].y)<t&&Math.abs(e[1].y-e[2].y)<t)){let t=e[0].x+(e[e.length-1].x-e[0].x)/2,i=e[0].y+(e[e.length-1].y-e[0].y)/2;e=[e[0],new Point(t,i),new Point(t,i),e[e.length-1]]}return e}getPreviewPoints(e){if(this.isSource||this.isTarget)return super.getPreviewPoints(e);let t=this.getCurrentPoints(),i=this.convertPoint(t[0].clone(),!1);e=this.convertPoint(e.clone(),!1);let s=[];for(let n=1;n<t.length;n+=1){let a=this.convertPoint(t[n].clone(),!1);n===this.index&&(0===Math.round(i.x-a.x)&&(i.x=e.x,a.x=e.x),0===Math.round(i.y-a.y)&&(i.y=e.y,a.y=e.y)),n<t.length-1&&s.push(a),i=a}if(1===s.length){let t=this.state.getVisibleTerminalState(!0),i=this.state.getVisibleTerminalState(!1),n=this.state.view.getScale(),a=this.state.view.getTranslate(),l=s[0].x*n+a.x,r=s[0].y*n+a.y;(null!=t&&contains(t,l,r)||null!=i&&contains(i,l,r))&&(s=[e,e])}return s}updatePreviewState(e,t,i,s){if(super.updatePreviewState(e,t,i,s),!this.isSource&&!this.isTarget){t=this.convertPoint(t.clone(),!1);let i=e.absolutePoints,s=i[0],n=i[1],a=[];for(let e=2;e<i.length;e+=1){let t=i[e];(0!==Math.round(s.x-n.x)||0!==Math.round(n.x-t.x))&&(0!==Math.round(s.y-n.y)||0!==Math.round(n.y-t.y))&&a.push(this.convertPoint(n.clone(),!1)),s=n,n=t}let l=this.state.getVisibleTerminalState(!0),r=this.state.getVisibleTerminalState(!1),o=this.state.absolutePoints,h=i[i.length-1];if(0===a.length&&i[0]&&h&&(0===Math.round(i[0].x-h.x)||0===Math.round(i[0].y-h.y)))a=[t,t];else if(5===i.length&&2===a.length&&null!=l&&null!=r&&null!=o&&0===Math.round(o[0].x-o[o.length-1].x)){let i=this.graph.getView(),s=i.getScale(),n=i.getTranslate(),o=i.getRoutingCenterY(l)/s-n.y,h=this.graph.getConnectionConstraint(e,l,!0);if(null!=h){let e=this.graph.getConnectionPoint(l,h);null!=e&&(this.convertPoint(e,!1),o=e.y)}let c=i.getRoutingCenterY(r)/s-n.y,d=this.graph.getConnectionConstraint(e,r,!1);if(d){let e=this.graph.getConnectionPoint(r,d);null!=e&&(this.convertPoint(e,!1),c=e.y)}a=[new Point(t.x,o),new Point(t.x,c)]}this.points=a,e.view.updateFixedTerminalPoints(e,l,r),e.view.updatePoints(e,this.points,l,r),e.view.updateFloatingTerminalPoints(e,l,r)}}connect(e,t,i,s,n){let a=this.graph.getDataModel(),l=e.getGeometry(),r=null;if(null!=l&&null!=l.points&&l.points.length>0){let e=this.abspoints,t=e[0],i=e[1];r=[];for(let s=2;s<e.length;s+=1){let n=e[s];t&&i&&n&&(0!==Math.round(t.x-i.x)||0!==Math.round(i.x-n.x))&&(0!==Math.round(t.y-i.y)||0!==Math.round(i.y-n.y))&&r.push(this.convertPoint(i.clone(),!1)),t=i,i=n}}return this.graph.batchUpdate(()=>{null!=r&&null!=(l=e.getGeometry())&&((l=l.clone()).points=r,a.setGeometry(e,l)),e=super.connect(e,t,i,s,n)}),e}getTooltipForNode(e){return null}start(e,t,i){super.start(e,t,i),null==this.bends||null==this.bends[i]||this.isSource||this.isTarget||setOpacity(this.bends[i].node,100)}createBends(){let e=[],t=this.createHandleShape(0);this.initBend(t),t.setCursor(CURSOR.TERMINAL_HANDLE),e.push(t);let i=this.getCurrentPoints();if(this.graph.isCellBendable(this.state.cell)){null==this.points&&(this.points=[]);for(let s=0;s<i.length-1;s+=1){t=this.createVirtualBend(),e.push(t);let n=0===Math.round(i[s].x-i[s+1].x);0===Math.round(i[s].y-i[s+1].y)&&s<i.length-2&&(n=0===Math.round(i[s].x-i[s+2].x)),t.setCursor(n?"col-resize":"row-resize"),this.points.push(new Point(0,0))}}return t=this.createHandleShape(i.length),this.initBend(t),t.setCursor(CURSOR.TERMINAL_HANDLE),e.push(t),e}redraw(){this.refresh(),super.redraw()}redrawInnerBends(e,t){if(this.graph.isCellBendable(this.state.cell)){let i=this.getCurrentPoints();if(null!=i&&i.length>1){let s=!1;if(4===i.length&&i[0]&&i[1]&&i[2]&&i[3]&&0===Math.round(i[1].x-i[2].x)&&0===Math.round(i[1].y-i[2].y))if(s=!0,0===Math.round(i[0].y-i[i.length-1].y)){let e=i[0].x+(i[i.length-1].x-i[0].x)/2;i[1]=new Point(e,i[1].y),i[2]=new Point(e,i[2].y)}else{let e=i[0].y+(i[i.length-1].y-i[0].y)/2;i[1]=new Point(i[1].x,e),i[2]=new Point(i[2].x,e)}for(let s=0;s<i.length-1;s+=1)if(null!=this.bends[s+1]){e=i[s],t=i[s+1];let n=new Point(e.x+(t.x-e.x)/2,e.y+(t.y-e.y)/2),a=this.bends[s+1].bounds;this.bends[s+1].bounds=new Rectangle(Math.floor(n.x-a.width/2),Math.floor(n.y-a.height/2),a.width,a.height),this.bends[s+1].redraw(),this.manageLabelHandle&&this.checkLabelHandle(this.bends[s+1].bounds)}s&&(setOpacity(this.bends[1].node,EdgeHandlerConfig.virtualBendOpacity),setOpacity(this.bends[3].node,EdgeHandlerConfig.virtualBendOpacity))}}}}class SelectionChange{constructor(e,t=[],i=[]){this.graph=e,this.added=t.slice(),this.removed=i.slice()}execute(){let e=this.graph.getSelectionModel();for(let t of this.removed)e.cellRemoved(t);for(let t of this.added)e.cellAdded(t);[this.added,this.removed]=[this.removed,this.added],e.fireEvent(new EventObject(InternalEvent.CHANGE,{added:this.added,removed:this.removed}))}}class GraphSelectionModel extends EventSource{constructor(e){super(),this.doneResource=isI18nEnabled()?"done":"",this.updatingSelectionResource=isI18nEnabled()?"updatingSelection":"",this.singleSelection=!1,this.graph=e,this.cells=[]}isSingleSelection(){return this.singleSelection}setSingleSelection(e){this.singleSelection=e}isSelected(e){return this.cells.indexOf(e)>=0}isEmpty(){return 0===this.cells.length}clear(){this.changeSelection(null,this.cells)}setCell(e){this.setCells(e?[e]:[])}setCells(e){this.singleSelection&&(e=[this.getFirstSelectableCell(e)]);let t=[];for(let i=0;i<e.length;i+=1)this.graph.isCellSelectable(e[i])&&t.push(e[i]);this.changeSelection(t,this.cells)}getFirstSelectableCell(e){for(let t=0;t<e.length;t+=1)if(this.graph.isCellSelectable(e[t]))return e[t];return null}addCell(e){this.addCells([e])}addCells(e){let t=null;if(this.singleSelection){t=this.cells;let i=this.getFirstSelectableCell(e);e=i?[i]:[]}let i=[];for(let t=0;t<e.length;t+=1)!this.isSelected(e[t])&&this.graph.isCellSelectable(e[t])&&i.push(e[t]);this.changeSelection(i,t)}removeCell(e){this.removeCells([e])}removeCells(e){let t=[];for(let i=0;i<e.length;i+=1)this.isSelected(e[i])&&t.push(e[i]);this.changeSelection(null,t)}changeSelection(e=null,t=null){if(e&&e.length>0&&e[0]||t&&t.length>0&&t[0]){let i=new SelectionChange(this.graph,e||[],t||[]);i.execute();let s=new UndoableEdit(this.graph,!1);s.add(i),this.fireEvent(new EventObject(InternalEvent.UNDO,{edit:s}))}}cellAdded(e){this.isSelected(e)||this.cells.push(e)}cellRemoved(e){let t=this.cells.indexOf(e);t>=0&&this.cells.splice(t,1)}}class RhombusShape extends Shape{constructor(e,t,i,s=1){super(),this.bounds=e,this.fill=t,this.stroke=i,this.strokeWidth=s}isRoundable(){return!0}paintVertexShape(e,t,i,s,n){var a;let l=s/2,r=n/2,o=((null==(a=this.style)?void 0:a.arcSize)??LINE_ARCSIZE)/2;e.begin(),this.addPoints(e,[new Point(t+l,i),new Point(t+s,i+r),new Point(t+l,i+n),new Point(t,i+r)],this.isRounded,o,!0),e.fillAndStroke()}}class CylinderShape extends Shape{constructor(e,t,i,s=1){super(),this.maxHeight=40,this.svgStrokeTolerance=0,this.bounds=e,this.fill=t,this.stroke=i,this.strokeWidth=s}paintVertexShape(e,t,i,s,n){e.translate(t,i),e.begin(),this.redrawPath(e,t,i,s,n,!1),e.fillAndStroke(),this.outline&&this.style&&this.style.backgroundOutline||(e.setShadow(!1),e.begin(),this.redrawPath(e,t,i,s,n,!0),e.stroke())}getCylinderSize(e,t,i,s){return Math.min(this.maxHeight,Math.round(s/5))}redrawPath(e,t,i,s,n,a=!1){let l=this.getCylinderSize(t,i,s,n);(a&&this.fill!==NONE||!a&&this.fill===NONE)&&(e.moveTo(0,l),e.curveTo(0,2*l,s,2*l,s,l),a||(e.stroke(),e.begin())),a||(e.moveTo(0,l),e.curveTo(0,-l/3,s,-l/3,s,l),e.lineTo(s,n-l),e.curveTo(s,n+l/3,0,n+l/3,0,n-l),e.close())}}class ActorShape extends Shape{constructor(e=null,t=NONE,i=NONE,s=1){super(),this.bounds=e,this.fill=t,this.stroke=i,this.strokeWidth=s}paintVertexShape(e,t,i,s,n){e.translate(t,i),e.begin(),this.redrawPath(e,t,i,s,n),e.fillAndStroke()}redrawPath(e,t,i,s,n){let a=s/3;e.moveTo(0,n),e.curveTo(0,3*n/5,0,2*n/5,s/2,2*n/5),e.curveTo(s/2-a,2*n/5,s/2-a,0,s/2,0),e.curveTo(s/2+a,0,s/2+a,2*n/5,s/2,2*n/5),e.curveTo(s,2*n/5,s,3*n/5,s,n),e.close()}}class TriangleShape extends ActorShape{constructor(){super()}isRoundable(){return!0}redrawPath(e,t,i,s,n){var a;let l=((null==(a=this.style)?void 0:a.arcSize)??LINE_ARCSIZE)/2;this.addPoints(e,[new Point(0,0),new Point(s,.5*n),new Point(0,n)],this.isRounded,l,!0)}}class HexagonShape extends ActorShape{constructor(){super()}redrawPath(e,t,i,s,n){var a;let l=((null==(a=this.style)?void 0:a.arcSize)??LINE_ARCSIZE)/2;this.addPoints(e,[new Point(.25*s,0),new Point(.75*s,0),new Point(s,.5*n),new Point(.75*s,n),new Point(.25*s,n),new Point(0,.5*n)],this.isRounded,l,!0)}}class CloudShape extends ActorShape{constructor(e,t,i,s=1){super(),this.bounds=e,this.fill=t,this.stroke=i,this.strokeWidth=s}redrawPath(e,t,i,s,n){e.moveTo(.25*s,.25*n),e.curveTo(.05*s,.25*n,0,.5*n,.16*s,.55*n),e.curveTo(0,.66*n,.18*s,.9*n,.31*s,.8*n),e.curveTo(.4*s,n,.7*s,n,.8*s,.8*n),e.curveTo(s,.8*n,s,.6*n,.875*s,.5*n),e.curveTo(s,.3*n,.8*s,.1*n,.625*s,.2*n),e.curveTo(.5*s,.05*n,.3*s,.05*n,.25*s,.25*n),e.close()}}class LineShape extends Shape{constructor(e,t,i=1,s=!1){super(),this.bounds=e,this.stroke=t,this.strokeWidth=i,this.vertical=s}paintVertexShape(e,t,i,s,n){if(e.begin(),this.vertical){let a=t+s/2;e.moveTo(a,i),e.lineTo(a,i+n)}else{let a=i+n/2;e.moveTo(t,a),e.lineTo(t+s,a)}e.stroke()}}class ArrowShape extends Shape{constructor(e,t,i,s=1,n=ARROW_WIDTH,a=ARROW_SPACING,l=ARROW_SIZE){super(),this.points=e,this.fill=t,this.stroke=i,this.strokeWidth=s,this.arrowWidth=n,this.spacing=a,this.endSize=l}augmentBoundingBox(e){super.augmentBoundingBox(e);let t=Math.max(this.arrowWidth,this.endSize);e.grow((t/2+this.strokeWidth)*this.scale)}paintEdgeShape(e,t){let i=ARROW_SPACING,s=ARROW_WIDTH,n=ARROW_SIZE,a=t[0],l=t[t.length-1],r=l.x-a.x,o=l.y-a.y,h=Math.sqrt(r*r+o*o),c=h-2*i-n,d=r/h,u=o/h,p=c*d,g=c*u,m=s*u/3,f=-30*d/3,x=a.x-m/2+i*d,v=a.y-f/2+i*u,b=x+m,y=v+f,w=b+p,C=y+g,E=w+m,S=C+f,T=E-3*m,M=S-3*f;e.begin(),e.moveTo(x,v),e.lineTo(b,y),e.lineTo(w,C),e.lineTo(E,S),e.lineTo(l.x-i*d,l.y-i*u),e.lineTo(T,M),e.lineTo(T+m,M+f),e.close(),e.fillAndStroke()}}class ArrowConnectorShape extends Shape{constructor(e,t,i,s=1,n=ARROW_WIDTH,a=ARROW_SPACING,l=ARROW_SIZE/5){super(),this.useSvgBoundingBox=!0,this.points=e,this.fill=t,this.stroke=i,this.strokeWidth=s,this.arrowWidth=n,this.arrowSpacing=a,this.startSize=ARROW_SIZE/5,this.endSize=l}isRoundable(){return!0}resetStyles(){super.resetStyles(),this.arrowSpacing=ARROW_SPACING}apply(e){super.apply(e),this.style&&null!=this.style.startSize&&null!=this.style.endSize&&(this.startSize=3*this.style.startSize,this.endSize=3*this.style.endSize)}augmentBoundingBox(e){super.augmentBoundingBox(e);let t=this.getEdgeWidth();this.isMarkerStart()&&(t=Math.max(t,this.getStartArrowWidth())),this.isMarkerEnd()&&(t=Math.max(t,this.getEndArrowWidth())),e.grow((t/2+this.strokeWidth)*this.scale)}paintEdgeShape(e,t){var i;let s,n,a=this.strokeWidth;this.outline&&(a=Math.max(1,(null==(i=this.style)?void 0:i.strokeWidth)??0));let l=this.getStartArrowWidth()+a,r=this.getEndArrowWidth()+a,o=this.outline?this.getEdgeWidth()+a:this.getEdgeWidth(),h=this.isOpenEnded(),c=this.isMarkerStart(),d=this.isMarkerEnd(),u=h?0:this.arrowSpacing+a/2,p=this.startSize+a,g=this.endSize+a,m=this.isArrowRounded(),f=t[t.length-1],x=1;for(;x<t.length-1&&t[x].x===t[0].x&&t[x].y===t[0].y;)x++;let v=t[x].x-t[0].x,b=t[x].y-t[0].y,y=Math.sqrt(v*v+b*b);if(0===y)return;let w=v/y,C=w,E=b/y,S=E,T=o*E,M=-o*w,A=[];m?e.setLineJoin("round"):t.length>2&&e.setMiterLimit(1.42),e.begin();let P=w,L=E;if(c&&!h)this.paintMarker(e,t[0].x,t[0].y,w,E,p,l,o,u,!0);else{let i=t[0].x+T/2+u*w,s=t[0].y+M/2+u*E,n=t[0].x-T/2+u*w,a=t[0].y-M/2+u*E;h?(e.moveTo(i,s),A.push(()=>{e.lineTo(n,a)})):(e.moveTo(n,a),e.lineTo(i,s))}let k=0,H=0,O=0;for(let i=0;i<t.length-2;i+=1){let a=relativeCcw(t[i].x,t[i].y,t[i+1].x,t[i+1].y,t[i+2].x,t[i+2].y);if(0!==(O=Math.sqrt((k=t[i+2].x-t[i+1].x)*k+(H=t[i+2].y-t[i+1].y)*H))){let l=Math.max(Math.sqrt((w*(C=k/O)+E*(S=H/O)+1)/2),.04),r=Math.sqrt((s=w+C)*s+(n=E+S)*n);if(0!==r){s/=r,n/=r;let h=Math.max(l,Math.min(this.strokeWidth/200+.04,.35)),c=0!==a&&m?Math.max(.1,h):Math.max(l,.06),d=t[i+1].x+n*o/2/c,u=t[i+1].y-s*o/2/c,p=t[i+1].x-n*o/2/c,g=t[i+1].y+s*o/2/c;if(0!==a&&m)if(-1===a){let t=p+E*o,i=g-w*o,s=p+S*o,n=g-C*o;e.lineTo(t,i),e.quadTo(d,u,s,n),((t,i)=>{A.push(()=>{e.lineTo(t,i)})})(p,g)}else e.lineTo(d,u),((t,i)=>{let s=d-E*o,n=u+w*o,a=d-S*o,l=u+C*o;A.push(()=>{e.quadTo(t,i,s,n)}),A.push(()=>{e.lineTo(a,l)})})(p,g);else e.lineTo(d,u),((t,i)=>{A.push(()=>{e.lineTo(t,i)})})(p,g);w=C,E=S}}}if(T=o*S,M=-o*C,d&&!h)this.paintMarker(e,f.x,f.y,-w,-E,g,r,o,u,!1);else{e.lineTo(f.x-u*C+T/2,f.y-u*S+M/2);let t=f.x-u*C-T/2,i=f.y-u*S-M/2;h?(e.moveTo(t,i),A.splice(0,0,()=>{e.moveTo(t,i)})):e.lineTo(t,i)}for(let e=A.length-1;e>=0;e--)A[e]();h?(e.end(),e.stroke()):(e.close(),e.fillAndStroke()),e.setShadow(!1),e.setMiterLimit(4),m&&e.setLineJoin("flat"),t.length>2&&(e.setMiterLimit(4),c&&!h&&(e.begin(),this.paintMarker(e,t[0].x,t[0].y,P,L,p,l,o,u,!0),e.stroke(),e.end()),d&&!h&&(e.begin(),this.paintMarker(e,f.x,f.y,-w,-E,g,r,o,u,!0),e.stroke(),e.end()))}paintMarker(e,t,i,s,n,a,l,r,o,h){let c=r/l,d=r*n/2,u=-r*s/2,p=(o+a)*s,g=(o+a)*n;h?e.moveTo(t-d+p,i-u+g):e.lineTo(t-d+p,i-u+g),e.lineTo(t-d/c+p,i-u/c+g),e.lineTo(t+o*s,i+o*n),e.lineTo(t+d/c+p,i+u/c+g),e.lineTo(t+d+p,i+u+g)}isArrowRounded(){return this.isRounded}getStartArrowWidth(){return ARROW_WIDTH}getEndArrowWidth(){return ARROW_WIDTH}getEdgeWidth(){return ARROW_WIDTH/3}isOpenEnded(){return!1}isMarkerStart(){var e;return((null==(e=this.style)?void 0:e.startArrow)??NONE)!==NONE}isMarkerEnd(){var e;return((null==(e=this.style)?void 0:e.endArrow)??NONE)!==NONE}}class DoubleEllipseShape extends Shape{constructor(e,t,i,s=1){super(),this.bounds=e,this.fill=t,this.stroke=i,this.strokeWidth=s}paintBackground(e,t,i,s,n){e.ellipse(t,i,s,n),e.fillAndStroke()}paintForeground(e,t,i,s,n){var a;if(!this.outline){let l=(null==(a=this.style)?void 0:a.margin)??Math.min(3+this.strokeWidth,Math.min(s/5,n/5));t+=l,i+=l,s-=2*l,n-=2*l,s>0&&n>0&&e.ellipse(t,i,s,n),e.stroke()}}getLabelBounds(e){var t;let i=(null==(t=this.style)?void 0:t.margin)??Math.min(3+this.strokeWidth,Math.min(e.width/5/this.scale,e.height/5/this.scale))*this.scale;return new Rectangle(e.x+i,e.y+i,e.width-2*i,e.height-2*i)}}class SwimlaneShape extends Shape{constructor(e,t,i,s=1){super(),this.imageSize=16,this.imageSrc=null,this.bounds=e,this.fill=t,this.stroke=i,this.strokeWidth=s}isRoundable(e,t,i,s,n){return!0}getTitleSize(){var e;return Math.max(0,(null==(e=this.style)?void 0:e.startSize)??DEFAULT_STARTSIZE)}getLabelBounds(e){var t,i;let s=this.getTitleSize(),n=new Rectangle(e.x,e.y,e.width,e.height),a=this.isHorizontal(),l=(null==(t=this.style)?void 0:t.flipH)??!1,r=(null==(i=this.style)?void 0:i.flipV)??!1,o=this.direction===DIRECTION.NORTH||this.direction===DIRECTION.SOUTH,h=!o==a,c=!h&&l!==(this.direction===DIRECTION.SOUTH||this.direction===DIRECTION.WEST),d=h&&r!==(this.direction===DIRECTION.SOUTH||this.direction===DIRECTION.WEST);if(o){let e=Math.min(n.width,s*this.scale);(c||d)&&(n.x+=n.width-e),n.width=e}else{let e=Math.min(n.height,s*this.scale);(c||d)&&(n.y+=n.height-e),n.height=e}return n}getGradientBounds(e,t,i,s,n){let a=this.getTitleSize();return this.isHorizontal()?new Rectangle(t,i,s,a=Math.min(a,n)):new Rectangle(t,i,a=Math.min(a,s),n)}getSwimlaneArcSize(e,t,i){var s,n,a;return(null==(s=this.style)?void 0:s.absoluteArcSize)?Math.min(e/2,Math.min(t/2,(null==(n=this.style)?void 0:n.arcSize)??LINE_ARCSIZE/2)):i*(((null==(a=this.style)?void 0:a.arcSize)??100*RECTANGLE_ROUNDING_FACTOR)/100)*3}isHorizontal(){var e;return(null==(e=this.style)?void 0:e.horizontal)??!0}paintVertexShape(e,t,i,s,n){var a,l,r;let o=this.getTitleSize(),h=(null==(a=this.style)?void 0:a.swimlaneFillColor)??NONE,c=(null==(l=this.style)?void 0:l.swimlaneLine)??!0,d=0;o=this.isHorizontal()?Math.min(o,n):Math.min(o,s),e.translate(t,i),this.isRounded?(d=this.getSwimlaneArcSize(s,n,o),d=Math.min((this.isHorizontal()?n:s)-o,Math.min(o,d)),this.paintRoundedSwimlane(e,t,i,s,n,o,d,h,c)):this.paintSwimlane(e,t,i,s,n,o,h,c);let u=(null==(r=this.style)?void 0:r.separatorColor)??NONE;if(this.paintSeparator(e,t,i,s,n,o,u),this.imageSrc){let a=this.getImageBounds(t,i,s,n);e.image(a.x-t,a.y-i,a.width,a.height,this.imageSrc,!1,!1,!1)}this.glass&&(e.setShadow(!1),this.paintGlassEffect(e,0,0,s,o,d))}paintSwimlane(e,t,i,s,n,a,l,r){e.begin();let o=!0;this.style&&null!=this.style.pointerEvents&&(o=this.style.pointerEvents),o||this.fill!==NONE||(e.pointerEvents=!1),this.isHorizontal()?(e.moveTo(0,a),e.lineTo(0,0),e.lineTo(s,0),e.lineTo(s,a),e.fillAndStroke(),a<n&&(l!==NONE&&o||(e.pointerEvents=!1),l!==NONE&&e.setFillColor(l),e.begin(),e.moveTo(0,a),e.lineTo(0,n),e.lineTo(s,n),e.lineTo(s,a),l===NONE?e.stroke():e.fillAndStroke())):(e.moveTo(a,0),e.lineTo(0,0),e.lineTo(0,n),e.lineTo(a,n),e.fillAndStroke(),a<s&&(l!==NONE&&o||(e.pointerEvents=!1),l!==NONE&&e.setFillColor(l),e.begin(),e.moveTo(a,0),e.lineTo(s,0),e.lineTo(s,n),e.lineTo(a,n),l===NONE?e.stroke():e.fillAndStroke())),r&&this.paintDivider(e,t,i,s,n,a,l===NONE)}paintRoundedSwimlane(e,t,i,s,n,a,l,r,o){e.begin();let h=!0;this.style&&null!=this.style.pointerEvents&&(h=this.style.pointerEvents),h||this.fill!==NONE||(e.pointerEvents=!1),this.isHorizontal()?(e.moveTo(s,a),e.lineTo(s,l),e.quadTo(s,0,s-Math.min(s/2,l),0),e.lineTo(Math.min(s/2,l),0),e.quadTo(0,0,0,l),e.lineTo(0,a),e.fillAndStroke(),a<n&&(r!==NONE&&h||(e.pointerEvents=!1),r!==NONE&&e.setFillColor(r),e.begin(),e.moveTo(0,a),e.lineTo(0,n-l),e.quadTo(0,n,Math.min(s/2,l),n),e.lineTo(s-Math.min(s/2,l),n),e.quadTo(s,n,s,n-l),e.lineTo(s,a),r===NONE?e.stroke():e.fillAndStroke())):(e.moveTo(a,0),e.lineTo(l,0),e.quadTo(0,0,0,Math.min(n/2,l)),e.lineTo(0,n-Math.min(n/2,l)),e.quadTo(0,n,l,n),e.lineTo(a,n),e.fillAndStroke(),a<s&&(r!==NONE&&h||(e.pointerEvents=!1),r!==NONE&&e.setFillColor(r),e.begin(),e.moveTo(a,n),e.lineTo(s-l,n),e.quadTo(s,n,s,n-Math.min(n/2,l)),e.lineTo(s,Math.min(n/2,l)),e.quadTo(s,0,s-l,0),e.lineTo(a,0),r===NONE?e.stroke():e.fillAndStroke())),o&&this.paintDivider(e,t,i,s,n,a,r===NONE)}paintDivider(e,t,i,s,n,a,l){l||e.setShadow(!1),e.begin(),this.isHorizontal()?(e.moveTo(0,a),e.lineTo(s,a)):(e.moveTo(a,0),e.lineTo(a,n)),e.stroke()}paintSeparator(e,t,i,s,n,a,l){l!==NONE&&(e.setStrokeColor(l),e.setDashed(!0),e.begin(),this.isHorizontal()?(e.moveTo(s,a),e.lineTo(s,n)):(e.moveTo(a,0),e.lineTo(s,0)),e.stroke(),e.setDashed(!1))}getImageBounds(e,t,i,s){return this.isHorizontal()?new Rectangle(e+i-this.imageSize,t,this.imageSize,this.imageSize):new Rectangle(e,t,this.imageSize,this.imageSize)}}class LabelShape extends RectangleShape{constructor(e,t,i,s){super(e,t,i,s),this.imageSize=DEFAULT_IMAGESIZE,this.imageSrc=null,this.spacing=2,this.indicatorSize=10,this.indicatorSpacing=2,this.indicatorImageSrc=null}init(e){super.init(e),this.indicatorShape&&(this.indicator=new this.indicatorShape,this.indicator.dialect=this.dialect,this.indicator.init(this.node))}redraw(){this.indicator&&(this.indicator.fill=this.indicatorColor,this.indicator.stroke=this.indicatorStrokeColor,this.indicator.gradient=this.indicatorGradientColor,this.indicator.direction=this.indicatorDirection,this.indicator.redraw()),super.redraw()}isHtmlAllowed(){return super.isHtmlAllowed()&&this.indicatorColor===NONE&&!!this.indicatorShape}paintForeground(e,t,i,s,n){this.paintImage(e,t,i,s,n),this.paintIndicator(e,t,i,s,n),super.paintForeground(e,t,i,s,n)}paintImage(e,t,i,s,n){if(this.imageSrc){let a=this.getImageBounds(t,i,s,n);e.image(a.x,a.y,a.width,a.height,this.imageSrc,!1,!1,!1)}}getImageBounds(e,t,i,s){var n,a,l,r,o;let h=(null==(n=this.style)?void 0:n.imageAlign)??ALIGN.LEFT,c=(null==(a=this.style)?void 0:a.verticalAlign)??ALIGN.MIDDLE,d=(null==(l=this.style)?void 0:l.imageWidth)??DEFAULT_IMAGESIZE,u=(null==(r=this.style)?void 0:r.imageHeight)??DEFAULT_IMAGESIZE,p=(null==(o=this.style)?void 0:o.spacing)??this.spacing+5;return h===ALIGN.CENTER?e+=(i-d)/2:h===ALIGN.RIGHT?e+=i-d-p:e+=p,c===ALIGN.TOP?t+=p:c===ALIGN.BOTTOM?t+=s-u-p:t+=(s-u)/2,new Rectangle(e,t,d,u)}paintIndicator(e,t,i,s,n){if(this.indicator)this.indicator.bounds=this.getIndicatorBounds(t,i,s,n),this.indicator.paint(e);else if(this.indicatorImageSrc){let a=this.getIndicatorBounds(t,i,s,n);e.image(a.x,a.y,a.width,a.height,this.indicatorImageSrc,!1,!1,!1)}}getIndicatorBounds(e,t,i,s){var n,a,l,r;let o=(null==(n=this.style)?void 0:n.imageAlign)??ALIGN.LEFT,h=(null==(a=this.style)?void 0:a.verticalAlign)??ALIGN.MIDDLE,c=(null==(l=this.style)?void 0:l.indicatorWidth)??this.indicatorSize,d=(null==(r=this.style)?void 0:r.indicatorHeight)??this.indicatorSize,u=this.spacing+5;return o===ALIGN.RIGHT?e+=i-c-u:o===ALIGN.CENTER?e+=(i-c)/2:e+=u,h===ALIGN.BOTTOM?t+=s-d-u:h===ALIGN.TOP?t+=u:t+=(s-d)/2,new Rectangle(e,t,c,d)}redrawHtmlShape(){for(super.redrawHtmlShape();this.node.hasChildNodes();)this.node.removeChild(this.node.lastChild);if(this.imageSrc&&this.bounds){let e=document.createElement("img");e.style.position="relative",e.setAttribute("border","0");let t=this.getImageBounds(this.bounds.x,this.bounds.y,this.bounds.width,this.bounds.height);t.x-=this.bounds.x,t.y-=this.bounds.y,e.style.left=`${Math.round(t.x)}px`,e.style.top=`${Math.round(t.y)}px`,e.style.width=`${Math.round(t.width)}px`,e.style.height=`${Math.round(t.height)}px`,e.src=this.imageSrc,this.node.appendChild(e)}}}let isDefaultElementsRegistered=!1;function registerDefaultShapes(){if(!isDefaultElementsRegistered){for(let[e,t]of[[SHAPE.ACTOR,ActorShape],[SHAPE.ARROW,ArrowShape],[SHAPE.ARROW_CONNECTOR,ArrowConnectorShape],[SHAPE.CONNECTOR,ConnectorShape],[SHAPE.CLOUD,CloudShape],[SHAPE.CYLINDER,CylinderShape],[SHAPE.DOUBLE_ELLIPSE,DoubleEllipseShape],[SHAPE.ELLIPSE,EllipseShape],[SHAPE.HEXAGON,HexagonShape],[SHAPE.IMAGE,ImageShape],[SHAPE.LABEL,LabelShape],[SHAPE.LINE,LineShape],[SHAPE.RECTANGLE,RectangleShape],[SHAPE.RHOMBUS,RhombusShape],[SHAPE.SWIMLANE,SwimlaneShape],[SHAPE.TRIANGLE,TriangleShape]])CellRenderer.registerShape(e,t);isDefaultElementsRegistered=!0}}let EllipsePerimeter=(e,t,i,s=!1)=>{let{x:n}=e,{y:a}=e,l=e.width/2,r=e.height/2,o=n+l,h=a+r,c=i.x,d=i.y,u=parseInt(String(c-o)),p=parseInt(String(d-h));if(0===u&&0!==p)return new Point(o,h+r*p/Math.abs(p));if(0===u&&0===p)return new Point(c,d);if(s){if(d>=a&&d<=a+e.height){let e=d-h,t=Math.sqrt(l*l*(1-e*e/(r*r)))||0;return c<=n&&(t=-t),new Point(o+t,d)}if(c>=n&&c<=n+e.width){let e=c-o,t=Math.sqrt(r*r*(1-e*e/(l*l)))||0;return d<=a&&(t=-t),new Point(c,h+t)}}let g=p/u,m=h-g*o,f=l*l*g*g+r*r,x=-2*o*f,v=Math.sqrt(x*x-4*f*(l*l*g*g*o*o+r*r*o*o-l*l*r*r)),b=(-x+v)/(2*f),y=(-x-v)/(2*f),w=g*b+m,C=g*y+m,E=0,S=0;return Math.sqrt(Math.pow(b-c,2)+Math.pow(w-d,2))<Math.sqrt(Math.pow(y-c,2)+Math.pow(C-d,2))?(E=b,S=w):(E=y,S=C),new Point(E,S)},HexagonPerimeter=(e,t,i,s=!1)=>{var n;let{x:a}=e,{y:l}=e,r=e.width,o=e.height,h=e.getCenterX(),c=e.getCenterY(),d=i.x,u=i.y,p=-Math.atan2(u-c,d-h),g=Math.PI,m=Math.PI/2,f=new Point(h,c),x=(null==(n=null==t?void 0:t.style)?void 0:n.direction)??DIRECTION.EAST,v=x===DIRECTION.NORTH||x===DIRECTION.SOUTH,b=new Point,y=new Point;if((d<a&&u<l||d<a&&u>l+o||d>a+r&&u<l||d>a+r&&u>l+o)&&(s=!1),s){if(v){if(d===h){if(u<=l)return new Point(h,l);if(u>=l+o)return new Point(h,l+o)}else if(d<a){if(u===l+o/4)return new Point(a,l+o/4);if(u===l+3*o/4)return new Point(a,l+3*o/4)}else if(d>a+r){if(u===l+o/4)return new Point(a+r,l+o/4);if(u===l+3*o/4)return new Point(a+r,l+3*o/4)}else if(d===a){if(u<c)return new Point(a,l+o/4);if(u>c)return new Point(a,l+3*o/4)}else if(d===a+r){if(u<c)return new Point(a+r,l+o/4);if(u>c)return new Point(a+r,l+3*o/4)}if(u===l)return new Point(h,l);if(u===l+o)return new Point(h,l+o);d<h?u>l+o/4&&u<l+3*o/4?(b=new Point(a,l),y=new Point(a,l+o)):u<l+o/4?(b=new Point(a-Math.floor(.5*r),l+Math.floor(.5*o)),y=new Point(a+r,l-Math.floor(.25*o))):u>l+3*o/4&&(b=new Point(a-Math.floor(.5*r),l+Math.floor(.5*o)),y=new Point(a+r,l+Math.floor(1.25*o))):d>h&&(u>l+o/4&&u<l+3*o/4?(b=new Point(a+r,l),y=new Point(a+r,l+o)):u<l+o/4?(b=new Point(a,l-Math.floor(.25*o)),y=new Point(a+Math.floor(1.5*r),l+Math.floor(.5*o))):u>l+3*o/4&&(b=new Point(a+Math.floor(1.5*r),l+Math.floor(.5*o)),y=new Point(a,l+Math.floor(1.25*o))))}else{if(u===c){if(d<=a)return new Point(a,l+o/2);if(d>=a+r)return new Point(a+r,l+o/2)}else if(u<l){if(d===a+r/4)return new Point(a+r/4,l);if(d===a+3*r/4)return new Point(a+3*r/4,l)}else if(u>l+o){if(d===a+r/4)return new Point(a+r/4,l+o);if(d===a+3*r/4)return new Point(a+3*r/4,l+o)}else if(u===l){if(d<h)return new Point(a+r/4,l);if(d>h)return new Point(a+3*r/4,l)}else if(u===l+o){if(d<h)return new Point(a+r/4,l+o);if(u>c)return new Point(a+3*r/4,l+o)}if(d===a)return new Point(a,c);if(d===a+r)return new Point(a+r,c);u<c?d>a+r/4&&d<a+3*r/4?(b=new Point(a,l),y=new Point(a+r,l)):d<a+r/4?(b=new Point(a-Math.floor(.25*r),l+o),y=new Point(a+Math.floor(.5*r),l-Math.floor(.5*o))):d>a+3*r/4&&(b=new Point(a+Math.floor(.5*r),l-Math.floor(.5*o)),y=new Point(a+Math.floor(1.25*r),l+o)):u>c&&(d>a+r/4&&d<a+3*r/4?(b=new Point(a,l+o),y=new Point(a+r,l+o)):d<a+r/4?(b=new Point(a-Math.floor(.25*r),l),y=new Point(a+Math.floor(.5*r),l+Math.floor(1.5*o))):d>a+3*r/4&&(b=new Point(a+Math.floor(.5*r),l+Math.floor(1.5*o)),y=new Point(a+Math.floor(1.25*r),l)))}let e=h,t=c;d>=a&&d<=a+r?(e=d,t=u<c?l+o:l):u>=l&&u<=l+o&&(t=u,e=d<h?a+r:a),f=intersection(e,t,i.x,i.y,b.x,b.y,y.x,y.y)}else{if(v){let e=Math.atan2(o/4,r/2);if(p===e)return new Point(a+r,l+Math.floor(.25*o));if(p===m)return new Point(a+Math.floor(.5*r),l);if(p===g-e)return new Point(a,l+Math.floor(.25*o));if(p===-e)return new Point(a+r,l+Math.floor(.75*o));if(p===-m)return new Point(a+Math.floor(.5*r),l+o);if(p===-g+e)return new Point(a,l+Math.floor(.75*o));p<e&&p>-e?(b=new Point(a+r,l),y=new Point(a+r,l+o)):p>e&&p<m?(b=new Point(a,l-Math.floor(.25*o)),y=new Point(a+Math.floor(1.5*r),l+Math.floor(.5*o))):p>m&&p<g-e?(b=new Point(a-Math.floor(.5*r),l+Math.floor(.5*o)),y=new Point(a+r,l-Math.floor(.25*o))):p>g-e&&p<=g||p<-g+e&&p>=-g?(b=new Point(a,l),y=new Point(a,l+o)):p<-e&&p>-m?(b=new Point(a+Math.floor(1.5*r),l+Math.floor(.5*o)),y=new Point(a,l+Math.floor(1.25*o))):p<-m&&p>-g+e&&(b=new Point(a-Math.floor(.5*r),l+Math.floor(.5*o)),y=new Point(a+r,l+Math.floor(1.25*o)))}else{let e=Math.atan2(o/2,r/4);if(p===e)return new Point(a+Math.floor(.75*r),l);if(p===g-e)return new Point(a+Math.floor(.25*r),l);if(p===g||p===-g)return new Point(a,l+Math.floor(.5*o));if(0===p)return new Point(a+r,l+Math.floor(.5*o));if(p===-e)return new Point(a+Math.floor(.75*r),l+o);if(p===-g+e)return new Point(a+Math.floor(.25*r),l+o);p>0&&p<e?(b=new Point(a+Math.floor(.5*r),l-Math.floor(.5*o)),y=new Point(a+Math.floor(1.25*r),l+o)):p>e&&p<g-e?(b=new Point(a,l),y=new Point(a+r,l)):p>g-e&&p<g?(b=new Point(a-Math.floor(.25*r),l+o),y=new Point(a+Math.floor(.5*r),l-Math.floor(.5*o))):p<0&&p>-e?(b=new Point(a+Math.floor(.5*r),l+Math.floor(1.5*o)),y=new Point(a+Math.floor(1.25*r),l)):p<-e&&p>-g+e?(b=new Point(a,l+o),y=new Point(a+r,l+o)):p<-g+e&&p>-g&&(b=new Point(a-Math.floor(.25*r),l),y=new Point(a+Math.floor(.5*r),l+Math.floor(1.5*o)))}f=intersection(h,c,i.x,i.y,b.x,b.y,y.x,y.y)}return null==f?new Point(h,c):f},RectanglePerimeter=(e,t,i,s=!1)=>{let n=e.getCenterX(),a=e.getCenterY(),l=i.x-n,r=Math.atan2(i.y-a,l),o=new Point(0,0),h=Math.PI,c=Math.PI/2-r,d=Math.atan2(e.height,e.width);return r<-h+d||r>h-d?(o.x=e.x,o.y=a-e.width*Math.tan(r)/2):r<-d?(o.y=e.y,o.x=n-e.height*Math.tan(c)/2):r<d?(o.x=e.x+e.width,o.y=a+e.width*Math.tan(r)/2):(o.y=e.y+e.height,o.x=n+e.height*Math.tan(c)/2),s&&(i.x>=e.x&&i.x<=e.x+e.width?o.x=i.x:i.y>=e.y&&i.y<=e.y+e.height&&(o.y=i.y),i.x<e.x?o.x=e.x:i.x>e.x+e.width&&(o.x=e.x+e.width),i.y<e.y?o.y=e.y:i.y>e.y+e.height&&(o.y=e.y+e.height)),o},RhombusPerimeter=(e,t,i,s=!1)=>{let{x:n}=e,{y:a}=e,l=e.width,r=e.height,o=n+l/2,h=a+r/2,c=i.x,d=i.y;if(o===c)return h>d?new Point(o,a):new Point(o,a+r);if(h===d)return o>c?new Point(n,h):new Point(n+l,h);let u=o,p=h;return(s&&(c>=n&&c<=n+l?u=c:d>=a&&d<=a+r&&(p=d)),c<o)?d<h?intersection(c,d,u,p,o,a,n,h):intersection(c,d,u,p,o,a+r,n,h):d<h?intersection(c,d,u,p,o,a,n+l,h):intersection(c,d,u,p,o,a+r,n+l,h)},TrianglePerimeter=(e,t,i,s=!1)=>{let n=null!=t?t.style.direction:null,a=n===DIRECTION.NORTH||n===DIRECTION.SOUTH,{x:l}=e,{y:r}=e,o=e.width,h=e.height,c=l+o/2,d=r+h/2,u=new Point(l,r),p=new Point(l+o,d),g=new Point(l,r+h);n===DIRECTION.NORTH?(u=g,p=new Point(c,r),g=new Point(l+o,r+h)):n===DIRECTION.SOUTH?(p=new Point(c,r+h),g=new Point(l+o,r)):n===DIRECTION.WEST&&(u=new Point(l+o,r),p=new Point(l,d),g=new Point(l+o,r+h));let m=i.x-c,f=i.y-d,x=a?Math.atan2(m,f):Math.atan2(f,m),v=a?Math.atan2(o,h):Math.atan2(h,o),b=!1;b=n===DIRECTION.NORTH||n===DIRECTION.WEST?x>-v&&x<v:x<-Math.PI+v||x>Math.PI-v;let y=null;if(b)y=s&&(a&&i.x>=u.x&&i.x<=g.x||!a&&i.y>=u.y&&i.y<=g.y)?a?new Point(i.x,u.y):new Point(u.x,i.y):n===DIRECTION.NORTH?new Point(l+o/2+h*Math.tan(x)/2,r+h):n===DIRECTION.SOUTH?new Point(l+o/2-h*Math.tan(x)/2,r):n===DIRECTION.WEST?new Point(l+o,r+h/2+o*Math.tan(x)/2):new Point(l,r+h/2-o*Math.tan(x)/2);else{if(s){let e=new Point(c,d);i.y>=r&&i.y<=r+h?(e.x=a?c:n===DIRECTION.WEST?l+o:l,e.y=i.y):i.x>=l&&i.x<=l+o&&(e.x=i.x,e.y=a?n===DIRECTION.NORTH?r+h:r:d),m=i.x-e.x,f=i.y-e.y,c=e.x,d=e.y}y=a&&i.x<=l+o/2||!a&&i.y<=r+h/2?intersection(i.x,i.y,c,d,u.x,u.y,p.x,p.y):intersection(i.x,i.y,c,d,p.x,p.y,g.x,g.y)}return null==y&&(y=new Point(c,d)),y},Perimeter={RectanglePerimeter:RectanglePerimeter,EllipsePerimeter:EllipsePerimeter,RhombusPerimeter:RhombusPerimeter,TrianglePerimeter:TrianglePerimeter,HexagonPerimeter:HexagonPerimeter},isDefaultsRegistered=!1,registerDefaultStyleElements=()=>{isDefaultsRegistered||(StyleRegistry.putValue(EDGESTYLE.ELBOW,EdgeStyle.ElbowConnector),StyleRegistry.putValue(EDGESTYLE.ENTITY_RELATION,EdgeStyle.EntityRelation),StyleRegistry.putValue(EDGESTYLE.LOOP,EdgeStyle.Loop),StyleRegistry.putValue(EDGESTYLE.MANHATTAN,EdgeStyle.ManhattanConnector),StyleRegistry.putValue(EDGESTYLE.ORTHOGONAL,EdgeStyle.OrthConnector),StyleRegistry.putValue(EDGESTYLE.SEGMENT,EdgeStyle.SegmentConnector),StyleRegistry.putValue(EDGESTYLE.SIDETOSIDE,EdgeStyle.SideToSide),StyleRegistry.putValue(EDGESTYLE.TOPTOBOTTOM,EdgeStyle.TopToBottom),StyleRegistry.putValue(PERIMETER.ELLIPSE,Perimeter.EllipsePerimeter),StyleRegistry.putValue(PERIMETER.HEXAGON,Perimeter.HexagonPerimeter),StyleRegistry.putValue(PERIMETER.RECTANGLE,Perimeter.RectanglePerimeter),StyleRegistry.putValue(PERIMETER.RHOMBUS,Perimeter.RhombusPerimeter),StyleRegistry.putValue(PERIMETER.TRIANGLE,Perimeter.TrianglePerimeter),isDefaultsRegistered=!0)},getOpposites=(e,t,i=!0,s=!0)=>e.reduce((e,n)=>{let a=n.getTerminal(!0),l=n.getTerminal(!1);return a===t&&null!=l&&l!==t&&s?e.push(l):l===t&&null!=a&&a!==t&&i&&e.push(a),e},[]),getTopmostCells=e=>{let t=new Dictionary,i=[];for(let i=0;i<e.length;i+=1)t.put(e[i],!0);for(let s=0;s<e.length;s+=1){let n=e[s],a=!0,l=n.getParent();for(;null!=l;){if(t.get(l)){a=!1;break}l=l.getParent()}a&&i.push(n)}return i},getParents=e=>{let t=[],i=new Dictionary;for(let s of e){let e=s.getParent();null==e||i.get(e)||(i.put(e,!0),t.push(e))}return t},cloneCell=(e=null,t=!0)=>e?cloneCells([e],t)[0]:null,cloneCells=(e,t=!0,i={})=>{let s=[];for(let n of e)s.push(cloneCellImpl(n,i,t));for(let t=0;t<s.length;t+=1)null!=s[t]&&restoreClone(s[t],e[t],i);return s},cloneCellImpl=(e,t={},i=!1)=>{let s=ObjectIdentity.get(e),n=t?t[s]:null;if(null==n&&(n=e.clone(),t[s]=n,i)){let i=e.getChildCount();for(let s=0;s<i;s+=1){let i=cloneCellImpl(e.getChildAt(s),t,!0);n.insert(i)}}return n},restoreClone=(e,t,i)=>{let s=t.getTerminal(!0);if(null!=s){let t=i[ObjectIdentity.get(s)];null!=t&&t.insertEdge(e,!0)}let n=t.getTerminal(!1);if(null!=n){let t=i[ObjectIdentity.get(n)];null!=t&&t.insertEdge(e,!1)}let a=e.getChildCount();for(let s=0;s<a;s+=1)restoreClone(e.getChildAt(s),t.getChildAt(s),i)},cellArrayUtils=Object.freeze(Object.defineProperty({__proto__:null,cloneCell:cloneCell,cloneCells:cloneCells,getOpposites:getOpposites,getParents:getParents,getTopmostCells:getTopmostCells},Symbol.toStringTag,{value:"Module"})),CellsMixin={cellsResizable:!0,cellsBendable:!0,cellsSelectable:!0,cellsDisconnectable:!0,autoSizeCells:!1,autoSizeCellsOnAdd:!1,cellsLocked:!1,cellsCloneable:!0,cellsDeletable:!0,cellsMovable:!0,extendParents:!0,extendParentsOnAdd:!0,extendParentsOnMove:!1,getBoundingBox(e){let t=null;if(e.length>0){for(let i of e)if(i.isVertex()||i.isEdge()){let e=this.getView().getBoundingBox(this.getView().getState(i),!0);e&&(t?t.add(e):t=Rectangle.fromRectangle(e))}}return t},removeStateForCell(e){for(let t of e.getChildren())this.removeStateForCell(t);this.getView().invalidate(e,!1,!0),this.getView().removeState(e)},getCurrentCellStyle(e,t=!1){let i=t?null:this.getView().getState(e);return i?i.style:this.getCellStyle(e)},getCellStyle(e){let t=e.getStyle(),i=this.getStylesheet(),s=e.isEdge()?i.getDefaultEdgeStyle():i.getDefaultVertexStyle();return this.postProcessCellStyle(i.getCellStyle(t,s??{}))},postProcessCellStyle(e){if(!e.image)return e;let t=e.image,i=this.getImageFromBundles(t);if(i?e.image=i:i=t,i&&"data:image/"===i.substring(0,11)){if("data:image/svg+xml,<"===i.substring(0,20))i=i.substring(0,19)+encodeURIComponent(i.substring(19));else if("data:image/svg+xml,%3C"!==i.substring(0,22)){let e=i.indexOf(",");e>0&&";base64,"!==i.substring(e-7,e+1)&&(i=`${i.substring(0,e)};base64,${i.substring(e+1)}`)}e.image=i}return e},setCellStyle(e,t){t=t??this.getSelectionCells(),this.batchUpdate(()=>{for(let i of t)this.getDataModel().setStyle(i,e)})},toggleCellStyle(e,t=!1,i){return i=i??this.getSelectionCell(),this.toggleCellStyles(e,t,[i])},toggleCellStyles(e,t=!1,i){let s=!1;return(i=i??this.getSelectionCells()).length>0&&(s=!(this.getCurrentCellStyle(i[0])[e]??t),this.setCellStyles(e,s,i)),s},setCellStyles(e,t,i){i=i??this.getSelectionCells(),setCellStyles(this.getDataModel(),i,e,t)},toggleCellStyleFlags(e,t,i){i=i??this.getSelectionCells(),this.setCellStyleFlags(e,t,null,i)},setCellStyleFlags(e,t,i=null,s){(s=s??this.getSelectionCells()).length>0&&(null===i&&(i=((this.getCurrentCellStyle(s[0])[e]||0)&t)!==t),setCellStyleFlags(this.getDataModel(),s,e,t,i))},alignCells(e,t,i=null){if((t=t??this.getSelectionCells()).length>1){if(null===i)for(let s of t){let t=this.getView().getState(s);if(t&&!s.isEdge())if(null===i)if(e===ALIGN.CENTER){i=t.x+t.width/2;break}else if(e===ALIGN.RIGHT)i=t.x+t.width;else if(e===ALIGN.TOP)i=t.y;else if(e===ALIGN.MIDDLE){i=t.y+t.height/2;break}else i=e===ALIGN.BOTTOM?t.y+t.height:t.x;else i=e===ALIGN.RIGHT?Math.max(i,t.x+t.width):e===ALIGN.TOP?Math.min(i,t.y):e===ALIGN.BOTTOM?Math.max(i,t.y+t.height):Math.min(i,t.x)}if(null!==i){let s=this.getView().scale;this.batchUpdate(()=>{let n=i;for(let i of t){let t=this.getView().getState(i);if(null!=t){let a=i.getGeometry();null==a||i.isEdge()||(a=a.clone(),e===ALIGN.CENTER?a.x+=(n-t.x-t.width/2)/s:e===ALIGN.RIGHT?a.x+=(n-t.x-t.width)/s:e===ALIGN.TOP?a.y+=(n-t.y)/s:e===ALIGN.MIDDLE?a.y+=(n-t.y-t.height/2)/s:e===ALIGN.BOTTOM?a.y+=(n-t.y-t.height)/s:a.x+=(n-t.x)/s,this.resizeCell(i,a))}}this.fireEvent(new EventObject(InternalEvent.ALIGN_CELLS,{align:e,cells:t}))})}}return t},cloneCell(e,t=!1,i={},s=!1){return this.cloneCells([e],t,i,s)[0]},cloneCells(e,t=!0,i={},s=!1){let n,a=new Dictionary,l=[];for(let t of e)a.put(t,!0),l.push(t);if(l.length>0){let{scale:l}=this.getView(),r=this.getView().translate,o=[];n=cloneCells(e,!0,i);for(let i=0;i<e.length;i+=1){let h=e[i],c=n[i];if(!t&&c.isEdge()&&null!==this.getEdgeValidationError(c,c.getTerminal(!0),c.getTerminal(!1)));else{o.push(c);let e=c.getGeometry();if(e){let t=this.getView().getState(h),i=h.getParent(),n=i?this.getView().getState(i):null;if(t&&n){let i=s?0:n.origin.x,o=s?0:n.origin.y;if(c.isEdge()){let s=t.absolutePoints,n=h.getTerminal(!0);for(;n&&!a.get(n);)n=n.getParent();!n&&s[0]&&e.setTerminalPoint(new Point(s[0].x/l-r.x,s[0].y/l-r.y),!0);let c=h.getTerminal(!1);for(;c&&!a.get(c);)c=c.getParent();let d=s.length-1,u=s[d];!c&&u&&e.setTerminalPoint(new Point(u.x/l-r.x,u.y/l-r.y),!1);let{points:p}=e;if(p)for(let e of p)e.x+=i,e.y+=o}else e.translate(i,o)}}}}n=o}else n=[];return n},addCell(e,t=null,i=null,s=null,n=null){return this.addCells([e],t,i,s,n)[0]},addCells(e,t=null,i=null,s=null,n=null,a=!1){let l=t??this.getDefaultParent(),r=i??l.getChildCount();return this.batchUpdate(()=>{this.cellsAdded(e,l,r,s,n,a,!0),this.fireEvent(new EventObject(InternalEvent.ADD_CELLS,{cells:e,p:l,i:r,source:s,target:n}))}),e},cellsAdded(e,t,i,s=null,n=null,a=!1,l=!1,r=!0){this.batchUpdate(()=>{let o=a?this.getView().getState(t):null,h=o?o.origin:null,c=new Point(0,0);e.forEach((e,a)=>{let o=e.getParent();if(h&&e!==t&&t!==o){let t=o?this.getView().getState(o):null,i=t?t.origin:c,s=e.getGeometry();if(s){let t=i.x-h.x,n=i.y-h.y;(s=s.clone()).translate(t,n),!s.relative&&e.isVertex()&&!this.isAllowNegativeCoordinates()&&(s.x=Math.max(0,s.x),s.y=Math.max(0,s.y)),this.getDataModel().setGeometry(e,s)}}t===o&&i+a>t.getChildCount()&&i--,this.getDataModel().add(t,e,i+a),this.autoSizeCellsOnAdd&&this.autoSizeCell(e,!0),(!r||r)&&this.isExtendParentsOnAdd(e)&&this.isExtendParent(e)&&this.extendParent(e),(!l||l)&&this.constrainChild(e),s&&this.cellConnected(e,s,!0),n&&this.cellConnected(e,n,!1)}),this.fireEvent(new EventObject(InternalEvent.CELLS_ADDED,{cells:e,parent:t,index:i,source:s,target:n,absolute:a}))})},autoSizeCell(e,t=!0){if(t)for(let t of e.getChildren())this.autoSizeCell(t);e.isVertex()&&this.isAutoSizeCell(e)&&this.updateCellSize(e)},removeCells(e=null,t=!0){if(e||(e=this.getDeletableCells(this.getSelectionCells())),t)e=this.getDeletableCells(this.addAllEdges(e));else{e=e.slice();let t=this.getDeletableCells(this.getAllEdges(e)),i=new Dictionary;for(let t of e)i.put(t,!0);for(let s of t)this.getView().getState(s)||i.get(s)||(i.put(s,!0),e.push(s))}return this.batchUpdate(()=>{this.cellsRemoved(e),this.fireEvent(new EventObject(InternalEvent.REMOVE_CELLS,{cells:e,includeEdges:t}))}),e??[]},cellsRemoved(e){if(e.length>0){let{scale:t}=this.getView(),i=this.getView().translate;this.batchUpdate(()=>{let s=new Dictionary;for(let t of e)s.put(t,!0);for(let n of e){let e=this.getAllEdges([n]),a=(e,s)=>{let a=e.getGeometry();if(a){let l=e.getTerminal(s),r=!1,o=l;for(;o;){if(n===o){r=!0;break}o=o.getParent()}if(r){a=a.clone();let n=this.getView().getState(e);if(n){let e=n.absolutePoints,l=s?0:e.length-1,r=e[l];a.setTerminalPoint(new Point(r.x/t-i.x-n.origin.x,r.y/t-i.y-n.origin.y),s)}else if(l){let e=this.getView().getState(l);e&&a.setTerminalPoint(new Point(e.getCenterX()/t-i.x,e.getCenterY()/t-i.y),s)}this.getDataModel().setGeometry(e,a),this.getDataModel().setTerminal(e,null,s)}}};for(let t of e)s.get(t)||(s.put(t,!0),a(t,!0),a(t,!1));this.getDataModel().remove(n)}this.fireEvent(new EventObject(InternalEvent.CELLS_REMOVED,{cells:e}))})}},toggleCells(e=!1,t,i=!0){return t=t??this.getSelectionCells(),i&&(t=this.addAllEdges(t)),this.batchUpdate(()=>{this.cellsToggled(t,e),this.fireEvent(new EventObject(InternalEvent.TOGGLE_CELLS,{show:e,cells:t,includeEdges:i}))}),t},cellsToggled(e,t=!1){e.length>0&&this.batchUpdate(()=>{for(let i of e)this.getDataModel().setVisible(i,t)})},updateCellSize(e,t=!1){return this.batchUpdate(()=>{this.cellSizeUpdated(e,t),this.fireEvent(new EventObject(InternalEvent.UPDATE_CELL_SIZE,{cell:e,ignoreChildren:t}))}),e},cellSizeUpdated(e,t=!1){this.batchUpdate(()=>{let i=this.getPreferredSizeForCell(e),s=e.getGeometry();if(i&&s){let n=e.isCollapsed();if(s=s.clone(),this.isSwimlane(e)){let t=this.getCellStyle(e),a=e.getStyle();t.horizontal??!0?(a.startSize=i.height+8,n&&(s.height=i.height+8),s.width=i.width):(a.startSize=i.width+8,n&&(s.width=i.width+8),s.height=i.height),this.getDataModel().setStyle(e,a)}else{let t=this.getView().createState(e),n=t.style.align??ALIGN.CENTER;n===ALIGN.RIGHT?s.x+=s.width-i.width:n===ALIGN.CENTER&&(s.x+=Math.round((s.width-i.width)/2));let a=t.getVerticalAlign();a===ALIGN.BOTTOM?s.y+=s.height-i.height:a===ALIGN.MIDDLE&&(s.y+=Math.round((s.height-i.height)/2)),s.width=i.width,s.height=i.height}if(!t&&!n){let t=this.getView().getBounds(e.getChildren());if(null!=t){let e=this.getView().translate,{scale:i}=this.getView(),n=(t.x+t.width)/i-s.x-e.x,a=(t.y+t.height)/i-s.y-e.y;s.width=Math.max(s.width,n),s.height=Math.max(s.height,a)}}this.cellsResized([e],[s],!1)}})},getPreferredSizeForCell(e,t=null){let i=null,s=this.getView().createState(e),{style:n}=s;if(!e.isEdge()){let e=n.fontSize||DEFAULT_FONTSIZE,a=0,l=0;(s.getImageSrc()||n.image)&&n.shape===SHAPE.LABEL&&(n.verticalAlign===ALIGN.MIDDLE&&(a+=n.imageWidth||DEFAULT_IMAGESIZE),n.align!==ALIGN.CENTER&&(l+=n.imageHeight||DEFAULT_IMAGESIZE)),a+=2*(n.spacing||0),a+=n.spacingLeft||0,a+=n.spacingRight||0,l+=2*(n.spacing||0),l+=n.spacingTop||0,l+=n.spacingBottom||0;let r=this.getFoldingImage(s);r&&(a+=r.width+8);let o=this.getCellRenderer().getLabelValue(s);if(o&&o.length>0){this.isHtmlLabel(s.cell)||(o=htmlEntities(o,!1));let r=getSizeForString(o=o.replace(/\n/g,"<br>"),e,n.fontFamily,t,n.fontStyle),h=r.width+a,c=r.height+l;if(!(n.horizontal??!0)){let e=c;c=h,h=e}this.isGridEnabled()&&(h=this.snap(h+this.getGridSize()/2),c=this.snap(c+this.getGridSize()/2)),i=new Rectangle(0,0,h,c)}else{let e=4*this.getGridSize();i=new Rectangle(0,0,e,e)}}return i},resizeCell(e,t,i=!1){return this.resizeCells([e],[t],i)[0]},resizeCells(e,t,i){return i=i??this.isRecursiveResize(),this.batchUpdate(()=>{let s=this.cellsResized(e,t,i);this.fireEvent(new EventObject(InternalEvent.RESIZE_CELLS,{cells:e,bounds:t,prev:s}))}),e},cellsResized(e,t,i=!1){let s=[];return e.length===t.length&&this.batchUpdate(()=>{e.forEach((e,n)=>{s.push(this.cellResized(e,t[n],!1,i)),this.isExtendParent(e)&&this.extendParent(e),this.constrainChild(e)}),this.isResetEdgesOnResize()&&this.resetEdges(e),this.fireEvent(new EventObject(InternalEvent.CELLS_RESIZED,{cells:e,bounds:t,prev:s}))}),s},cellResized(e,t,i=!1,s=!1){let n=e.getGeometry();if(n&&(n.x!==t.x||n.y!==t.y||n.width!==t.width||n.height!==t.height)){let a=n.clone();if(!i&&a.relative){let{offset:e}=a;e&&(e.x+=t.x-a.x,e.y+=t.y-a.y)}else a.x=t.x,a.y=t.y;a.width=t.width,a.height=t.height,!a.relative&&e.isVertex()&&!this.isAllowNegativeCoordinates()&&(a.x=Math.max(0,a.x),a.y=Math.max(0,a.y)),this.batchUpdate(()=>{s&&this.resizeChildCells(e,a),this.getDataModel().setGeometry(e,a),this.constrainChildCells(e)})}return n},resizeChildCells(e,t){let i=e.getGeometry();if(i){let s=0!==i.width?t.width/i.width:1,n=0!==i.height?t.height/i.height:1;for(let t of e.getChildren())this.scaleCell(t,s,n,!0)}},constrainChildCells(e){for(let t of e.getChildren())this.constrainChild(t)},scaleCell(e,t,i,s=!1){let n=e.getGeometry();if(n){let a=this.getCurrentCellStyle(e),{x:l}=n=n.clone(),{y:r}=n,o=n.width,h=n.height;n.scale(t,i,"fixed"===a.aspect),a.resizeWidth?n.width=o*t:a.resizeWidth||(n.width=o),a.resizeHeight?n.height=h*i:a.resizeHeight||(n.height=h),this.isCellMovable(e)||(n.x=l,n.y=r),this.isCellResizable(e)||(n.width=o,n.height=h),e.isVertex()?this.cellResized(e,n,!0,s):this.getDataModel().setGeometry(e,n)}},extendParent(e){let t=e.getParent(),i=t?t.getGeometry():null;if(t&&i&&!t.isCollapsed()){let s=e.getGeometry();s&&!s.relative&&(i.width<s.x+s.width||i.height<s.y+s.height)&&((i=i.clone()).width=Math.max(i.width,s.x+s.width),i.height=Math.max(i.height,s.y+s.height),this.cellsResized([t],[i],!1))}},importCells(e,t,i,s=null,n=null,a={}){return this.moveCells(e,t,i,!0,s,n,a)},moveCells(e,t=0,i=0,s=!1,n=null,a=null,l={}){if(0!==t||0!==i||s||n){let r=e=getTopmostCells(e);this.batchUpdate(()=>{let o=new Dictionary;for(let t of e)o.put(t,!0);let h=e=>{for(;e;){if(o.get(e))return!0;e=e.getParent()}return!1},c=[];for(let t of e){let e=t.getGeometry(),i=t.getParent();e&&e.relative&&(!i||i.isEdge())&&(!i||h(i.getTerminal(!0))||h(i.getTerminal(!1)))||c.push(t)}e=c,s&&(e=this.cloneCells(e,this.isCloneInvalidEdges(),l),n||(n=this.getDefaultParent()));let d=this.isAllowNegativeCoordinates();if(n&&this.setAllowNegativeCoordinates(!0),this.cellsMoved(e,t,i,!s&&this.isDisconnectOnMove()&&this.isAllowDanglingEdges(),!n,this.isExtendParentsOnMove()&&!n),this.setAllowNegativeCoordinates(d),n){let t=n.getChildCount();this.cellsAdded(e,n,t,null,null,!0),s&&e.forEach((e,t)=>{let i=e.getGeometry(),s=r[t].getParent();i&&i.relative&&s&&s.isEdge()&&this.getDataModel().contains(s)&&this.getDataModel().add(s,e)})}this.fireEvent(new EventObject(InternalEvent.MOVE_CELLS,{cells:e,dx:t,dy:i,clone:s,target:n,event:a}))})}return e},cellsMoved(e,t,i,s=!1,n=!1,a=!1){(0!==t||0!==i)&&this.batchUpdate(()=>{for(let l of(s&&this.disconnectGraph(e),e))this.translateCell(l,t,i),a&&this.isExtendParent(l)?this.extendParent(l):n&&this.constrainChild(l);this.isResetEdgesOnMove()&&this.resetEdges(e),this.fireEvent(new EventObject(InternalEvent.CELLS_MOVED,{cells:e,dx:t,dy:i,disconnect:s}))})},translateCell(e,t,i){let s=e.getGeometry();if(s){if((s=s.clone()).translate(t,i),!s.relative&&e.isVertex()&&!this.isAllowNegativeCoordinates()&&(s.x=Math.max(0,s.x),s.y=Math.max(0,s.y)),s.relative&&!e.isEdge()){let n=e.getParent(),a=0;if(n.isVertex()&&(a=this.getCurrentCellStyle(n).rotation??0),0!==a){let e=toRadians(-a),s=Math.cos(e),n=Math.sin(e),l=getRotatedPoint(new Point(t,i),s,n,new Point(0,0));t=l.x,i=l.y}s.offset?(s.offset.x=s.offset.x+t,s.offset.y=s.offset.y+i):s.offset=new Point(t,i)}this.getDataModel().setGeometry(e,s)}},getCellContainmentArea(e){if(!e.isEdge()){let t=e.getParent();if(t&&t!==this.getDefaultParent()){let e=t.getGeometry();if(e){let i=0,s=0,n=e.width,a=e.height;if(this.isSwimlane(t)){let e=this.getStartSize(t),l=this.getCurrentCellStyle(t),r=l.direction??DIRECTION.EAST,o=l.flipH??!1,h=l.flipV??!1;if(r===DIRECTION.SOUTH||r===DIRECTION.NORTH){let t=e.width;e.width=e.height,e.height=t}(r===DIRECTION.EAST&&!h||r===DIRECTION.NORTH&&!o||r===DIRECTION.WEST&&h||r===DIRECTION.SOUTH&&o)&&(i=e.width,s=e.height),n-=e.width,a-=e.height}return new Rectangle(i,s,n,a)}}}return null},constrainChild(e,t=!0){let i=e.getGeometry();if(i&&(this.isConstrainRelativeChildren()||!i.relative)){let t=e.getParent(),s=this.getMaximumGraphBounds();if(s&&t){let e=this.getBoundingBoxFromGeometry([t],!1);e&&(s=Rectangle.fromRectangle(s),s.x-=e.x,s.y-=e.y)}if(this.isConstrainChild(e)){let t=this.getCellContainmentArea(e);if(t){let i=this.getOverlap(e);i>0&&(t=Rectangle.fromRectangle(t),t.x-=t.width*i,t.y-=t.height*i,t.width+=2*t.width*i,t.height+=2*t.height*i),s?(s=Rectangle.fromRectangle(s)).intersect(t):s=t}}if(s){let t=[e];if(!e.isCollapsed())for(let i of e.getDescendants())i.isVisible()&&t.push(i);let n=this.getBoundingBoxFromGeometry(t,!1);if(n){i=i.clone();let t=0;i.width>s.width&&(t=i.width-s.width,i.width-=t),n.x+n.width>s.x+s.width&&(t-=n.x+n.width-s.x-s.width-t);let a=0;i.height>s.height&&(a=i.height-s.height,i.height-=a),n.y+n.height>s.y+s.height&&(a-=n.y+n.height-s.y-s.height-a),n.x<s.x&&(t-=n.x-s.x),n.y<s.y&&(a-=n.y-s.y),(0!==t||0!==a)&&(i.relative?(i.offset||(i.offset=new Point),i.offset.x+=t,i.offset.y+=a):(i.x+=t,i.y+=a)),this.getDataModel().setGeometry(e,i)}}}},getChildCells(e,t=!1,i=!1){let s=(e=e??this.getDefaultParent()).getChildCells(t,i),n=[];for(let e of s)e.isVisible()&&n.push(e);return n},getCellAt(e,t,i=null,s=!0,n=!0,a=null){if(!i&&((i=this.getCurrentRoot())||(i=this.getDataModel().getRoot())),i){let l=i.getChildCount();for(let r=l-1;r>=0;r--){let l=i.getChildAt(r),o=this.getCellAt(e,t,l,s,n,a);if(o)return o;if(l.isVisible()&&(n&&l.isEdge()||s&&l.isVertex())){let i=this.getView().getState(l);if(i&&(!a||!a(i,e,t))&&this.intersects(i,e,t))return l}}}return null},getCells(e,t,i,s,n=null,a=[],l=null,r=null,o=!1){if(i>0||s>0||l){let h=this.getDataModel(),c=e+i,d=t+s;if(!n&&((n=this.getCurrentRoot())||(n=h.getRoot())),n)for(let h of n.getChildren()){let n=this.getView().getState(h);if(n&&h.isVisible()&&(!r||!r(n))){let u=n.style.rotation??0,p=n;0!==u&&(p=getBoundingBox(p,u));let g=l&&h.isVertex()&&intersects$1(l,p)||!l&&(h.isEdge()||h.isVertex())&&p.x>=e&&p.y+p.height<=d&&p.y>=t&&p.x+p.width<=c;g&&a.push(h),(!g||o)&&this.getCells(e,t,i,s,h,a,l,r,o)}}}return a},getCellsBeyond(e,t,i=null,s=!1,n=!1){let a=[];if((s||n)&&(i||(i=this.getDefaultParent()),i))for(let l of i.getChildren()){let i=this.getView().getState(l);l.isVisible()&&i&&(!s||i.x>=e)&&(!n||i.y>=t)&&a.push(l)}return a},intersects(e,t,i){let s=e.absolutePoints;if(s.length>0){let e=this.getEventTolerance()*this.getEventTolerance(),n=s[0];for(let a=1;a<s.length;a+=1){let l=s[a];if(n&&l&&ptSegDistSq(n.x,n.y,l.x,l.y,t,i)<=e)return!0;n=l}}else{let s=toRadians(e.style.rotation??0);if(0!==s){let n=Math.cos(-s),a=Math.sin(-s),l=new Point(e.getCenterX(),e.getCenterY()),r=getRotatedPoint(new Point(t,i),n,a,l);t=r.x,i=r.y}if(contains(e,t,i))return!0}return!1},isValidAncestor:(e,t,i=!1)=>i?t.isAncestor(e):(null==e?void 0:e.getParent())===t,isCellLocked(e){let t=e.getGeometry();return this.isCellsLocked()||!!t&&e.isVertex()&&t.relative},isCellsLocked(){return this.cellsLocked},setCellsLocked(e){this.cellsLocked=e},getCloneableCells(e){return this.getDataModel().filterCells(e,e=>this.isCellCloneable(e))},isCellCloneable(e){return this.isCellsCloneable()&&(this.getCurrentCellStyle(e).cloneable??!0)},isCellsCloneable(){return this.cellsCloneable},setCellsCloneable(e){this.cellsCloneable=e},getExportableCells(e){return this.getDataModel().filterCells(e,e=>this.canExportCell(e))},canExportCell(e=null){return this.isExportEnabled()},getImportableCells(e){return this.getDataModel().filterCells(e,e=>this.canImportCell(e))},canImportCell(e=null){return this.isImportEnabled()},isCellSelectable(e){return this.isCellsSelectable()},isCellsSelectable(){return this.cellsSelectable},setCellsSelectable(e){this.cellsSelectable=e},getDeletableCells(e){return this.getDataModel().filterCells(e,e=>this.isCellDeletable(e))},isCellDeletable(e){return this.isCellsDeletable()&&(this.getCurrentCellStyle(e).deletable??!0)},isCellsDeletable(){return this.cellsDeletable},setCellsDeletable(e){this.cellsDeletable=e},isCellRotatable(e){return this.getCurrentCellStyle(e).rotatable??!0},getMovableCells(e){return this.getDataModel().filterCells(e,e=>this.isCellMovable(e))},isCellMovable(e){return this.isCellsMovable()&&!this.isCellLocked(e)&&(this.getCurrentCellStyle(e).movable??!0)},isCellsMovable(){return this.cellsMovable},setCellsMovable(e){this.cellsMovable=e},isCellResizable(e){return this.isCellsResizable()&&!this.isCellLocked(e)&&(this.getCurrentCellStyle(e).resizable??!0)},isCellsResizable(){return this.cellsResizable},setCellsResizable(e){this.cellsResizable=e},isCellBendable(e){return this.isCellsBendable()&&!this.isCellLocked(e)&&(this.getCurrentCellStyle(e).bendable??!0)},isCellsBendable(){return this.cellsBendable},setCellsBendable(e){this.cellsBendable=e},isAutoSizeCell(e){return this.isAutoSizeCells()||(this.getCurrentCellStyle(e).autoSize??!1)},isAutoSizeCells(){return this.autoSizeCells},setAutoSizeCells(e){this.autoSizeCells=e},isExtendParent(e){return!e.isEdge()&&this.isExtendParents()},isExtendParents(){return this.extendParents},setExtendParents(e){this.extendParents=e},isExtendParentsOnAdd(e){return this.extendParentsOnAdd},setExtendParentsOnAdd(e){this.extendParentsOnAdd=e},isExtendParentsOnMove(){return this.extendParentsOnMove},setExtendParentsOnMove(e){this.extendParentsOnMove=e},getCursorForCell:e=>null,getCellBounds(e,t=!1,i=!1){let s=[e];t&&(s=s.concat(e.getEdges()));let n=this.getView().getBounds(s);if(i)for(let i of e.getChildren()){let e=this.getCellBounds(i,t,!0);n&&e?n.add(e):n=e}return n},getBoundingBoxFromGeometry(e,t=!1){let i=null,s=null;for(let n of e)if(t||n.isVertex()){let t=n.getGeometry();if(t){let a=null;if(n.isEdge()){let e=e=>{e&&(s?s.add(new Rectangle(e.x,e.y,0,0)):s=new Rectangle(e.x,e.y,0,0))};n.getTerminal(!0)||e(t.getTerminalPoint(!0)),n.getTerminal(!1)||e(t.getTerminalPoint(!1));let i=t.points;if(i&&i.length>0){s=new Rectangle(i[0].x,i[0].y,0,0);for(let t=1;t<i.length;t++)e(i[t])}a=s}else{let i=n.getParent();t.relative&&i?i.isVertex()&&i!==this.getView().currentRoot&&(s=this.getBoundingBoxFromGeometry([i],!1))&&(a=new Rectangle(t.x*s.width,t.y*s.height,t.width,t.height),e.indexOf(i)>=0&&(a.x+=s.x,a.y+=s.y)):(a=Rectangle.fromRectangle(t),i&&i.isVertex()&&e.indexOf(i)>=0&&(s=this.getBoundingBoxFromGeometry([i],!1))&&(a.x+=s.x,a.y+=s.y)),a&&t.offset&&(a.x+=t.offset.x,a.y+=t.offset.y);let l=this.getCurrentCellStyle(n);if(a){let e=l.rotation??0;0!==e&&(a=getBoundingBox(a,e))}}a&&(i?i.add(a):i=Rectangle.fromRectangle(a))}}return i}},ConnectionsMixin={constrainChildren:!0,constrainRelativeChildren:!1,disconnectOnMove:!0,cellsDisconnectable:!0,getOutlineConstraint(e,t,i){if(t.shape){let i=this.getView().getPerimeterBounds(t),s=t.style.direction;if(s===DIRECTION.NORTH||s===DIRECTION.SOUTH){i.x+=i.width/2-i.height/2,i.y+=i.height/2-i.width/2;let e=i.width;i.width=i.height,i.height=e}let n=toRadians(t.shape.getShapeRotation());if(0!==n){let t=Math.cos(-n),s=Math.sin(-n),a=new Point(i.getCenterX(),i.getCenterY());e=getRotatedPoint(e,t,s,a)}let a=1,l=1,r=0,o=0;if(t.cell.isVertex()){let e=t.style.flipH,n=t.style.flipV;if(s===DIRECTION.NORTH||s===DIRECTION.SOUTH){let t=e;e=n,n=t}e&&(a=-1,r=-i.width),n&&(l=-1,o=-i.height)}return e=new Point((e.x-i.x)*a-r+i.x,(e.y-i.y)*l-o+i.y),new ConnectionConstraint(new Point(0===i.width?0:Math.round((e.x-i.x)*1e3/i.width)/1e3,0===i.height?0:Math.round((e.y-i.y)*1e3/i.height)/1e3),!1)}return null},getAllConnectionConstraints(e,t){var i,s;return(null==(s=null==(i=null==e?void 0:e.shape)?void 0:i.stencil)?void 0:s.constraints)??null},getConnectionConstraint(e,t,i=!1){let s=null,n=e.style[i?"exitX":"entryX"];if(void 0!==n){let t=e.style[i?"exitY":"entryY"];void 0!==t&&(s=new Point(n,t))}let a=!1,l=0,r=0;return s&&(a=e.style[i?"exitPerimeter":"entryPerimeter"]||!1,l=e.style[i?"exitDx":"entryDx"],r=e.style[i?"exitDy":"entryDy"],l=Number.isFinite(l)?l:0,r=Number.isFinite(r)?r:0),new ConnectionConstraint(s,a,null,l,r)},setConnectionConstraint(e,t,i=!1,s=null){s&&this.batchUpdate(()=>{s&&s.point?s.point&&(this.setCellStyles(i?"exitX":"entryX",s.point.x,[e]),this.setCellStyles(i?"exitY":"entryY",s.point.y,[e]),this.setCellStyles(i?"exitDx":"entryDx",s.dx,[e]),this.setCellStyles(i?"exitDy":"entryDy",s.dy,[e]),s.perimeter?this.setCellStyles(i?"exitPerimeter":"entryPerimeter",null,[e]):this.setCellStyles(i?"exitPerimeter":"entryPerimeter","0",[e])):(this.setCellStyles(i?"exitX":"entryX",null,[e]),this.setCellStyles(i?"exitY":"entryY",null,[e]),this.setCellStyles(i?"exitDx":"entryDx",null,[e]),this.setCellStyles(i?"exitDy":"entryDy",null,[e]),this.setCellStyles(i?"exitPerimeter":"entryPerimeter",null,[e]))})},getConnectionPoint(e,t,i=!0){let s=null;if(t.point){let i=this.getView().getPerimeterBounds(e),n=new Point(i.getCenterX(),i.getCenterY()),a=e.style.direction,l=0;e.style.anchorPointDirection&&(a===DIRECTION.NORTH?l+=270:a===DIRECTION.WEST?l+=180:a===DIRECTION.SOUTH&&(l+=90),(a===DIRECTION.NORTH||a===DIRECTION.SOUTH)&&i.rotate90());let{scale:r}=this.getView();s=new Point(i.x+t.point.x*i.width+t.dx*r,i.y+t.point.y*i.height+t.dy*r);let o=e.style.rotation||0;if(t.perimeter){if(0!==l){let e=0,t=0;90===l?t=1:180===l?e=-1:270===l&&(t=-1),s=getRotatedPoint(s,e,t,n)}s=this.getView().getPerimeterPoint(e,s,!1)}else if(o+=l,e.cell.isVertex()){let t=e.style.flipH,n=e.style.flipV;if(a===DIRECTION.NORTH||a===DIRECTION.SOUTH){let e=t;t=n,n=e}t&&(s.x=2*i.getCenterX()-s.x),n&&(s.y=2*i.getCenterY()-s.y)}if(0!==o&&s){let e=toRadians(o);s=getRotatedPoint(s,Math.cos(e),Math.sin(e),n)}}return i&&s&&(s.x=Math.round(s.x),s.y=Math.round(s.y)),s},connectCell(e,t=null,i=!1,s=null){return this.batchUpdate(()=>{let n=e.getTerminal(i);this.cellConnected(e,t,i,s),this.fireEvent(new EventObject(InternalEvent.CONNECT_CELL,"edge",e,"terminal",t,"source",i,"previous",n))}),e},cellConnected(e,t,i=!1,s=null){this.batchUpdate(()=>{let n=e.getTerminal(i);if(this.setConnectionConstraint(e,t,i,s),this.isPortsEnabled()){let s=null;t&&this.isPort(t)&&(s=t.getId(),t=this.getTerminalForPort(t,i));let n=i?"sourcePort":"targetPort";this.setCellStyles(n,s,[e])}this.getDataModel().setTerminal(e,t,i),this.isResetEdgesOnConnect()&&this.resetEdge(e),this.fireEvent(new EventObject(InternalEvent.CELL_CONNECTED,"edge",e,"terminal",t,"source",i,"previous",n))})},disconnectGraph(e){this.batchUpdate(()=>{let{scale:t,translate:i}=this.getView(),s=new Dictionary;for(let t=0;t<e.length;t+=1)s.put(e[t],!0);for(let n of e)if(n.isEdge()){let e=n.getGeometry();if(e){let a=this.getView().getState(n),l=n.getParent(),r=l?this.getView().getState(l):null;if(a&&r){e=e.clone();let l=-r.origin.x,o=-r.origin.y,h=a.absolutePoints,c=n.getTerminal(!0);if(c&&this.isCellDisconnectable(n,c,!0)){for(;c&&!s.get(c);)c=c.getParent();!c&&h[0]&&(e.setTerminalPoint(new Point(h[0].x/t-i.x+l,h[0].y/t-i.y+o),!0),this.getDataModel().setTerminal(n,null,!0))}let d=n.getTerminal(!1);if(d&&this.isCellDisconnectable(n,d,!1)){for(;d&&!s.get(d);)d=d.getParent();if(!d){let s=h.length-1,a=h[s];a&&(e.setTerminalPoint(new Point(a.x/t-i.x+l,a.y/t-i.y+o),!1),this.getDataModel().setTerminal(n,null,!1))}}this.getDataModel().setGeometry(n,e)}}}})},getConnections(e,t=null){return this.getEdges(e,t,!0,!0,!1)},isConstrainChild(e){return this.isConstrainChildren()&&!!e.getParent()&&!e.getParent().isEdge()},isConstrainChildren(){return this.constrainChildren},setConstrainChildren(e){this.constrainChildren=e},isConstrainRelativeChildren(){return this.constrainRelativeChildren},setConstrainRelativeChildren(e){this.constrainRelativeChildren=e},isDisconnectOnMove(){return this.disconnectOnMove},setDisconnectOnMove(e){this.disconnectOnMove=e},isCellDisconnectable(e,t=null,i=!1){return this.isCellsDisconnectable()&&!this.isCellLocked(e)},isCellsDisconnectable(){return this.cellsDisconnectable},setCellsDisconnectable(e){this.cellsDisconnectable=e},isValidSource(e){return null==e&&this.isAllowDanglingEdges()||null!=e&&(!e.isEdge()||this.isConnectableEdges())&&e.isConnectable()},isValidTarget(e){return this.isValidSource(e)},isValidConnection(e,t){return this.isValidSource(e)&&this.isValidTarget(t)},setConnectable(e){let t=this.getPlugin("ConnectionHandler");null==t||t.setEnabled(e)},isConnectable(){let e=this.getPlugin("ConnectionHandler");return(null==e?void 0:e.isEnabled())??!1}},DragDropMixin={dropEnabled:!1,splitEnabled:!0,autoScroll:!0,isAutoScroll(){return this.autoScroll},autoExtend:!0,isAutoExtend(){return this.autoExtend},isDropEnabled(){return this.dropEnabled},setDropEnabled(e){this.dropEnabled=e},isSplitEnabled(){return this.splitEnabled},setSplitEnabled(e){this.splitEnabled=e},isSplitTarget(e,t=[],i){if(e.isEdge()&&1===t.length&&t[0].isConnectable()&&!this.getEdgeValidationError(e,e.getTerminal(!0),t[0])){let i=e.getTerminal(!0),s=e.getTerminal(!1);return!t[0].isAncestor(i)&&!t[0].isAncestor(s)}return!1}},EdgeMixin={resetEdgesOnResize:!1,isResetEdgesOnResize(){return this.resetEdgesOnResize},resetEdgesOnMove:!1,isResetEdgesOnMove(){return this.resetEdgesOnMove},resetEdgesOnConnect:!0,isResetEdgesOnConnect(){return this.resetEdgesOnConnect},connectableEdges:!1,allowDanglingEdges:!0,cloneInvalidEdges:!1,alternateEdgeStyle:{},edgeLabelsMovable:!0,isEdgeLabelsMovable(){return this.edgeLabelsMovable},setEdgeLabelsMovable(e){this.edgeLabelsMovable=e},setAllowDanglingEdges(e){this.allowDanglingEdges=e},isAllowDanglingEdges(){return this.allowDanglingEdges},setConnectableEdges(e){this.connectableEdges=e},isConnectableEdges(){return this.connectableEdges},setCloneInvalidEdges(e){this.cloneInvalidEdges=e},isCloneInvalidEdges(){return this.cloneInvalidEdges},flipEdge(e){return this.alternateEdgeStyle&&this.batchUpdate(()=>{Object.keys(e.getStyle()).length?this.getDataModel().setStyle(e,this.alternateEdgeStyle):this.getDataModel().setStyle(e,{}),this.resetEdge(e),this.fireEvent(new EventObject(InternalEvent.FLIP_EDGE,{edge:e}))}),e},splitEdge(e,t,i,s=0,n=0,a,l,r=null){r=r??e.getParent();let o=e.getTerminal(!0);return this.batchUpdate(()=>{if(!i){i=this.cloneCell(e);let t=this.getView().getState(e),a=i.getGeometry();if(a&&t){let i=this.getView().translate,l=this.getView().scale,r=findNearestSegment(t,(s+i.x)*l,(n+i.y)*l);a.points=a.points.slice(0,r),(a=e.getGeometry())&&((a=a.clone()).points=a.points.slice(r),this.getDataModel().setGeometry(e,a))}}this.cellsMoved(t,s,n,!1,!1),this.cellsAdded(t,r,r?r.getChildCount():0,null,null,!0),this.cellsAdded([i],r,r?r.getChildCount():0,o,t[0],!1),this.cellConnected(e,t[0],!0),this.fireEvent(new EventObject(InternalEvent.SPLIT_EDGE,{edge:e,cells:t,newEdge:i,dx:s,dy:n}))}),i},insertEdge(...e){let t,i,s,n,a,l;if(1===e.length&&"object"==typeof e[0]){let r=e[0];t=r.parent,i=r.id,s=r.value,n=r.source,a=r.target,l=r.style}else[t,i,s,n,a,l]=e;let r=this.createEdge(t,i,s,n,a,l);return this.addEdge(r,t,n,a)},createEdge(e=null,t,i,s=null,n=null,a={}){let l=new Cell(i,new Geometry,a);return l.setId(t),l.setEdge(!0),l.geometry.relative=!0,l},addEdge(e,t=null,i=null,s=null,n=null){return this.addCell(e,t,n,i,s)},addAllEdges(e){return removeDuplicates(e.slice().concat(this.getAllEdges(e)))},getAllEdges(e){let t=[];if(e)for(let i=0;i<e.length;i+=1){let s=e[i].getEdgeCount();for(let n=0;n<s;n++)t.push(e[i].getEdgeAt(n));let n=e[i].getChildren();t=t.concat(this.getAllEdges(n))}return t},getIncomingEdges(e,t=null){return this.getEdges(e,t,!0,!1,!1)},getOutgoingEdges(e,t=null){return this.getEdges(e,t,!1,!0,!1)},getEdges(e,t=null,i=!0,s=!0,n=!0,a=!1){let l=[],r=e.isCollapsed(),o=e.getChildCount();for(let t=0;t<o;t+=1){let n=e.getChildAt(t);(r||!n.isVisible())&&(l=l.concat(n.getEdges(i,s)))}l=l.concat(e.getEdges(i,s));let h=[];for(let r=0;r<l.length;r+=1){let o=this.getView().getState(l[r]),c=o?o.getVisibleTerminal(!0):this.getView().getVisibleTerminal(l[r],!0),d=o?o.getVisibleTerminal(!1):this.getView().getVisibleTerminal(l[r],!1);(n&&c===d||c!==d&&(i&&d===e&&(!t||this.isValidAncestor(c,t,a))||s&&c===e&&(!t||this.isValidAncestor(d,t,a))))&&h.push(l[r])}return h},getChildEdges(e){return this.getChildCells(e,!1,!0)},getEdgesBetween(e,t,i=!1){let s=this.getEdges(e),n=[];for(let a=0;a<s.length;a+=1){let l=this.getView().getState(s[a]),r=l?l.getVisibleTerminal(!0):this.getView().getVisibleTerminal(s[a],!0),o=l?l.getVisibleTerminal(!1):this.getView().getVisibleTerminal(s[a],!1);(r!==e||o!==t)&&(i||r!==t||o!==e)||n.push(s[a])}return n},resetEdges(e){let t=new Dictionary;for(let i=0;i<e.length;i+=1)t.put(e[i],!0);this.batchUpdate(()=>{for(let i=0;i<e.length;i+=1){let s=e[i].getEdges();for(let e=0;e<s.length;e++){let i=this.getView().getState(s[e]),n=i?i.getVisibleTerminal(!0):this.getView().getVisibleTerminal(s[e],!0),a=i?i.getVisibleTerminal(!1):this.getView().getVisibleTerminal(s[e],!1);t.get(n)&&t.get(a)||this.resetEdge(s[e])}this.resetEdges(e[i].getChildren())}})},resetEdge(e){let t=e.getGeometry();return t&&t.points&&t.points.length>0&&((t=t.clone()).points=[],this.getDataModel().setGeometry(e,t)),e}},EditingMixin={cellsEditable:!0,startEditing(e){this.startEditingAtCell(null,e)},startEditingAtCell(e=null,t){if(!t||!isMultiTouchEvent(t))if(e){this.fireEvent(new EventObject(InternalEvent.START_EDITING,{cell:e,event:t}));let i=this.getPlugin("CellEditorHandler");null==i||i.startEditing(e,t),this.fireEvent(new EventObject(InternalEvent.EDITING_STARTED,{cell:e,event:t}))}else(e=this.getSelectionCell())&&!this.isCellEditable(e)&&(e=null)},getEditingValue(e,t){return this.convertValueToString(e)},stopEditing(e=!1){let t=this.getPlugin("CellEditorHandler");null==t||t.stopEditing(e),this.fireEvent(new EventObject(InternalEvent.EDITING_STOPPED,{cancel:e}))},labelChanged(e,t,i){return this.batchUpdate(()=>{let s=e.value;this.cellLabelChanged(e,t,this.isAutoSizeCell(e)),this.fireEvent(new EventObject(InternalEvent.LABEL_CHANGED,{cell:e,value:t,old:s,event:i}))}),e},cellLabelChanged(e,t,i=!1){this.batchUpdate(()=>{this.getDataModel().setValue(e,t),i&&this.cellSizeUpdated(e,!1)})},isEditing(e=null){let t=this.getPlugin("CellEditorHandler"),i=null==t?void 0:t.getEditingCell();return e?e===i:!!i},isCellEditable(e){return this.isCellsEditable()&&!this.isCellLocked(e)&&(this.getCurrentCellStyle(e).editable??!0)},isCellsEditable(){return this.cellsEditable},setCellsEditable(e){this.cellsEditable=e}},EventsMixin={lastTouchEvent:null,doubleClickCounter:0,lastTouchCell:null,fireDoubleClick:null,tapAndHoldThread:null,lastMouseX:null,lastMouseY:null,isMouseTrigger:null,ignoreMouseEvents:null,mouseMoveRedirect:null,mouseUpRedirect:null,lastEvent:null,escapeEnabled:!0,invokesStopCellEditing:!0,enterStopsCellEditing:!1,isMouseDown:!1,nativeDblClickEnabled:!0,doubleTapEnabled:!0,doubleTapTimeout:500,doubleTapTolerance:25,lastTouchX:0,lastTouchY:0,lastTouchTime:0,tapAndHoldEnabled:!0,tapAndHoldDelay:500,tapAndHoldInProgress:!1,tapAndHoldValid:!1,initialTouchX:0,initialTouchY:0,tolerance:4,isNativeDblClickEnabled(){return this.nativeDblClickEnabled},getEventTolerance(){return this.tolerance},setEventTolerance(e){this.tolerance=e},escape(e){this.fireEvent(new EventObject(InternalEvent.ESCAPE,{event:e}))},click(e){let t=e.getEvent(),i=e.getCell(),s=new EventObject(InternalEvent.CLICK,{event:t,cell:i});if(e.isConsumed()&&s.consume(),this.fireEvent(s),this.isEnabled()&&!isConsumed(t)&&!s.isConsumed()){if(i){if(this.isTransparentClickEvent(t)){let t=!1,s=this.getCellAt(e.graphX,e.graphY,null,!1,!1,e=>{let s=this.isCellSelected(e.cell);return!(t=t||s)||s||e.cell!==i&&e.cell.isAncestor(i)});s&&(i=s)}}else if(this.isSwimlaneSelectionEnabled()&&null!=(i=this.getSwimlaneAt(e.getGraphX(),e.getGraphY()))&&(!this.isToggleEvent(t)||!isAltDown(t))){let e=i,s=[];for(;null!=e;){e=e.getParent();let t=this.getView().getState(e);this.isSwimlane(e)&&null!=t&&s.push(e)}if(s.length>0){(s=s.reverse()).splice(0,0,i),s.push(i);for(let e=0;e<s.length-1;e+=1)this.isCellSelected(s[e])&&(i=s[this.isToggleEvent(t)?e:e+1])}}i?this.selectCellForEvent(i,t):this.isToggleEvent(t)||this.clearSelection()}return!1},dblClick(e,t=null){let i=new EventObject(InternalEvent.DOUBLE_CLICK,{event:e,cell:t});this.fireEvent(i),this.isEnabled()&&!isConsumed(e)&&!i.isConsumed()&&t&&this.isCellEditable(t)&&!this.isEditing(t)&&(this.startEditingAtCell(t,e),InternalEvent.consume(e))},tapAndHold(e){let t=e.getEvent(),i=new EventObject(InternalEvent.TAP_AND_HOLD,{event:t,cell:e.getCell()}),s=this.getPlugin("PanningHandler"),n=this.getPlugin("ConnectionHandler");if(this.fireEvent(i),i.isConsumed()&&s&&(s.panningTrigger=!1),this.isEnabled()&&!isConsumed(t)&&!i.isConsumed()&&n&&n.isEnabled()){let t=n.marker.getCell(e);if(t){let i=this.getView().getState(t);i&&(n.marker.currentColor=n.marker.validColor,n.marker.markedState=i,n.marker.mark(),n.first=new Point(e.getGraphX(),e.getGraphY()),n.edgeState=n.createEdgeState(e),n.previous=i,n.fireEvent(new EventObject(InternalEvent.START,{state:n.previous})))}}},addMouseListener(e){this.mouseListeners.push(e)},removeMouseListener(e){for(let t=0;t<this.mouseListeners.length;t+=1)if(this.mouseListeners[t]===e){this.mouseListeners.splice(t,1);break}},updateMouseEvent(e,t){let i=convertPoint(this.getContainer(),e.getX(),e.getY());if(e.graphX=i.x-this.getPanDx(),e.graphY=i.y-this.getPanDy(),!e.getCell()&&this.isMouseDown&&t===InternalEvent.MOUSE_MOVE){let t=this.getCellAt(i.x,i.y,null,!0,!0,e=>!e.shape||e.shape.paintBackground!==this.paintBackground||e.style.pointerEvents||e.shape.fill!==NONE);e.state=t?this.getView().getState(t):null}return e},getStateForTouchEvent(e){let t=getClientX(e),i=getClientY(e),s=convertPoint(this.getContainer(),t,i),n=this.getCellAt(s.x,s.y);return n?this.getView().getState(n):null},isEventIgnored(e,t,i){let s=isMouseEvent(t.getEvent()),n=!1;t.getEvent()===this.lastEvent?n=!0:this.lastEvent=t.getEvent();let a=this.getEventSource();return a&&e!==InternalEvent.MOUSE_MOVE?(InternalEvent.removeGestureListeners(a,null,this.mouseMoveRedirect,this.mouseUpRedirect),this.mouseMoveRedirect=null,this.mouseUpRedirect=null,this.setEventSource(null)):!Client.IS_GC&&a&&t.getSource()!==a?n=!0:a&&Client.IS_TOUCH&&e===InternalEvent.MOUSE_DOWN&&!s&&!isPenEvent(t.getEvent())&&(this.setEventSource(t.getSource()),this.mouseMoveRedirect=e=>{this.fireMouseEvent(InternalEvent.MOUSE_MOVE,new InternalMouseEvent(e,this.getStateForTouchEvent(e)))},this.mouseUpRedirect=e=>{this.fireMouseEvent(InternalEvent.MOUSE_UP,new InternalMouseEvent(e,this.getStateForTouchEvent(e)))},InternalEvent.addGestureListeners(a,null,this.mouseMoveRedirect,this.mouseUpRedirect)),this.isSyntheticEventIgnored(e,t,i)&&(n=!0),!isPopupTrigger(this.lastEvent)&&e!==InternalEvent.MOUSE_MOVE&&2===this.lastEvent.detail||(e===InternalEvent.MOUSE_UP&&this.isMouseDown?this.isMouseDown=!1:e!==InternalEvent.MOUSE_DOWN||this.isMouseDown?n||(Client.IS_FF&&e===InternalEvent.MOUSE_MOVE||!this.isMouseDown||this.isMouseTrigger===s)&&(e!==InternalEvent.MOUSE_DOWN||!this.isMouseDown)&&(e!==InternalEvent.MOUSE_UP||this.isMouseDown)||(n=!0):(this.isMouseDown=!0,this.isMouseTrigger=s),n||e!==InternalEvent.MOUSE_DOWN||(this.lastMouseX=t.getX(),this.lastMouseY=t.getY()),n)},isSyntheticEventIgnored(e,t,i){let s=!1,n=isMouseEvent(t.getEvent());return this.ignoreMouseEvents&&n&&e!==InternalEvent.MOUSE_MOVE?(this.ignoreMouseEvents=e!==InternalEvent.MOUSE_UP,s=!0):Client.IS_FF&&!n&&e===InternalEvent.MOUSE_UP&&(this.ignoreMouseEvents=!0),s},isEventSourceIgnored(e,t){let i=t.getSource();if(!i)return!0;let s=i.nodeName?i.nodeName.toLowerCase():"",n=!isMouseEvent(t.getEvent())||isLeftMouseButton(t.getEvent());return e===InternalEvent.MOUSE_DOWN&&n&&("select"===s||"option"===s||"input"===s&&"checkbox"!==i.type&&"radio"!==i.type&&"button"!==i.type&&"submit"!==i.type&&"file"!==i.type)},getEventState:e=>e,fireMouseEvent(e,t,i){if(i=i??this,this.isEventSourceIgnored(e,t)){let e=this.getPlugin("TooltipHandler");e&&e.hide();return}if(t=this.updateMouseEvent(t,e),!this.nativeDblClickEnabled&&!isPopupTrigger(t.getEvent())||this.doubleTapEnabled&&Client.IS_TOUCH&&(isTouchEvent(t.getEvent())||isPenEvent(t.getEvent()))){let i=new Date().getTime();if(e===InternalEvent.MOUSE_DOWN)if(this.lastTouchEvent&&this.lastTouchEvent!==t.getEvent()&&i-this.lastTouchTime<this.doubleTapTimeout&&Math.abs(this.lastTouchX-t.getX())<this.doubleTapTolerance&&Math.abs(this.lastTouchY-t.getY())<this.doubleTapTolerance&&this.doubleClickCounter<2){this.doubleClickCounter+=1;let i=!1;if(e===InternalEvent.MOUSE_UP){if(t.getCell()===this.lastTouchCell&&this.lastTouchCell){this.lastTouchTime=0;let e=this.lastTouchCell;this.lastTouchCell=null,this.dblClick(t.getEvent(),e),i=!0}}else this.fireDoubleClick=!0,this.lastTouchTime=0;if(i){InternalEvent.consume(t.getEvent());return}}else this.lastTouchEvent&&this.lastTouchEvent===t.getEvent()||(this.lastTouchCell=t.getCell(),this.lastTouchX=t.getX(),this.lastTouchY=t.getY(),this.lastTouchTime=i,this.lastTouchEvent=t.getEvent(),this.doubleClickCounter=0);else if((this.isMouseDown||e===InternalEvent.MOUSE_UP)&&this.fireDoubleClick){this.fireDoubleClick=!1;let e=this.lastTouchCell;this.lastTouchCell=null,this.isMouseDown=!1,(e||(isTouchEvent(t.getEvent())||isPenEvent(t.getEvent()))&&(Client.IS_GC||Client.IS_SF))&&Math.abs(this.lastTouchX-t.getX())<this.doubleTapTolerance&&Math.abs(this.lastTouchY-t.getY())<this.doubleTapTolerance?this.dblClick(t.getEvent(),e):InternalEvent.consume(t.getEvent());return}}if(!this.isEventIgnored(e,t,i)){let s=t.getState();if(t.state=s?this.getEventState(s):null,this.fireEvent(new EventObject(InternalEvent.FIRE_MOUSE_EVENT,{eventName:e,event:t})),Client.IS_SF||Client.IS_GC||t.getEvent().target!==this.getContainer()){let s=this.getContainer();if(e===InternalEvent.MOUSE_MOVE&&this.isMouseDown&&this.isAutoScroll()&&!isMultiTouchEvent(t.getEvent()))this.scrollPointToVisible(t.getGraphX(),t.getGraphY(),this.isAutoExtend());else if(e===InternalEvent.MOUSE_UP&&this.isIgnoreScrollbars()&&this.isTranslateToScrollPosition()&&(0!==s.scrollLeft||0!==s.scrollTop)){let e=this.getView().scale,t=this.getView().translate;this.getView().setTranslate(t.x-s.scrollLeft/e,t.y-s.scrollTop/e),s.scrollLeft=0,s.scrollTop=0}let n=this.mouseListeners;for(let s of(t.getEvent().preventDefault||(t.getEvent().returnValue=!0),n))e===InternalEvent.MOUSE_DOWN?s.mouseDown(i,t):e===InternalEvent.MOUSE_MOVE?s.mouseMove(i,t):e===InternalEvent.MOUSE_UP&&s.mouseUp(i,t);e===InternalEvent.MOUSE_UP&&this.click(t)}if((isTouchEvent(t.getEvent())||isPenEvent(t.getEvent()))&&e===InternalEvent.MOUSE_DOWN&&this.tapAndHoldEnabled&&!this.tapAndHoldInProgress){this.tapAndHoldInProgress=!0,this.initialTouchX=t.getGraphX(),this.initialTouchY=t.getGraphY();let e=()=>{this.tapAndHoldValid&&this.tapAndHold(t),this.tapAndHoldInProgress=!1,this.tapAndHoldValid=!1};this.tapAndHoldThread&&window.clearTimeout(this.tapAndHoldThread),this.tapAndHoldThread=window.setTimeout(e,this.tapAndHoldDelay),this.tapAndHoldValid=!0}else e===InternalEvent.MOUSE_UP?(this.tapAndHoldInProgress=!1,this.tapAndHoldValid=!1):this.tapAndHoldValid&&(this.tapAndHoldValid=Math.abs(this.initialTouchX-t.getGraphX())<this.tolerance&&Math.abs(this.initialTouchY-t.getGraphY())<this.tolerance);let n=this.getPlugin("CellEditorHandler");e===InternalEvent.MOUSE_DOWN&&this.isEditing()&&!(null==n?void 0:n.isEventSource(t.getEvent()))&&this.stopEditing(!this.isInvokesStopCellEditing()),this.consumeMouseEvent(e,t,i)}},consumeMouseEvent(e,t,i){e===InternalEvent.MOUSE_DOWN&&isTouchEvent(t.getEvent())&&t.consume(!1)},fireGestureEvent(e,t=null){this.lastTouchTime=0,this.fireEvent(new EventObject(InternalEvent.GESTURE,{event:e,cell:t}))},sizeDidChange(){let e=this.getGraphBounds(),t=this.getBorder(),i=Math.max(0,e.x)+e.width+2*t,s=Math.max(0,e.y)+e.height+2*t,n=this.getMinimumContainerSize();if(n&&(i=Math.max(i,n.width),s=Math.max(s,n.height)),this.isResizeContainer()&&this.doResizeContainer(i,s),this.isPreferPageSize()||this.isPageVisible()){let t=this.getPreferredPageSize(e,Math.max(1,i),Math.max(1,s));i=t.width*this.getView().scale,s=t.height*this.getView().scale}let a=this.getMinimumGraphSize();a&&(i=Math.max(i,a.width*this.getView().scale),s=Math.max(s,a.height*this.getView().scale)),i=Math.ceil(i),s=Math.ceil(s);let l=this.getView().getDrawPane().ownerSVGElement;l&&(l.style.minWidth=`${Math.max(1,i)}px`,l.style.minHeight=`${Math.max(1,s)}px`,l.style.width="100%",l.style.height="100%"),this.updatePageBreaks(this.isPageBreaksVisible(),i,s),this.fireEvent(new EventObject(InternalEvent.SIZE,{bounds:e}))},isCloneEvent:e=>isControlDown(e),isTransparentClickEvent:e=>!1,isToggleEvent:e=>Client.IS_MAC?isMetaDown(e):isControlDown(e),isGridEnabledEvent:e=>!isAltDown(e),isConstrainedEvent:e=>isShiftDown(e),isIgnoreTerminalEvent:e=>!1,getPointForEvent(e,t=!0){let i=convertPoint(this.getContainer(),getClientX(e),getClientY(e)),s=this.getView().scale,n=this.getView().translate,a=t?this.getGridSize()/2:0;return i.x=this.snap(i.x/s-n.x-a),i.y=this.snap(i.y/s-n.y-a),i},isEscapeEnabled(){return this.escapeEnabled},setEscapeEnabled(e){this.escapeEnabled=e},isInvokesStopCellEditing(){return this.invokesStopCellEditing},setInvokesStopCellEditing(e){this.invokesStopCellEditing=e},isEnterStopsCellEditing(){return this.enterStopsCellEditing},setEnterStopsCellEditing(e){this.enterStopsCellEditing=e},getCursorForMouseEvent(e){let t=e.getCell();return t?this.getCursorForCell(t):null}},FoldingMixin={collapseExpandResource:isI18nEnabled()?"collapse-expand":"",getCollapseExpandResource(){return this.collapseExpandResource},isFoldingEnabled(){return this.options.foldingEnabled},getFoldableCells(e,t=!1){return this.getDataModel().filterCells(e,e=>this.isCellFoldable(e,t))},isCellFoldable(e,t){return e.getChildCount()>0&&(this.getCurrentCellStyle(e).foldable??!0)},getFoldingImage(e){if(null!=e&&this.isFoldingEnabled()&&!e.cell.isEdge()){let t=e.cell.isCollapsed();if(this.isCellFoldable(e.cell,!t))return t?this.options.collapsedImage:this.options.expandedImage}return null},foldCells(e=!1,t=!1,i=null,s=!1,n=null){return null==i&&(i=this.getFoldableCells(this.getSelectionCells(),e)),this.stopEditing(!1),this.batchUpdate(()=>{this.cellsFolded(i,e,t,s),this.fireEvent(new EventObject(InternalEvent.FOLD_CELLS,"collapse",e,"recurse",t,"cells",i))}),i},cellsFolded(e=null,t=!1,i=!1,s=!1){null!=e&&e.length>0&&this.batchUpdate(()=>{for(let n=0;n<e.length;n+=1)if((!s||this.isCellFoldable(e[n],t))&&t!==e[n].isCollapsed()){if(this.getDataModel().setCollapsed(e[n],t),this.swapBounds(e[n],t),this.isExtendParent(e[n])&&this.extendParent(e[n]),i){let s=e[n].getChildren();this.cellsFolded(s,t,i)}this.constrainChild(e[n])}this.fireEvent(new EventObject(InternalEvent.CELLS_FOLDED,{cells:e,collapse:t,recurse:i}))})},swapBounds(e,t=!1){let i=e.getGeometry();null!=i&&(i=i.clone(),this.updateAlternateBounds(e,i,t),i.swap(),this.getDataModel().setGeometry(e,i))},updateAlternateBounds(e=null,t=null,i=!1){if(null!=e&&null!=t){let i=this.getCurrentCellStyle(e);if(null==t.alternateBounds){let s=t;if(this.options.collapseToPreferredSize){let t=this.getPreferredSizeForCell(e);if(null!=t){s=t;let e=i.startSize??0;e>0&&(s.height=Math.max(s.height,e))}}t.alternateBounds=new Rectangle(0,0,s.width,s.height)}if(null!=t.alternateBounds){t.alternateBounds.x=t.x,t.alternateBounds.y=t.y;let e=toRadians(i.rotation||0);if(0!==e){let i=t.alternateBounds.getCenterX()-t.getCenterX(),s=t.alternateBounds.getCenterY()-t.getCenterY(),n=Math.cos(e),a=Math.sin(e),l=n*i-a*s,r=a*i+n*s;t.alternateBounds.x+=l-i,t.alternateBounds.y+=r-s}}}}},GroupingMixin={groupCells(e,t=0,i){i||(i=sortCells(this.getSelectionCells(),!0)),i||(i=this.getCellsForGroup(i)),null==e&&(e=this.createGroupCell(i));let s=this.getBoundsForGroup(e,i,t);if(i.length>1&&null!=s){let n=e.getParent();null==n&&(n=i[0].getParent()),this.batchUpdate(()=>{null==e.getGeometry()&&this.getDataModel().setGeometry(e,new Geometry);let a=n.getChildCount();this.cellsAdded([e],n,a,null,null,!1,!1,!1),a=e.getChildCount(),this.cellsAdded(i,e,a,null,null,!1,!1,!1),this.cellsMoved(i,-s.x,-s.y,!1,!1,!1),this.cellsResized([e],[s],!1),this.fireEvent(new EventObject(InternalEvent.GROUP_CELLS,{group:e,border:t,cells:i}))})}return e},getCellsForGroup(e){let t=[];if(null!=e&&e.length>0){let i=e[0].getParent();t.push(e[0]);for(let s=1;s<e.length;s+=1)e[s].getParent()===i&&t.push(e[s])}return t},getBoundsForGroup(e,t,i){let s=this.getBoundingBoxFromGeometry(t,!0);if(null!=s){if(this.isSwimlane(e)){let t=this.getStartSize(e);s.x-=t.width,s.y-=t.height,s.width+=t.width,s.height+=t.height}null!=i&&(s.x-=i,s.y-=i,s.width+=2*i,s.height+=2*i)}return s},createGroupCell(e){let t=new Cell("");return t.setVertex(!0),t.setConnectable(!1),t},ungroupCells(e){let t=[];return null==e&&(e=this.getCellsForUngroup()),null!=e&&e.length>0&&this.batchUpdate(()=>{let i=e;for(let e=0;e<i.length;e+=1){let s=i[e].getChildren();if(null!=s&&s.length>0){s=s.slice();let n=i[e].getParent(),a=n.getChildCount();for(let e of(this.cellsAdded(s,n,a,null,null,!0),t=t.concat(s),s)){let t=this.getView().getState(e),i=e.getGeometry();null!=t&&null!=i&&i.relative&&((i=i.clone()).x=t.origin.x,i.y=t.origin.y,i.relative=!1,this.getDataModel().setGeometry(e,i))}}}this.removeCellsAfterUngroup(i),this.fireEvent(new EventObject(InternalEvent.UNGROUP_CELLS,{cells:e}))}),t},getCellsForUngroup(){let e=this.getSelectionCells(),t=[];for(let i=0;i<e.length;i+=1)e[i].isVertex()&&e[i].getChildCount()>0&&t.push(e[i]);return t},removeCellsAfterUngroup(e){this.cellsRemoved(this.addAllEdges(e))},removeCellsFromParent(e){return null==e&&(e=this.getSelectionCells()),this.batchUpdate(()=>{let t=this.getDefaultParent(),i=t.getChildCount();this.cellsAdded(e,t,i,null,null,!0),this.fireEvent(new EventObject(InternalEvent.REMOVE_CELLS_FROM_PARENT,{cells:e}))}),e},updateGroupBounds(e,t=0,i=!1,s=0,n=0,a=0,l=0){return null==e&&(e=this.getSelectionCells()),t=null!=t?t:0,i=null!=i&&i,s=null!=s?s:0,n=null!=n?n:0,a=null!=a?a:0,l=null!=l?l:0,this.batchUpdate(()=>{for(let r=e.length-1;r>=0;r--){let o=e[r].getGeometry();if(null==o)continue;let h=this.getChildCells(e[r]);if(null!=h&&h.length>0){let c=this.getBoundingBoxFromGeometry(h,!0);if(null!=c&&c.width>0&&c.height>0){let d=this.isSwimlane(e[r])?this.getActualStartSize(e[r],!0):new Rectangle;o=o.clone(),i&&(o.x=Math.round(o.x+c.x-t-d.x-l),o.y=Math.round(o.y+c.y-t-d.y-s)),o.width=Math.round(c.width+2*t+d.x+l+n+d.width),o.height=Math.round(c.height+2*t+d.y+s+a+d.height),this.getDataModel().setGeometry(e[r],o),this.moveCells(h,t+d.x-c.x+l,t+d.y-c.y+s)}}}}),e},enterGroup(e){null!=(e=e||this.getSelectionCell())&&this.isValidRoot(e)&&(this.getView().setCurrentRoot(e),this.clearSelection())},exitGroup(){let e=this.getDataModel().getRoot(),t=this.getCurrentRoot();if(null!=t){let i=t.getParent();for(;i!==e&&!this.isValidRoot(i)&&i.getParent()!==e;)i=i.getParent();i===e||i.getParent()===e?this.getView().setCurrentRoot(null):this.getView().setCurrentRoot(i),null!=this.getView().getState(t)&&this.setSelectionCell(t)}}},ImageMixin={addImageBundle(e){this.imageBundles.push(e)},removeImageBundle(e){let t=[];for(let i=0;i<this.imageBundles.length;i+=1)this.imageBundles[i]!==e&&t.push(this.imageBundles[i]);this.imageBundles=t},getImageFromBundles(e){if(e)for(let t=0;t<this.imageBundles.length;t+=1){let i=this.imageBundles[t].getImage(e);if(i)return i}return null}},LabelMixin={getLabel(e){let t="";return this.isLabelsVisible()&&null!=e&&(this.getCurrentCellStyle(e).noLabel||(t=this.convertValueToString(e))),t},isHtmlLabel(e){return this.isHtmlLabels()},labelsVisible:!0,isLabelsVisible(){return this.labelsVisible},htmlLabels:!1,isHtmlLabels(){return this.htmlLabels},setHtmlLabels(e){this.htmlLabels=e},isWrapping(e){return"wrap"===this.getCurrentCellStyle(e).whiteSpace},isLabelClipped(e){return"hidden"===this.getCurrentCellStyle(e).overflow},isLabelMovable(e){return!this.isCellLocked(e)&&(e.isEdge()&&this.isEdgeLabelsMovable()||e.isVertex()&&this.isVertexLabelsMovable())}},OrderMixin={orderCells(e=!1,t){return t||(t=this.getSelectionCells()),t||(t=sortCells(this.getSelectionCells(),!0)),this.batchUpdate(()=>{this.cellsOrdered(t,e);let i=new EventObject(InternalEvent.ORDER_CELLS,"back",e,"cells",t);this.fireEvent(i)}),t},cellsOrdered(e,t=!1){this.batchUpdate(()=>{for(let i=0;i<e.length;i+=1){let s=e[i].getParent();t?this.getDataModel().add(s,e[i],i):this.getDataModel().add(s,e[i],s?s.getChildCount()-1:0)}this.fireEvent(new EventObject(InternalEvent.CELLS_ORDERED,{back:t,cells:e}))})}};class CellOverlay extends EventSource{constructor(e,t=null,i="right",s="bottom",n=new Point,a="help"){super(),this.align="right",this.verticalAlign="bottom",this.offset=new Point,this.cursor="help",this.defaultOverlap=.5,this.image=e,this.tooltip=t,this.align=i,this.verticalAlign=s,this.offset=n,this.cursor=a}getBounds(e){let t=e.cell.isEdge(),i=e.view.scale,s=null,n=this.image,a=n.width,l=n.height;if(t){let t=e.absolutePoints;if(t.length%2==1)s=t[Math.floor(t.length/2)];else{let e=t.length/2,i=t[e-1],n=t[e];s=new Point(i.x+(n.x-i.x)/2,i.y+(n.y-i.y)/2)}}else{if(s=new Point,"left"===this.align)s.x=e.x;else if("center"===this.align)s.x=e.x+e.width/2;else if("right"===this.align)s.x=e.x+e.width;else throw Error();if("top"===this.verticalAlign)s.y=e.y;else if("middle"===this.verticalAlign)s.y=e.y+e.height/2;else if("bottom"===this.verticalAlign)s.y=e.y+e.height;else throw Error()}return new Rectangle(Math.round(s.x-(a*this.defaultOverlap-this.offset.x)*i),Math.round(s.y-(l*this.defaultOverlap-this.offset.y)*i),a*i,l*i)}toString(){return this.tooltip}}let OverlaysMixin={addCellOverlay(e,t){e.overlays.push(t);let i=this.getView().getState(e);return i&&this.getCellRenderer().redraw(i),this.fireEvent(new EventObject(InternalEvent.ADD_OVERLAY,{cell:e,overlay:t})),t},getCellOverlays:e=>e.overlays,removeCellOverlay(e,t=null){if(t){let i=e.overlays.indexOf(t);if(i>=0){e.overlays.splice(i,1);let s=this.getView().getState(e);s&&this.getCellRenderer().redraw(s),this.fireEvent(new EventObject(InternalEvent.REMOVE_OVERLAY,{cell:e,overlay:t}))}else t=null}else this.removeCellOverlays(e);return t},removeCellOverlays(e){let{overlays:t}=e;e.overlays=[];let i=this.getView().getState(e);i&&this.getCellRenderer().redraw(i);for(let i=0;i<t.length;i+=1)this.fireEvent(new EventObject(InternalEvent.REMOVE_OVERLAY,"cell",e,"overlay",t[i]));return t},clearCellOverlays(e=null){if(!(e=e??this.getDataModel().getRoot()))return;this.removeCellOverlays(e);let t=e.getChildCount();for(let i=0;i<t;i+=1){let t=e.getChildAt(i);this.clearCellOverlays(t)}},setCellWarning(e,t=null,i,s=!1){if(i=i??this.getWarningImage(),t&&t.length>0){let n=new CellOverlay(i,`<font color=red>${t}</font>`);return s&&n.addListener(InternalEvent.CLICK,(t,i)=>{this.isEnabled()&&this.setSelectionCell(e)}),this.addCellOverlay(e,n)}return this.removeCellOverlays(e),null}},PageBreaksMixin={horizontalPageBreaks:null,verticalPageBreaks:null,updatePageBreaks(e,t,i){let{scale:s,translate:n}=this.getView(),a=this.getPageFormat(),l=s*this.getPageScale(),r=new Rectangle(0,0,a.width*l,a.height*l),o=Rectangle.fromRectangle(this.getGraphBounds());o.width=Math.max(1,o.width),o.height=Math.max(1,o.height),r.x=Math.floor((o.x-n.x*s)/r.width)*r.width+n.x*s,r.y=Math.floor((o.y-n.y*s)/r.height)*r.height+n.y*s,o.width=Math.ceil((o.width+(o.x-r.x))/r.width)*r.width,o.height=Math.ceil((o.height+(o.y-r.y))/r.height)*r.height;let h=(e=e&&Math.min(r.width,r.height)>this.getMinPageBreakDist())?Math.ceil(o.height/r.height)+1:0,c=e?Math.ceil(o.width/r.width)+1:0,d=(c-1)*r.width,u=(h-1)*r.height;null==this.horizontalPageBreaks&&h>0&&(this.horizontalPageBreaks=[]),null==this.verticalPageBreaks&&c>0&&(this.verticalPageBreaks=[]);let p=e=>{if(null!=e){let t=e===this.horizontalPageBreaks?h:c;for(let i=0;i<=t;i+=1){let t=e===this.horizontalPageBreaks?[new Point(Math.round(r.x),Math.round(r.y+i*r.height)),new Point(Math.round(r.x+d),Math.round(r.y+i*r.height))]:[new Point(Math.round(r.x+i*r.width),Math.round(r.y)),new Point(Math.round(r.x+i*r.width),Math.round(r.y+u))];if(null!=e[i])e[i].points=t,e[i].redraw();else{let s=new PolylineShape(t,this.getPageBreakColor());s.dialect=this.getDialect(),s.pointerEvents=!1,s.isDashed=this.isPageBreakDashed(),s.init(this.getView().backgroundPane),s.redraw(),e[i]=s}}for(let i=t;i<e.length;i+=1)e[i].destroy();e.splice(t,e.length-t)}};p(this.horizontalPageBreaks),p(this.verticalPageBreaks)}},PanningMixin={shiftPreview1:null,shiftPreview2:null,useScrollbarsForPanning:!0,isUseScrollbarsForPanning(){return this.useScrollbarsForPanning},timerAutoScroll:!1,isTimerAutoScroll(){return this.timerAutoScroll},allowAutoPanning:!1,isAllowAutoPanning(){return this.allowAutoPanning},panDx:0,getPanDx(){return this.panDx},setPanDx(e){this.panDx=e},panDy:0,getPanDy(){return this.panDy},setPanDy(e){this.panDy=e},panGraph(e,t){let i=this.getContainer();if(this.useScrollbarsForPanning&&hasScrollbars(i))i.scrollLeft=-e,i.scrollTop=-t;else{let s=this.getView().getCanvas();if(0===e&&0===t){if(s.removeAttribute("transform"),this.shiftPreview1){let e=this.shiftPreview1.firstChild;for(;e;){let t=e.nextSibling;i.appendChild(e),e=t}this.shiftPreview1.parentNode&&this.shiftPreview1.parentNode.removeChild(this.shiftPreview1),this.shiftPreview1=null,i.appendChild(s.parentNode);let t=this.shiftPreview2;for(e=t.firstChild;e;){let t=e.nextSibling;i.appendChild(e),e=t}t.parentNode&&t.parentNode.removeChild(t),this.shiftPreview2=null}}else{if(s.setAttribute("transform",`translate(${e},${t})`),!this.shiftPreview1){this.shiftPreview1=document.createElement("div"),this.shiftPreview1.style.position="absolute",this.shiftPreview1.style.overflow="visible",this.shiftPreview2=document.createElement("div"),this.shiftPreview2.style.position="absolute",this.shiftPreview2.style.overflow="visible";let e=this.shiftPreview1,t=i.firstChild;for(;t;){let i=t.nextSibling;t!==s.parentNode?e.appendChild(t):e=this.shiftPreview2,t=i}this.shiftPreview1.firstChild&&i.insertBefore(this.shiftPreview1,s.parentNode),this.shiftPreview2.firstChild&&i.appendChild(this.shiftPreview2)}this.shiftPreview1.style.left=`${e}px`,this.shiftPreview1.style.top=`${t}px`,this.shiftPreview2&&(this.shiftPreview2.style.left=`${e}px`,this.shiftPreview2.style.top=`${t}px`)}this.panDx=e,this.panDy=t,this.fireEvent(new EventObject(InternalEvent.PAN))}},scrollCellToVisible(e,t=!1){let i=-this.getView().translate.x,s=-this.getView().translate.y,n=this.getView().getState(e);if(n){let e=new Rectangle(i+n.x,s+n.y,n.width,n.height);if(t&&this.getContainer()){let t=this.getContainer().clientWidth,i=this.getContainer().clientHeight;e.x=e.getCenterX()-t/2,e.width=t,e.y=e.getCenterY()-i/2,e.height=i}let a=new Point(this.getView().translate.x,this.getView().translate.y);if(this.scrollRectToVisible(e)){let e=new Point(this.getView().translate.x,this.getView().translate.y);this.getView().translate.x=a.x,this.getView().translate.y=a.y,this.getView().setTranslate(e.x,e.y)}}},scrollRectToVisible(e){let t=!1,i=this.getContainer(),s=i.offsetWidth,n=i.offsetHeight,a=Math.min(s,e.width),l=Math.min(n,e.height);if(hasScrollbars(i)){e.x+=this.getView().translate.x,e.y+=this.getView().translate.y;let t=i.scrollLeft-e.x,s=Math.max(t-i.scrollLeft,0);t>0?i.scrollLeft-=t+2:(t=e.x+a-i.scrollLeft-i.clientWidth)>0&&(i.scrollLeft+=t+2);let n=i.scrollTop-e.y,r=Math.max(0,n-i.scrollTop);n>0?i.scrollTop-=n+2:(n=e.y+l-i.scrollTop-i.clientHeight)>0&&(i.scrollTop+=n+2),this.useScrollbarsForPanning||0==s&&0==r||this.getView().setTranslate(s,r)}else{let i=-this.getView().translate.x,r=-this.getView().translate.y,o=this.getView().scale;if(e.x+a>i+s&&(this.getView().translate.x-=(e.x+a-s-i)/o,t=!0),e.y+l>r+n&&(this.getView().translate.y-=(e.y+l-n-r)/o,t=!0),e.x<i&&(this.getView().translate.x+=(i-e.x)/o,t=!0),e.y<r&&(this.getView().translate.y+=(r-e.y)/o,t=!0),t){this.getView().refresh();let e=this.getPlugin("SelectionCellsHandler");e&&e.refresh()}}return t},setPanning(e){let t=this.getPlugin("PanningHandler");t&&(t.panningEnabled=e)}},PortsMixin={portsEnabled:!0,isPort:e=>!1,getTerminalForPort:(e,t=!1)=>e.getParent(),isPortsEnabled(){return this.portsEnabled},setPortsEnabled(e){this.portsEnabled=e}},SelectionMixin={selectionModel:null,getSelectionModel(){return this.selectionModel},setSelectionModel(e){this.selectionModel=e},isCellSelected(e){return this.selectionModel.isSelected(e)},isSelectionEmpty(){return this.selectionModel.isEmpty()},clearSelection(){this.selectionModel.clear()},getSelectionCount(){return this.selectionModel.cells.length},getSelectionCell(){return this.selectionModel.cells[0]},getSelectionCells(){return this.selectionModel.cells.slice()},setSelectionCell(e){this.selectionModel.setCell(e)},setSelectionCells(e){this.selectionModel.setCells(e)},addSelectionCell(e){this.selectionModel.addCell(e)},addSelectionCells(e){this.selectionModel.addCells(e)},removeSelectionCell(e){this.selectionModel.removeCell(e)},removeSelectionCells(e){this.selectionModel.removeCells(e)},selectRegion(e,t){let i=this.getCells(e.x,e.y,e.width,e.height);return this.selectCellsForEvent(i,t),i},selectNextCell(){this.selectCell(!0)},selectPreviousCell(){this.selectCell()},selectParentCell(){this.selectCell(!1,!0)},selectChildCell(){this.selectCell(!1,!1,!0)},selectCell(e=!1,t=!1,i=!1){let s=this.selectionModel.cells.length>0?this.selectionModel.cells[0]:null;this.selectionModel.cells.length>1&&this.selectionModel.clear();let n=s?s.getParent():this.getDefaultParent(),a=n.getChildCount();if(!s&&a>0){let e=n.getChildAt(0);this.setSelectionCell(e)}else if(n&&(!s||t)&&this.getView().getState(n)&&n.getGeometry())this.getCurrentRoot()!==n&&this.setSelectionCell(n);else if(s&&i){if(s.getChildCount()>0){let e=s.getChildAt(0);this.setSelectionCell(e)}}else if(a>0){let t=n.getIndex(s);if(e){t++;let e=n.getChildAt(t%a);this.setSelectionCell(e)}else{let e=--t<0?a-1:t,i=n.getChildAt(e);this.setSelectionCell(i)}}},selectAll(e,t=!1){e=e??this.getDefaultParent();let i=t?e.filterDescendants(t=>t!==e&&!!this.getView().getState(t)):e.getChildren();this.setSelectionCells(i)},selectVertices(e,t=!1){this.selectCells(!0,!1,e,t)},selectEdges(e){this.selectCells(!1,!0,e)},selectCells(e=!1,t=!1,i,s=!1){i=i??this.getDefaultParent();let n=i=>{let n=i.getParent();return!!this.getView().getState(i)&&((s||0===i.getChildCount())&&i.isVertex()&&e&&n&&!n.isEdge()||i.isEdge()&&t)},a=i.filterDescendants(n);this.setSelectionCells(a)},selectCellForEvent(e,t){let i=this.isCellSelected(e);this.isToggleEvent(t)?i?this.removeSelectionCell(e):this.addSelectionCell(e):i&&1===this.getSelectionCount()||this.setSelectionCell(e)},selectCellsForEvent(e,t){this.isToggleEvent(t)?this.addSelectionCells(e):this.setSelectionCells(e)},isSiblingSelected(e){let t=e.getParent(),i=t.getChildCount();for(let s=0;s<i;s+=1){let i=t.getChildAt(s);if(e!==i&&this.isCellSelected(i))return!0}return!1},getSelectionCellsForChanges(e,t=null){let i=new Dictionary,s=[],n=e=>{if(!i.get(e)&&this.getDataModel().contains(e))if(e.isEdge()||e.isVertex())i.put(e,!0),s.push(e);else{let t=e.getChildCount();for(let i=0;i<t;i+=1)n(e.getChildAt(i))}};for(let i=0;i<e.length;i+=1){let s=e[i];if(s.constructor!==RootChange&&(!t||!t(s))){let e=null;s instanceof ChildChange?e=s.child:s.cell&&s.cell instanceof Cell&&(e=s.cell),e&&n(e)}}return s},updateSelection(){let e=this.getSelectionCells(),t=[];for(let i of e)if(this.getDataModel().contains(i)&&i.isVisible()){let e=i.getParent();for(;e&&e!==this.getView().currentRoot;){if(e.isCollapsed()||!e.isVisible()){t.push(i);break}e=e.getParent()}}else t.push(i);this.removeSelectionCells(t)}},SnapMixin={snapTolerance:0,getSnapTolerance(){return this.snapTolerance},gridSize:10,gridEnabled:!0,snap(e){return this.gridEnabled&&(e=Math.round(e/this.gridSize)*this.gridSize),e},snapDelta(e,t,i=!1,s=!1,n=!1){let a=this.getView().translate,l=this.getView().scale;if(!i&&this.gridEnabled){let i=this.gridSize*l*.5;if(!s){let s=t.x-(this.snap(t.x/l-a.x)+a.x)*l;Math.abs(e.x-s)<i?e.x=0:e.x=this.snap(e.x/l)*l-s}if(!n){let s=t.y-(this.snap(t.y/l-a.y)+a.y)*l;Math.abs(e.y-s)<i?e.y=0:e.y=this.snap(e.y/l)*l-s}}else{let i=.5*l;if(!s){let s=t.x-(Math.round(t.x/l-a.x)+a.x)*l;Math.abs(e.x-s)<i?e.x=0:e.x=Math.round(e.x/l)*l-s}if(!n){let s=t.y-(Math.round(t.y/l-a.y)+a.y)*l;Math.abs(e.y-s)<i?e.y=0:e.y=Math.round(e.y/l)*l-s}}return e},isGridEnabled(){return this.gridEnabled},setGridEnabled(e){this.gridEnabled=e},getGridSize(){return this.gridSize},setGridSize(e){this.gridSize=e}},SwimlaneMixin={swimlaneSelectionEnabled:!0,swimlaneNesting:!0,swimlaneIndicatorColorAttribute:"fillColor",getSwimlane(e=null){for(;e&&!this.isSwimlane(e);)e=e.getParent();return e},getSwimlaneAt(e,t,i){if(!i&&((i=this.getCurrentRoot())||(i=this.getDataModel().getRoot())),i){let s=i.getChildCount();for(let n=0;n<s;n+=1){let s=i.getChildAt(n);if(s){let i=this.getSwimlaneAt(e,t,s);if(null!=i)return i;if(s.isVisible()&&this.isSwimlane(s)){let i=this.getView().getState(s);if(i&&this.intersects(i,e,t))return s}}}}return null},hitsSwimlaneContent(e,t,i){let s=this.getView().getState(e),n=this.getStartSize(e);if(s){let e=this.getView().getScale();if(t-=s.x,i-=s.y,n.width>0&&t>0&&t>n.width*e||n.height>0&&i>0&&i>n.height*e)return!0}return!1},getStartSize(e,t=!1){let i=new Rectangle,s=this.getCurrentCellStyle(e,t),n=s.startSize??DEFAULT_STARTSIZE;return s.horizontal??!0?i.height=n:i.width=n,i},getSwimlaneDirection(e){let t=e.direction??DIRECTION.EAST,i=e.flipH,s=e.flipV,n=3*!(e.horizontal??!0);t===DIRECTION.NORTH?n--:t===DIRECTION.WEST?n+=2:t===DIRECTION.SOUTH&&(n+=1);let a=mod(n,2);return i&&1===a&&(n+=2),s&&0===a&&(n+=2),[DIRECTION.NORTH,DIRECTION.EAST,DIRECTION.SOUTH,DIRECTION.WEST][mod(n,4)]},getActualStartSize(e,t=!1){let i=new Rectangle;if(this.isSwimlane(e,t)){let s=this.getCurrentCellStyle(e,t),n=s.startSize??DEFAULT_STARTSIZE,a=this.getSwimlaneDirection(s);a===DIRECTION.NORTH?i.y=n:a===DIRECTION.WEST?i.x=n:a===DIRECTION.SOUTH?i.height=n:i.width=n}return i},isSwimlane(e,t=!1){return!(!e||e.getParent()===this.getDataModel().getRoot()||e.isEdge())&&this.getCurrentCellStyle(e,t).shape===SHAPE.SWIMLANE},isValidDropTarget(e,t,i){return e&&(this.isSplitEnabled()&&this.isSplitTarget(e,t,i)||!e.isEdge()&&(this.isSwimlane(e)||e.getChildCount()>0&&!e.isCollapsed()))},getDropTarget(e,t,i=null,s=!1){if(!this.isSwimlaneNesting()){for(let t=0;t<e.length;t+=1)if(this.isSwimlane(e[t]))return null}let n=convertPoint(this.getContainer(),getClientX(t),getClientY(t));n.x-=this.getPanDx(),n.y-=this.getPanDy();let a=this.getSwimlaneAt(n.x,n.y);if(i){if(a){let e=a.getParent();for(;e&&this.isSwimlane(e)&&e!==i;)e=e.getParent();e===i&&(i=a)}}else i=a;for(;i&&!this.isValidDropTarget(i,e,t)&&!this.getDataModel().isLayer(i);)i=i.getParent();let l=i;if(!s)for(;l&&0>e.indexOf(l);)l=l.getParent();return this.getDataModel().isLayer(i)||l?null:i},isSwimlaneNesting(){return this.swimlaneNesting},setSwimlaneNesting(e){this.swimlaneNesting=e},isSwimlaneSelectionEnabled(){return this.swimlaneSelectionEnabled},setSwimlaneSelectionEnabled(e){this.swimlaneSelectionEnabled=e}},TerminalMixin={isTerminalPointMovable:(e,t)=>!0,getOpposites(e,t=null,i=!0,s=!0){let n=[],a=new Dictionary;for(let l=0;l<e.length;l+=1){let r=this.getView().getState(e[l]),o=r?r.getVisibleTerminal(!0):this.getView().getVisibleTerminal(e[l],!0),h=r?r.getVisibleTerminal(!1):this.getView().getVisibleTerminal(e[l],!1);o===t&&h&&h!==t&&s?a.get(h)||(a.put(h,!0),n.push(h)):h===t&&o&&o!==t&&i&&(a.get(o)||(a.put(o,!0),n.push(o)))}return n}},TooltipMixin={getTooltip(e,t,i,s){let n=null;if(e.control&&(t===e.control.node||t.parentNode===e.control.node)&&(n=htmlEntities(translate(n=this.getCollapseExpandResource())||n,!0).replace(/\\n/g,"<br>")),!n&&e.overlays&&e.overlays.visit((e,i)=>{n||t!==i.node&&t.parentNode!==i.node||(n=i.overlay?i.overlay.toString()??null:null)}),!n){let i=this.getPlugin("SelectionCellsHandler"),s=null==i?void 0:i.getHandler(e.cell);s&&"getTooltipForNode"in s&&"function"==typeof s.getTooltipForNode&&(n=s.getTooltipForNode(t))}return n||(n=this.getTooltipForCell(e.cell)),n},getTooltipForCell(e){let t=null;return e&&"getTooltip"in e?e.getTooltip():this.convertValueToString(e)},setTooltips(e){let t=this.getPlugin("TooltipHandler");null==t||t.setEnabled(e)}},ValidationMixin={validationAlert(e){alert(e)},isEdgeValid(e,t,i){return!this.getEdgeValidationError(e,t,i)},getEdgeValidationError(e=null,t=null,i=null){if(e&&!this.isAllowDanglingEdges()&&(!t||!i))return"";if(e&&!e.getTerminal(!0)&&!e.getTerminal(!1))return null;if(!this.isAllowLoops()&&t===i&&t||!this.isValidConnection(t,i))return"";if(t&&i){let s="";if(!this.isMultigraph()){let n=this.getDataModel().getEdgesBetween(t,i,!0);(n.length>1||1===n.length&&n[0]!==e)&&(s+=`${translate(this.getAlreadyConnectedResource())||this.getAlreadyConnectedResource()}
`)}let n=t.getDirectedEdgeCount(!0,e),a=i.getDirectedEdgeCount(!1,e);for(let l of this.multiplicities){let r=l.check(this,e,t,i,n,a);null!=r&&(s+=r)}let l=this.validateEdge(e,t,i);return null!=l&&(s+=l),s.length>0?s:null}return this.isAllowDanglingEdges()?null:""},validateEdge:(e=null,t=null,i=null)=>null,validateGraph(e=null,t){if(!(e=e??this.getDataModel().getRoot()))return"The root does not exist!";t=t??{};let i=!0,s=e.getChildCount();for(let n=0;n<s;n+=1){let s=e.getChildAt(n),a=t;this.isValidRoot(s)&&(a={});let l=this.validateGraph(s,a);l?this.setCellWarning(s,l.replace(/\n/g,"<br>")):this.setCellWarning(s,null),i=i&&null==l}let n="";e&&e.isCollapsed()&&!i&&(n+=`${translate(this.getContainsValidationErrorsResource())||this.getContainsValidationErrorsResource()}
`),e&&e.isEdge()?n+=this.getEdgeValidationError(e,e.getTerminal(!0),e.getTerminal(!1))||"":n+=this.getCellValidationError(e)||"";let a=this.validateCell(e,t);return null!=a&&(n+=a),null==e.getParent()&&this.getView().validate(),n.length>0||!i?n:null},getCellValidationError(e){let t=e.getDirectedEdgeCount(!0),i=e.getDirectedEdgeCount(!1),s=e.getValue(),n="";for(let e=0;e<this.multiplicities.length;e+=1){let a=this.multiplicities[e];a.source&&isNode(s,a.type,a.attr,a.value)&&(t>a.max||t<a.min)?n+=`${a.countError}
`:!a.source&&isNode(s,a.type,a.attr,a.value)&&(i>a.max||i<a.min)&&(n+=`${a.countError}
`)}return n.length>0?n:null},validateCell:(e,t)=>null},VertexMixin={vertexLabelsMovable:!1,allowNegativeCoordinates:!0,isAllowNegativeCoordinates(){return this.allowNegativeCoordinates},setAllowNegativeCoordinates(e){this.allowNegativeCoordinates=e},insertVertex(...e){var t,i,s,n;let a,l,r,o,h,c,d,u,p,g;if(1===e.length&&"object"==typeof e[0]){let m=e[0];a=m.parent,l=m.id,r=m.value,o="x"in m?m.x:null==(t=m.position)?void 0:t[0],h="y"in m?m.y:null==(i=m.position)?void 0:i[1],c="width"in m?m.width:null==(s=m.size)?void 0:s[0],d="height"in m?m.height:null==(n=m.size)?void 0:n[1],u=m.style,p=m.relative,g=m.geometryClass}else[a,l,r,o,h,c,d,u,p,g]=e;let m=this.createVertex(a,l,r,o,h,c,d,u,p,g);return this.addCell(m,a)},createVertex(e,t,i,s,n,a,l,r,o=!1,h=Geometry){let c=new h(s,n,a,l);c.relative=o;let d=new Cell(i,c,r);return d.setId(t),d.setVertex(!0),d.setConnectable(!0),d},getChildVertices(e){return this.getChildCells(e,!0,!1)},isVertexLabelsMovable(){return this.vertexLabelsMovable},setVertexLabelsMovable(e){this.vertexLabelsMovable=e}},ZoomMixin={zoomFactor:1.2,keepSelectionVisibleOnZoom:!1,centerZoom:!0,zoomIn(){this.zoom(this.zoomFactor)},zoomOut(){this.zoom(1/this.zoomFactor)},zoomActual(){1===this.getView().scale?this.getView().setTranslate(0,0):(this.getView().translate.x=0,this.getView().translate.y=0,this.getView().setScale(1))},zoomTo(e,t=!1){this.zoom(e/this.getView().scale,t)},zoom(e,t){t=t??this.centerZoom;let i=Math.round(this.getView().scale*e*100)/100,s=this.getView().getState(this.getSelectionCell()),n=this.getContainer();if(e=i/this.getView().scale,this.keepSelectionVisibleOnZoom&&null!=s){let t=new Rectangle(s.x*e,s.y*e,s.width*e,s.height*e);this.getView().scale=i,this.scrollRectToVisible(t)||(this.getView().revalidate(),this.getView().setScale(i))}else{let s=hasScrollbars(this.getContainer());if(t&&!s){let t=n.offsetWidth,s=n.offsetHeight;if(e>1){let n=(e-1)/(2*i);t*=-n,s*=-n}else{let i=(1/e-1)/(2*this.getView().scale);t*=i,s*=i}this.getView().scaleAndTranslate(i,this.getView().translate.x+t,this.getView().translate.y+s)}else{let a=this.getView().translate.x,l=this.getView().translate.y,r=n.scrollLeft,o=n.scrollTop;if(this.getView().setScale(i),s){let i=0,s=0;t&&(i=n.offsetWidth*(e-1)/2,s=n.offsetHeight*(e-1)/2),n.scrollLeft=(this.getView().translate.x-a)*this.getView().scale+Math.round(r*e+i),n.scrollTop=(this.getView().translate.y-l)*this.getView().scale+Math.round(o*e+s)}}}},zoomToRect(e){let t=this.getContainer(),i=t.clientWidth/e.width/(t.clientHeight/e.height);e.x=Math.max(0,e.x),e.y=Math.max(0,e.y);let s=Math.min(t.scrollWidth,e.x+e.width),n=Math.min(t.scrollHeight,e.y+e.height);if(e.width=s-e.x,e.height=n-e.y,i<1){let s=e.height/i,a=(s-e.height)/2;e.height=s;let l=Math.min(e.y,a);e.y-=l,n=Math.min(t.scrollHeight,e.y+e.height),e.height=n-e.y}else{let n=e.width*i,a=(n-e.width)/2;e.width=n;let l=Math.min(e.x,a);e.x-=l,s=Math.min(t.scrollWidth,e.x+e.width),e.width=s-e.x}let a=t.clientWidth/e.width,l=this.getView().scale*a;hasScrollbars(this.getContainer())?(this.getView().setScale(l),t.scrollLeft=Math.round(e.x*a),t.scrollTop=Math.round(e.y*a)):this.getView().scaleAndTranslate(l,this.getView().translate.x-e.x/this.getView().scale,this.getView().translate.y-e.y/this.getView().scale)}},applyGraphMixins=e=>{let t=mixInto(e);for(let e of[CellsMixin,ConnectionsMixin,DragDropMixin,EdgeMixin,EditingMixin,EventsMixin,FoldingMixin,GroupingMixin,ImageMixin,LabelMixin,OrderMixin,PageBreaksMixin,OverlaysMixin,PanningMixin,PortsMixin,SelectionMixin,SnapMixin,SwimlaneMixin,TerminalMixin,TooltipMixin,ValidationMixin,VertexMixin,ZoomMixin])t(e)};class CellEditorHandler{constructor(e){this.clearOnChange=!1,this.bounds=null,this.resizeThread=null,this.textDirection=null,this.textarea=null,this.editingCell=null,this.trigger=null,this.modified=!1,this.autoSize=!0,this.selectText=!0,this.emptyLabelText=Client.IS_FF?"<br>":"",this.escapeCancelsEditing=!0,this.textNode=null,this.zIndex=5,this.minResize=new Rectangle(0,20),this.wordWrapPadding=0,this.blurEnabled=!1,this.initialValue=null,this.align=null,this.graph=e,this.zoomHandler=()=>{this.graph.isEditing()&&this.resize()},this.changeHandler=e=>{this.editingCell&&!this.graph.getView().getState(this.editingCell,!1)&&this.stopEditing(!0)},this.graph.getView().addListener(InternalEvent.SCALE,this.zoomHandler),this.graph.getView().addListener(InternalEvent.SCALE_AND_TRANSLATE,this.zoomHandler),this.graph.getDataModel().addListener(InternalEvent.CHANGE,this.changeHandler)}init(){this.textarea=document.createElement("div"),this.textarea.className="mxCellEditor mxPlainTextEditor",this.textarea.contentEditable=String(!0),Client.IS_GC&&(this.textarea.style.minHeight="1em"),this.textarea.style.position="absolute",this.installListeners(this.textarea)}applyValue(e,t){this.graph.labelChanged(e.cell,t,this.trigger)}setAlign(e){this.textarea&&(this.textarea.style.textAlign=e),this.align=e,this.resize()}getInitialValue(e,t){let i=htmlEntities(this.graph.getEditingValue(e.cell,t),!1);return(i=replaceTrailingNewlines(i,"<div><br></div>")).replace(/\n/g,"<br>")}getCurrentValue(e){return this.textarea?extractTextWithWhitespace(Array.from(this.textarea.childNodes)):null}isCancelEditingKeyEvent(e){return this.escapeCancelsEditing||isShiftDown(e)||isControlDown(e)||isMetaDown(e)}installListeners(e){InternalEvent.addListener(e,"dragstart",e=>{this.graph.stopEditing(!1),InternalEvent.consume(e)}),InternalEvent.addListener(e,"blur",e=>{this.blurEnabled&&this.focusLost()}),InternalEvent.addListener(e,"keydown",e=>{isConsumed(e)||(this.isStopEditingEvent(e)?(this.graph.stopEditing(!1),InternalEvent.consume(e)):27===e.keyCode&&(this.graph.stopEditing(this.isCancelEditingKeyEvent(e)),InternalEvent.consume(e)))});let t=t=>{null!=this.editingCell&&this.clearOnChange&&e.innerHTML===this.getEmptyLabelText()&&(!Client.IS_FF||8!==t.keyCode&&46!==t.keyCode)&&(this.clearOnChange=!1,e.innerHTML="")};InternalEvent.addListener(e,"keypress",t),InternalEvent.addListener(e,"paste",t);let i=e=>{if(null!=this.editingCell){let e=this.textarea;0===e.innerHTML.length||"<br>"===e.innerHTML?(e.innerHTML=this.getEmptyLabelText(),this.clearOnChange=e.innerHTML.length>0):this.clearOnChange=!1}};InternalEvent.addListener(e,"input",i),InternalEvent.addListener(e,"cut",i),InternalEvent.addListener(e,"paste",i);let s="input",n=e=>{null!=this.editingCell&&this.autoSize&&!isConsumed(e)&&(null!=this.resizeThread&&window.clearTimeout(this.resizeThread),this.resizeThread=window.setTimeout(()=>{this.resizeThread=null,this.resize()},0))};InternalEvent.addListener(e,s,n),InternalEvent.addListener(window,"resize",n),InternalEvent.addListener(e,"cut",n),InternalEvent.addListener(e,"paste",n)}isStopEditingEvent(e){return 113===e.keyCode||this.graph.isEnterStopsCellEditing()&&13===e.keyCode&&!isControlDown(e)&&!isShiftDown(e)}isEventSource(e){return getSource(e)===this.textarea}resize(){let e=this.editingCell?this.graph.getView().getState(this.editingCell):null;if(e){if(null!=this.textarea){let t=e.cell.isEdge(),{scale:i}=this.graph.getView(),s=null;if(this.autoSize&&"fill"!==e.style.overflow){let n=e.style.labelWidth??null;if(null==(s=null!=e.text&&null==this.align?e.text.margin:null)&&(s=getAlignmentAsPoint(this.align??e.style.align??ALIGN.CENTER,e.style.verticalAlign??ALIGN.MIDDLE)),t){if(this.bounds=new Rectangle(e.absoluteOffset.x,e.absoluteOffset.y,0,0),null!=n){let e=(n+2)*i;this.bounds.width=e,this.bounds.x+=s.x*e}}else{let t=Rectangle.fromRectangle(e),s=e.style.labelPosition??ALIGN.CENTER,a=e.style.verticalLabelPosition??ALIGN.MIDDLE;if(t=null!=e.shape&&"center"===s&&"middle"===a?e.shape.getLabelBounds(t):t,null!=n&&(t.width=n*i),!e.view.graph.cellRenderer.legacySpacing||"width"!==e.style.overflow){let l=new TextShape,r=(e.style.spacing??2)*i,o=((e.style.spacingTop??0)+l.baseSpacingTop)*i+r,h=((e.style.spacingRight??0)+l.baseSpacingRight)*i+r,c=((e.style.spacingBottom??0)+l.baseSpacingBottom)*i+r,d=((e.style.spacingLeft??0)+l.baseSpacingLeft)*i+r;s=null!=e.style.labelPosition?e.style.labelPosition:"center",a=null!=e.style.verticalLabelPosition?e.style.verticalLabelPosition:"middle",t=new Rectangle(t.x+d,t.y+o,t.width-(s===ALIGN.CENTER&&null==n?d+h:0),t.height-(a===ALIGN.MIDDLE?o+c:0))}this.bounds=new Rectangle(t.x+e.absoluteOffset.x,t.y+e.absoluteOffset.y,t.width,t.height)}if(this.graph.isWrapping(e.cell)&&(this.bounds.width>=2||this.bounds.height>=2)&&this.textarea.innerHTML!==this.getEmptyLabelText()){this.textarea.style.wordWrap=WORD_WRAP,this.textarea.style.whiteSpace="normal";let e=Math.round(this.bounds.width/i)+this.wordWrapPadding;"relative"!==this.textarea.style.position?(this.textarea.style.width=`${e}px`,this.textarea.scrollWidth>e&&(this.textarea.style.width=`${this.textarea.scrollWidth}px`)):this.textarea.style.maxWidth=`${e}px`}else this.textarea.style.whiteSpace="nowrap",this.textarea.style.width="";this.textarea.scrollWidth,this.textarea.scrollHeight,this.textarea.style.left=`${Math.max(0,Math.round(this.bounds.x-s.x*(this.bounds.width-2))+1)}px`,this.textarea.style.top=`${Math.max(0,Math.round(this.bounds.y-s.y*(this.bounds.height-4)+3*(-1===s.y))+1)}px`}else this.bounds=this.getEditorBounds(e),this.textarea.style.width=`${Math.round(this.bounds.width/i)}px`,this.textarea.style.height=`${Math.round(this.bounds.height/i)}px`,this.textarea.style.left=`${Math.max(0,Math.round(this.bounds.x+1))}px`,this.textarea.style.top=`${Math.max(0,Math.round(this.bounds.y+1))}px`,this.graph.isWrapping(e.cell)&&(this.bounds.width>=2||this.bounds.height>=2)&&this.textarea.innerHTML!==this.getEmptyLabelText()?(this.textarea.style.wordWrap=WORD_WRAP,this.textarea.style.whiteSpace="normal","fill"!==e.style.overflow&&(this.textarea.style.width=`${Math.round(this.bounds.width/i)+this.wordWrapPadding}px`)):(this.textarea.style.whiteSpace="nowrap","fill"!==e.style.overflow&&(this.textarea.style.width=""));setPrefixedStyle(this.textarea.style,"transformOrigin","0px 0px"),setPrefixedStyle(this.textarea.style,"transform",`scale(${i},${i})${null==s?"":` translate(${100*s.x}%,${100*s.y}%)`}`)}}else this.stopEditing(!0)}focusLost(){this.stopEditing(!this.graph.isInvokesStopCellEditing())}getBackgroundColor(e){return NONE}startEditing(e,t=null){this.stopEditing(!0),this.align=null,null==this.textarea&&this.init();let i=this.graph.getPlugin("TooltipHandler");null==i||i.hideTooltip();let s=this.graph.getView().getState(e);if(s){let{scale:i}=this.graph.getView(),n=s.style.fontSize??DEFAULT_FONTSIZE,a=s.style.fontFamily??DEFAULT_FONTFAMILY,l=s.style.fontColor??"black",r=s.style.align??ALIGN.LEFT,o=(s.style.fontStyle||0)&FONT.BOLD,h=(s.style.fontStyle||0)&FONT.ITALIC,c=[];(s.style.fontStyle||0)&FONT.UNDERLINE&&c.push("underline"),(s.style.fontStyle||0)&FONT.STRIKETHROUGH&&c.push("line-through");let d=this.textarea;d.style.lineHeight=String(LINE_HEIGHT),d.style.backgroundColor=this.getBackgroundColor(s)||"transparent",d.style.textDecoration=c.join(" "),d.style.fontWeight=o?"bold":"normal",d.style.fontStyle=h?"italic":"",d.style.fontSize=`${Math.round(n)}px`,d.style.zIndex=String(this.zIndex),d.style.fontFamily=a,d.style.textAlign=r,d.style.outline="none",d.style.color=l;let u=this.textDirection=s.style.textDirection??DEFAULT_TEXT_DIRECTION;"auto"===u&&(null===s.text||s.text.dialect===DIALECT.STRICTHTML||isNode(s.text.value)||(u=s.text.getAutoDirection())),"ltr"===u||"rtl"===u?d.setAttribute("dir",u):d.removeAttribute("dir"),d.innerHTML=this.getInitialValue(s,t)||"",this.initialValue=d.innerHTML,0===d.innerHTML.length||"<br>"===d.innerHTML?(d.innerHTML=this.getEmptyLabelText(),this.clearOnChange=!0):this.clearOnChange=d.innerHTML===this.getEmptyLabelText(),this.graph.container.appendChild(d),this.editingCell=e,this.trigger=t,this.textNode=null,null!==s.text&&this.isHideLabel(s)&&(this.textNode=s.text.node,this.textNode.style.visibility="hidden"),this.autoSize&&(s.cell.isEdge()||"fill"!==s.style.overflow)&&window.setTimeout(()=>{this.resize()},0),this.resize();try{d.focus(),this.isSelectText()&&d.innerHTML.length>0&&(d.innerHTML!==this.getEmptyLabelText()||!this.clearOnChange)&&document.execCommand("selectAll",!1)}catch(e){}}}isSelectText(){return this.selectText}stopEditing(e=!1){if(this.editingCell){this.textNode&&(this.textNode.style.visibility="visible",this.textNode=null);let t=e?null:this.graph.view.getState(this.editingCell),i=this.textarea,s=this.initialValue;if(this.initialValue=null,this.editingCell=null,this.bounds=null,i.blur(),clearSelection(),i.parentNode&&i.parentNode.removeChild(i),this.clearOnChange&&i.innerHTML===this.getEmptyLabelText()&&(i.innerHTML="",this.clearOnChange=!1),t&&(i.innerHTML!==s||null!==this.align)){this.prepareTextarea();let e=this.getCurrentValue(t);this.graph.batchUpdate(()=>{null!==e&&this.applyValue(t,e),null!==this.align&&this.graph.setCellStyles("align",this.align,[t.cell])})}this.trigger=null,this.textarea&&InternalEvent.release(this.textarea),this.textarea=null,this.align=null}}prepareTextarea(){let e=this.textarea;e.lastChild&&"BR"===e.lastChild.nodeName&&e.removeChild(e.lastChild)}isHideLabel(e=null){return!0}getMinimumSize(e){let{scale:t}=this.graph.getView(),i=this.textarea;return new Rectangle(0,0,null===e.text?30:e.text.size*t+20,"left"===i.style.textAlign?120:40)}getEditorBounds(e){let t=e.cell.isEdge(),{scale:i}=this.graph.getView(),s=this.getMinimumSize(e),n=s.width,a=s.height,l=null;if(!t&&e.view.graph.cellRenderer.legacySpacing&&"fill"===e.style.overflow)l=e.shape.getLabelBounds(Rectangle.fromRectangle(e));else{let s=new TextShape,r=(e.style.spacing??0)*i,o=((e.style.spacingTop??0)+s.baseSpacingTop)*i+r,h=((e.style.spacingRight??0)+s.baseSpacingRight)*i+r,c=((e.style.spacingBottom??0)+s.baseSpacingBottom)*i+r,d=((e.style.spacingLeft??0)+s.baseSpacingLeft)*i+r;l=new Rectangle(e.x,e.y,Math.max(n,e.width-d-h),Math.max(a,e.height-o-c));let u=null!=e.style.labelPosition?e.style.labelPosition:"center",p=null!=e.style.verticalLabelPosition?e.style.verticalLabelPosition:"middle";if(l=null!=e.shape&&"center"===u&&"middle"===p?e.shape.getLabelBounds(l):l,t?(l.x=e.absoluteOffset.x,l.y=e.absoluteOffset.y,null!=e.text&&null!=e.text.boundingBox&&(e.text.boundingBox.x>0&&(l.x=e.text.boundingBox.x),e.text.boundingBox.y>0&&(l.y=e.text.boundingBox.y))):null!=e.text&&null!=e.text.boundingBox&&(l.x=Math.min(l.x,e.text.boundingBox.x),l.y=Math.min(l.y,e.text.boundingBox.y)),l.x+=d,l.y+=o,null!=e.text&&null!=e.text.boundingBox&&(t?(l.width=Math.max(n,e.text.boundingBox.width),l.height=Math.max(a,e.text.boundingBox.height)):(l.width=Math.max(l.width,e.text.boundingBox.width),l.height=Math.max(l.height,e.text.boundingBox.height))),e.cell.isVertex()){let t=e.style.labelPosition??ALIGN.CENTER;"left"===t?l.x-=e.width:"right"===t&&(l.x+=e.width);let i=null!=e.style.verticalLabelPosition?e.style.verticalLabelPosition:"middle";"top"===i?l.y-=e.height:"bottom"===i&&(l.y+=e.height)}}return new Rectangle(Math.round(l.x),Math.round(l.y),Math.round(l.width),Math.round(l.height))}getEmptyLabelText(e=null){return this.emptyLabelText??""}getEditingCell(){return this.editingCell}onDestroy(){this.textarea&&(InternalEvent.release(this.textarea),this.textarea.parentNode&&this.textarea.parentNode.removeChild(this.textarea),this.textarea=null),this.graph.getDataModel().removeListener(this.changeHandler),this.graph.getView().removeListener(this.zoomHandler)}}CellEditorHandler.pluginId="CellEditorHandler";class TooltipHandler{init(){document.body&&(this.div=document.createElement("div"),this.div.className="mxTooltip",this.div.style.visibility="hidden",document.body.appendChild(this.div),InternalEvent.addGestureListeners(this.div,e=>{let t=getSource(e);t&&"A"!==t.nodeName&&this.hideTooltip()}),InternalEvent.addListener(this.graph.getContainer(),"mouseleave",e=>{this.div!==e.relatedTarget&&this.hide()}))}constructor(e){this.zIndex=10005,this.delay=500,this.ignoreTouchEvents=!0,this.hideOnHover=!1,this.destroyed=!1,this.lastX=0,this.lastY=0,this.state=null,this.stateSource=!1,this.thread=null,this.enabled=!1,this.graph=e,this.graph.addMouseListener(this)}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}isHideOnHover(){return this.hideOnHover}setHideOnHover(e){this.hideOnHover=e}getStateForEvent(e){return e.getState()}mouseDown(e,t){this.reset(t,!1),this.hideTooltip()}mouseMove(e,t){if(t.getX()!==this.lastX||t.getY()!==this.lastY){this.reset(t,!0);let e=this.getStateForEvent(t);(this.isHideOnHover()||e!==this.state||t.getSource()!==this.node&&(!this.stateSource||null!=e&&this.stateSource===(t.isSource(e.shape)||!t.isSource(e.text))))&&this.hideTooltip()}this.lastX=t.getX(),this.lastY=t.getY()}mouseUp(e,t){this.reset(t,!0),this.hideTooltip()}resetTimer(){this.thread&&(window.clearTimeout(this.thread),this.thread=null)}reset(e,t,i=null){if((!this.ignoreTouchEvents||isMouseEvent(e.getEvent()))&&(this.resetTimer(),i=i??this.getStateForEvent(e),t&&this.isEnabled()&&i&&(!this.div||"hidden"==this.div.style.visibility))){let t=e.getSource(),s=e.getX(),n=e.getY(),a=e.isSource(i.shape)||e.isSource(i.text),l=this.graph.getPlugin("PopupMenuHandler");this.thread=window.setTimeout(()=>{if(i&&t&&!this.graph.isEditing()&&l&&!l.isMenuShowing()&&!this.graph.isMouseDown){let e=this.graph.getTooltip(i,t,s,n);this.show(e,s,n),this.state=i,this.node=t,this.stateSource=a}},this.delay)}}hide(){this.resetTimer(),this.hideTooltip()}hideTooltip(){this.div&&(this.div.style.visibility="hidden",this.div.innerHTML="")}show(e,t,i){if(!this.destroyed&&e&&""!==e){let s=getScrollOrigin();this.div||this.init(),this.div.style.zIndex=String(this.zIndex),this.div.style.left=`${t+s.x}px`,this.div.style.top=`${i+TOOLTIP_VERTICAL_OFFSET+s.y}px`,isNode(e)?(this.div.innerHTML="",this.div.appendChild(e)):this.div.innerHTML=e.replace(/\n/g,"<br>"),this.div.style.visibility="",fit(this.div)}}onDestroy(){var e;this.destroyed||(this.resetTimer(),this.graph.removeMouseListener(this),this.div&&InternalEvent.release(this.div),(null==(e=this.div)?void 0:e.parentNode)&&this.div.parentNode.removeChild(this.div),this.destroyed=!0,this.div=null)}}TooltipHandler.pluginId="TooltipHandler";class SelectionCellsHandler extends EventSource{constructor(e){super(),this.enabled=!0,this.maxHandlers=100,this.graph=e,this.handlers=new Dictionary,this.graph.addMouseListener(this),this.refreshHandler=(e,t)=>{this.isEnabled()&&this.refresh()},this.graph.getSelectionModel().addListener(InternalEvent.CHANGE,this.refreshHandler),this.graph.getDataModel().addListener(InternalEvent.CHANGE,this.refreshHandler),this.graph.getView().addListener(InternalEvent.SCALE,this.refreshHandler),this.graph.getView().addListener(InternalEvent.TRANSLATE,this.refreshHandler),this.graph.getView().addListener(InternalEvent.SCALE_AND_TRANSLATE,this.refreshHandler),this.graph.getView().addListener(InternalEvent.DOWN,this.refreshHandler),this.graph.getView().addListener(InternalEvent.UP,this.refreshHandler)}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}getHandler(e){return this.handlers.get(e)}isHandled(e){return!!this.getHandler(e)}reset(){this.handlers.visit((e,t)=>{t.reset.apply(t)})}getHandledSelectionCells(){return this.graph.getSelectionCells()}refresh(){let e=this.handlers;this.handlers=new Dictionary;let t=sortCells(this.getHandledSelectionCells(),!1);for(let i=0;i<t.length;i+=1){let s=this.graph.view.getState(t[i]);if(s){let n=e.remove(t[i]);n&&(n.state!==s?(n.onDestroy(),n=null):this.isHandlerActive(n)||(n.refresh&&n.refresh(),n.redraw())),n&&this.handlers.put(t[i],n)}}e.visit((e,t)=>{this.fireEvent(new EventObject(InternalEvent.REMOVE,{state:t.state})),t.onDestroy()});for(let e=0;e<t.length;e+=1){let i=this.graph.view.getState(t[e]);if(i){let s=this.handlers.get(t[e]);s?s.updateParentHighlight():(s=this.graph.createHandler(i),this.fireEvent(new EventObject(InternalEvent.ADD,{state:i})),this.handlers.put(t[e],s))}}}isHandlerActive(e){return null!==e.index}updateHandler(e){let t=this.handlers.remove(e.cell);if(t){let{index:i}=t,s=t.startX,n=t.startY;t.onDestroy(),(t=this.graph.createHandler(e))&&(this.handlers.put(e.cell,t),null!==i&&t.start(s,n,i))}}mouseDown(e,t){this.graph.isEnabled()&&this.isEnabled()&&this.handlers.visit((i,s)=>{s.mouseDown(e,t)})}mouseMove(e,t){this.graph.isEnabled()&&this.isEnabled()&&this.handlers.visit((i,s)=>{s.mouseMove(e,t)})}mouseUp(e,t){this.graph.isEnabled()&&this.isEnabled()&&this.handlers.visit((i,s)=>{s.mouseUp(e,t)})}onDestroy(){this.graph.removeMouseListener(this),this.graph.removeListener(this.refreshHandler),this.graph.getDataModel().removeListener(this.refreshHandler),this.graph.getView().removeListener(this.refreshHandler)}}SelectionCellsHandler.pluginId="SelectionCellsHandler";class MaxPopupMenu extends EventSource{constructor(e){super(),this.activeRow=null,this.eventReceiver=null,this.submenuImage=`${Client.imageBasePath}/submenu.gif`,this.zIndex=10006,this.useLeftButtonForPopup=!1,this.enabled=!0,this.itemCount=0,this.autoExpand=!1,this.smartSeparators=!1,this.labels=!0,this.willAddSeparator=!1,this.containsItems=!1,e&&(this.factoryMethod=e),this.table=document.createElement("table"),this.table.className="mxPopupMenu",this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody),this.div=document.createElement("div"),this.div.className="mxPopupMenu",this.div.style.display="inline",this.div.style.zIndex=String(this.zIndex),this.div.appendChild(this.table),InternalEvent.disableContextMenu(this.div)}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}isPopupTrigger(e){return e.isPopupTrigger()||this.useLeftButtonForPopup&&isLeftMouseButton(e.getEvent())}addItem(e,t,i,s=null,n=null,a=!0,l=!0,r=!1){var o;s=s??this,this.itemCount++,s.willAddSeparator&&(s.containsItems&&this.addSeparator(s,!0),s.willAddSeparator=!1),s.containsItems=!0;let h=document.createElement("tr");h.className="mxPopupMenuItem";let c=document.createElement("td");if(c.className="mxPopupMenuIcon",t){let e=document.createElement("img");e.src=t,c.appendChild(e)}else if(n){let e=document.createElement("div");e.className=n,c.appendChild(e)}if(h.appendChild(c),this.labels){let t=document.createElement("td");t.className=`mxPopupMenuItem${!a?" mxDisabled":""}`,write(t,e),t.align="left",h.appendChild(t);let i=document.createElement("td");i.className=`mxPopupMenuItem${!a?" mxDisabled":""}`,i.style.paddingRight="6px",i.style.textAlign="right",h.appendChild(i),null==s.div&&this.createSubmenu(s)}return null==(o=s.tbody)||o.appendChild(h),l&&a&&(InternalEvent.addGestureListeners(h,e=>{this.eventReceiver=h,s&&s.activeRow!=h&&s.activeRow!=s&&(s.activeRow&&s.activeRow.div.parentNode&&this.hideSubmenu(s),h.div&&(this.showSubmenu(s,h),s.activeRow=h)),InternalEvent.consume(e)},e=>{s&&s.activeRow!=h&&s.activeRow!=s&&(s.activeRow&&s.activeRow.div.parentNode&&this.hideSubmenu(s),this.autoExpand&&h.div&&(this.showSubmenu(s,h),s.activeRow=h)),r||(h.className="mxPopupMenuItemHover")},e=>{this.eventReceiver==h&&(s&&s.activeRow!=h&&this.hideMenu(),null==i||i(e)),this.eventReceiver=null,InternalEvent.consume(e)}),r||InternalEvent.addListener(h,"mouseout",e=>{h.className="mxPopupMenuItem"})),h}addCheckmark(e,t){if(e.firstChild){let i=e.firstChild.nextSibling;i.style.backgroundImage=`url('${t}')`,i.style.backgroundRepeat="no-repeat",i.style.backgroundPosition="2px 50%"}}createSubmenu(e){var t,i;e.table=document.createElement("table"),e.table.className="mxPopupMenu",e.tbody=document.createElement("tbody"),e.table.appendChild(e.tbody),e.div=document.createElement("div"),e.div.className="mxPopupMenu",e.div.style.position="absolute",e.div.style.display="inline",e.div.style.zIndex=String(this.zIndex),e.div.appendChild(e.table);let s=document.createElement("img");s.setAttribute("src",this.submenuImage),(null==(i=null==(t=e.firstChild)?void 0:t.nextSibling)?void 0:i.nextSibling)&&e.firstChild.nextSibling.nextSibling.appendChild(s)}showSubmenu(e,t){if(t.div){t.div.style.left=`${e.div.offsetLeft+t.offsetLeft+t.offsetWidth-1}px`,t.div.style.top=`${e.div.offsetTop+t.offsetTop}px`,document.body.appendChild(t.div);let i=t.div.offsetLeft,s=t.div.offsetWidth,n=getDocumentScrollOrigin(document),a=document.body,l=document.documentElement;i+s>n.x+(a.clientWidth||l.clientWidth)&&(t.div.style.left=`${Math.max(0,e.div.offsetLeft-s-6)}px`),fit(t.div)}}addSeparator(e=null,t=!1){if(e=e||this,this.smartSeparators&&!t)e.willAddSeparator=!0;else if(e.tbody){e.willAddSeparator=!1;let t=document.createElement("tr"),i=document.createElement("td");i.className="mxPopupMenuIcon",i.style.padding="0 0 0 0px",t.appendChild(i);let s=document.createElement("td");s.style.padding="0 0 0 0px",s.setAttribute("colSpan","2");let n=document.createElement("hr");n.setAttribute("size","1"),s.appendChild(n),t.appendChild(s),e.tbody.appendChild(t)}}popup(e,t,i,s){if(this.div&&this.tbody&&this.factoryMethod){for(this.div.style.left=`${e}px`,this.div.style.top=`${t}px`;this.tbody.firstChild;)InternalEvent.release(this.tbody.firstChild),this.tbody.removeChild(this.tbody.firstChild);this.itemCount=0,this.factoryMethod(this,i,s),this.itemCount>0&&(this.showMenu(),this.fireEvent(new EventObject(InternalEvent.SHOW)))}}isMenuShowing(){return this.div&&this.div.parentNode==document.body}showMenu(){document.body.appendChild(this.div),fit(this.div)}hideMenu(){var e;this.div&&(null==(e=this.div.parentNode)||e.removeChild(this.div),this.hideSubmenu(this),this.containsItems=!1,this.fireEvent(new EventObject(InternalEvent.HIDE)))}hideSubmenu(e){var t;e.activeRow&&(this.hideSubmenu(e.activeRow),null==(t=e.activeRow.div.parentNode)||t.removeChild(e.activeRow.div),e.activeRow=null)}destroy(){var e;this.div&&(InternalEvent.release(this.div),null==(e=this.div.parentNode)||e.removeChild(this.div))}}class PopupMenuHandler extends MaxPopupMenu{constructor(e){super(),this.inTolerance=!1,this.popupTrigger=!1,this.selectOnPopup=!0,this.clearSelectionOnBackground=!0,this.triggerX=null,this.triggerY=null,this.screenX=null,this.screenY=null,this.graph=e,this.graph.addMouseListener(this),this.gestureHandler=(e,t)=>{this.inTolerance=!1},this.graph.addListener(InternalEvent.GESTURE,this.gestureHandler),this.init()}init(){InternalEvent.addGestureListeners(this.div,e=>{let t=this.graph.getPlugin("TooltipHandler");null==t||t.hide()})}isSelectOnPopup(e){return this.selectOnPopup}mouseDown(e,t){this.isEnabled()&&!isMultiTouchEvent(t.getEvent())&&(this.hideMenu(),this.triggerX=t.getGraphX(),this.triggerY=t.getGraphY(),this.screenX=getMainEvent(t.getEvent()).screenX,this.screenY=getMainEvent(t.getEvent()).screenY,this.popupTrigger=this.isPopupTrigger(t),this.inTolerance=!0)}mouseMove(e,t){this.inTolerance&&null!=this.screenX&&null!=this.screenY&&(Math.abs(getMainEvent(t.getEvent()).screenX-this.screenX)>this.graph.getEventTolerance()||Math.abs(getMainEvent(t.getEvent()).screenY-this.screenY)>this.graph.getEventTolerance())&&(this.inTolerance=!1)}mouseUp(e,t){if(this.popupTrigger&&this.inTolerance&&null!=this.triggerX&&null!=this.triggerY){let e=this.getCellForPopupEvent(t);this.graph.isEnabled()&&this.isSelectOnPopup(t)&&null!=e&&!this.graph.isCellSelected(e)?this.graph.setSelectionCell(e):this.clearSelectionOnBackground&&null==e&&this.graph.clearSelection();let i=this.graph.getPlugin("TooltipHandler");null==i||i.hide();let s=getScrollOrigin();this.popup(t.getX()+s.x+1,t.getY()+s.y+1,e,t.getEvent()),t.consume()}this.popupTrigger=!1,this.inTolerance=!1}getCellForPopupEvent(e){return e.getCell()}onDestroy(){this.graph.removeMouseListener(this),this.graph.removeListener(this.gestureHandler),super.destroy()}}PopupMenuHandler.pluginId="PopupMenuHandler";class ConnectionHandler extends EventSource{constructor(e,t=null){super(),this.previous=null,this.iconState=null,this.icons=[],this.cell=null,this.currentPoint=null,this.sourceConstraint=null,this.shape=null,this.icon=null,this.originalPoint=null,this.currentState=null,this.selectedIcon=null,this.waypoints=[],this.factoryMethod=null,this.moveIconFront=!1,this.moveIconBack=!1,this.connectImage=null,this.targetConnectImage=!1,this.enabled=!1,this.select=!0,this.createTarget=!1,this.error=null,this.waypointsEnabled=!1,this.ignoreMouseDown=!1,this.first=null,this.connectIconOffset=new Point(0,TOOLTIP_VERTICAL_OFFSET),this.edgeState=null,this.mouseDownCounter=0,this.movePreviewAway=!1,this.outlineConnect=!1,this.livePreview=!1,this.cursor=null,this.insertBeforeSource=!1,this.graph=e,this.factoryMethod=t,this.graph.addMouseListener(this),this.marker=this.createMarker(),this.constraintHandler=new ConstraintHandler(this.graph),this.changeHandler=e=>{this.iconState&&(this.iconState=this.graph.getView().getState(this.iconState.cell)),this.iconState?(this.redrawIcons(this.icons,this.iconState),this.constraintHandler.reset()):this.previous&&!this.graph.view.getState(this.previous.cell)&&this.reset()},this.graph.getDataModel().addListener(InternalEvent.CHANGE,this.changeHandler),this.graph.getView().addListener(InternalEvent.SCALE,this.changeHandler),this.graph.getView().addListener(InternalEvent.TRANSLATE,this.changeHandler),this.graph.getView().addListener(InternalEvent.SCALE_AND_TRANSLATE,this.changeHandler),this.drillHandler=e=>{this.reset()},this.graph.addListener(InternalEvent.START_EDITING,this.drillHandler),this.graph.getView().addListener(InternalEvent.DOWN,this.drillHandler),this.graph.getView().addListener(InternalEvent.UP,this.drillHandler),this.escapeHandler=()=>{this.reset()},this.graph.addListener(InternalEvent.ESCAPE,this.escapeHandler)}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}isInsertBefore(e,t,i,s,n){return this.insertBeforeSource&&t!==i}isCreateTarget(e){return this.createTarget}setCreateTarget(e){this.createTarget=e}createShape(){let e=this.livePreview&&this.edgeState?this.graph.cellRenderer.createShape(this.edgeState):new PolylineShape([],INVALID_COLOR);return e&&e.node&&(e.dialect=DIALECT.SVG,e.scale=this.graph.view.scale,e.pointerEvents=!1,e.isDashed=!0,e.init(this.graph.getView().getOverlayPane()),InternalEvent.redirectMouseEvents(e.node,this.graph,null)),e}isConnectableCell(e){return!0}createMarker(){return new ConnectionHandlerCellMarker(this.graph,this)}start(e,t,i,s){this.previous=e,this.first=new Point(t,i),this.edgeState=s??this.createEdgeState(),this.marker.currentColor=this.marker.validColor,this.marker.markedState=e,this.marker.mark(),this.fireEvent(new EventObject(InternalEvent.START,{state:this.previous}))}isConnecting(){return!!this.first&&!!this.shape}isValidSource(e,t){return this.graph.isValidSource(e)}isValidTarget(e){return!0}validateConnection(e,t){return this.isValidTarget(t)?this.graph.getEdgeValidationError(null,e,t):""}getConnectImage(e){return this.connectImage}isMoveIconToFrontForState(e){return!!e.text&&e.text.node.parentNode===this.graph.container||this.moveIconFront}createIcons(e){let t=this.getConnectImage(e);if(t){this.iconState=e;let i=[],s=new ImageShape(new Rectangle(0,0,t.width,t.height),t.src,void 0,void 0,0);s.preserveImageAspect=!1,this.isMoveIconToFrontForState(e)?(s.dialect=DIALECT.STRICTHTML,s.init(this.graph.container)):(s.dialect=DIALECT.SVG,s.init(this.graph.getView().getOverlayPane()),this.moveIconBack&&s.node.parentNode&&s.node.previousSibling&&s.node.parentNode.insertBefore(s.node,s.node.parentNode.firstChild)),s.node.style.cursor=CURSOR.CONNECT;let n=()=>this.currentState??e,a=e=>{isConsumed(e)||(this.icon=s,this.graph.fireMouseEvent(InternalEvent.MOUSE_DOWN,new InternalMouseEvent(e,n())))};return InternalEvent.redirectMouseEvents(s.node,this.graph,n,a),i.push(s),this.redrawIcons(i,this.iconState),i}return[]}redrawIcons(e,t){if(e[0]&&e[0].bounds){let i=this.getIconPosition(e[0],t);e[0].bounds.x=i.x,e[0].bounds.y=i.y,e[0].redraw()}}getIconPosition(e,t){let{scale:i}=this.graph.getView(),s=t.getCenterX(),n=t.getCenterY();if(this.graph.isSwimlane(t.cell)){let e=this.graph.getStartSize(t.cell);s=0!==e.width?t.x+e.width*i/2:s,n=0!==e.height?t.y+e.height*i/2:n;let a=toRadians(t.style.rotation??0);if(0!==a){let e=Math.cos(a),i=Math.sin(a),l=new Point(t.getCenterX(),t.getCenterY()),r=getRotatedPoint(new Point(s,n),e,i,l);s=r.x,n=r.y}}return new Point(s-e.bounds.width/2,n-e.bounds.height/2)}destroyIcons(){for(let e=0;e<this.icons.length;e+=1)this.icons[e].destroy();this.icons=[],this.icon=null,this.selectedIcon=null,this.iconState=null}isStartEvent(e){return null!==this.constraintHandler.currentFocus&&null!==this.constraintHandler.currentConstraint||null!==this.previous&&null===this.error&&(0===this.icons.length||null!==this.icon)}mouseDown(e,t){if(this.mouseDownCounter+=1,this.isEnabled()&&this.graph.isEnabled()&&!t.isConsumed()&&!this.isConnecting()&&this.isStartEvent(t)){if(this.constraintHandler.currentConstraint&&this.constraintHandler.currentFocus&&this.constraintHandler.currentPoint?(this.sourceConstraint=this.constraintHandler.currentConstraint,this.previous=this.constraintHandler.currentFocus,this.first=this.constraintHandler.currentPoint.clone()):this.first=new Point(t.getGraphX(),t.getGraphY()),this.edgeState=this.createEdgeState(t),this.mouseDownCounter=1,this.waypointsEnabled&&!this.shape&&(this.waypoints=[],this.shape=this.createShape(),this.edgeState&&this.shape.apply(this.edgeState)),!this.previous&&this.edgeState&&this.edgeState.cell.geometry){let e=this.graph.getPointForEvent(t.getEvent());this.edgeState.cell.geometry.setTerminalPoint(e,!0)}this.fireEvent(new EventObject(InternalEvent.START,{state:this.previous})),t.consume()}this.selectedIcon=this.icon,this.icon=null}isImmediateConnectSource(e){return!this.graph.isCellMovable(e.cell)}createEdgeState(e){return null}isOutlineConnectEvent(e){if(!this.currentPoint)return!1;let t=getOffset(this.graph.container),i=e.getEvent(),s=getClientX(i),n=getClientY(i),a=document.documentElement,l=(window.pageXOffset||a.scrollLeft)-(a.clientLeft||0),r=(window.pageYOffset||a.scrollTop)-(a.clientTop||0),o=this.currentPoint.x-this.graph.container.scrollLeft+t.x-l,h=this.currentPoint.y-this.graph.container.scrollTop+t.y-r;return this.outlineConnect&&!isShiftDown(e.getEvent())&&(e.isSource(this.marker.highlight.shape)||isAltDown(e.getEvent())&&null!=e.getState()||this.marker.highlight.isHighlightAt(s,n)||(o!==s||h!==n)&&null==e.getState()&&this.marker.highlight.isHighlightAt(o,h))}updateCurrentState(e,t){if(this.constraintHandler.update(e,!this.first,!1,!this.first||e.isSource(this.marker.highlight.shape)?null:t),null!=this.constraintHandler.currentFocus&&null!=this.constraintHandler.currentConstraint)this.marker.highlight&&this.marker.highlight.state&&this.marker.highlight.state.cell===this.constraintHandler.currentFocus.cell&&this.marker.highlight.shape?"transparent"!==this.marker.highlight.shape.stroke&&(this.marker.highlight.shape.stroke="transparent",this.marker.highlight.repaint()):this.marker.markCell(this.constraintHandler.currentFocus.cell,"transparent"),this.previous&&(this.error=this.validateConnection(this.previous.cell,this.constraintHandler.currentFocus.cell),this.error||(this.currentState=this.constraintHandler.currentFocus),(this.error||this.currentState&&!this.isCellEnabled(this.currentState.cell))&&this.constraintHandler.reset());else{this.graph.isIgnoreTerminalEvent(e.getEvent())?(this.marker.reset(),this.currentState=null):(this.marker.process(e),this.currentState=this.marker.getValidState()),null==this.currentState||this.isCellEnabled(this.currentState.cell)||(this.constraintHandler.reset(),this.marker.reset(),this.currentState=null);let i=this.isOutlineConnectEvent(e);if(null!=this.currentState&&i){e.isSource(this.marker.highlight.shape)&&(t=new Point(e.getGraphX(),e.getGraphY()));let i=this.graph.getOutlineConstraint(t,this.currentState,e);this.constraintHandler.setFocus(e,this.currentState,!1),this.constraintHandler.currentConstraint=i,this.constraintHandler.currentPoint=t}if(this.outlineConnect&&null!=this.marker.highlight&&null!=this.marker.highlight.shape){let t=this.graph.view.scale;if(null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus)this.marker.highlight.shape.stroke=OUTLINE_HIGHLIGHT_COLOR,this.marker.highlight.shape.strokeWidth=OUTLINE_HIGHLIGHT_STROKEWIDTH/t/t,this.marker.highlight.repaint();else if(this.marker.hasValidState()){let i=e.getCell();i&&i.isConnectable()&&this.marker.getValidState()!==e.getState()?(this.marker.highlight.shape.stroke="transparent",this.currentState=null):this.marker.highlight.shape.stroke=DEFAULT_VALID_COLOR,this.marker.highlight.shape.strokeWidth=HIGHLIGHT_STROKEWIDTH/t/t,this.marker.highlight.repaint()}}}}isCellEnabled(e){return!0}convertWaypoint(e){let t=this.graph.getView().getScale(),i=this.graph.getView().getTranslate();e.x=e.x/t-i.x,e.y=e.y/t-i.y}snapToPreview(e,t){if(!isAltDown(e.getEvent())&&this.previous){let i=this.graph.getGridSize()*this.graph.view.scale/2,s=this.sourceConstraint&&this.first?this.first:new Point(this.previous.getCenterX(),this.previous.getCenterY());Math.abs(s.x-e.getGraphX())<i&&(t.x=s.x),Math.abs(s.y-e.getGraphY())<i&&(t.y=s.y)}}mouseMove(e,t){if(!t.isConsumed()&&(this.ignoreMouseDown||this.first||!this.graph.isMouseDown)){!this.isEnabled()&&this.currentState&&(this.destroyIcons(),this.currentState=null);let e=this.graph.getView(),{scale:i}=e,s=e.translate,n=new Point(t.getGraphX(),t.getGraphY());if(this.error=null,this.graph.isGridEnabledEvent(t.getEvent())&&(n=new Point((this.graph.snap(n.x/i-s.x)+s.x)*i,(this.graph.snap(n.y/i-s.y)+s.y)*i)),this.snapToPreview(t,n),this.currentPoint=n,(this.first||this.isEnabled()&&this.graph.isEnabled())&&(this.shape||!this.first||Math.abs(t.getGraphX()-this.first.x)>this.graph.getEventTolerance()||Math.abs(t.getGraphY()-this.first.y)>this.graph.getEventTolerance())&&this.updateCurrentState(t,n),this.first){let e=null,i=n;this.constraintHandler.currentConstraint&&this.constraintHandler.currentFocus&&this.constraintHandler.currentPoint?(e=this.constraintHandler.currentConstraint,i=this.constraintHandler.currentPoint.clone()):this.previous&&!this.graph.isIgnoreTerminalEvent(t.getEvent())&&isShiftDown(t.getEvent())&&(Math.abs(this.previous.getCenterX()-n.x)<Math.abs(this.previous.getCenterY()-n.y)?n.x=this.previous.getCenterX():n.y=this.previous.getCenterY());let s=this.first;if(this.selectedIcon&&this.selectedIcon.bounds){let e=this.selectedIcon.bounds.width,i=this.selectedIcon.bounds.height;if(this.currentState&&this.targetConnectImage){let e=this.getIconPosition(this.selectedIcon,this.currentState);this.selectedIcon.bounds.x=e.x,this.selectedIcon.bounds.y=e.y}else{let s=new Rectangle(t.getGraphX()+this.connectIconOffset.x,t.getGraphY()+this.connectIconOffset.y,e,i);this.selectedIcon.bounds=s}this.selectedIcon.redraw()}if(this.edgeState)this.updateEdgeState(i,e),i=this.edgeState.absolutePoints[this.edgeState.absolutePoints.length-1],s=this.edgeState.absolutePoints[0];else{if(this.currentState&&!this.constraintHandler.currentConstraint){let e=this.getTargetPerimeterPoint(this.currentState,t);null!=e&&(i=e)}if(!this.sourceConstraint&&this.previous){let e=this.waypoints.length>0?this.waypoints[0]:i,n=this.getSourcePerimeterPoint(this.previous,e,t);n&&(s=n)}}if(!this.currentState&&this.movePreviewAway&&i){let e=s;if(this.edgeState&&this.edgeState.absolutePoints.length>=2){let t=this.edgeState.absolutePoints[this.edgeState.absolutePoints.length-2];t&&(e=t)}if(e){let t=i.x-e.x,s=i.y-e.y,n=Math.sqrt(t*t+s*s);if(0===n)return;this.originalPoint=i.clone(),i.x-=4*t/n,i.y-=4*s/n}}else this.originalPoint=null;if(!this.shape){let e=Math.abs(t.getGraphX()-this.first.x),i=Math.abs(t.getGraphY()-this.first.y);(e>this.graph.getEventTolerance()||i>this.graph.getEventTolerance())&&(this.shape=this.createShape(),this.edgeState&&this.shape.apply(this.edgeState),this.updateCurrentState(t,n))}if(this.shape){if(this.edgeState)this.shape.points=this.edgeState.absolutePoints;else{let e=[s];this.waypoints.length>0&&(e=e.concat(this.waypoints)),e.push(i),this.shape.points=e}this.drawPreview()}this.cursor&&(this.graph.container.style.cursor=this.cursor),InternalEvent.consume(t.getEvent()),t.consume()}else this.isEnabled()&&this.graph.isEnabled()?this.previous===this.currentState||this.edgeState?this.previous!==this.currentState||null==this.currentState||0!==this.icons.length||this.graph.isMouseDown||t.consume():(this.destroyIcons(),!this.currentState||this.error||this.constraintHandler.currentConstraint||(this.icons=this.createIcons(this.currentState),0===this.icons.length&&(this.currentState.setCursor(CURSOR.CONNECT),t.consume())),this.previous=this.currentState):this.constraintHandler.reset();if(!this.graph.isMouseDown&&null!=this.currentState&&null!=this.icons){let e=!1,i=t.getSource();for(let t=0;t<this.icons.length&&!e;t+=1)e=i===this.icons[t].node||!!i&&i.parentNode===this.icons[t].node;e||this.updateIcons(this.currentState,this.icons,t)}}else this.constraintHandler.reset()}updateEdgeState(e,t){if(!this.edgeState)return;this.sourceConstraint&&this.sourceConstraint.point&&(this.edgeState.style.exitX=this.sourceConstraint.point.x,this.edgeState.style.exitY=this.sourceConstraint.point.y),t&&t.point?(this.edgeState.style.entryX=t.point.x,this.edgeState.style.entryY=t.point.y):(this.edgeState.style.entryX=0,this.edgeState.style.entryY=0),this.edgeState.absolutePoints=[null,null!=this.currentState?null:e],this.sourceConstraint&&this.graph.view.updateFixedTerminalPoint(this.edgeState,this.previous,!0,this.sourceConstraint),null!=this.currentState&&(null==t&&(t=this.graph.getConnectionConstraint(this.edgeState,this.previous,!1)),this.edgeState.setAbsoluteTerminalPoint(null,!1),this.graph.view.updateFixedTerminalPoint(this.edgeState,this.currentState,!1,t));let i=[];for(let e=0;e<this.waypoints.length;e+=1){let t=this.waypoints[e].clone();this.convertWaypoint(t),i[e]=t}this.graph.view.updatePoints(this.edgeState,i,this.previous,this.currentState),this.graph.view.updateFloatingTerminalPoints(this.edgeState,this.previous,this.currentState)}getTargetPerimeterPoint(e,t){let i=null,{view:s}=e,n=s.getPerimeterFunction(e);if(n&&this.previous&&this.edgeState){let t=this.waypoints.length>0?this.waypoints[this.waypoints.length-1]:new Point(this.previous.getCenterX(),this.previous.getCenterY()),a=n(s.getPerimeterBounds(e),this.edgeState,t,!1);a&&(i=a)}else i=new Point(e.getCenterX(),e.getCenterY());return i}getSourcePerimeterPoint(e,t,i){let s=null,{view:n}=e,a=n.getPerimeterFunction(e),l=new Point(e.getCenterX(),e.getCenterY());if(a){let i=e.style.rotation??0,r=-(Math.PI/180*i);0!==i&&(t=getRotatedPoint(new Point(t.x,t.y),Math.cos(r),Math.sin(r),l));let o=a(n.getPerimeterBounds(e),e,t,!1);o&&(0!==i&&(o=getRotatedPoint(new Point(o.x,o.y),Math.cos(-r),Math.sin(-r),l)),s=o)}else s=l;return s}updateIcons(e,t,i){}isStopEvent(e){return!!e.getState()}addWaypointForEvent(e){if(!this.first)return;let t=convertPoint(this.graph.container,e.getX(),e.getY()),i=Math.abs(t.x-this.first.x),s=Math.abs(t.y-this.first.y);if(this.waypoints.length>0||this.mouseDownCounter>1&&(i>this.graph.getEventTolerance()||s>this.graph.getEventTolerance())){let{scale:i}=this.graph.view;t=new Point(this.graph.snap(e.getGraphX()/i)*i,this.graph.snap(e.getGraphY()/i)*i),this.waypoints.push(t)}}checkConstraints(e,t){return!e||!t||!e.point||!t.point||!e.point.equals(t.point)||e.dx!==t.dx||e.dy!==t.dy||e.perimeter!==t.perimeter}mouseUp(e,t){if(!t.isConsumed()&&this.isConnecting()){if(this.waypointsEnabled&&!this.isStopEvent(t)){this.addWaypointForEvent(t),t.consume();return}let e=this.sourceConstraint,i=this.constraintHandler.currentConstraint,s=this.previous?this.previous.cell:null,n=null;this.constraintHandler.currentConstraint&&this.constraintHandler.currentFocus&&(n=this.constraintHandler.currentFocus.cell),!n&&this.currentState&&(n=this.currentState.cell),!this.error&&(!s||!n||s!==n||this.checkConstraints(e,i))?this.connect(s,n,t.getEvent(),t.getCell()):(null!=this.previous&&null!=this.marker.validState&&this.previous.cell===this.marker.validState.cell&&this.graph.selectCellForEvent(this.marker.validState.cell,t.getEvent()),null!=this.error&&this.error.length>0&&this.graph.validationAlert(this.error)),this.destroyIcons(),t.consume()}null!=this.first&&this.reset()}reset(){null!=this.shape&&(this.shape.destroy(),this.shape=null),null!=this.cursor&&null!=this.graph.container&&(this.graph.container.style.cursor=""),this.destroyIcons(),this.marker.reset(),this.constraintHandler.reset(),this.originalPoint=null,this.currentPoint=null,this.edgeState=null,this.previous=null,this.error=null,this.sourceConstraint=null,this.mouseDownCounter=0,this.first=null,this.fireEvent(new EventObject(InternalEvent.RESET))}drawPreview(){this.updatePreview(null===this.error),this.shape&&this.shape.redraw()}updatePreview(e){this.shape&&(this.shape.strokeWidth=this.getEdgeWidth(e),this.shape.stroke=this.getEdgeColor(e))}getEdgeColor(e){return e?VALID_COLOR:INVALID_COLOR}getEdgeWidth(e){return e?3:1}connect(e,t,i,s=null){var n,a,l,r;if(t||this.isCreateTarget(i)||this.graph.isAllowDanglingEdges()){let o=this.graph.getDataModel(),h=!1,c=null;o.beginUpdate();try{if(e&&!t&&!this.graph.isIgnoreTerminalEvent(i)&&this.isCreateTarget(i)&&(t=this.createTargetVertex(i,e))){if(s=this.graph.getDropTarget([t],i,s),h=!0,null!=s&&s.isEdge())s=this.graph.getDefaultParent();else{let e=s?this.graph.getView().getState(s):null;if(e){let i=t.getGeometry();i&&(i.x-=e.origin.x,i.y-=e.origin.y)}}this.graph.addCell(t,s)}let d=this.graph.getDefaultParent();e&&t&&e.getParent()===t.getParent()&&(null==(n=e.getParent())?void 0:n.getParent())!==o.getRoot()&&(d=e.getParent(),e.geometry&&e.geometry.relative&&t.geometry&&t.geometry.relative&&(d=d.getParent()));let u=null,p={};if((null==(a=this.edgeState)?void 0:a.cell)&&(u=this.edgeState.cell.value,p=this.edgeState.cell.style??{}),(c=this.insertEdge(d,"",u,e,t,p))&&e){if(this.graph.setConnectionConstraint(c,e,!0,this.sourceConstraint),this.graph.setConnectionConstraint(c,t,!1,this.constraintHandler.currentConstraint),(null==(r=null==(l=this.edgeState)?void 0:l.cell)?void 0:r.geometry)&&o.setGeometry(c,this.edgeState.cell.geometry),d=e.getParent(),this.isInsertBefore(c,e,t,i,s)){let t=e;for(;t&&null!=t.parent&&null!=t.geometry&&t.geometry.relative&&t.parent!==c.parent;)t=t.getParent();null!=t&&null!=t.parent&&t.parent===c.parent&&o.add(d,c,t.parent.getIndex(t))}let n=c.getGeometry();if(null==n&&((n=new Geometry).relative=!0,o.setGeometry(c,n)),this.waypoints.length>0){let e=this.graph.view.scale,t=this.graph.view.translate;n.points=[];for(let i=0;i<this.waypoints.length;i+=1){let s=this.waypoints[i];n.points.push(new Point(s.x/e-t.x,s.y/e-t.y))}}if(!t&&this.currentPoint){let e=this.graph.view.translate,t=this.graph.view.scale,i=null!=this.originalPoint?new Point(this.originalPoint.x/t-e.x,this.originalPoint.y/t-e.y):new Point(this.currentPoint.x/t-e.x,this.currentPoint.y/t-e.y);i.x-=this.graph.getPanDx()/this.graph.view.scale,i.y-=this.graph.getPanDy()/this.graph.view.scale,n.setTerminalPoint(i,!1)}this.fireEvent(new EventObject(InternalEvent.CONNECT,"cell",c,"terminal",t,"event",i,"target",s,"terminalInserted",h))}}catch(t){GlobalConfig.logger.show();let e=`Error in ConnectionHandler: ${t instanceof Error?t.message+"\n"+t.stack:"unknown cause"}`;GlobalConfig.logger.debug(e)}finally{o.endUpdate()}this.select&&this.selectCells(c,h?t:null)}}selectCells(e,t){this.graph.setSelectionCell(e)}insertEdge(e,t,i,s,n,a){if(!this.factoryMethod)return this.graph.insertEdge(e,t,i,s,n,a);let l=this.createEdge(i,s,n,a);return this.graph.addEdge(l,e,s,n)}createTargetVertex(e,t){let i=t.getGeometry();for(;i&&i.relative;)i=(t=t.getParent()).getGeometry();let s=this.graph.cloneCell(t);if((i=s.getGeometry())&&this.currentPoint){let e=this.graph.view.translate,s=this.graph.view.scale,n=new Point(this.currentPoint.x/s-e.x,this.currentPoint.y/s-e.y);i.x=Math.round(n.x-i.width/2-this.graph.getPanDx()/s),i.y=Math.round(n.y-i.height/2-this.graph.getPanDy()/s);let a=this.getAlignmentTolerance();if(a>0){let n=this.graph.view.getState(t);if(null!=n){let t=n.x/s-e.x,l=n.y/s-e.y;Math.abs(t-i.x)<=a&&(i.x=Math.round(t)),Math.abs(l-i.y)<=a&&(i.y=Math.round(l))}}}return s}getAlignmentTolerance(e){return this.graph.isGridEnabled()?this.graph.getGridSize()/2:this.graph.getSnapTolerance()}createEdge(e,t,i,s={}){let n=null;if(null!=this.factoryMethod&&(n=this.factoryMethod(t,i,s)),null==n){(n=new Cell(e||"")).setEdge(!0),n.setStyle(s);let t=new Geometry;t.relative=!0,n.setGeometry(t)}return n}onDestroy(){this.graph.removeMouseListener(this),this.shape&&(this.shape.destroy(),this.shape=null),this.marker&&(this.marker.destroy(),this.marker=null),this.constraintHandler&&this.constraintHandler.onDestroy(),this.changeHandler&&(this.graph.getDataModel().removeListener(this.changeHandler),this.graph.getView().removeListener(this.changeHandler)),this.drillHandler&&(this.graph.removeListener(this.drillHandler),this.graph.getView().removeListener(this.drillHandler)),this.escapeHandler&&this.graph.removeListener(this.escapeHandler)}}ConnectionHandler.pluginId="ConnectionHandler";class ConnectionHandlerCellMarker extends CellMarker{constructor(e,t,i=DEFAULT_VALID_COLOR,s=DEFAULT_INVALID_COLOR,n=DEFAULT_HOTSPOT){super(e,i,s,n),this.hotspotEnabled=!0,this.connectionHandler=t}getCell(e){let t=super.getCell(e);if(this.connectionHandler.error=null,!t&&this.connectionHandler.currentPoint&&(t=this.connectionHandler.graph.getCellAt(this.connectionHandler.currentPoint.x,this.connectionHandler.currentPoint.y)),t&&!t.isConnectable()&&this.connectionHandler.cell){let e=this.connectionHandler.cell.getParent();e&&e.isVertex()&&e.isConnectable()&&(t=e)}return t&&(this.connectionHandler.graph.isSwimlane(t)&&null!=this.connectionHandler.currentPoint&&this.connectionHandler.graph.hitsSwimlaneContent(t,this.connectionHandler.currentPoint.x,this.connectionHandler.currentPoint.y)||!this.connectionHandler.isConnectableCell(t))&&(t=null),t?this.connectionHandler.isConnecting()?this.connectionHandler.previous&&(this.connectionHandler.error=this.connectionHandler.validateConnection(this.connectionHandler.previous.cell,t),null!==this.connectionHandler.error&&0===this.connectionHandler.error.length&&(t=null,this.connectionHandler.isCreateTarget(e.getEvent())&&(this.connectionHandler.error=null))):this.connectionHandler.isValidSource(t,e)||(t=null):!this.connectionHandler.isConnecting()||this.connectionHandler.isCreateTarget(e.getEvent())||this.connectionHandler.graph.isAllowDanglingEdges()||(this.connectionHandler.error=""),t}isValidState(e){return this.connectionHandler.isConnecting()?!this.connectionHandler.error:super.isValidState(e)}getMarkerColor(e,t,i){return!this.connectionHandler.connectImage||this.connectionHandler.isConnecting()?super.getMarkerColor(e,t,i):NONE}intersects(e,t){return!!(this.connectionHandler.connectImage||this.connectionHandler.isConnecting())||super.intersects(e,t)}}class Guide{constructor(e,t){this.states=[],this.horizontal=!0,this.vertical=!0,this.guideX=null,this.guideY=null,this.rounded=!1,this.tolerance=2,this.graph=e,this.setStates(t)}setStates(e){this.states=e}isEnabledForEvent(e){return!0}getGuideTolerance(e=!1){return e&&this.graph.isGridEnabled()?this.graph.getGridSize()/2:this.tolerance}createGuideShape(e=!1){let t=new PolylineShape([],GUIDE_COLOR,GUIDE_STROKEWIDTH);return t.isDashed=!0,t}isStateIgnored(e){return!1}move(e=null,t,i=!1,s=!1){if((this.horizontal||this.vertical)&&e){let{scale:s}=this.graph.getView(),n=this.getGuideTolerance(i)*s,a=e.clone();a.x+=t.x,a.y+=t.y;let l=!1,r=null,o=null,h=!1,c=null,d=null,u=n,p=n,g=a.x,m=a.x+a.width,f=a.getCenterX(),x=a.y,v=a.y+a.height,b=a.getCenterY(),y=(i,s,n)=>{let a=!1;n&&Math.abs(i-f)<u?(t.x=i-e.getCenterX(),u=Math.abs(i-f),a=!0):!n&&(Math.abs(i-g)<u?(t.x=i-e.x,u=Math.abs(i-g),a=!0):Math.abs(i-m)<u&&(t.x=i-e.x-e.width,u=Math.abs(i-m),a=!0)),a&&(r=s,o=i,this.guideX||(this.guideX=this.createGuideShape(!0),this.guideX.dialect=DIALECT.SVG,this.guideX.pointerEvents=!1,this.guideX.init(this.graph.getView().getOverlayPane()))),l=l||a},w=(i,s,n)=>{let a=!1;n&&Math.abs(i-b)<p?(t.y=i-e.getCenterY(),p=Math.abs(i-b),a=!0):!n&&(Math.abs(i-x)<p?(t.y=i-e.y,p=Math.abs(i-x),a=!0):Math.abs(i-v)<p&&(t.y=i-e.y-e.height,p=Math.abs(i-v),a=!0)),a&&(c=s,d=i,this.guideY||(this.guideY=this.createGuideShape(!1),this.guideY.dialect=DIALECT.SVG,this.guideY.pointerEvents=!1,this.guideY.init(this.graph.getView().getOverlayPane()))),h=h||a};for(let e=0;e<this.states.length;e+=1){let t=this.states[e];t&&!this.isStateIgnored(t)&&(this.horizontal&&(y(t.getCenterX(),t,!0),y(t.x,t,!1),y(t.x+t.width,t,!1),t.cell||y(t.getCenterX(),t,!1)),this.vertical&&(w(t.getCenterY(),t,!0),w(t.y,t,!1),w(t.y+t.height,t,!1),t.cell||w(t.getCenterY(),t,!1)))}this.graph.snapDelta(t,e,!i,l,h),t=this.getDelta(e,r,t.x,c,t.y);let C=this.graph.container;if(!l&&this.guideX)this.guideX.node.style.visibility="hidden";else if(this.guideX){let i=null,s=null;r&&(i=Math.min(e.y+t.y-this.graph.getPanDy(),r.y),s=Math.max(e.y+e.height+t.y-this.graph.getPanDy(),r.y+r.height)),null!==i&&null!==s?this.guideX.points=[new Point(o,i),new Point(o,s)]:this.guideX.points=[new Point(o,-this.graph.getPanDy()),new Point(o,C.scrollHeight-3-this.graph.getPanDy())],this.guideX.stroke=this.getGuideColor(r,!0),this.guideX.node.style.visibility="visible",this.guideX.redraw()}if(h||null==this.guideY){if(null!=this.guideY){let i=null,s=null;null!=c&&null!=e&&(i=Math.min(e.x+t.x-this.graph.getPanDx(),c.x),s=Math.max(e.x+e.width+t.x-this.graph.getPanDx(),c.x+c.width)),null!=i&&null!=s&&null!==d?this.guideY.points=[new Point(i,d),new Point(s,d)]:null!==d&&(this.guideY.points=[new Point(-this.graph.getPanDx(),d),new Point(C.scrollWidth-3-this.graph.getPanDx(),d)]),this.guideY.stroke=this.getGuideColor(c,!1),this.guideY.node.style.visibility="visible",this.guideY.redraw()}}else this.guideY.node.style.visibility="hidden"}return t}getDelta(e,t=null,i,s=null,n){let a=this.graph.view.scale;return(this.rounded||null!=t&&null==t.cell)&&(i=Math.round((e.x+i)/a)*a-e.x),(this.rounded||null!=s&&null==s.cell)&&(n=Math.round((e.y+n)/a)*a-e.y),new Point(i,n)}getGuideColor(e,t){return GUIDE_COLOR}hide(){this.setVisible(!1)}setVisible(e){this.guideX&&(this.guideX.node.style.visibility=e?"visible":"hidden"),this.guideY&&(this.guideY.node.style.visibility=e?"visible":"hidden")}destroy(){this.guideX&&(this.guideX.destroy(),this.guideX=null),this.guideY&&(this.guideY.destroy(),this.guideY=null)}}class SelectionHandler{constructor(e){this.refreshThread=null,this.maxCells=50,this.enabled=!0,this.highlightEnabled=!0,this.cloneEnabled=!0,this.moveEnabled=!0,this.guidesEnabled=!1,this.handlesVisible=!0,this.guide=null,this.currentDx=0,this.currentDy=0,this.updateCursor=!0,this.selectEnabled=!0,this.removeCellsFromParent=!0,this.removeEmptyParents=!1,this.connectOnDrop=!1,this.scrollOnMove=!0,this.minimumSize=6,this.previewColor="black",this.htmlPreview=!1,this.shape=null,this.scaleGrid=!1,this.rotationEnabled=!0,this.maxLivePreview=0,this.allowLivePreview=Client.IS_SVG,this.cell=null,this.delayedSelection=!1,this.first=null,this.cells=null,this.bounds=null,this.pBounds=null,this.allCells=new Dictionary,this.cellWasClicked=!1,this.cloning=!1,this.cellCount=0,this.target=null,this.suspended=!1,this.livePreviewActive=!1,this.livePreviewUsed=!1,this.highlight=null,this.graph=e,this.graph.addMouseListener(this),this.panHandler=()=>{this.suspended||(this.updatePreview(),this.updateHint())},this.graph.addListener(InternalEvent.PAN,this.panHandler),this.escapeHandler=(e,t)=>{this.reset()},this.graph.addListener(InternalEvent.ESCAPE,this.escapeHandler),this.refreshHandler=(e,t)=>{this.refreshThread&&window.clearTimeout(this.refreshThread),this.refreshThread=window.setTimeout(()=>{var e;if(this.refreshThread=null,this.first&&!this.suspended&&this.cells){let t=this.currentDx,i=this.currentDy;this.currentDx=0,this.currentDy=0,this.updatePreview(),this.bounds=this.graph.getView().getBounds(this.cells),this.pBounds=this.getPreviewBounds(this.cells),null!=this.pBounds||this.livePreviewUsed?(this.currentDx=t,this.currentDy=i,this.updatePreview(),this.updateHint(),this.livePreviewUsed&&(this.setHandlesVisibleForCells((null==(e=this.getSelectionCellsHandler())?void 0:e.getHandledSelectionCells())??[],!1,!0),this.updatePreview())):this.reset()}},0)},this.graph.getDataModel().addListener(InternalEvent.CHANGE,this.refreshHandler),this.graph.addListener(InternalEvent.REFRESH,this.refreshHandler),this.keyHandler=e=>{if(null!=this.graph.container&&"hidden"!==this.graph.container.style.visibility&&null!=this.first&&!this.suspended){let t=this.graph.isCloneEvent(e)&&this.graph.isCellsCloneable()&&this.isCloneEnabled();t!==this.cloning&&(this.cloning=t,this.checkPreview(),this.updatePreview())}},"undefined"!=typeof document&&(InternalEvent.addListener(document,"keydown",this.keyHandler),InternalEvent.addListener(document,"keyup",this.keyHandler))}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}isCloneEnabled(){return this.cloneEnabled}setCloneEnabled(e){this.cloneEnabled=e}isMoveEnabled(){return this.moveEnabled}setMoveEnabled(e){this.moveEnabled=e}isSelectEnabled(){return this.selectEnabled}setSelectEnabled(e){this.selectEnabled=e}isRemoveCellsFromParent(){return this.removeCellsFromParent}setRemoveCellsFromParent(e){this.removeCellsFromParent=e}isPropagateSelectionCell(e,t,i){let s=e.getParent();if(t){let t=e.isEdge()?null:e.getGeometry();return!this.graph.isSiblingSelected(e)&&t&&t.relative||!this.graph.isSwimlane(s)}return(!this.graph.isToggleEvent(i.getEvent())||!this.graph.isSiblingSelected(e)&&!this.graph.isCellSelected(e)&&!this.graph.isSwimlane(s)||this.graph.isCellSelected(s))&&(this.graph.isToggleEvent(i.getEvent())||!this.graph.isCellSelected(s))}getInitialCellForEvent(e){let t=e.getState();if((!this.graph.isToggleEvent(e.getEvent())||!isAltDown(e.getEvent()))&&t&&!this.graph.isCellSelected(t.cell)){let i=t.cell.getParent(),s=i?this.graph.view.getState(i):null;for(;s&&!this.graph.isCellSelected(s.cell)&&(s.cell.isVertex()||s.cell.isEdge())&&this.isPropagateSelectionCell(t.cell,!0,e);)s=(i=(t=s).cell.getParent())?this.graph.view.getState(i):null}return t?t.cell:null}isDelayedSelection(e,t){let i=e,s=this.getSelectionCellsHandler();if(!this.graph.isToggleEvent(t.getEvent())||!isAltDown(t.getEvent()))for(;i;){if(null==s?void 0:s.isHandled(i)){let e=this.graph.getPlugin("CellEditorHandler");return(null==e?void 0:e.getEditingCell())!==i}i=i.getParent()}return this.graph.isToggleEvent(t.getEvent())&&!isAltDown(t.getEvent())}selectDelayed(e){let t=this.graph.getPlugin("PopupMenuHandler");if(!t||!t.isPopupTrigger(e)){let t=e.getCell();null===t&&(t=this.cell),t&&this.selectCellForEvent(t,e)}}selectCellForEvent(e,t){let i=this.graph.view.getState(e);if(i)if(t.isSource(i.control))this.graph.selectCellForEvent(e,t.getEvent());else{if(!this.graph.isToggleEvent(t.getEvent())||!isAltDown(t.getEvent())){let i=e.getParent();for(;i&&this.graph.view.getState(i)&&(i.isVertex()||i.isEdge())&&this.isPropagateSelectionCell(e,!1,t);)i=(e=i).getParent()}this.graph.selectCellForEvent(e,t.getEvent())}return e}consumeMouseEvent(e,t){t.consume()}mouseDown(e,t){if(!t.isConsumed()&&this.isEnabled()&&this.graph.isEnabled()&&t.getState()&&!isMultiTouchEvent(t.getEvent())){let e=this.getInitialCellForEvent(t);if(e&&(this.delayedSelection=this.isDelayedSelection(e,t),this.cell=null,this.isSelectEnabled()&&!this.delayedSelection&&this.graph.selectCellForEvent(e,t.getEvent()),this.isMoveEnabled())){let i=e.getGeometry();i&&this.graph.isCellMovable(e)&&(!e.isEdge()||this.graph.getSelectionCount()>1||i.points&&i.points.length>0||!e.getTerminal(!0)||!e.getTerminal(!1)||this.graph.isAllowDanglingEdges()||this.graph.isCloneEvent(t.getEvent())&&this.graph.isCellsCloneable())?this.start(e,t.getX(),t.getY()):this.delayedSelection&&(this.cell=e),this.cellWasClicked=!0,this.consumeMouseEvent(InternalEvent.MOUSE_DOWN,t)}}}getGuideStates(){let e=this.graph.getDefaultParent(),t=e=>{let t=e.getGeometry();return!!this.graph.view.getState(e)&&e.isVertex()&&!!t&&!t.relative};return this.graph.view.getCellStates(e.filterDescendants(t))}getCells(e){return!this.delayedSelection&&this.graph.isCellMovable(e)?[e]:this.graph.getMovableCells(this.graph.getSelectionCells())}getPreviewBounds(e){let t=this.getBoundingBox(e);if(t){if(t.width=Math.max(0,t.width-1),t.height=Math.max(0,t.height-1),t.width<this.minimumSize){let e=this.minimumSize-t.width;t.x-=e/2,t.width=this.minimumSize}else t.x=Math.round(t.x),t.width=Math.ceil(t.width);if(t.height<this.minimumSize){let e=this.minimumSize-t.height;t.y-=e/2,t.height=this.minimumSize}else t.y=Math.round(t.y),t.height=Math.ceil(t.height)}return t}getBoundingBox(e){let t=null;if(e.length>0){for(let i=0;i<e.length;i+=1)if(e[i].isVertex()||e[i].isEdge()){let s=this.graph.view.getState(e[i]);if(s){let n=null;e[i].isVertex()&&s.shape&&s.shape.boundingBox&&(n=s.shape.boundingBox),n&&(t?t.add(n):t=Rectangle.fromRectangle(n))}}}return t}createPreviewShape(e){let t=new RectangleShape(e,NONE,this.previewColor);return t.isDashed=!0,this.htmlPreview?(t.dialect=DIALECT.STRICTHTML,t.init(this.graph.container)):(t.dialect=DIALECT.SVG,t.init(this.graph.getView().getOverlayPane()),t.pointerEvents=!1,Client.IS_IOS&&(t.getSvgScreenOffset=()=>0)),t}createGuide(){return new Guide(this.graph,this.getGuideStates())}start(e,t,i,s){this.cell=e,this.first=convertPoint(this.graph.container,t,i),this.cells=s||this.getCells(this.cell),this.bounds=this.graph.getView().getBounds(this.cells),this.pBounds=this.getPreviewBounds(this.cells),this.cloning=!1,this.cellCount=0;for(let e=0;e<this.cells.length;e+=1)this.cellCount+=this.addStates(this.cells[e],this.allCells);if(this.guidesEnabled){this.guide=this.createGuide();let t=e.getParent(),i=2>t.getChildCount(),s=new Dictionary,n=this.graph.getOpposites(this.graph.getEdges(this.cell),this.cell);for(let e=0;e<n.length;e+=1){let t=this.graph.view.getState(n[e]);t&&!s.get(t)&&s.put(t,!0)}this.guide.isStateIgnored=e=>{let n=e.cell.getParent();return!!e.cell&&(!this.cloning&&!!this.isCellMoving(e.cell)||e.cell!==(this.target||t)&&!i&&!s.get(e)&&(!this.target||this.target.getChildCount()>=2)&&n!==(this.target||t))}}}addStates(e,t){let i=this.graph.view.getState(e),s=0;if(i&&!t.get(e)){t.put(e,i),s++;let n=e.getChildCount();for(let i=0;i<n;i+=1)s+=this.addStates(e.getChildAt(i),t)}return s}isCellMoving(e){return this.allCells.get(e)}useGuidesForEvent(e){return!this.guide||this.guide.isEnabledForEvent(e.getEvent())&&!this.graph.isConstrainedEvent(e.getEvent())}snap(e){let t=this.scaleGrid?this.graph.view.scale:1;return e.x=this.graph.snap(e.x/t)*t,e.y=this.graph.snap(e.y/t)*t,e}getDelta(e){let t=convertPoint(this.graph.container,e.getX(),e.getY());return this.first?new Point(t.x-this.first.x-this.graph.getPanDx(),t.y-this.first.y-this.graph.getPanDy()):new Point}updateHint(e){}removeHint(){}roundLength(e){return Math.round(100*e)/100}isValidDropTarget(e,t){return!!this.cell&&this.cell.getParent()!==e}checkPreview(){this.livePreviewActive&&this.cloning?(this.resetLivePreview(),this.livePreviewActive=!1):this.maxLivePreview>=this.cellCount&&!this.livePreviewActive&&this.allowLivePreview?this.cloning&&this.livePreviewActive||(this.livePreviewActive=!0,this.livePreviewUsed=!0):this.livePreviewUsed||this.shape||!this.bounds||(this.shape=this.createPreviewShape(this.bounds))}mouseMove(e,t){let{graph:i}=this;if(!t.isConsumed()&&i.isMouseDown&&this.cell&&this.first&&this.bounds&&!this.suspended){if(isMultiTouchEvent(t.getEvent())){this.reset();return}let e=this.getDelta(t),s=i.getEventTolerance();if(this.shape||this.livePreviewActive||Math.abs(e.x)>s||Math.abs(e.y)>s){this.highlight||(this.highlight=new CellHighlight(this.graph,DROP_TARGET_COLOR,3));let s=i.isCloneEvent(t.getEvent())&&i.isCellsCloneable()&&this.isCloneEnabled(),n=i.isGridEnabledEvent(t.getEvent()),a=t.getCell(),l=!0,r=null;this.cloning=s,i.isDropEnabled()&&this.highlightEnabled&&this.cells&&(r=i.getDropTarget(this.cells,t.getEvent(),a,s));let o=r?i.getView().getState(r):null,h=!1;if(o&&(s||r&&this.isValidDropTarget(r,t)))this.target!==r&&(this.target=r,this.setHighlightColor(DROP_TARGET_COLOR)),h=!0;else if(this.target=null,this.connectOnDrop&&a&&this.cells&&1===this.cells.length&&a.isVertex()&&a.isConnectable()&&(o=i.getView().getState(a))){let e=null===i.getEdgeValidationError(null,this.cell,a)?VALID_COLOR:INVALID_CONNECT_TARGET_COLOR;this.setHighlightColor(e),h=!0}o&&h?this.highlight.highlight(o):this.highlight.hide(),this.guide&&this.useGuidesForEvent(t)?(e=this.guide.move(this.bounds,e,n,s),l=!1):e=this.graph.snapDelta(e,this.bounds,!n,!1,!1),this.guide&&l&&this.guide.hide(),i.isConstrainedEvent(t.getEvent())&&(Math.abs(e.x)>Math.abs(e.y)?e.y=0:e.x=0),this.checkPreview(),(this.currentDx!==e.x||this.currentDy!==e.y)&&(this.currentDx=e.x,this.currentDy=e.y,this.updatePreview())}this.updateHint(t),this.consumeMouseEvent(InternalEvent.MOUSE_MOVE,t),InternalEvent.consume(t.getEvent())}else if((this.isMoveEnabled()||this.isCloneEnabled())&&this.updateCursor&&!t.isConsumed()&&(t.getState()||t.sourceState)&&!i.isMouseDown){let e=i.getCursorForMouseEvent(t),s=t.getCell();!e&&s&&i.isEnabled()&&i.isCellMovable(s)&&(e=s.isEdge()?CURSOR.MOVABLE_EDGE:CURSOR.MOVABLE_VERTEX),e&&t.sourceState&&t.sourceState.setCursor(e)}}updatePreview(e=!1){var t;this.livePreviewUsed&&!e?this.cells&&(this.setHandlesVisibleForCells((null==(t=this.getSelectionCellsHandler())?void 0:t.getHandledSelectionCells())??[],!1),this.updateLivePreview(this.currentDx,this.currentDy)):this.updatePreviewShape()}updatePreviewShape(){this.shape&&this.pBounds&&(this.shape.bounds=new Rectangle(Math.round(this.pBounds.x+this.currentDx),Math.round(this.pBounds.y+this.currentDy),this.pBounds.width,this.pBounds.height),this.shape.redraw())}updateLivePreview(e,t){if(!this.suspended){let i=[];if(this.allCells&&this.allCells.visit((s,n)=>{let a=n?this.graph.view.getState(n.cell):null;if(a!==n&&n&&(n.destroy(),a?this.allCells.put(n.cell,a):this.allCells.remove(n.cell),n=a),n){let s=n.clone();i.push([n,s]),n.shape&&(null===n.shape.originalPointerEvents&&(n.shape.originalPointerEvents=n.shape.pointerEvents),n.shape.pointerEvents=!1,n.text&&(null===n.text.originalPointerEvents&&(n.text.originalPointerEvents=n.text.pointerEvents),n.text.pointerEvents=!1)),n.cell.isVertex()&&(n.x+=e,n.y+=t,this.cloning?n.text&&(n.text.updateBoundingBox(),n.text.boundingBox&&(n.text.boundingBox.x+=e,n.text.boundingBox.y+=t),n.text.unrotatedBoundingBox&&(n.text.unrotatedBoundingBox.x+=e,n.text.unrotatedBoundingBox.y+=t)):(n.view.graph.cellRenderer.redraw(n,!0),n.view.invalidate(n.cell),n.invalid=!1,n.control&&n.control.node&&(n.control.node.style.visibility="hidden")))}}),0===i.length)this.reset();else{let s=this.graph.view.scale;for(let n=0;n<i.length;n+=1){let a=i[n][0];if(a.cell.isEdge()){let l=a.cell.getGeometry(),r=[];if(l&&l.points)for(let i=0;i<l.points.length;i++)l.points[i]&&r.push(new Point(l.points[i].x+e/s,l.points[i].y+t/s));let o=a.visibleSourceState,h=a.visibleTargetState,c=i[n][1].absolutePoints;if(null!=o&&this.isCellMoving(o.cell))a.view.updateFixedTerminalPoint(a,o,!0,this.graph.getConnectionConstraint(a,o,!0));else{let i=c[0];i&&(a.setAbsoluteTerminalPoint(new Point(i.x+e,i.y+t),!0),o=null)}if(null!=h&&this.isCellMoving(h.cell))a.view.updateFixedTerminalPoint(a,h,!1,this.graph.getConnectionConstraint(a,h,!1));else{let i=c[c.length-1];i&&(a.setAbsoluteTerminalPoint(new Point(i.x+e,i.y+t),!1),h=null)}a.view.updatePoints(a,r,o,h),a.view.updateFloatingTerminalPoints(a,o,h),a.view.updateEdgeLabelOffset(a),a.invalid=!1,this.cloning||a.view.graph.cellRenderer.redraw(a,!0)}}this.graph.view.validate(),this.redrawHandles(i),this.resetPreviewStates(i)}}}redrawHandles(e){let t=this.getSelectionCellsHandler();for(let i=0;i<e.length;i+=1){let s=null==t?void 0:t.getHandler(e[i][0].cell);null==s||s.redraw(!0)}}resetPreviewStates(e){for(let t=0;t<e.length;t+=1)e[t][0].setState(e[t][1])}suspend(){this.suspended||(this.livePreviewUsed&&this.updateLivePreview(0,0),this.shape&&(this.shape.node.style.visibility="hidden"),this.guide&&this.guide.setVisible(!1),this.suspended=!0)}resume(){this.suspended&&(this.suspended=!1,this.livePreviewUsed&&(this.livePreviewActive=!0),this.shape&&(this.shape.node.style.visibility="visible"),this.guide&&this.guide.setVisible(!0))}resetLivePreview(){this.allCells.visit((e,t)=>{t.shape&&null!==t.shape.originalPointerEvents&&(t.shape.pointerEvents=t.shape.originalPointerEvents,t.shape.originalPointerEvents=null,t.shape.bounds=null,t.text&&null!==t.text.originalPointerEvents&&(t.text.pointerEvents=t.text.originalPointerEvents,t.text.originalPointerEvents=null)),t.control&&t.control.node&&"hidden"===t.control.node.style.visibility&&(t.control.node.style.visibility=""),!this.cloning&&t.text&&t.text.updateBoundingBox(),t.view.invalidate(t.cell)}),this.graph.view.validate()}setHandlesVisibleForCells(e,t,i=!1){if(i||this.handlesVisible!==t){this.handlesVisible=t;let i=this.getSelectionCellsHandler();for(let s=0;s<e.length;s+=1){let n=null==i?void 0:i.getHandler(e[s]);n&&(n.setHandlesVisible(t),t&&n.redraw())}}}setHighlightColor(e){this.highlight&&this.highlight.setHighlightColor(e)}mouseUp(e,t){if(!t.isConsumed())if(this.livePreviewUsed&&this.resetLivePreview(),this.cell&&this.first&&(this.shape||this.livePreviewUsed)&&isNumeric(this.currentDx)&&isNumeric(this.currentDy)){let{graph:e}=this,i=t.getCell();if(this.connectOnDrop&&!this.target&&i&&i.isVertex()&&i.isConnectable()&&e.isEdgeValid(null,this.cell,i)){let s=e.getPlugin("ConnectionHandler");null==s||s.connect(this.cell,i,t.getEvent())}else{let i=e.isCloneEvent(t.getEvent())&&e.isCellsCloneable()&&this.isCloneEnabled(),{scale:s}=e.getView(),n=this.roundLength(this.currentDx/s),a=this.roundLength(this.currentDy/s),l=this.target;l&&e.isSplitEnabled()&&this.cells&&e.isSplitTarget(l,this.cells,t.getEvent())?e.splitEdge(l,this.cells,null,n,a,t.getGraphX(),t.getGraphY()):this.cells&&this.moveCells(this.cells,n,a,i,this.target,t.getEvent())}}else this.isSelectEnabled()&&this.delayedSelection&&null!=this.cell&&this.selectDelayed(t);this.cellWasClicked&&this.consumeMouseEvent(InternalEvent.MOUSE_UP,t),this.reset()}reset(){var e;this.livePreviewUsed&&(this.resetLivePreview(),this.setHandlesVisibleForCells((null==(e=this.getSelectionCellsHandler())?void 0:e.getHandledSelectionCells())??[],!0)),this.destroyShapes(),this.removeHint(),this.delayedSelection=!1,this.livePreviewActive=!1,this.livePreviewUsed=!1,this.cellWasClicked=!1,this.suspended=!1,this.currentDx=0,this.currentDy=0,this.cellCount=0,this.cloning=!1,this.allCells.clear(),this.pBounds=null,this.target=null,this.first=null,this.cells=null,this.cell=null}shouldRemoveCellsFromParent(e,t,i){if(e.isVertex()){let t=this.graph.getView().getState(e);if(t){let e=convertPoint(this.graph.container,getClientX(i),getClientY(i)),s=toRadians(t.style.rotation??0);return 0!==s&&(e=getRotatedPoint(e,Math.cos(-s),Math.sin(-s),new Point(t.getCenterX(),t.getCenterY()))),!contains(t,e.x,e.y)}}return!1}moveCells(e,t,i,s,n,a){if(!this.cell)return;s&&(e=this.graph.getCloneableCells(e));let l=this.cell.getParent();!n&&l&&this.isRemoveCellsFromParent()&&this.shouldRemoveCellsFromParent(l,e,a)&&(n=this.graph.getDefaultParent()),s=!!s&&!this.graph.isCellLocked(n||this.graph.getDefaultParent()),this.graph.batchUpdate(()=>{let l=[];if(!s&&n&&this.removeEmptyParents){let t=new Dictionary;for(let i=0;i<e.length;i+=1)t.put(e[i],!0);for(let i=0;i<e.length;i+=1){let s=e[i].getParent();s&&!t.get(s)&&(t.put(s,!0),l.push(s))}}e=this.graph.moveCells(e,t,i,s,n,a);let r=[];for(let e=0;e<l.length;e+=1)this.shouldRemoveParent(l[e])&&r.push(l[e]);this.graph.removeCells(r,!1)}),s&&this.graph.setSelectionCells(e),this.isSelectEnabled()&&this.scrollOnMove&&this.graph.scrollCellToVisible(e[0])}shouldRemoveParent(e){let t=this.graph.view.getState(e);return null!=t&&(t.cell.isEdge()||t.cell.isVertex())&&this.graph.isCellDeletable(t.cell)&&0===t.cell.getChildCount()&&t.isTransparentState()}destroyShapes(){this.shape&&(this.shape.destroy(),this.shape=null),this.guide&&(this.guide.destroy(),this.guide=null),this.highlight&&(this.highlight.destroy(),this.highlight=null)}onDestroy(){this.graph.removeMouseListener(this),this.graph.removeListener(this.panHandler),this.graph.removeListener(this.escapeHandler),this.graph.getDataModel().removeListener(this.refreshHandler),this.graph.removeListener(this.refreshHandler),InternalEvent.removeListener(document,"keydown",this.keyHandler),InternalEvent.removeListener(document,"keyup",this.keyHandler),this.destroyShapes(),this.removeHint()}getSelectionCellsHandler(){return this.graph.getPlugin("SelectionCellsHandler")}}SelectionHandler.pluginId="SelectionHandler";class PanningManager{constructor(e){this.damper=1/6,this.delay=10,this.handleMouseOut=!0,this.border=0,this.thread=null,this.active=!1,this.tdx=0,this.tdy=0,this.t0x=0,this.t0y=0,this.dx=0,this.dy=0,this.scrollbars=!1,this.scrollLeft=0,this.scrollTop=0,this.thread=null,this.active=!1,this.tdx=0,this.tdy=0,this.t0x=0,this.t0y=0,this.dx=0,this.dy=0,this.scrollbars=!1,this.scrollLeft=0,this.scrollTop=0,this.mouseListener={mouseDown:(e,t)=>{},mouseMove:(e,t)=>{},mouseUp:(e,t)=>{this.active&&this.stop()}},e.addMouseListener(this.mouseListener),this.mouseUpListener=()=>{this.active&&this.stop()},InternalEvent.addListener(document,"mouseup",this.mouseUpListener);let t=()=>(this.scrollbars=hasScrollbars(e.container),this.scrollLeft=e.container.scrollLeft,this.scrollTop=e.container.scrollTop,window.setInterval(()=>{if(this.tdx-=this.dx,this.tdy-=this.dy,this.scrollbars){let t=-e.container.scrollLeft-Math.ceil(this.dx),i=-e.container.scrollTop-Math.ceil(this.dy);e.panGraph(t,i),e.setPanDx(this.scrollLeft-e.container.scrollLeft),e.setPanDy(this.scrollTop-e.container.scrollTop),e.fireEvent(new EventObject(InternalEvent.PAN))}else e.panGraph(this.getDx(),this.getDy())},this.delay));this.isActive=()=>this.active,this.getDx=()=>Math.round(this.tdx),this.getDy=()=>Math.round(this.tdy),this.start=()=>{this.t0x=e.view.translate.x,this.t0y=e.view.translate.y,this.active=!0},this.panTo=(i,s,n=0,a=0)=>{this.active||this.start(),this.scrollLeft=e.container.scrollLeft,this.scrollTop=e.container.scrollTop;let l=e.container;this.dx=i+n-l.scrollLeft-l.clientWidth,this.dx<0&&Math.abs(this.dx)<this.border?this.dx=this.border+this.dx:this.handleMouseOut?this.dx=Math.max(this.dx,0):this.dx=0,0==this.dx&&(this.dx=i-l.scrollLeft,this.dx>0&&this.dx<this.border?this.dx-=this.border:this.handleMouseOut?this.dx=Math.min(0,this.dx):this.dx=0),this.dy=s+a-l.scrollTop-l.clientHeight,this.dy<0&&Math.abs(this.dy)<this.border?this.dy=this.border+this.dy:this.handleMouseOut?this.dy=Math.max(this.dy,0):this.dy=0,0==this.dy&&(this.dy=s-l.scrollTop,this.dy>0&&this.dy<this.border?this.dy-=this.border:this.handleMouseOut?this.dy=Math.min(0,this.dy):this.dy=0),0!=this.dx||0!=this.dy?(this.dx*=this.damper,this.dy*=this.damper,null==this.thread&&(this.thread=t())):null!=this.thread&&(window.clearInterval(this.thread),this.thread=null)},this.stop=()=>{if(this.active)if(this.active=!1,null!=this.thread&&(window.clearInterval(this.thread),this.thread=null),this.tdx=0,this.tdy=0,this.scrollbars)e.setPanDx(0),e.setPanDy(0),e.fireEvent(new EventObject(InternalEvent.PAN));else{let t=e.getPanDx(),i=e.getPanDy();(0!=t||0!=i)&&(e.panGraph(0,0),e.view.setTranslate(this.t0x+t/e.view.scale,this.t0y+i/e.view.scale))}},this.destroy=()=>{e.removeMouseListener(this.mouseListener),InternalEvent.removeListener(document,"mouseup",this.mouseUpListener)}}}class PanningHandler extends EventSource{constructor(e){super(),this.getPanningManager=()=>this.panningManager,this.useLeftButtonForPanning=!1,this.usePopupTrigger=!0,this.ignoreCell=!1,this.previewEnabled=!0,this.useGrid=!1,this.panningEnabled=!1,this.pinchEnabled=!0,this.initialScale=0,this.maxScale=8,this.minScale=.01,this.dx=0,this.dy=0,this.startX=0,this.startY=0,this.dx0=0,this.dy0=0,this.panningTrigger=!1,this.active=!1,this.mouseDownEvent=null,this.graph=e,this.graph.addMouseListener(this),this.forcePanningHandler=(e,t)=>{let i=t.getProperty("eventName"),s=t.getProperty("event");i===InternalEvent.MOUSE_DOWN&&this.isForcePanningEvent(s)&&(this.start(s),this.active=!0,this.fireEvent(new EventObject(InternalEvent.PAN_START,{event:s})),s.consume())},this.graph.addListener(InternalEvent.FIRE_MOUSE_EVENT,this.forcePanningHandler),this.gestureHandler=(e,t)=>{if(this.isPinchEnabled()){let e=t.getProperty("event");isConsumed(e)||"gesturestart"!==e.type?"gestureend"===e.type&&0!==this.initialScale&&(this.initialScale=0):(this.initialScale=this.graph.view.scale,!this.active&&this.mouseDownEvent&&(this.start(this.mouseDownEvent),this.mouseDownEvent=null)),0!==this.initialScale&&this.zoomGraph(e)}},this.graph.addListener(InternalEvent.GESTURE,this.gestureHandler),this.mouseUpListener=()=>{this.active&&this.reset()},InternalEvent.addListener(document,"mouseup",this.mouseUpListener),this.panningManager=new PanningManager(e)}isActive(){return this.active||null!==this.initialScale}isPanningEnabled(){return this.panningEnabled}setPanningEnabled(e){this.panningEnabled=e}isPinchEnabled(){return this.pinchEnabled}setPinchEnabled(e){this.pinchEnabled=e}isPanningTrigger(e){let t=e.getEvent();return this.useLeftButtonForPanning&&!e.getState()&&isLeftMouseButton(t)||isControlDown(t)&&isShiftDown(t)||this.usePopupTrigger&&isPopupTrigger(t)}isForcePanningEvent(e){return this.ignoreCell||isMultiTouchEvent(e.getEvent())}mouseDown(e,t){this.mouseDownEvent=t,!t.isConsumed()&&this.isPanningEnabled()&&!this.active&&this.isPanningTrigger(t)&&(this.start(t),this.consumePanningTrigger(t))}start(e){this.dx0=-this.graph.container.scrollLeft,this.dy0=-this.graph.container.scrollTop,this.startX=e.getX(),this.startY=e.getY(),this.dx=0,this.dy=0,this.panningTrigger=!0}consumePanningTrigger(e){e.consume()}mouseMove(e,t){if(this.dx=t.getX()-this.startX,this.dy=t.getY()-this.startY,this.active)this.previewEnabled&&(this.useGrid&&(this.dx=this.graph.snap(this.dx),this.dy=this.graph.snap(this.dy)),this.graph.panGraph(this.dx+this.dx0,this.dy+this.dy0)),this.fireEvent(new EventObject(InternalEvent.PAN,{event:t}));else if(this.panningTrigger){let e=this.active;this.active=Math.abs(this.dx)>this.graph.getSnapTolerance()||Math.abs(this.dy)>this.graph.getSnapTolerance(),!e&&this.active&&this.fireEvent(new EventObject(InternalEvent.PAN_START,{event:t}))}(this.active||this.panningTrigger)&&t.consume()}mouseUp(e,t){if(this.active){if(0!==this.dx&&0!==this.dy){if(!this.graph.isUseScrollbarsForPanning()||!hasScrollbars(this.graph.container)){let{scale:e}=this.graph.getView(),t=this.graph.getView().translate;this.graph.panGraph(0,0),this.panGraph(t.x+this.dx/e,t.y+this.dy/e)}t.consume()}this.fireEvent(new EventObject(InternalEvent.PAN_END,{event:t}))}this.reset()}zoomGraph(e){let t=Math.round(this.initialScale*e.scale*100)/100;t=Math.max(this.minScale,t),t=Math.min(this.maxScale,t),this.graph.view.scale!==t&&(this.graph.zoomTo(t),InternalEvent.consume(e))}reset(){this.panningTrigger=!1,this.mouseDownEvent=null,this.active=!1,this.dx=0,this.dy=0}panGraph(e,t){this.graph.getView().setTranslate(e,t)}onDestroy(){this.graph.removeMouseListener(this),this.graph.removeListener(this.forcePanningHandler),this.graph.removeListener(this.gestureHandler),InternalEvent.removeListener(document,"mouseup",this.mouseUpListener)}}function keep2digits(e){return Number(e.toFixed(2))}PanningHandler.pluginId="PanningHandler";class FitPlugin{constructor(e){this.graph=e,this.maxFitScale=8}fitCenter(e){let t=(null==e?void 0:e.margin)??2,{container:i,view:s}=this.graph,n=i.clientWidth-2*t,a=i.clientHeight-2*t,l=this.graph.getGraphBounds(),r=s.scale,o=l.width/r,h=l.height/r,c=Math.min(this.maxFitScale??1/0,n/o,a/h),d=Math.floor(s.translate.x+(i.clientWidth-o*c)/(2*c)-l.x/r),u=Math.floor(s.translate.y+(i.clientHeight-h*c)/(2*c)-l.y/r);return c=keep2digits(c),s.scaleAndTranslate(c,d,u),c}onDestroy(){}}FitPlugin.pluginId="fit";class RubberBandHandler{constructor(e){this.first=null,this.destroyed=!1,this.dragHandler=null,this.dropHandler=null,this.x=0,this.y=0,this.width=0,this.height=0,this.defaultOpacity=20,this.enabled=!0,this.div=null,this.sharedDiv=null,this.currentX=0,this.currentY=0,this.fadeOut=!1,this.graph=e,this.graph.addMouseListener(this),this.forceRubberbandHandler=(e,t)=>{let i=t.getProperty("eventName"),s=t.getProperty("event");if(i===InternalEvent.MOUSE_DOWN&&this.isForceRubberbandEvent(s)){let e=getOffset(this.graph.container),t=getScrollOrigin(this.graph.container);t.x-=e.x,t.y-=e.y,this.start(s.getX()+t.x,s.getY()+t.y),s.consume(!1)}},this.graph.addListener(InternalEvent.FIRE_MOUSE_EVENT,this.forceRubberbandHandler),this.panHandler=()=>{this.repaint()},this.graph.addListener(InternalEvent.PAN,this.panHandler),this.gestureHandler=(e,t)=>{this.first&&this.reset()},this.graph.addListener(InternalEvent.GESTURE,this.gestureHandler)}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}isForceRubberbandEvent(e){return isAltDown(e.getEvent())}mouseDown(e,t){if(!t.isConsumed()&&this.isEnabled()&&this.graph.isEnabled()&&!t.getState()&&!isMultiTouchEvent(t.getEvent())){let e=getOffset(this.graph.container),i=getScrollOrigin(this.graph.container);i.x-=e.x,i.y-=e.y,this.start(t.getX()+i.x,t.getY()+i.y),t.consume(!1)}}start(e,t){this.first=new Point(e,t);let{container:i}=this.graph;function s(e){let t=new InternalMouseEvent(e),s=convertPoint(i,t.getX(),t.getY());return t.graphX=s.x,t.graphY=s.y,t}this.dragHandler=e=>{this.mouseMove(this.graph,s(e))},this.dropHandler=e=>{this.mouseUp(this.graph,s(e))},Client.IS_FF&&InternalEvent.addGestureListeners(document,null,this.dragHandler,this.dropHandler)}mouseMove(e,t){if(!t.isConsumed()&&this.first){let e=getScrollOrigin(this.graph.container),i=getOffset(this.graph.container);e.x-=i.x,e.y-=i.y;let s=t.getX()+e.x,n=t.getY()+e.y,a=this.first.x-s,l=this.first.y-n,r=this.graph.getEventTolerance();(this.div||Math.abs(a)>r||Math.abs(l)>r)&&(this.div||(this.div=this.createShape()),clearSelection(),this.update(s,n),t.consume())}}createShape(){this.sharedDiv||(this.sharedDiv=document.createElement("div"),this.sharedDiv.className="mxRubberband",setOpacity(this.sharedDiv,this.defaultOpacity)),this.graph.container.appendChild(this.sharedDiv);let e=this.sharedDiv;return Client.IS_SVG&&this.fadeOut&&(this.sharedDiv=null),e}isActive(e,t){return this.div&&"none"!==this.div.style.display}mouseUp(e,t){let i=this.isActive();this.reset(),i&&(this.execute(t.getEvent()),t.consume())}execute(e){let t=new Rectangle(this.x,this.y,this.width,this.height);this.graph.selectRegion(t,e)}reset(){if(this.div)if(Client.IS_SVG&&this.fadeOut){let e=this.div;setPrefixedStyle(e.style,"transition","all 0.2s linear"),e.style.pointerEvents="none",e.style.opacity=String(0),window.setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},200)}else this.div.parentNode&&this.div.parentNode.removeChild(this.div);InternalEvent.removeGestureListeners(document,null,this.dragHandler,this.dropHandler),this.dragHandler=null,this.dropHandler=null,this.currentX=0,this.currentY=0,this.first=null,this.div=null}update(e,t){this.currentX=e,this.currentY=t,this.repaint()}repaint(){if(this.div&&this.first){let e=this.currentX-this.graph.getPanDx(),t=this.currentY-this.graph.getPanDy();this.x=Math.min(this.first.x,e),this.y=Math.min(this.first.y,t),this.width=Math.max(this.first.x,e)-this.x,this.height=Math.max(this.first.y,t)-this.y;let i=0,s=0;this.div.style.left=`${this.x+i}px`,this.div.style.top=`${this.y+s}px`,this.div.style.width=`${Math.max(1,this.width)}px`,this.div.style.height=`${Math.max(1,this.height)}px`}}onDestroy(){!this.destroyed&&(this.destroyed=!0,this.graph.removeMouseListener(this),this.graph.removeListener(this.forceRubberbandHandler),this.graph.removeListener(this.panHandler),this.reset(),this.sharedDiv&&(this.sharedDiv=null))}}RubberBandHandler.pluginId="RubberBandHandler";let getDefaultPlugins=()=>[CellEditorHandler,TooltipHandler,SelectionCellsHandler,PopupMenuHandler,ConnectionHandler,SelectionHandler,PanningHandler,FitPlugin];class Graph extends EventSource{createCellRenderer(){return new CellRenderer}createEdgeHandlerInstance(e){return new EdgeHandler(e)}createEdgeSegmentHandler(e){return new EdgeSegmentHandler(e)}createElbowEdgeHandler(e){return new ElbowEdgeHandler(e)}createGraphDataModel(){return new GraphDataModel}createGraphView(){return new GraphView(this)}createSelectionModel(){return new GraphSelectionModel(this)}createStylesheet(){return new Stylesheet}createVertexHandler(e){return new VertexHandler(e)}registerDefaults(){registerDefaultShapes(),registerDefaultStyleElements(),registerDefaultEdgeMarkers()}constructor(e,t,i=getDefaultPlugins(),s=null){super(),this.destroyed=!1,this.graphModelChangeListener=null,this.paintBackground=null,this.isConstrainedMoving=!1,this.cells=[],this.imageBundles=[],this.mouseListeners=[],this.multiplicities=[],this.plugins={},this.renderHint=null,this.dialect="svg",this.defaultOverlap=.5,this.defaultParent=null,this.backgroundImage=null,this.pageVisible=!1,this.pageBreaksVisible=!1,this.pageBreakColor="gray",this.pageBreakDashed=!0,this.minPageBreakDist=20,this.preferPageSize=!1,this.pageFormat=new Rectangle(...PAGE_FORMAT_A4_PORTRAIT),this.pageScale=1.5,this.enabled=!0,this.exportEnabled=!0,this.importEnabled=!0,this.ignoreScrollbars=!1,this.translateToScrollPosition=!1,this.maximumGraphBounds=null,this.minimumGraphSize=null,this.minimumContainerSize=null,this.maximumContainerSize=null,this.resizeContainer=!1,this.border=0,this.keepEdgesInForeground=!1,this.keepEdgesInBackground=!1,this.recursiveResize=!1,this.resetViewOnRootChange=!0,this.allowLoops=!1,this.defaultLoopStyle=EdgeStyle.Loop,this.multigraph=!0,this.minFitScale=.1,this.maxFitScale=8,this.warningImage=new ImageBox(`${Client.imageBasePath}/warning${Client.IS_MAC?".png":".gif"}`,16,16),this.alreadyConnectedResource=isI18nEnabled()?"alreadyConnected":"",this.containsValidationErrorsResource=isI18nEnabled()?"containsValidationErrors":"",this.options={foldingEnabled:!0,collapsedImage:new ImageBox(`${Client.imageBasePath}/collapsed.gif`,9,9),expandedImage:new ImageBox(`${Client.imageBasePath}/expanded.gif`,9,9),collapseToPreferredSize:!0},this.getContainer=()=>this.container,this.getPlugin=e=>this.plugins[e],this.getCellRenderer=()=>this.cellRenderer,this.getDialect=()=>this.dialect,this.isPageVisible=()=>this.pageVisible,this.isPageBreaksVisible=()=>this.pageBreaksVisible,this.getPageBreakColor=()=>this.pageBreakColor,this.isPageBreakDashed=()=>this.pageBreakDashed,this.getMinPageBreakDist=()=>this.minPageBreakDist,this.isPreferPageSize=()=>this.preferPageSize,this.getPageFormat=()=>this.pageFormat,this.getPageScale=()=>this.pageScale,this.isExportEnabled=()=>this.exportEnabled,this.isImportEnabled=()=>this.importEnabled,this.isIgnoreScrollbars=()=>this.ignoreScrollbars,this.isTranslateToScrollPosition=()=>this.translateToScrollPosition,this.getMinimumGraphSize=()=>this.minimumGraphSize,this.setMinimumGraphSize=e=>this.minimumGraphSize=e,this.getMinimumContainerSize=()=>this.minimumContainerSize,this.setMinimumContainerSize=e=>this.minimumContainerSize=e,this.getAlreadyConnectedResource=()=>this.alreadyConnectedResource,this.getContainsValidationErrorsResource=()=>this.containsValidationErrorsResource,this.registerDefaults(),this.container=e??document.createElement("div"),this.model=t??this.createGraphDataModel(),this.cellRenderer=this.createCellRenderer(),this.setStylesheet(s??this.createStylesheet()),this.view=this.createGraphView(),this.graphModelChangeListener=(e,t)=>{this.graphModelChanged(t.getProperty("edit").changes)},this.getDataModel().addListener(InternalEvent.CHANGE,this.graphModelChangeListener),this.view.init(),this.sizeDidChange(),this.setSelectionModel(this.createSelectionModel()),i.forEach(e=>this.plugins[e.pluginId]=new e(this)),this.view.revalidate()}getWarningImage(){return this.warningImage}batchUpdate(e){this.getDataModel().batchUpdate(e)}getDataModel(){return this.model}getView(){return this.view}getStylesheet(){return this.stylesheet}setStylesheet(e){this.stylesheet=e}graphModelChanged(e){for(let t of e)this.processChange(t);this.updateSelection(),this.view.validate(),this.sizeDidChange()}processChange(e){if(e instanceof RootChange)this.clearSelection(),this.setDefaultParent(null),e.previous&&this.removeStateForCell(e.previous),this.resetViewOnRootChange&&(this.view.scale=1,this.view.translate.x=0,this.view.translate.y=0),this.fireEvent(new EventObject(InternalEvent.ROOT));else if(e instanceof ChildChange){let t=e.child.getParent();this.view.invalidate(e.child,!0,!0),(!t||!this.getDataModel().contains(t)||t.isCollapsed())&&(this.view.invalidate(e.child,!0,!0),this.removeStateForCell(e.child),this.view.currentRoot==e.child&&this.home()),t!=e.previous&&(null!=t&&this.view.invalidate(t,!1,!1),null!=e.previous&&this.view.invalidate(e.previous,!1,!1))}else if(e instanceof TerminalChange||e instanceof GeometryChange)(e instanceof TerminalChange||null==e.previous&&null!=e.geometry||null!=e.previous&&!e.previous.equals(e.geometry))&&this.view.invalidate(e.cell);else if(e instanceof ValueChange)this.view.invalidate(e.cell,!1,!1);else if(e instanceof StyleChange){this.view.invalidate(e.cell,!0,!0);let t=this.view.getState(e.cell);null!=t&&(t.invalidStyle=!0)}else null!=e.cell&&e.cell instanceof Cell&&this.removeStateForCell(e.cell)}scrollPointToVisible(e,t,i=!1,s=20){let n=this.getPlugin("PanningHandler");if(!this.isTimerAutoScroll()&&(this.ignoreScrollbars||hasScrollbars(this.container))){let n=this.container;if(e>=n.scrollLeft&&t>=n.scrollTop&&e<=n.scrollLeft+n.clientWidth&&t<=n.scrollTop+n.clientHeight){let a=n.scrollLeft+n.clientWidth-e;if(a<s){let e=n.scrollLeft;if(n.scrollLeft+=s-a,i&&e===n.scrollLeft){let e=this.view.getDrawPane().ownerSVGElement,t=n.scrollWidth+s-a;e.style.width=`${t}px`,n.scrollLeft+=s-a}}else(a=e-n.scrollLeft)<s&&(n.scrollLeft-=s-a);let l=n.scrollTop+n.clientHeight-t;if(l<s){let e=n.scrollTop;if(n.scrollTop+=s-l,e==n.scrollTop&&i){let e=this.view.getDrawPane().ownerSVGElement,t=n.scrollHeight+s-l;e.style.height=`${t}px`,n.scrollTop+=s-l}}else(l=t-n.scrollTop)<s&&(n.scrollTop-=s-l)}}else this.isAllowAutoPanning()&&n&&!n.isActive()&&n.getPanningManager().panTo(e+this.getPanDx(),t+this.getPanDy())}getBorderSizes(){let e=getCurrentStyle(this.container);return new Rectangle(parseCssNumber(e.paddingLeft)+("none"!=e.borderLeftStyle?parseCssNumber(e.borderLeftWidth):0),parseCssNumber(e.paddingTop)+("none"!=e.borderTopStyle?parseCssNumber(e.borderTopWidth):0),parseCssNumber(e.paddingRight)+("none"!=e.borderRightStyle?parseCssNumber(e.borderRightWidth):0),parseCssNumber(e.paddingBottom)+("none"!=e.borderBottomStyle?parseCssNumber(e.borderBottomWidth):0))}getPreferredPageSize(e,t,i){let s=this.view.translate,n=this.pageFormat,a=this.pageScale,l=new Rectangle(0,0,Math.ceil(n.width*a),Math.ceil(n.height*a)),r=this.pageBreaksVisible?Math.ceil(t/l.width):1,o=this.pageBreaksVisible?Math.ceil(i/l.height):1;return new Rectangle(0,0,r*l.width+2+s.x,o*l.height+2+s.y)}fit(e=this.getBorder(),t=!1,i=0,s=!0,n=!1,a=!1,l=null){let{container:r,view:o}=this;if(r){let h=this.getBorderSizes(),c=r.offsetWidth-h.x-h.width-1,d=null!=l?l:r.offsetHeight-h.y-h.height-1,u=o.getGraphBounds();if(u.width>0&&u.height>0){t&&null!=u.x&&null!=u.y&&(u=u.clone(),u.width+=u.x,u.height+=u.y,u.x=0,u.y=0);let l=o.scale,h=u.width/l,p=u.height/l;this.backgroundImage&&(h=Math.max(h,this.backgroundImage.width-u.x/l),p=Math.max(p,this.backgroundImage.height-u.y/l));let g=(t?e:2*e)+i+1;c-=g,d-=g;let m=n?d/p:a?c/h:Math.min(c/h,d/p);if(null!=this.minFitScale&&(m=Math.max(m,this.minFitScale)),null!=this.maxFitScale&&(m=Math.min(m,this.maxFitScale)),!s)return m;if(t)o.scale!=m&&o.setScale(m);else if(hasScrollbars(r)){o.setScale(m);let e=this.getGraphBounds();null!=e.x&&(r.scrollLeft=e.x),null!=e.y&&(r.scrollTop=e.y)}else{let t=null!=u.x?Math.floor(o.translate.x-u.x/l+e/m+i/2):e,s=null!=u.y?Math.floor(o.translate.y-u.y/l+e/m+i/2):e;o.scaleAndTranslate(m,t,s)}}}return o.scale}doResizeContainer(e,t){null!=this.maximumContainerSize&&(e=Math.min(this.maximumContainerSize.width,e),t=Math.min(this.maximumContainerSize.height,t));let i=this.container;i.style.width=`${Math.ceil(e)}px`,i.style.height=`${Math.ceil(t)}px`}createHandler(e){let t=null;if(e.cell.isEdge()){let i=e.getVisibleTerminalState(!0),s=e.getVisibleTerminalState(!1),n=e.cell.getGeometry(),a=this.getView().getEdgeStyle(e,n&&n.points||void 0,i,s);t=this.createEdgeHandler(e,a)}else t=this.createVertexHandler(e);return t}createEdgeHandler(e,t){let i=null;return t==EdgeStyle.ElbowConnector||t==EdgeStyle.Loop||t==EdgeStyle.SideToSide||t==EdgeStyle.TopToBottom?this.createElbowEdgeHandler(e):t==EdgeStyle.ManhattanConnector||t==EdgeStyle.OrthConnector||t==EdgeStyle.SegmentConnector?this.createEdgeSegmentHandler(e):this.createEdgeHandlerInstance(e)}getCurrentRoot(){return this.view.currentRoot}getTranslateForRoot(e){return null}getChildOffsetForCell(e){return null}home(){let e=this.getCurrentRoot();null!=e&&(this.view.setCurrentRoot(null),null!=this.view.getState(e)&&this.setSelectionCell(e))}isValidRoot(e){return!!e}getGraphBounds(){return this.view.getGraphBounds()}getMaximumGraphBounds(){return this.maximumGraphBounds}refresh(e=null){e?this.view.clear(e,!1):this.view.clear(void 0,!0),this.view.validate(),this.sizeDidChange(),this.fireEvent(new EventObject(InternalEvent.REFRESH))}center(e=!0,t=!0,i=.5,s=.5){let n=this.container,a=hasScrollbars(this.container),l=2*this.getBorder(),r=n.clientWidth-l,o=n.clientHeight-l,h=this.getGraphBounds(),c=this.view.translate,d=this.view.scale,u=e?r-h.width:0,p=t?o-h.height:0;if(a){h.x-=c.x,h.y-=c.y;let e=n.scrollWidth,t=n.scrollHeight;e>r&&(u=0),t>o&&(p=0),this.view.setTranslate(Math.floor(u/2-h.x),Math.floor(p/2-h.y)),n.scrollLeft=(e-r)/2,n.scrollTop=(t-o)/2}else this.view.setTranslate(e?Math.floor(c.x-h.x/d+u*i/d):c.x,t?Math.floor(c.y-h.y/d+p*s/d):c.y)}isOrthogonal(e){let t=e.style.orthogonal;if(!isNullish(t))return t;let i=this.view.getEdgeStyle(e);return[EdgeStyle.EntityRelation,EdgeStyle.ElbowConnector,EdgeStyle.ManhattanConnector,EdgeStyle.OrthConnector,EdgeStyle.SegmentConnector,EdgeStyle.SideToSide,EdgeStyle.TopToBottom].includes(i)}getBackgroundImage(){return this.backgroundImage}setBackgroundImage(e){this.backgroundImage=e}convertValueToString(e){let t=e.getValue();if(null!=t){if(isNode(t))return t.nodeName;if("function"==typeof t.toString)return t.toString()}return""}getLinkForCell(e){return null}getBorder(){return this.border}setBorder(e){this.border=e}isResizeContainer(){return this.resizeContainer}setResizeContainer(e){this.resizeContainer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}isMultigraph(){return this.multigraph}setMultigraph(e){this.multigraph=e}isAllowLoops(){return this.allowLoops}setAllowLoops(e){this.allowLoops=e}isRecursiveResize(e=null){return this.recursiveResize}setRecursiveResize(e){this.recursiveResize=e}getOverlap(e){return this.isAllowOverlapParent(e)?this.defaultOverlap:0}isAllowOverlapParent(e){return!1}getDefaultParent(){let e=this.getCurrentRoot();return!e&&((e=this.defaultParent)||(e=this.getDataModel().getRoot().getChildAt(0))),e}setDefaultParent(e){this.defaultParent=e}destroy(){!this.destroyed&&(this.destroyed=!0,Object.values(this.plugins).forEach(e=>e.onDestroy()),this.view.destroy(),this.model&&this.graphModelChangeListener&&(this.getDataModel().removeListener(this.graphModelChangeListener),this.graphModelChangeListener=null))}}applyGraphMixins(Graph);class LayoutManager extends EventSource{constructor(e){super(),this.bubbling=!0,this.enabled=!0,this.undoHandler=(e,t)=>{this.isEnabled()&&this.beforeUndo(t.getProperty("edit"))},this.moveHandler=(e,t)=>{this.isEnabled()&&this.cellsMoved(t.getProperty("cells"),t.getProperty("event"))},this.resizeHandler=(e,t)=>{this.isEnabled()&&this.cellsResized(t.getProperty("cells"),t.getProperty("bounds"),t.getProperty("previous"))},this.setGraph(e)}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}isBubbling(){return this.bubbling}setBubbling(e){this.bubbling=e}getGraph(){return this.graph}setGraph(e){this.graph&&(this.graph.getDataModel().removeListener(this.undoHandler),this.graph.removeListener(this.moveHandler),this.graph.removeListener(this.resizeHandler)),this.graph=e,this.graph&&(this.graph.getDataModel().addListener(InternalEvent.BEFORE_UNDO,this.undoHandler),this.graph.addListener(InternalEvent.MOVE_CELLS,this.moveHandler),this.graph.addListener(InternalEvent.RESIZE_CELLS,this.resizeHandler))}hasLayout(e){return!!this.getLayout(e,InternalEvent.LAYOUT_CELLS)}getLayout(e,t){return null}beforeUndo(e){this.executeLayoutForCells(this.getCellsForChanges(e.changes))}cellsMoved(e,t){if(e.length>0&&t){let i=convertPoint(this.getGraph().container,getClientX(t),getClientY(t));for(let t=0;t<e.length;t+=1){let s=this.getLayout(e[t].getParent(),InternalEvent.MOVE_CELLS);s&&s.moveCell(e[t],i.x,i.y)}}}cellsResized(e=null,t=null,i=null){if(e&&t)for(let s=0;s<e.length;s+=1){let n=this.getLayout(e[s].getParent(),InternalEvent.RESIZE_CELLS);n&&n.resizeCell(e[s],t[s],null==i?void 0:i[s])}}getCellsForChanges(e){let t=[];for(let i of e){if(i instanceof RootChange)return[];t=t.concat(this.getCellsForChange(i))}return t}getCellsForChange(e){return e instanceof ChildChange?this.addCellsWithLayout(e.child,this.addCellsWithLayout(e.previous)):e instanceof TerminalChange||e instanceof GeometryChange||e instanceof VisibleChange||e instanceof StyleChange?this.addCellsWithLayout(e.cell):[]}addCellsWithLayout(e,t=[]){return this.addDescendantsWithLayout(e,this.addAncestorsWithLayout(e,t))}addAncestorsWithLayout(e,t=[]){return e&&(this.hasLayout(e)&&t.push(e),this.isBubbling()&&this.addAncestorsWithLayout(e.getParent(),t)),t}addDescendantsWithLayout(e,t=[]){if(e&&this.hasLayout(e))for(let i=0;i<e.getChildCount();i+=1){let s=e.getChildAt(i);this.hasLayout(s)&&(t.push(s),this.addDescendantsWithLayout(s,t))}return t}executeLayoutForCells(e){let t=sortCells(e,!1);this.layoutCells(t,!0),this.layoutCells(t.reverse(),!1)}layoutCells(e,t=!1){if(e.length>0){let i=this.getGraph().getDataModel();i.batchUpdate(()=>{let s=null;for(let n of e)n!==i.getRoot()&&n!==s&&(this.executeLayout(n,t),s=n);this.fireEvent(new EventObject(InternalEvent.LAYOUT_CELLS,{cells:e}))})}}executeLayout(e,t=!1){let i=this.getLayout(e,t?InternalEvent.BEGIN_UPDATE:InternalEvent.END_UPDATE);i&&i.execute(e)}destroy(){this.setGraph(null)}}class Outline{constructor(e,t=null){this.sizer=null,this.selectionBorder=null,this.updateHandler=null,this.refreshHandler=null,this.panHandler=null,this.active=null,this.bounds=null,this.zoom=!1,this.startX=null,this.startY=null,this.dx0=null,this.dy0=null,this.index=null,this.outline=null,this.graphRenderHint="exact",this.enabled=!0,this.showViewport=!0,this.border=10,this.sizerSize=8,this.labelsVisible=!1,this.updateOnPan=!1,this.sizerImage=null,this.minScale=1e-4,this.suspended=!1,this.source=e,null!=t&&this.init(t)}init(e){this.outline=this.createGraph(e);let t=this.outline.graphModelChanged;this.outline.graphModelChanged=e=>{this.suspended||null==this.outline||t.apply(this.outline,[e])},this.outline.labelsVisible=this.labelsVisible,this.outline.setEnabled(!1),this.updateHandler=(e,t)=>{this.suspended||this.active||this.update()},this.source.getDataModel().addListener(InternalEvent.CHANGE,this.updateHandler),this.outline.addMouseListener(this);let i=this.source.getView();i.addListener(InternalEvent.SCALE,this.updateHandler),i.addListener(InternalEvent.TRANSLATE,this.updateHandler),i.addListener(InternalEvent.SCALE_AND_TRANSLATE,this.updateHandler),i.addListener(InternalEvent.DOWN,this.updateHandler),i.addListener(InternalEvent.UP,this.updateHandler),InternalEvent.addListener(this.source.container,"scroll",this.updateHandler),this.panHandler=(e,t)=>{this.updateOnPan&&this.updateHandler(e,t)},this.source.addListener(InternalEvent.PAN,this.panHandler),this.refreshHandler=e=>{let t=this.outline;null==t||t.setStylesheet(this.source.getStylesheet()),null==t||t.refresh()},this.source.addListener(InternalEvent.REFRESH,this.refreshHandler),this.bounds=new Rectangle(0,0,0,0),this.selectionBorder=new RectangleShape(this.bounds,NONE,OUTLINE_COLOR,OUTLINE_STROKEWIDTH),this.selectionBorder.dialect=this.outline.dialect,this.selectionBorder.init(this.outline.getView().getOverlayPane());let s=this.selectionBorder.node,n=e=>{let t=getSource(e),i=e=>{let t=this.outline;null==t||t.fireMouseEvent(InternalEvent.MOUSE_MOVE,new InternalMouseEvent(e))},s=e=>{let n=this.outline;InternalEvent.removeGestureListeners(t,null,i,s),null==n||n.fireMouseEvent(InternalEvent.MOUSE_UP,new InternalMouseEvent(e))},n=this.outline;InternalEvent.addGestureListeners(t,null,i,s),null==n||n.fireMouseEvent(InternalEvent.MOUSE_DOWN,new InternalMouseEvent(e))};InternalEvent.addGestureListeners(this.selectionBorder.node,n);let a=this.sizer=this.createSizer(),l=a.node;a.init(this.outline.getView().getOverlayPane()),this.enabled&&(l.style.cursor="nwse-resize"),InternalEvent.addGestureListeners(this.sizer.node,n),s.style.display=this.showViewport?"":"none",l.style.display=s.style.display,s.style.cursor="move",this.update(!1)}createGraph(e){let t=new Graph(e,this.source.getDataModel(),getDefaultPlugins(),this.source.getStylesheet());return t.options.foldingEnabled=!1,t.autoScroll=!1,t}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}setZoomEnabled(e){this.sizer.node.style.visibility=e?"visible":"hidden"}refresh(){this.update(!0)}createSizer(){let e=this.outline;if(null!=this.sizerImage){let t=new ImageShape(new Rectangle(0,0,this.sizerImage.width,this.sizerImage.height),this.sizerImage.src);return e&&(t.dialect=e.dialect),t}let t=new RectangleShape(new Rectangle(0,0,this.sizerSize,this.sizerSize),OUTLINE_HANDLE_FILLCOLOR,OUTLINE_HANDLE_STROKECOLOR);return e&&(t.dialect=e.dialect),t}getSourceContainerSize(){return new Rectangle(0,0,this.source.container.scrollWidth,this.source.container.scrollHeight)}getOutlineOffset(e){return null}getSourceGraphBounds(){return this.source.getGraphBounds()}update(e=!1){if(null!=this.source&&null!=this.source.container&&null!=this.outline&&null!=this.outline.container){let t=this.source.view.scale,i=this.getSourceGraphBounds(),s=new Rectangle(i.x/t+this.source.panDx,i.y/t+this.source.panDy,i.width/t,i.height/t),n=new Rectangle(0,0,this.source.container.clientWidth/t,this.source.container.clientHeight/t),a=s.clone();a.add(n);let l=this.getSourceContainerSize(),r=Math.max(l.width/t,a.width),o=Math.max(l.height/t,a.height),h=Math.min(Math.max(0,this.outline.container.clientWidth-this.border)/r,Math.max(0,this.outline.container.clientHeight-this.border)/o),c=Number.isNaN(h)?this.minScale:Math.max(this.minScale,h);if(c>0){this.outline.getView().scale!==c&&(this.outline.getView().scale=c,e=!0);let t=this.outline.getView();t.currentRoot!==this.source.getView().currentRoot&&t.setCurrentRoot(this.source.getView().currentRoot);let i=this.source.view.translate,n=i.x+this.source.panDx,a=i.y+this.source.panDy,l=this.getOutlineOffset(c);null!=l&&(n+=l.x,a+=l.y),s.x<0&&(n-=s.x),s.y<0&&(a-=s.y),(t.translate.x!==n||t.translate.y!==a)&&(t.translate.x=n,t.translate.y=a,e=!0);let r=t.translate,o=(c=this.source.getView().scale)/t.scale,h=1/t.scale,{container:d}=this.source;this.bounds=new Rectangle((r.x-i.x-this.source.panDx)/h,(r.y-i.y-this.source.panDy)/h,d.clientWidth/o,d.clientHeight/o),this.bounds.x+=this.source.container.scrollLeft*t.scale/c,this.bounds.y+=this.source.container.scrollTop*t.scale/c;let u=this.selectionBorder,p=u.bounds;(p.x!==this.bounds.x||p.y!==this.bounds.y||p.width!==this.bounds.width||p.height!==this.bounds.height)&&(u.bounds=this.bounds,u.redraw());let g=this.sizer;p=g.bounds;let m=new Rectangle(this.bounds.x+this.bounds.width-p.width/2,this.bounds.y+this.bounds.height-p.height/2,p.width,p.height);(p.x!==m.x||p.y!==m.y||p.width!==m.width||p.height!==m.height)&&(g.bounds=m,"hidden"!==g.node.style.visibility&&g.redraw()),e&&this.outline.view.revalidate()}}}mouseDown(e,t){if(this.enabled&&this.showViewport){let e=isMouseEvent(t.getEvent())?0:this.source.tolerance,i=e>0?new Rectangle(t.getGraphX()-e,t.getGraphY()-e,2*e,2*e):null;this.zoom=t.isSource(this.sizer)||null!=i&&intersects(this.sizer.bounds,i),this.startX=t.getX(),this.startY=t.getY(),this.active=!0;let s=this.source.container;this.source.useScrollbarsForPanning&&hasScrollbars(this.source.container)?(this.dx0=s.scrollLeft,this.dy0=s.scrollTop):(this.dx0=0,this.dy0=0)}t.consume()}mouseMove(e,t){if(this.active){let e=this.bounds,i=this.sizer,s=i.node,n=this.selectionBorder,a=n.node,l=this.source,r=this.outline;a.style.display=this.showViewport?"":"none",s.style.display=a.style.display;let o=this.getTranslateForEvent(t),h=o.x,c=o.y,d=null;if(r&&!this.zoom){let{scale:t}=r.getView();n.bounds=d=new Rectangle(e.x+h,e.y+c,e.width,e.height),n.redraw(),h/=t,h*=l.getView().scale,c/=t,c*=l.getView().scale,l.panGraph(-h-this.dx0,-c-this.dy0)}else{let{container:t}=this.source;c=h/(t.clientWidth/t.clientHeight),n.bounds=d=new Rectangle(e.x,e.y,Math.max(1,e.width+h),Math.max(1,e.height+c)),n.redraw()}let u=i.bounds;i.bounds=new Rectangle(d.x+d.width-u.width/2,d.y+d.height-u.height/2,u.width,u.height),"hidden"!==s.style.visibility&&i.redraw(),t.consume()}}getTranslateForEvent(e){return new Point(e.getX()-this.startX,e.getY()-this.startY)}mouseUp(e,t){if(this.active){let e=this.getTranslateForEvent(t),i=e.x,s=e.y,n=this.source,a=this.outline,l=this.selectionBorder;if(Math.abs(i)>0||Math.abs(s)>0){if(this.zoom){let e=l.bounds.width,{scale:t}=n.getView();n.zoomTo(Math.max(this.minScale,t-i*t/e),!1)}else if(a&&(!n.useScrollbarsForPanning||!hasScrollbars(n.container))){n.panGraph(0,0),i/=a.getView().scale,s/=a.getView().scale;let e=n.getView().translate;n.getView().setTranslate(e.x-i,e.y-s)}this.update(),t.consume()}this.index=null,this.active=!1}}destroy(){null!=this.source&&(this.source.removeListener(this.panHandler),this.source.removeListener(this.refreshHandler),this.source.getDataModel().removeListener(this.updateHandler),this.source.getView().removeListener(this.updateHandler),InternalEvent.removeListener(this.source.container,"scroll",this.updateHandler),this.source=null),null!=this.outline&&(this.outline.removeMouseListener(this),this.outline.destroy(),this.outline=null),null!=this.selectionBorder&&(this.selectionBorder.destroy(),this.selectionBorder=null),null!=this.sizer&&(this.sizer.destroy(),this.sizer=null)}}class PrintPreview{constructor(e,t=null,i=null,s=null,n=0,a=0,l=null,r="Printer-friendly version",o=null){this.border=0,this.marginTop=0,this.marginBottom=0,this.x0=0,this.y0=0,this.autoOrigin=!0,this.printOverlays=!1,this.printControls=!1,this.printBackgroundImage=!1,this.backgroundColor="#ffffff",this.wnd=null,this.targetWindow=null,this.pageCount=0,this.clipping=!0,this.graph=e,this.scale=null!=t?t:1/e.pageScale,this.border=null!=s?s:0,this.pageFormat=Rectangle.fromRectangle(null!=i?i:e.pageFormat),this.title=r,this.x0=n,this.y0=a,this.borderColor=l,this.pageSelector=null==o||o}getWindow(){return this.wnd}getDoctype(){return""}appendGraph(e,t,i,s,n,a){this.graph=e,this.scale=null!=t?t:1/e.pageScale,this.x0=i,this.y0=s,this.open(null,null,n,a)}open(e=null,t=null,i=!1,s=!1){let n=this.graph.cellRenderer.initializeOverlay,a=null;try{this.printOverlays&&(this.graph.cellRenderer.initializeOverlay=(e,t)=>{t.init(e.view.getDrawPane())}),this.printControls&&(this.graph.cellRenderer.initControl=(e,t,i,s)=>(t.dialect=e.view.graph.dialect,t.init(e.view.getDrawPane()),null)),this.wnd=null!=t?t:this.wnd;let n=!1;if(null==this.wnd&&(n=!0,this.wnd=window.open()),!this.wnd)throw Error("Create new window not allowed");let l=this.wnd.document;if(n){let t=this.getDoctype();null!=t&&t.length>0&&l.writeln(t),"CSS1Compat"===document.compatMode&&l.writeln("<!DOCTYPE html>"),l.writeln("<html>"),l.writeln("<head>"),this.writeHead(l,e),l.writeln("</head>"),l.writeln('<body class="mxPage">')}let r=this.graph.getGraphBounds().clone(),o=this.graph.getView().getScale(),h=o/this.scale,c=this.graph.getView().getTranslate();this.autoOrigin||(this.x0-=c.x*this.scale,this.y0-=c.y*this.scale,r.width+=r.x,r.height+=r.y,r.x=0,r.y=0,this.border=0);let d=this.pageFormat.width-2*this.border,u=this.pageFormat.height-2*this.border;this.pageFormat.height+=this.marginTop+this.marginBottom,r.width/=h,r.height/=h;let p=Math.max(1,Math.ceil((r.width+this.x0)/d)),g=Math.max(1,Math.ceil((r.height+this.y0)/u));this.pageCount=p*g;let m=()=>{if(this.pageSelector&&(g>1||p>1)){let e=this.createPageSelector(g,p);l.body.appendChild(e)}},f=(e,t)=>{if(null!=this.borderColor&&(e.style.borderColor=this.borderColor,e.style.borderStyle="solid",e.style.borderWidth="1px"),e.style.background=this.backgroundColor,(i||t)&&(e.style.pageBreakAfter="always"),n&&Client.IS_EDGE)l.writeln(e.outerHTML),e.parentNode.removeChild(e);else if(Client.IS_EDGE){let t=l.createElement("div");t.innerHTML=e.outerHTML,t=t.getElementsByTagName("div")[0],l.body.appendChild(t),e.parentNode.removeChild(e)}else e.parentNode.removeChild(e),l.body.appendChild(e);(i||t)&&this.addPageBreak(l)},x=this.getCoverPages(this.pageFormat.width,this.pageFormat.height);if(x)for(let e of x)f(e,!0);let v=this.getAppendices(this.pageFormat.width,this.pageFormat.height);for(let e=0;e<g;e+=1){let t=e*u/this.scale-this.y0/this.scale+(r.y-c.y*o)/o;for(let i=0;i<p;i++){if(null==this.wnd)return null;let s=i*d/this.scale-this.x0/this.scale+(r.x-c.x*o)/o,n=e*p+i+1,l=new Rectangle(s,t,d,u);(a=this.renderPage(this.pageFormat.width,this.pageFormat.height,0,0,e=>{this.addGraphFragment(-s,-t,this.scale,n,e,l),this.printBackgroundImage&&this.insertBackgroundImage(e,-s,-t)},n)).setAttribute("id",`mxPage-${n}`),f(a,null!=v||e<g-1||i<p-1)}}if(v)for(let[e,t]of v.entries())f(t,e<v.length-1);n&&!s&&(this.closeDocument(),m()),this.wnd.focus()}catch(e){null!=a&&null!=a.parentNode&&a.parentNode.removeChild(a)}finally{this.graph.cellRenderer.initializeOverlay=n}return this.wnd}addPageBreak(e){let t=e.createElement("hr");t.className="mxPageBreak",e.body.appendChild(t)}closeDocument(){try{if(null!=this.wnd&&null!=this.wnd.document){let e=this.wnd.document;this.writePostfix(e),e.writeln("</body>"),e.writeln("</html>"),e.close(),InternalEvent.release(e.body)}}catch(e){}}writeHead(e,t){null!=this.title&&e.writeln(`<title>${this.title}</title>`),addLinkToHead("stylesheet",`${Client.basePath}/css/common.css`,e),e.writeln('<style type="text/css">'),e.writeln("@media print {"),e.writeln("  * { -webkit-print-color-adjust: exact; }"),e.writeln("  table.mxPageSelector { display: none; }"),e.writeln("  hr.mxPageBreak { display: none; }"),e.writeln("}"),e.writeln("@media screen {"),e.writeln("  table.mxPageSelector { position: fixed; right: 10px; top: 10px;font-family: Arial; font-size:10pt; border: solid 1px darkgray;background: white; border-collapse:collapse; }"),e.writeln("  table.mxPageSelector td { border: solid 1px gray; padding:4px; }"),e.writeln("  body.mxPage { background: gray; }"),e.writeln("}"),null!=t&&e.writeln(t),e.writeln("</style>")}writePostfix(e){}createPageSelector(e,t){if(!this.wnd)throw Error("Popup window not created");let i=this.wnd.document,s=i.createElement("table");s.className="mxPageSelector",s.setAttribute("border","0");let n=i.createElement("tbody");for(let s=0;s<e;s+=1){let e=i.createElement("tr");for(let n=0;n<t;n++){let a=s*t+n+1,l=i.createElement("td"),r=i.createElement("a");if(r.setAttribute("href",`#mxPage-${a}`),Client.IS_NS&&!Client.IS_SF&&!Client.IS_GC){let e=`let page = document.getElementById('mxPage-${a}');page.scrollIntoView(true);event.preventDefault();`;r.setAttribute("onclick",e)}write(r,String(a)),l.appendChild(r),e.appendChild(l)}n.appendChild(e)}return s.appendChild(n),s}renderPage(e,t,i,s,n,a){let l=document.createElement("div"),r=null;try{if(0!==i||0!==s){l.style.position="relative",l.style.width=`${e}px`,l.style.height=`${t}px`,l.style.pageBreakInside="avoid";let n=document.createElement("div");n.style.position="relative",n.style.top=`${this.border}px`,n.style.left=`${this.border}px`,n.style.width=`${e-2*this.border}px`,n.style.height=`${t-2*this.border}px`,n.style.overflow="hidden";let a=document.createElement("div");a.style.position="relative",a.style.marginLeft=`${i}px`,a.style.marginTop=`${s}px`,n.appendChild(a),l.appendChild(n),document.body.appendChild(l),r=a}else{l.style.width=`${e}px`,l.style.height=`${t}px`,l.style.overflow="hidden",l.style.pageBreakInside="avoid";let i=document.createElement("div");i.style.width=`${e-2*this.border}px`,i.style.height=`${t-2*this.border}px`,i.style.overflow="hidden",i.style.top=`${this.border}px`,i.style.left=`${this.border}px`,l.appendChild(i),document.body.appendChild(l),r=i}}catch(e){throw l&&l.parentNode&&l.parentNode.removeChild(l),l=null,e}return n(r),l}getRoot(){let e=this.graph.view.currentRoot;return null==e&&(e=this.graph.getDataModel().getRoot()),e}useCssTransforms(){return!Client.NO_FO&&!Client.IS_SF}addGraphFragment(e,t,i,s,n,a){let l=this.graph.getView(),r=this.graph.container;this.graph.container=n;let o=l.getCanvas(),h=l.getBackgroundPane(),c=l.getDrawPane(),d=l.getOverlayPane(),u=i;if(this.graph.dialect===DIALECT.SVG){if(l.createSvg(),this.useCssTransforms()){let s=l.getDrawPane().parentNode;s.getAttribute("transform"),s.setAttribute("transformOrigin","0 0"),s.setAttribute("transform",`scale(${i},${i})translate(${e},${t})`),i=1,e=0,t=0}}else l.createHtml();let p=l.isEventsEnabled();l.setEventsEnabled(!1);let g=this.graph.isEnabled();this.graph.setEnabled(!1);let m=l.getTranslate();l.translate=new Point(e,t);let{redraw:f}=this.graph.cellRenderer,{states:x}=l,v=l.scale;if(this.clipping){let e=new Rectangle((a.x+m.x)*v,(a.y+m.y)*v,a.width*v/u,a.height*v/u);this.graph.cellRenderer.redraw=(t,i,s)=>{if(null!=t){let i=x.get(t.cell);if(null!=i){let t=l.getBoundingBox(i,!1);if(null!=t&&t.width>0&&t.height>0&&!intersects$1(e,t))return}}f.apply(this.graph.cellRenderer,[t,i,s])}}let b=null;try{let e=[this.getRoot()];b=new TemporaryCellStates(l,i,e,null,e=>this.getLinkForCellState(e))}catch(e){GlobalConfig.logger.error("PrintPreview unable to generate the preview",e)}finally{let e=n.firstChild;for(;null!=e;){let t=e.nextSibling,i=e.nodeName.toLowerCase();"svg"===i?(e.style.overflow="hidden",e.style.position="relative",e.style.top=`${this.marginTop}px`,e.setAttribute("width",String(a.width)),e.setAttribute("height",String(a.height)),e.style.width="",e.style.height=""):"default"!==e.style.cursor&&"div"!==i&&e.parentNode.removeChild(e),e=t}if(this.printBackgroundImage){let e=n.getElementsByTagName("svg");e.length>0&&(e[0].style.position="absolute")}l.overlayPane.parentNode.removeChild(l.overlayPane),this.graph.setEnabled(g),this.graph.container=r,this.graph.cellRenderer.redraw=f,l.canvas=o,l.backgroundPane=h,l.drawPane=c,l.overlayPane=d,l.translate=m,b&&b.destroy(),l.setEventsEnabled(p)}}getLinkForCellState(e){return this.graph.getLinkForCell(e.cell)}insertBackgroundImage(e,t,i){let s=this.graph.backgroundImage;if(null!=s){let n=document.createElement("img");n.style.position="absolute",n.style.marginLeft=`${Math.round(t*this.scale)}px`,n.style.marginTop=`${Math.round(i*this.scale)}px`,n.setAttribute("width",String(Math.round(this.scale*s.width))),n.setAttribute("height",String(Math.round(this.scale*s.height))),n.src=s.src,e.insertBefore(n,e.firstChild)}}getCoverPages(e,t){return null}getAppendices(e,t){return null}print(e){let t=this.open(e);null!=t&&t.print()}close(){null!=this.wnd&&(this.wnd.close(),this.wnd=null)}}class SwimlaneManager extends EventSource{constructor(e,t=!0,i=!0,s=!0){super(),this.enabled=!0,this.horizontal=!0,this.addEnabled=!0,this.resizeEnabled=!0,this.horizontal=t,this.addEnabled=i,this.resizeEnabled=s,this.addHandler=(e,t)=>{this.isEnabled()&&this.isAddEnabled()&&this.cellsAdded(t.getProperty("cells"))},this.resizeHandler=(e,t)=>{this.isEnabled()&&this.isResizeEnabled()&&this.cellsResized(t.getProperty("cells"))},this.setGraph(e)}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}isHorizontal(){return this.horizontal}setHorizontal(e){this.horizontal=e}isAddEnabled(){return this.addEnabled}setAddEnabled(e){this.addEnabled=e}isResizeEnabled(){return this.resizeEnabled}setResizeEnabled(e){this.resizeEnabled=e}getGraph(){return this.graph}setGraph(e){this.graph&&(this.graph.removeListener(this.addHandler),this.graph.removeListener(this.resizeHandler)),this.graph=e,this.graph&&(this.graph.addListener(InternalEvent.ADD_CELLS,this.addHandler),this.graph.addListener(InternalEvent.CELLS_RESIZED,this.resizeHandler))}isSwimlaneIgnored(e){return!this.getGraph().isSwimlane(e)}isCellHorizontal(e){return this.graph.isSwimlane(e)?this.graph.getCellStyle(e).horizontal??!0:!this.isHorizontal()}cellsAdded(e){e.length>0&&this.graph.batchUpdate(()=>{for(let t of e)this.isSwimlaneIgnored(t)||this.swimlaneAdded(t)})}swimlaneAdded(e){let t=e.getParent(),i=t.getChildCount(),s=null;for(let n=0;n<i;n+=1){let i=t.getChildAt(n);if(i!==e&&!this.isSwimlaneIgnored(i)&&(s=i.getGeometry()))break}if(s){let i=t?this.isCellHorizontal(t):this.horizontal;this.resizeSwimlane(e,s.width,s.height,i)}}cellsResized(e){e.length>0&&this.graph.batchUpdate(()=>{for(let t of e)if(!this.isSwimlaneIgnored(t)){let e=t.getGeometry();if(e){let i=new Rectangle(0,0,e.width,e.height),s=t,n=s;for(;n;){s=n,n=n.getParent();let e=this.graph.isSwimlane(n)?this.graph.getStartSize(n):new Rectangle;i.width+=e.width,i.height+=e.height}let a=n?this.isCellHorizontal(n):this.horizontal;this.resizeSwimlane(s,i.width,i.height,a)}}})}resizeSwimlane(e,t,i,s){let n=this.graph.getDataModel();n.batchUpdate(()=>{let a=this.isCellHorizontal(e);if(!this.isSwimlaneIgnored(e)){let a=e.getGeometry();a&&(s&&a.height!==i||!s&&a.width!==t)&&(a=a.clone(),s?a.height=i:a.width=t,n.setGeometry(e,a))}let l=this.graph.isSwimlane(e)?this.graph.getStartSize(e):new Rectangle;t-=l.width,i-=l.height;let r=e.getChildCount();for(let s=0;s<r;s+=1){let n=e.getChildAt(s);this.resizeSwimlane(n,t,i,a)}})}destroy(){this.setGraph(null)}}class CellAttributeChange{constructor(e,t,i){this.cell=e,this.attribute=t,this.value=i,this.previous=i}execute(){let e=this.cell.getAttribute(this.attribute);isNullish(this.previous)?this.cell.value.removeAttribute(this.attribute):this.cell.setAttribute(this.attribute,this.previous),this.previous=e}}class KeyHandler{constructor(e,t=null){this.keydownHandler=null,this.graph=null,this.target=null,this.normalKeys={},this.shiftKeys={},this.controlKeys={},this.controlShiftKeys={},this.enabled=!0,null!=e&&(this.graph=e,this.target=t||document.documentElement,this.keydownHandler=e=>{this.keyDown(e)},InternalEvent.addListener(this.target,"keydown",this.keydownHandler))}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}bindKey(e,t){this.normalKeys[e]=t}bindShiftKey(e,t){this.shiftKeys[e]=t}bindControlKey(e,t){this.controlKeys[e]=t}bindControlShiftKey(e,t){this.controlShiftKeys[e]=t}isControlDown(e){return isControlDown(e)}getFunction(e){if(null!=e&&!isAltDown(e))return this.isControlDown(e)?isShiftDown(e)?this.controlShiftKeys[e.keyCode]:this.controlKeys[e.keyCode]:isShiftDown(e)?this.shiftKeys[e.keyCode]:this.normalKeys[e.keyCode];return null}isGraphEvent(e){var t;let i=getSource(e),s=null==(t=this.graph)?void 0:t.getPlugin("CellEditorHandler");return!!(i===this.target||i.parentNode===this.target||s&&s.isEventSource(e))||!!this.graph&&isAncestorNode(this.graph.container,i)}keyDown(e){if(this.isEnabledForEvent(e)){if(27===e.keyCode)this.escape(e);else if(!this.isEventIgnored(e)){let t=this.getFunction(e);null!=t&&(t(e),InternalEvent.consume(e))}}}isEnabledForEvent(e){var t;return(null==(t=this.graph)?void 0:t.isEnabled())&&!isConsumed(e)&&this.isGraphEvent(e)&&this.isEnabled()}isEventIgnored(e){var t;return(null==(t=this.graph)?void 0:t.isEditing())??!1}escape(e){var t;(null==(t=this.graph)?void 0:t.isEscapeEnabled())&&this.graph.escape(e)}onDestroy(){null!=this.target&&null!=this.keydownHandler&&(InternalEvent.removeListener(this.target,"keydown",this.keydownHandler),this.keydownHandler=null),this.target=null}}class EditorKeyHandler{constructor(e=null){if(this.editor=null,this.handler=null,null!=e){this.editor=e;let t=this.handler=new KeyHandler(e.graph),i=this.handler.escape;this.handler.escape=s=>{i.apply(t,[s]),e.hideProperties(),e.fireEvent(new EventObject(InternalEvent.ESCAPE,{event:s}))}}}bindAction(e,t,i){let s=()=>{this.editor.execute(t)};i?this.handler.bindControlKey(e,s):this.handler.bindKey(e,s)}destroy(){this.handler.onDestroy(),this.handler=null}}class EditorPopupMenu{constructor(e=null){this.imageBasePath=null,this.config=e}createMenu(e,t,i=null,s=null){if(!isNullish(this.config)){let n=this.createConditions(e,i,s),a=this.config.firstChild;this.addItems(e,t,i,s,n,a,null)}}addItems(e,t,i=null,s=null,n,a,l=null){let r=!1;for(;a;){if("add"===a.nodeName){let o=a.getAttribute("if");if(isNullish(o)||n[o]){let o=a.getAttribute("as");o=translate(o)||o;let h=doEval(getTextContent(a)),c=a.getAttribute("action"),d=a.getAttribute("icon"),u=a.getAttribute("iconCls"),p=a.getAttribute("enabled-if"),g=isNullish(p)||n[p];r&&(t.addSeparator(l),r=!1),!isNullish(d)&&this.imageBasePath&&(d=this.imageBasePath+d);let m=this.addAction(t,e,o,d,h,c,i,l,u,g);this.addItems(e,t,i,s,n,a.firstChild,m)}}else"separator"===a.nodeName&&(r=!0);a=a.nextSibling}}addAction(e,t,i,s=null,n=null,a=null,l=null,r=null,o=null,h=!0){let c=e=>{"function"==typeof n&&n.call(t,t,l,e),isNullish(a)||t.execute(a,l,e)};return e.addItem(i,s||null,c,r,o,h)}createConditions(e,t=null,i=null){let s=e.graph.getDataModel(),n=t?t.getChildCount():0,a={};a.nocell=null==t,a.ncells=e.graph.getSelectionCount()>1,a.notRoot=s.getRoot()!==e.graph.getDefaultParent().getParent(),a.cell=null!=t;let l=null!=t&&1===e.graph.getSelectionCount();for(let s of(a.nonEmpty=l&&n>0,a.expandable=l&&e.graph.isCellFoldable(t,!1),a.collapsable=l&&e.graph.isCellFoldable(t,!0),a.validRoot=l&&e.graph.isValidRoot(t),a.emptyValidRoot=a.validRoot&&0===n,a.swimlane=l&&e.graph.isSwimlane(t),Array.from(this.config.getElementsByTagName("condition")))){let n=doEval(getTextContent(s)),l=s.getAttribute("name");isNullish(l)||"function"!=typeof n||(a[l]=n(e,t,i))}return a}}class MaxToolbar extends EventSource{constructor(e){super(),this.menu=null,this.currentImg=null,this.selectedMode=null,this.defaultMode=null,this.defaultFunction=null,this.enabled=!0,this.noReset=!1,this.updateDefaultMode=!0,this.container=e}addItem(e=null,t=null,i=null,s=null,n=null,a=null){let l=document.createElement(null!=t?"img":"button"),r=n||(a?"mxToolbarMode":"mxToolbarItem");l.className=r,t&&l.setAttribute("src",t),null!=e&&(null!=t?l.setAttribute("title",e):write(l,e)),this.container.appendChild(l),null!=i&&(InternalEvent.addListener(l,"click",i),Client.IS_TOUCH&&InternalEvent.addListener(l,"touchend",i));let o=e=>{null!=s?l.setAttribute("src",t):l.style.backgroundColor=""};return InternalEvent.addGestureListeners(l,e=>{if(null!=s?l.setAttribute("src",s):l.style.backgroundColor="gray",a){null==this.menu&&(this.menu=new MaxPopupMenu);let t=this.currentImg;if(this.menu.isMenuShowing()&&this.menu.hideMenu(),t!=l){this.currentImg=l,this.menu.factoryMethod=a;let t=new Point(l.offsetLeft,l.offsetTop+l.offsetHeight);if(this.menu.popup(t.x,t.y,null,e),this.menu.isMenuShowing()){l.className=`${r}Selected`;let e=this.menu.hideMenu;this.menu.hideMenu=()=>{e.apply(this),l.className=r,this.currentImg=null}}}}},null,o),InternalEvent.addListener(l,"mouseout",o),l}addCombo(e){let t=document.createElement("div");t.style.display="inline",t.className="mxToolbarComboContainer";let i=document.createElement("select");return i.className=e||"mxToolbarCombo",t.appendChild(i),this.container.appendChild(t),i}addActionCombo(e,t){let i=document.createElement("select");return i.className=t||"mxToolbarCombo",this.addOption(i,e,null),InternalEvent.addListener(i,"change",e=>{let t=i.options[i.selectedIndex];i.selectedIndex=0,null!=t.funct&&t.funct(e)}),this.container.appendChild(i),i}addOption(e,t,i=null){let s=document.createElement("option");return writeln(s,t),"function"==typeof i?s.funct=i:s.setAttribute("value",i),e.appendChild(s),s}addSwitchMode(e,t,i,s=null,n="mxToolbarMode"){let a=document.createElement("img");return a.initialClassName=n,a.className=a.initialClassName,a.setAttribute("src",t),a.altIcon=s,null!=e&&a.setAttribute("title",e),InternalEvent.addListener(a,"click",e=>{let t=this.selectedMode,s=t.altIcon;null!=s?(t.altIcon=t.getAttribute("src"),t.setAttribute("src",s)):t.className=t.initialClassName,this.updateDefaultMode&&(this.defaultMode=a),this.selectedMode=a,null!=(s=a.altIcon)?(a.altIcon=a.getAttribute("src"),a.setAttribute("src",s)):a.className=`${a.initialClassName}Selected`,this.fireEvent(new EventObject(InternalEvent.SELECT)),i()}),this.container.appendChild(a),null==this.defaultMode&&(this.defaultMode=a,this.selectMode(a),i()),a}addMode(e=null,t=null,i,s,n=null,a=!1){a=null==a||a;let l=document.createElement(null!=t?"img":"button");return l.initialClassName=n||"mxToolbarMode",l.className=l.initialClassName,t&&l.setAttribute("src",t),l.altIcon=s,null!=e&&l.setAttribute("title",e),this.enabled&&a&&(InternalEvent.addListener(l,"click",e=>{this.selectMode(l,i),this.noReset=!1}),InternalEvent.addListener(l,"dblclick",e=>{this.selectMode(l,i),this.noReset=!0}),null==this.defaultMode&&(this.defaultMode=l,this.defaultFunction=i,this.selectMode(l,i))),this.container.appendChild(l),l}selectMode(e,t=null){if(this.selectedMode!=e){if(null!=this.selectedMode){let e=this.selectedMode.altIcon;null!=e?(this.selectedMode.altIcon=this.selectedMode.getAttribute("src"),this.selectedMode.setAttribute("src",e)):this.selectedMode.className=this.selectedMode.initialClassName}this.selectedMode=e;let i=this.selectedMode.altIcon;null!=i?(this.selectedMode.altIcon=this.selectedMode.getAttribute("src"),this.selectedMode.setAttribute("src",i)):this.selectedMode.className=`${this.selectedMode.initialClassName}Selected`,this.fireEvent(new EventObject(InternalEvent.SELECT,{function:t}))}}resetMode(e=!1){(e||!this.noReset)&&this.selectedMode!=this.defaultMode&&this.selectMode(this.defaultMode,this.defaultFunction)}addSeparator(e){return this.addItem(null,e,null)}addBreak(){br(this.container)}addLine(){let e=document.createElement("hr");e.style.marginRight="6px",e.setAttribute("size","1"),this.container.appendChild(e)}destroy(){InternalEvent.release(this.container),this.container=null,this.defaultMode=null,this.defaultFunction=null,this.selectedMode=null,null!=this.menu&&this.menu.destroy()}}class DragSource{constructor(e,t){this.dragOffset=null,this.dragElement=null,this.previewElement=null,this.previewOffset=null,this.enabled=!0,this.currentGraph=null,this.currentDropTarget=null,this.currentPoint=null,this.currentGuide=null,this.currentHighlight=null,this.autoscroll=!0,this.guidesEnabled=!0,this.gridEnabled=!0,this.highlightDropTargets=!0,this.dragElementZIndex=100,this.dragElementOpacity=70,this.checkEventSource=!0,this.mouseMoveHandler=null,this.mouseUpHandler=null,this.eventSource=null,this.element=e,this.dropHandler=t,InternalEvent.addGestureListeners(e,e=>{this.mouseDown(e)}),InternalEvent.addListener(e,"dragstart",e=>{InternalEvent.consume(e)}),this.eventConsumer=(e,t)=>{let i=t.getProperty("eventName"),s=t.getProperty("event");i!==InternalEvent.MOUSE_DOWN&&s.consume()}}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}isGuidesEnabled(){return this.guidesEnabled}setGuidesEnabled(e){this.guidesEnabled=e}isGridEnabled(){return this.gridEnabled}setGridEnabled(e){this.gridEnabled=e}getGraphForEvent(e){return null}getDropTarget(e,t,i,s){return e.getCellAt(t,i)}createDragElement(e){return this.element.cloneNode(!0)}createPreviewElement(e){return null}isActive(){return!!this.mouseMoveHandler}reset(){this.currentGraph&&(this.dragExit(this.currentGraph),this.currentGraph=null),this.removeDragElement(),this.removeListeners(),this.stopDrag()}mouseDown(e){this.enabled&&!isConsumed(e)&&null==this.mouseMoveHandler&&(this.startDrag(e),this.mouseMoveHandler=this.mouseMove.bind(this),this.mouseUpHandler=this.mouseUp.bind(this),InternalEvent.addGestureListeners(document,null,this.mouseMoveHandler,this.mouseUpHandler),Client.IS_TOUCH&&!isMouseEvent(e)&&(this.eventSource=getSource(e),this.eventSource&&InternalEvent.addGestureListeners(this.eventSource,null,this.mouseMoveHandler,this.mouseUpHandler)))}startDrag(e){this.dragElement=this.createDragElement(e),this.dragElement.style.position="absolute",this.dragElement.style.zIndex=String(this.dragElementZIndex),setOpacity(this.dragElement,this.dragElementOpacity),this.checkEventSource&&Client.IS_SVG&&(this.dragElement.style.pointerEvents="none")}stopDrag(){this.removeDragElement()}removeDragElement(){this.dragElement&&(this.dragElement.parentNode&&this.dragElement.parentNode.removeChild(this.dragElement),this.dragElement=null)}getElementForEvent(e){return isTouchEvent(e)||isPenEvent(e)?document.elementFromPoint(getClientX(e),getClientY(e)):getSource(e)}graphContainsEvent(e,t){let i=getClientX(t),s=getClientY(t),n=getOffset(e.container),a=getScrollOrigin(),l=this.getElementForEvent(t);if(this.checkEventSource)for(;l&&l!==e.container;)l=l.parentNode;return!!l&&i>=n.x-a.x&&s>=n.y-a.y&&i<=n.x-a.x+e.container.offsetWidth&&s<=n.y-a.y+e.container.offsetHeight}mouseMove(e){let t=this.getGraphForEvent(e);if(t&&!this.graphContainsEvent(t,e)&&(t=null),t!==this.currentGraph&&(this.currentGraph&&this.dragExit(this.currentGraph,e),this.currentGraph=t,this.currentGraph&&this.dragEnter(this.currentGraph,e)),this.currentGraph&&this.dragOver(this.currentGraph,e),this.dragElement&&(!this.previewElement||"visible"!==this.previewElement.style.visibility)){let t=getClientX(e),i=getClientY(e);null==this.dragElement.parentNode&&document.body.appendChild(this.dragElement),this.dragElement.style.visibility="visible",this.dragOffset&&(t+=this.dragOffset.x,i+=this.dragOffset.y);let s=getDocumentScrollOrigin(document);this.dragElement.style.left=`${t+s.x}px`,this.dragElement.style.top=`${i+s.y}px`}else this.dragElement&&(this.dragElement.style.visibility="hidden");InternalEvent.consume(e)}mouseUp(e){if(this.currentGraph){if(this.currentPoint&&(!this.previewElement||"hidden"!==this.previewElement.style.visibility)){let{scale:t}=this.currentGraph.view,i=this.currentGraph.view.translate,s=this.currentPoint.x/t-i.x,n=this.currentPoint.y/t-i.y;this.drop(this.currentGraph,e,this.currentDropTarget,s,n)}this.dragExit(this.currentGraph),this.currentGraph=null}this.stopDrag(),this.removeListeners(),InternalEvent.consume(e)}removeListeners(){this.eventSource&&(InternalEvent.removeGestureListeners(this.eventSource,null,this.mouseMoveHandler,this.mouseUpHandler),this.eventSource=null),InternalEvent.removeGestureListeners(document,null,this.mouseMoveHandler,this.mouseUpHandler),this.mouseMoveHandler=null,this.mouseUpHandler=null}dragEnter(e,t){if(e.isMouseDown=!0,e.isMouseTrigger=isMouseEvent(t),this.previewElement=this.createPreviewElement(e),this.previewElement&&this.checkEventSource&&Client.IS_SVG&&(this.previewElement.style.pointerEvents="none"),this.isGuidesEnabled()&&this.previewElement){let t=e.getPlugin("SelectionHandler");this.currentGuide=new Guide(e,null==t?void 0:t.getGuideStates())}this.highlightDropTargets&&(this.currentHighlight=new CellHighlight(e,DROP_TARGET_COLOR)),e.addListener(InternalEvent.FIRE_MOUSE_EVENT,this.eventConsumer)}dragExit(e,t){this.currentDropTarget=null,this.currentPoint=null,e.isMouseDown=!1,e.removeListener(this.eventConsumer),this.previewElement&&(this.previewElement.parentNode&&this.previewElement.parentNode.removeChild(this.previewElement),this.previewElement=null),this.currentGuide&&(this.currentGuide.destroy(),this.currentGuide=null),this.currentHighlight&&(this.currentHighlight.destroy(),this.currentHighlight=null)}dragOver(e,t){let i=getOffset(e.container),s=getScrollOrigin(e.container),n=getClientX(t)-i.x+s.x-e.getPanDx(),a=getClientY(t)-i.y+s.y-e.getPanDy();if(e.isAutoScroll()&&(!this.autoscroll||this.autoscroll)&&e.scrollPointToVisible(n,a,e.isAutoExtend()),this.currentHighlight&&e.isDropEnabled()&&(this.currentDropTarget=this.getDropTarget(e,n,a,t),this.currentDropTarget)){let t=e.getView().getState(this.currentDropTarget);this.currentHighlight.highlight(t)}if(this.previewElement){this.previewElement.parentNode||(e.container.appendChild(this.previewElement),this.previewElement.style.zIndex="3",this.previewElement.style.position="absolute");let i=this.isGridEnabled()&&e.isGridEnabledEvent(t),s=!0;if(this.currentGuide&&this.currentGuide.isEnabledForEvent(t)){let e=new Rectangle(0,0,parseInt(this.previewElement.style.width),parseInt(this.previewElement.style.height)),t=new Point(n,a);t=this.currentGuide.move(e,t,i,!0),s=!1,n=t.x,a=t.y}else if(i){let{scale:t}=e.view,i=e.view.translate,s=e.getGridSize()/2;n=(e.snap(n/t-i.x-s)+i.x)*t,a=(e.snap(a/t-i.y-s)+i.y)*t}this.currentGuide&&s&&this.currentGuide.hide(),this.previewOffset&&(n+=this.previewOffset.x,a+=this.previewOffset.y),this.previewElement.style.left=`${Math.round(n)}px`,this.previewElement.style.top=`${Math.round(a)}px`,this.previewElement.style.visibility="visible"}this.currentPoint=new Point(n,a)}drop(e,t,i=null,s,n){this.dropHandler(e,t,i,s,n),"hidden"!==e.container.style.visibility&&e.container.focus()}}let makeDraggable=(e,t,i,s=null,n=null,a=null,l=null,r=!1,o=!0,h=null)=>{let c=new DragSource(e,i);return c.dragOffset=new Point(null!=n?n:0,null!=a?a:TOOLTIP_VERTICAL_OFFSET),null!=l&&(c.autoscroll=l),c.setGuidesEnabled(!1),null!=o&&(c.highlightDropTargets=o),null!=h&&(c.getDropTarget=h),c.getGraphForEvent=e=>"function"==typeof t?t(e):t,null!=s&&(c.createDragElement=()=>s.cloneNode(!0),r&&(c.createPreviewElement=e=>{let t=s.cloneNode(!0),i=parseInt(t.style.width),n=parseInt(t.style.height);return t.style.width=`${Math.round(i*e.view.scale)}px`,t.style.height=`${Math.round(n*e.view.scale)}px`,t})),c},gestureUtils=Object.freeze(Object.defineProperty({__proto__:null,makeDraggable:makeDraggable},Symbol.toStringTag,{value:"Module"}));class EditorToolbar{constructor(e=null,t=null){this.toolbar=null,this.resetHandler=null,this.spacing=4,this.connectOnDrop=!1,this.editor=t,null!=e&&null!=t&&this.init(e)}init(e){null!=e&&(this.toolbar=new MaxToolbar(e),this.toolbar.addListener(InternalEvent.SELECT,(t,i)=>{let s=i.getProperty("function");null!=s?this.editor.insertFunction=()=>{s.apply(this,[e]),this.toolbar.resetMode()}:this.editor.insertFunction=null}),this.resetHandler=()=>{null!=this.toolbar&&this.toolbar.resetMode(!0)},this.editor.graph.addListener(InternalEvent.DOUBLE_CLICK,this.resetHandler),this.editor.addListener(InternalEvent.ESCAPE,this.resetHandler))}addItem(e,t,i,s){let n=()=>{null!=i&&i.length>0&&this.editor.execute(i)};return this.toolbar.addItem(e,t,n,s)}addSeparator(e){e=e||`${Client.imageBasePath}/separator.gif`,this.toolbar.addSeparator(e)}addCombo(){return this.toolbar.addCombo()}addActionCombo(e){return this.toolbar.addActionCombo(e)}addActionOption(e,t,i){let s=()=>{this.editor.execute(i)};this.addOption(e,t,s)}addOption(e,t,i){return this.toolbar.addOption(e,t,i)}addMode(e,t,i,s=null,n=null){let a=()=>{this.editor.setMode(i),null!=n&&n(this.editor)};return this.toolbar.addSwitchMode(e,t,a,s)}addPrototype(e,t,i,s,n,a=!0){let l=()=>"function"==typeof i?i():null!=i?this.editor.graph.cloneCell(i):null,r=(e,t)=>{"function"==typeof n?n(this.editor,l(),e,t):this.drop(l(),e,t),this.toolbar.resetMode(),InternalEvent.consume(e)},o=this.toolbar.addMode(e,t,r,s,null,a),h=(e,t,i)=>{r(t,i)};return this.installDropHandler(o,h),o}drop(e,t,i=null){let{graph:s}=this.editor;if(s.getDataModel(),null==i||i.isEdge()||!this.connectOnDrop||!i.isConnectable()){for(;null!=i&&!s.isValidDropTarget(i,[e],t);)i=i.getParent();this.insert(e,t,i)}else this.connect(e,t,i)}insert(e,t,i=null){let{graph:s}=this.editor;if(s.canImportCell(e)){let n=getClientX(t),a=getClientY(t),l=convertPoint(s.container,n,a);return i&&s.isSplitEnabled()&&s.isSplitTarget(i,[e],t)?s.splitEdge(i,[e],null,l.x,l.y):this.editor.addVertex(i,e,l.x,l.y)}return null}connect(e,t,i=null){let{graph:s}=this.editor,n=s.getDataModel();if(null!=i&&e.isConnectable()&&s.isEdgeValid(null,i,e)){let t=null;n.beginUpdate();try{let a=i.getGeometry(),l=e.getGeometry().clone();l.x=a.x+(a.width-l.width)/2,l.y=a.y+(a.height-l.height)/2;let r=this.spacing*s.gridSize,o=20*i.getDirectedEdgeCount(!0);this.editor.horizontalFlow?l.x+=(l.width+a.width)/2+r+o:l.y+=(l.height+a.height)/2+r+o,e.setGeometry(l);let h=i.getParent();if(s.addCell(e,h),s.constrainChild(e),t=this.editor.createEdge(i,e),null==t.getGeometry()){let e=new Geometry;e.relative=!0,n.setGeometry(t,e)}s.addEdge(t,h,i,e)}finally{n.endUpdate()}s.setSelectionCells([e,t]),s.scrollCellToVisible(e)}}installDropHandler(e,t){document.createElement("img").setAttribute("src",e.getAttribute("src"))}destroy(){null!=this.resetHandler&&(this.editor.graph.removeListener(this.resetHandler),this.editor.removeListener(this.resetHandler),this.resetHandler=null),null!=this.toolbar&&(this.toolbar.destroy(),this.toolbar=null)}}class UndoManager extends EventSource{constructor(e=100){super(),this.size=100,this.history=[],this.indexOfNextAdd=0,this.size=e,this.clear()}isEmpty(){return 0==this.history.length}clear(){this.history=[],this.indexOfNextAdd=0,this.fireEvent(new EventObject(InternalEvent.CLEAR))}canUndo(){return this.indexOfNextAdd>0}undo(){for(;this.indexOfNextAdd>0;){let e=this.history[--this.indexOfNextAdd];if(e.undo(),e.isSignificant()){this.fireEvent(new EventObject(InternalEvent.UNDO,{edit:e}));break}}}canRedo(){return this.indexOfNextAdd<this.history.length}redo(){let e=this.history.length;for(;this.indexOfNextAdd<e;){let e=this.history[this.indexOfNextAdd++];if(e.redo(),e.isSignificant()){this.fireEvent(new EventObject(InternalEvent.REDO,{edit:e}));break}}}undoableEditHappened(e){this.trim(),this.size>0&&this.size==this.history.length&&this.history.shift(),this.history.push(e),this.indexOfNextAdd=this.history.length,this.fireEvent(new EventObject(InternalEvent.ADD,{edit:e}))}trim(){if(this.history.length>this.indexOfNextAdd){let e=this.history.splice(this.indexOfNextAdd,this.history.length-this.indexOfNextAdd);for(let t=0;t<e.length;t+=1)e[t].die()}}}class GraphLayout{constructor(e){this.useBoundingBox=!0,this.parent=null,this.graph=e}moveCell(e,t,i){}resizeCell(e,t,i){}execute(e){}getGraph(){return this.graph}getConstraint(e,t,i,s){return this.graph.getCurrentCellStyle(t)[e]}traverse({vertex:e,directed:t,func:i,edge:s,visited:n}){if(null!=i&&null!=e&&(t=null==t||t,!(n=n||new Dictionary).get(e))){n.put(e,!0);let a=i(e,s);if(null==a||a){let s=e.getEdgeCount();if(s>0)for(let a=0;a<s;a+=1){let s=e.getEdgeAt(a),l=s.getTerminal(!0)===e;if(!t||l){let e=this.graph.view.getVisibleTerminal(s,!l);this.traverse({vertex:e,directed:t,func:i,edge:s,visited:n})}}}}}isAncestor(e,t,i){if(!i)return t.getParent()===e;if(t===e)return!1;for(;null!=t&&t!==e;)t=t.getParent();return t===e}isVertexMovable(e){return this.graph.isCellMovable(e)}isVertexIgnored(e){return!e.isVertex()||!e.isVisible()}isEdgeIgnored(e){return!e.isEdge()||!e.isVisible()||null==e.getTerminal(!0)||null==e.getTerminal(!1)}setEdgeStyleEnabled(e,t){this.graph.setCellStyles("noEdgeStyle",t?"0":"1",[e])}setOrthogonalEdge(e,t){this.graph.setCellStyles("orthogonal",t?"1":"0",[e])}getParentOffset(e){let t=new Point;if(null!=e&&e!==this.parent&&(this.graph.getDataModel(),this.parent&&this.parent.isAncestor(e))){let i=e.getGeometry();for(;e!==this.parent;)t.x+=i.x,t.y+=i.y,i=(e=e.getParent()).getGeometry()}return t}setEdgePoints(e,t){if(null!=e){let{model:i}=this.graph,s=e.getGeometry();if(null==s?(s=new Geometry).setRelative(!0):s=s.clone(),null!=this.parent&&null!=t){let i=e.getParent(),s=this.getParentOffset(i);for(let e=0;e<t.length;e+=1)t[e].x=t[e].x-s.x,t[e].y=t[e].y-s.y}s.points=t,i.setGeometry(e,s)}}setVertexLocation(e,t,i){let s=this.graph.getDataModel(),n=e.getGeometry(),a=null;if(null!=n){if(a=new Rectangle(t,i,n.width,n.height),this.useBoundingBox){let s=this.graph.getView().getState(e);if(null!=s&&null!=s.text&&null!=s.text.boundingBox){let{scale:e}=this.graph.getView(),n=s.text.boundingBox;s.text.boundingBox.x<s.x&&(t+=(s.x-n.x)/e,a.width=n.width),s.text.boundingBox.y<s.y&&(i+=(s.y-n.y)/e,a.height=n.height)}}if(null!=this.parent){let s=e.getParent();if(null!=s&&s!==this.parent){let e=this.getParentOffset(s);t-=e.x,i-=e.y}}(n.x!==t||n.y!==i)&&((n=n.clone()).x=t,n.y=i,s.setGeometry(e,n))}return a}getVertexBounds(e){let t=e.getGeometry();if(this.useBoundingBox){let i=this.graph.getView().getState(e);if(null!=i&&null!=i.text&&null!=i.text.boundingBox){let{scale:e}=this.graph.getView(),s=i.text.boundingBox,n=Math.max(i.x-s.x,0)/e,a=Math.max(i.y-s.y,0)/e,l=Math.max(s.x+s.width-(i.x+i.width),0)/e,r=Math.max(s.y+s.height-(i.y+i.height),0)/e;t=new Rectangle(t.x-n,t.y-a,t.width+n+l,t.height+a+r)}}if(null!=this.parent){let i=e.getParent();if(t=t.clone(),null!=i&&i!==this.parent){let e=this.getParentOffset(i);t.x+=e.x,t.y+=e.y}}return new Rectangle(t.x,t.y,t.width,t.height)}arrangeGroups(e,t,i,s,n,a){return this.graph.updateGroupBounds(e,t,!0,i,s,n,a)}}class WeightedCellSorter{constructor(e,t=0){this.weightedValue=0,this.nudge=!1,this.visited=!1,this.rankIndex=null,this.cell=e,this.weightedValue=t}static compare(e,t){return null!=e&&null!=t?t.weightedValue>e.weightedValue?-1:t.weightedValue<e.weightedValue?1:t.nudge?-1:1:0}}function findTreeRoots(e,t,i=!1,s=!1){let n=[];if(null!=t){let a=null,l=0;for(let r of t.getChildren())if(r.isVertex()&&r.isVisible()){let o=e.getConnections(r,i?t:null),h=0,c=0;for(let t=0;t<o.length;t++)e.view.getVisibleTerminal(o[t],!0)==r?h++:c++;(s&&0==h&&c>0||!s&&0==c&&h>0)&&n.push(r);let d=s?c-h:h-c;d>l&&(l=d,a=r)}0==n.length&&null!=a&&n.push(a)}return n}class CompactTreeLayout extends GraphLayout{constructor(e,t=!0,i=!1){super(e),this.parentX=null,this.parentY=null,this.visited={},this.horizontal=!0,this.invert=!1,this.resizeParent=!0,this.maintainParentLocation=!1,this.groupPadding=10,this.groupPaddingTop=0,this.groupPaddingRight=0,this.groupPaddingBottom=0,this.groupPaddingLeft=0,this.parentsChanged=null,this.moveTree=!1,this.levelDistance=10,this.nodeDistance=20,this.resetEdges=!0,this.prefHozEdgeSep=5,this.prefVertEdgeOff=4,this.minEdgeJetty=8,this.channelBuffer=4,this.edgeRouting=!0,this.sortEdges=!1,this.alignRanks=!1,this.maxRankHeight=[],this.root=null,this.node=null,this.horizontal=t,this.invert=i}isVertexIgnored(e){return super.isVertexIgnored(e)||0===e.getConnections().length}isHorizontal(){return this.horizontal}execute(e,t){this.parent=e;let i=this.graph.getDataModel();if(null==t)if(this.graph.getEdges(e,e.getParent(),this.invert,!this.invert,!1).length>0)this.root=e;else{let t=findTreeRoots(this.graph,e,!0,this.invert);if(t.length>0){for(let e=0;e<t.length;e+=1)if(!this.isVertexIgnored(t[e])&&this.graph.getEdges(t[e],null,this.invert,!this.invert,!1).length>0){this.root=t[e];break}}}else this.root=t;if(null!=this.root){if(this.resizeParent?this.parentsChanged={}:this.parentsChanged=null,this.parentX=null,this.parentY=null,e!==this.root&&null!=e.isVertex()&&this.maintainParentLocation){let t=e.getGeometry();null!=t&&(this.parentX=t.x,this.parentY=t.y)}i.beginUpdate();try{if(this.visited={},this.node=this.dfs(this.root,e),this.alignRanks&&(this.maxRankHeight=[],this.findRankHeights(this.node,0),this.setCellHeights(this.node,0)),null!=this.node){this.layout(this.node);let t=this.graph.gridSize,s=t;if(!this.moveTree){let e=this.getVertexBounds(this.root);null!=e&&(t=e.x,s=e.y)}let n=null;if(n=this.isHorizontal()?this.horizontalLayout(this.node,t,s):this.verticalLayout(this.node,null,t,s),null!=n){let e=0,i=0;n.x<0&&(e=Math.abs(t-n.x)),n.y<0&&(i=Math.abs(s-n.y)),(0!==e||0!==i)&&this.moveNode(this.node,e,i),this.resizeParent&&this.adjustParents(),this.edgeRouting&&this.localEdgeProcessing(this.node)}if(null!=this.parentX&&null!=this.parentY){let t=e.getGeometry();null!=t&&((t=t.clone()).x=this.parentX,t.y=this.parentY,i.setGeometry(e,t))}}}finally{i.endUpdate()}}}moveNode(e,t,i){e.x+=t,e.y+=i,this.apply(e);let{child:s}=e;for(;null!=s;)this.moveNode(s,t,i),s=s.next}sortOutgoingEdges(e,t){let i=new Dictionary;t.sort((t,s)=>{let n=t.getTerminal(t.getTerminal(!1)==e),a=i.get(n);null==a&&(a=CellPath.create(n).split(CellPath.PATH_SEPARATOR),i.put(n,a));let l=s.getTerminal(s.getTerminal(!1)===e),r=i.get(l);return null==r&&(r=CellPath.create(l).split(CellPath.PATH_SEPARATOR),i.put(l,r)),CellPath.compare(a,r)})}findRankHeights(e,t){let i=this.maxRankHeight;(null==i[t]||i[t]<e.height)&&(i[t]=e.height);let{child:s}=e;for(;null!=s;)this.findRankHeights(s,t+1),s=s.next}setCellHeights(e,t){let i=this.maxRankHeight;null!=i[t]&&i[t]>e.height&&(e.height=i[t]);let{child:s}=e;for(;null!=s;)this.setCellHeights(s,t+1),s=s.next}dfs(e,t){let i=CellPath.create(e),s=null;if(null!=e&&null==this.visited[i]&&!this.isVertexIgnored(e)){this.visited[i]=e,s=this.createNode(e),this.graph.getDataModel();let n=null,a=this.graph.getEdges(e,t,this.invert,!this.invert,!1,!0),l=this.graph.getView();this.sortEdges&&this.sortOutgoingEdges(e,a);for(let e=0;e<a.length;e+=1){let i=a[e];if(!this.isEdgeIgnored(i)){this.resetEdges&&this.setEdgePoints(i,null),this.edgeRouting&&(this.setEdgeStyleEnabled(i,!1),this.setEdgePoints(i,null));let e=l.getState(i),a=null!=e?e.getVisibleTerminal(this.invert):l.getVisibleTerminal(i,this.invert),r=this.dfs(a,t);null!=r&&null!=a.getGeometry()&&(null==n?s.child=r:n.next=r,n=r)}}}return s}layout(e){let{child:t}=e;for(;null!=t;)this.layout(t),t=t.next;null!=e.child?this.attachParent(e,this.join(e)):this.layoutLeaf(e)}horizontalLayout(e,t,i,s=null){e.x+=t+e.offsetX,e.y+=i+e.offsetY,s=this.apply(e,s);let{child:n}=e;if(null!=n){s=this.horizontalLayout(n,e.x,e.y,s);let t=e.y+n.offsetY,i=n.next;for(;null!=i;)s=this.horizontalLayout(i,e.x+n.offsetX,t,s),t+=i.offsetY,i=i.next}return s}verticalLayout(e,t,i,s,n=null){e.x=e.x+i+e.offsetY,e.y=e.y+s+e.offsetX,n=this.apply(e,n);let{child:a}=e;if(null!=a){n=this.verticalLayout(a,e,e.x,e.y,n);let t=e.x+a.offsetY,i=a.next;for(;null!=i;)n=this.verticalLayout(i,e,t,e.y+a.offsetX,n),t+=i.offsetY,i=i.next}return n}attachParent(e,t){let i=this.nodeDistance+this.levelDistance,s=(t-e.width)/2-this.nodeDistance,n=s+e.width+2*this.nodeDistance-t;e.child.offsetX=i+e.height,e.child.offsetY=n,e.contour.upperHead=this.createLine(e.height,0,this.createLine(i,n,e.contour.upperHead)),e.contour.lowerHead=this.createLine(e.height,0,this.createLine(i,s,e.contour.lowerHead))}layoutLeaf(e){let t=2*this.nodeDistance;e.contour.upperTail=this.createLine(e.height+t,0),e.contour.upperHead=e.contour.upperTail,e.contour.lowerTail=this.createLine(0,-e.width-t),e.contour.lowerHead=this.createLine(e.height+t,0,e.contour.lowerTail)}join(e){let t=2*this.nodeDistance,{child:i}=e;e.contour=i.contour;let s=i.width+t,n=s;for(i=i.next;null!=i;){let a=this.merge(e.contour,i.contour);i.offsetY=a+s,i.offsetX=0,n+=a+(s=i.width+t),i=i.next}return n}merge(e,t){let i=0,s=0,n=0,a=e.lowerHead,l=t.upperHead;for(;null!=l&&null!=a;){let e=this.offset(i,s,l.dx,l.dy,a.dx,a.dy);s+=e,n+=e,i+l.dx<=a.dx?(i+=l.dx,s+=l.dy,l=l.next):(i-=a.dx,s-=a.dy,a=a.next)}if(null!=l){let n=this.bridge(e.upperTail,0,0,l,i,s);e.upperTail=null!=n.next?t.upperTail:n,e.lowerTail=t.lowerTail}else{let n=this.bridge(t.lowerTail,i,s,a,0,0);null==n.next&&(e.lowerTail=n)}return e.lowerHead=t.lowerHead,n}offset(e,t,i,s,n,a){let l=0;return n<=e||e+i<=0?0:(l=n*s-i*a>0?e<0?e*s/i-t:e>0?e*a/n-t:-t:n<e+i?a-(t+(n-e)*s/i):n>e+i?(i+e)*a/n-(t+s):a-(t+s))>0?l:0}bridge(e,t,i,s,n,a){let l=n+s.dx-t,r=0,o=0;r=0===s.dx?s.dy:(o=l*s.dy)/s.dx;let h=this.createLine(l,r,s.next);return e.next=this.createLine(0,a+s.dy-r-i,h),h}createNode(e){let t={};t.cell=e,t.x=0,t.y=0,t.width=0,t.height=0;let i=this.getVertexBounds(e);return null!=i&&(this.isHorizontal()?(t.width=i.height,t.height=i.width):(t.width=i.width,t.height=i.height)),t.offsetX=0,t.offsetY=0,t.contour={},t}apply(e,t=null){this.graph.getDataModel();let i=e.cell,s=i.getGeometry();if(null!=i&&null!=s){if(this.isVertexMovable(i)&&(s=this.setVertexLocation(i,e.x,e.y),this.resizeParent)){let e=i.getParent(),t=CellPath.create(e),s=this.parentsChanged;null==s[t]&&(s[t]=e)}t=null==t?new Rectangle(s.x,s.y,s.width,s.height):new Rectangle(Math.min(t.x,s.x),Math.min(t.y,s.y),Math.max(t.x+t.width,s.x+s.width),Math.max(t.y+t.height,s.y+s.height))}return t}createLine(e,t,i=null){return{dx:e,dy:t,next:i}}adjustParents(){let e=[];for(let t in this.parentsChanged)e.push(this.parentsChanged[t]);this.arrangeGroups(sortCells(e,!0),this.groupPadding,this.groupPaddingTop,this.groupPaddingRight,this.groupPaddingBottom,this.groupPaddingLeft)}localEdgeProcessing(e){this.processNodeOutgoing(e);let{child:t}=e;for(;null!=t;)this.localEdgeProcessing(t),t=t.next}processNodeOutgoing(e){let{child:t}=e,i=e.cell,s=0,n=[];for(;null!=t;){let e;s++,e=this.horizontal?t.y:t.x,n.push(new WeightedCellSorter(t,e)),t=t.next}n.sort(WeightedCellSorter.compare);let a=e.width,l=(s+1)*this.prefHozEdgeSep;a>l+2*this.prefHozEdgeSep&&(a-=2*this.prefHozEdgeSep);let r=a/s,o=r/2;a>l+2*this.prefHozEdgeSep&&(o+=this.prefHozEdgeSep);let h=this.minEdgeJetty-this.prefVertEdgeOff,c=this.getVertexBounds(i);t=e.child;for(let e=0;e<n.length;e++){let t=n[e].cell.cell,a=this.getVertexBounds(t),l=this.graph.getEdgesBetween(i,t,!1),d=[],u=0,p=0;for(let e=0;e<l.length;e+=1)this.horizontal?(u=c.x+c.width,p=c.y+o,d.push(new Point(u,p)),u=c.x+c.width+h,d.push(new Point(u,p)),p=a.y+a.height/2):(u=c.x+o,p=c.y+c.height,d.push(new Point(u,p)),p=c.y+c.height+h,d.push(new Point(u,p)),u=a.x+a.width/2),d.push(new Point(u,p)),this.setEdgePoints(l[e],d);e<s/2?h+=this.prefVertEdgeOff:e>s/2&&(h-=this.prefVertEdgeOff),o+=r}}}class StackLayout extends GraphLayout{constructor(e,t=null,i=null,s=null,n=null,a=null){super(e),this.border=0,this.marginTop=0,this.marginLeft=0,this.marginRight=0,this.marginBottom=0,this.keepFirstLocation=!1,this.fill=!1,this.resizeParent=!1,this.resizeParentMax=!1,this.resizeLast=!1,this.wrap=null,this.borderCollapse=!0,this.allowGaps=!1,this.gridSize=0,this.horizontal=null==t||t,this.spacing=null!=i?i:0,this.x0=null!=s?s:0,this.y0=null!=n?n:0,this.border=null!=a?a:0}isHorizontal(){return this.horizontal}moveCell(e,t,i){let s=this.graph.getDataModel(),n=e.getParent(),a=this.isHorizontal();if(null!=e&&null!=n){let l=0,r=0,o=n.getChildCount(),h=a?t:i,c=this.graph.getView().getState(n);for(null!=c&&(h-=a?c.x:c.y),h/=this.graph.view.scale,l=0;l<o;l+=1){let t=n.getChildAt(l);if(t!==e){let e=t.getGeometry();if(null!=e){let t=a?e.x+e.width/2:e.y+e.height/2;if(r<=h&&t>h)break;r=t}}}let d=n.getIndex(e);d=Math.max(0,l-+(l>d)),s.add(n,e,d)}}getParentSize(e){let t=this.graph.getDataModel(),i=e.getGeometry();return null!=this.graph.container&&(null==i&&t.isLayer(e)||e===this.graph.getView().currentRoot)&&(i=new Geometry(0,0,this.graph.container.offsetWidth-1,this.graph.container.offsetHeight-1)),i}getLayoutCells(e){this.graph.getDataModel();let t=e.getChildCount(),i=[];for(let s=0;s<t;s+=1){let t=e.getChildAt(s);!this.isVertexIgnored(t)&&this.isVertexMovable(t)&&i.push(t)}return this.allowGaps&&i.sort((e,t)=>{let i=e.getGeometry(),s=t.getGeometry();return this.horizontal?i.x===s.x?0:i.x>s.x&&s.x>0?1:-1:i.y===s.y?0:i.y>s.y&&s.y>0?1:-1}),i}snap(e){if(null!=this.gridSize&&this.gridSize>0&&(e=Math.max(e,this.gridSize))/this.gridSize>1){let t=e%this.gridSize;e+=t>this.gridSize/2?this.gridSize-t:-t}return e}execute(e){if(null!=e){let t=this.getParentSize(e),i=this.isHorizontal(),s=this.graph.getDataModel(),n=null;null!=t&&(n=(i?t.height-this.marginTop-this.marginBottom:t.width-this.marginLeft-this.marginRight)-2*this.border);let a=this.x0+this.border+this.marginLeft,l=this.y0+this.border+this.marginTop;if(this.graph.isSwimlane(e)){let s=this.graph.getCellStyle(e),r=s.startSize??DEFAULT_STARTSIZE,o=s.horizontal??!0;null!=t&&(r=o?Math.min(r,t.height):Math.min(r,t.width)),i===o&&null!=n&&(n-=r),o?l+=r:a+=r}s.beginUpdate();try{let s=0,r=null,o=0,h=null,c=this.getLayoutCells(e);for(let e=0;e<c.length;e+=1){let t=c[e],d=t.getGeometry();if(null!=d){d=d.clone(),null!=this.wrap&&null!=r&&(i&&r.x+r.width+d.width+2*this.spacing>this.wrap||!i&&r.y+r.height+d.height+2*this.spacing>this.wrap)&&(r=null,i?l+=s+this.spacing:a+=s+this.spacing,s=0),s=Math.max(s,i?d.height:d.width);let e=0;if(this.borderCollapse||(e=this.graph.getCellStyle(t).strokeWidth??1),null!=r){let t=o+this.spacing+Math.floor(e/2);i?d.x=this.snap((this.allowGaps?Math.max(t,d.x):t)-this.marginLeft)+this.marginLeft:d.y=this.snap((this.allowGaps?Math.max(t,d.y):t)-this.marginTop)+this.marginTop}else this.keepFirstLocation||(i?d.x=this.allowGaps&&d.x>a?Math.max(this.snap(d.x-this.marginLeft)+this.marginLeft,a):a:d.y=this.allowGaps&&d.y>l?Math.max(this.snap(d.y-this.marginTop)+this.marginTop,l):l);i?d.y=l:d.x=a,this.fill&&null!=n&&(i?d.height=n:d.width=n),i?d.width=this.snap(d.width):d.height=this.snap(d.height),this.setChildGeometry(t,d),h=t,r=d,o=i?r.x+r.width+Math.floor(e/2):r.y+r.height+Math.floor(e/2)}}this.resizeParent&&null!=t&&null!=r&&!e.isCollapsed()?this.updateParentGeometry(e,t,r):this.resizeLast&&null!=t&&null!=r&&null!=h&&(i?r.width=t.width-r.x-this.spacing-this.marginRight-this.marginLeft:r.height=t.height-r.y-this.spacing-this.marginBottom,this.setChildGeometry(h,r))}finally{s.endUpdate()}}}setChildGeometry(e,t){let i=e.getGeometry();(null==i||t.x!==i.x||t.y!==i.y||t.width!==i.width||t.height!==i.height)&&this.graph.getDataModel().setGeometry(e,t)}updateParentGeometry(e,t,i){let s=this.isHorizontal(),n=this.graph.getDataModel(),a=t.clone();if(s){let e=i.x+i.width+this.marginRight+this.border;this.resizeParentMax?a.width=Math.max(a.width,e):a.width=e}else{let e=i.y+i.height+this.marginBottom+this.border;this.resizeParentMax?a.height=Math.max(a.height,e):a.height=e}(t.x!==a.x||t.y!==a.y||t.width!==a.width||t.height!==a.height)&&n.setGeometry(e,a)}}class CellCodec extends ObjectCodec{constructor(){super(new Cell,["children","edges","overlays","mxTransient"],["parent","source","target"]),this.setName("Cell")}isCellCodec(){return!0}isNumericAttribute(e,t,i){return"value"!==t.nodeName&&super.isNumericAttribute(e,t,i)}isExcluded(e,t,i,s){return super.isExcluded(e,t,i,s)||s&&"value"===t&&isElement(i)}afterEncode(e,t,i){if(isElement(t.value)){let s=i;(i=importNode(e.document,t.value,!0)).appendChild(s);let n=s.getAttribute("id");i.setAttribute("id",String(n)),s.removeAttribute("id")}return i}beforeDecode(e,t,i){let s=t.cloneNode(!0),n=this.getName();if(t.nodeName!==n){let e=t.getElementsByTagName(n)[0];null!=e&&e.parentNode===t?(removeWhitespace(e,!0),removeWhitespace(e,!1),e.parentNode.removeChild(e),s=e):s=null,i.value=t.cloneNode(!0);let a=i.value.getAttribute("id");null!=a&&(i.setId(a),i.value.removeAttribute("id"))}else i.setId(t.getAttribute("id"));if(null!=s)for(let t=0;t<this.idrefs.length;t+=1){let n=this.idrefs[t],a=s.getAttribute(n);if(null!=a){s.removeAttribute(n);let t=e.objects[a]||e.lookup(a);if(null==t){let i=e.getElementById(a);null!=i&&(t=(CodecRegistry.codecs[i.nodeName]||this).decode(e,i))}i[n]=t}}return s}}class ModelCodec extends ObjectCodec{constructor(){super(new GraphDataModel),this.setName("GraphDataModel")}encodeObject(e,t,i){let s=e.document.createElement("root");e.encodeCell(t.getRoot(),s),i.appendChild(s)}decodeChild(e,t,i){"root"===t.nodeName?this.decodeRoot(e,t,i):this.decodeChild.apply(this,[e,t,i])}decodeRoot(e,t,i){let s=null,n=t.firstChild;for(;null!=n;){let t=e.decodeCell(n);null!=t&&null==t.getParent()&&(s=t),n=n.nextSibling}null!=s&&i.setRoot(s)}}let fieldMapping=new Map([["autosize","autoSize"]]);function convertStyleFromString(e){let t={};for(let i of(e.startsWith(";")&&(t.ignoreDefaultStyle=!0),e.split(";").filter(([e])=>e)))if(i.includes("=")){let[e,s]=i.split("=");t[fieldMapping.get(e)??e]=convertToNumericIfNeeded(s)}else t.baseStyleNames||(t.baseStyleNames=[]),t.baseStyleNames.push(i);return t}function convertToNumericIfNeeded(e){if(!isNumeric(e))return e;let t=parseFloat(e);return(Number.isNaN(t)||!Number.isFinite(t))&&(t=0),t}class mxCellCodec extends CellCodec{getName(){return"mxCell"}decodeAttribute(e,t,i){let s=t.nodeName;i&&"style"==s?i.style=convertStyleFromString(t.value):super.decodeAttribute(e,t,i)}}class mxGeometryCodec extends ObjectCodec{getName(){return"mxGeometry"}constructor(){super(new Geometry)}afterDecode(e,t,i){let s=i.points;if(s){let e=[];for(let t of s){let i=t;e.push(new Point(i.x,i.y))}i.points=e}return i}}let isBaseCodecsRegistered=!1,registerBaseCodecs=(e=!1)=>{(!isBaseCodecsRegistered||e)&&(CodecRegistry.register(new ObjectCodec({})),CodecRegistry.register(new ObjectCodec([])),isBaseCodecsRegistered=!0)},createObjectCodec=(e,t)=>{let i=new ObjectCodec(e);return i.setName(t),i},isModelCodecsRegistered=!1,registerModelCodecs=(e=!1)=>{(!isModelCodecsRegistered||e)&&(CodecRegistry.register(new CellCodec),CodecRegistry.register(new ModelCodec),CodecRegistry.register(createObjectCodec(new Geometry,"Geometry")),CodecRegistry.register(createObjectCodec(new Point,"Point")),registerBaseCodecs(e),CodecRegistry.addAlias("mxGraphModel","GraphDataModel"),CodecRegistry.addAlias("mxPoint","Point"),CodecRegistry.register(new mxCellCodec,!1),CodecRegistry.register(new mxGeometryCodec,!1),isModelCodecsRegistered=!0)};class ModelXmlSerializer{constructor(e){this.dataModel=e,this.registerCodecs()}import(e){let t="string"==typeof e?parseXml(e):e.ownerDocument;new Codec(t).decode(t.documentElement,this.dataModel)}export(e){let t=new Codec().encode(this.dataModel);return(null==e?void 0:e.pretty)??!0?getPrettyXml(t):getXml(t)}registerCodecs(){registerModelCodecs()}}let activeWindow=null;class MaxWindow extends EventSource{constructor(e,t,i,s,n=null,a=null,l=!0,r=!0,o=null,h){super(),this.closeImage=`${Client.imageBasePath}/close.gif`,this.minimizeImage=`${Client.imageBasePath}/minimize.gif`,this.normalizeImage=`${Client.imageBasePath}/normalize.gif`,this.maximizeImage=`${Client.imageBasePath}/maximize.gif`,this.resizeImage=`${Client.imageBasePath}/resize.gif`,this.visible=!1,this.minimumSize=new Rectangle(0,0,50,40),this.destroyOnClose=!0,null!=t&&(this.content=t,this.init(i,s,n,a,h),this.installMaximizeHandler(),this.installMinimizeHandler(),this.installCloseHandler(),this.setMinimizable(l),this.setTitle(e),r&&this.installMoveHandler(),null!=o&&null!=o.parentNode?o.parentNode.replaceChild(this.div,o):document.body.appendChild(this.div))}init(e,t,i=null,s=null,n="mxWindow"){this.div=document.createElement("div"),this.div.className=n,this.div.style.left=`${e}px`,this.div.style.top=`${t}px`,this.table=document.createElement("table"),this.table.className=n,Client.IS_POINTER&&(this.div.style.touchAction="none"),null!=i&&(this.div.style.width=`${i}px`,this.table.style.width=`${i}px`),null!=s&&(this.div.style.height=`${s}px`,this.table.style.height=`${s}px`);let a=document.createElement("tbody"),l=document.createElement("tr");this.title=document.createElement("td"),this.title.className=`${n}Title`,this.buttons=document.createElement("div"),this.buttons.style.position="absolute",this.buttons.style.display="inline-block",this.buttons.style.right="4px",this.buttons.style.top="5px",this.title.appendChild(this.buttons),l.appendChild(this.title),a.appendChild(l),l=document.createElement("tr"),this.td=document.createElement("td"),this.td.className=`${n}Pane`,this.contentWrapper=document.createElement("div"),this.contentWrapper.className=`${n}Pane`,this.contentWrapper.style.width="100%",this.contentWrapper.appendChild(this.content),"DIV"!==this.content.nodeName.toUpperCase()&&(this.contentWrapper.style.height="100%"),this.td.appendChild(this.contentWrapper),l.appendChild(this.td),a.appendChild(l),this.table.appendChild(a),this.div.appendChild(this.table);let r=e=>{this.activate()};InternalEvent.addGestureListeners(this.title,r),InternalEvent.addGestureListeners(this.table,r),this.hide()}setTitle(e){let t=this.title.firstChild;for(;null!=t;){let e=t.nextSibling;t.nodeType===NODETYPE.TEXT&&t.parentNode.removeChild(t),t=e}write(this.title,e||""),this.title.appendChild(this.buttons)}setScrollable(e){(null==navigator.userAgent||0>navigator.userAgent.indexOf("Presto/2.5"))&&(e?this.contentWrapper.style.overflow="auto":this.contentWrapper.style.overflow="hidden")}activate(){if(activeWindow!==this){let e=getCurrentStyle(this.getElement()),t=null!=e?parseInt(e.zIndex):3;if(activeWindow){let e=activeWindow.getElement();(null==e?void 0:e.style)&&(e.style.zIndex=String(t))}let i=activeWindow;this.getElement().style.zIndex=String(t+1),activeWindow=this,this.fireEvent(new EventObject(InternalEvent.ACTIVATE,{previousWindow:i}))}}getElement(){return this.div}fit(){fit(this.div)}isResizable(){return null!=this.resize&&"none"!==this.resize.style.display}setResizable(e){if(e)if(null==this.resize){this.resize=document.createElement("img"),this.resize.style.position="absolute",this.resize.style.bottom="2px",this.resize.style.right="2px",this.resize.setAttribute("src",this.resizeImage),this.resize.style.cursor="nw-resize";let e=null,t=null,i=null,s=null,n=n=>{this.activate(),e=getClientX(n),t=getClientY(n),i=this.div.offsetWidth,s=this.div.offsetHeight,InternalEvent.addGestureListeners(document,null,a,l),this.fireEvent(new EventObject(InternalEvent.RESIZE_START,{event:n})),InternalEvent.consume(n)},a=n=>{if(null!=e&&null!=t){let a=getClientX(n)-e,l=getClientY(n)-t;null!=i&&null!=s&&this.setSize(i+a,s+l),this.fireEvent(new EventObject(InternalEvent.RESIZE,{event:n})),InternalEvent.consume(n)}},l=i=>{null!=e&&null!=t&&(e=null,t=null,InternalEvent.removeGestureListeners(document,null,a,l),this.fireEvent(new EventObject(InternalEvent.RESIZE_END,{event:i})),InternalEvent.consume(i))};InternalEvent.addGestureListeners(this.resize,n,a,l),this.div.appendChild(this.resize)}else this.resize.style.display="inline";else null!=this.resize&&(this.resize.style.display="none")}setSize(e,t){e=Math.max(this.minimumSize.width,e),t=Math.max(this.minimumSize.height,t),this.div.style.width=`${e}px`,this.div.style.height=`${t}px`,this.table.style.width=`${e}px`,this.table.style.height=`${t}px`,this.contentWrapper.style.height=`${this.div.offsetHeight-this.title.offsetHeight}px`}setMinimizable(e){this.minimize.style.display=e?"":"none"}getMinimumSize(){return new Rectangle(0,0,0,this.title.offsetHeight)}installMinimizeHandler(){this.minimize=document.createElement("img"),this.minimize.setAttribute("src",this.minimizeImage),this.minimize.setAttribute("title","Minimize"),this.minimize.style.cursor="pointer",this.minimize.style.marginLeft="2px",this.minimize.style.display="none",this.buttons.appendChild(this.minimize);let e=!1,t=null,i=null,s=s=>{if(this.activate(),e)e=!1,this.minimize.setAttribute("src",this.minimizeImage),this.minimize.setAttribute("title","Minimize"),this.contentWrapper.style.display="",null!=t&&null!=i&&(this.maximize.style.display=t,this.div.style.height=i,this.table.style.height=i),null!=this.resize&&(this.resize.style.visibility=""),this.fireEvent(new EventObject(InternalEvent.NORMALIZE,{event:s}));else{e=!0,this.minimize.setAttribute("src",this.normalizeImage),this.minimize.setAttribute("title","Normalize"),this.contentWrapper.style.display="none",t=this.maximize.style.display,this.maximize.style.display="none",i=this.table.style.height;let n=this.getMinimumSize();n.height>0&&(this.div.style.height=`${n.height}px`,this.table.style.height=`${n.height}px`),n.width>0&&(this.div.style.width=`${n.width}px`,this.table.style.width=`${n.width}px`),null!=this.resize&&(this.resize.style.visibility="hidden"),this.fireEvent(new EventObject(InternalEvent.MINIMIZE,{event:s}))}InternalEvent.consume(s)};InternalEvent.addGestureListeners(this.minimize,s)}setMaximizable(e){this.maximize.style.display=e?"":"none"}installMaximizeHandler(){this.maximize=document.createElement("img"),this.maximize.setAttribute("src",this.maximizeImage),this.maximize.setAttribute("title","Maximize"),this.maximize.style.cursor="default",this.maximize.style.marginLeft="2px",this.maximize.style.cursor="pointer",this.maximize.style.display="none",this.buttons.appendChild(this.maximize);let e=!1,t=null,i=null,s=null,n=null,a=null,l=l=>{if(this.activate(),"none"!==this.maximize.style.display){if(e)e=!1,this.maximize.setAttribute("src",this.maximizeImage),this.maximize.setAttribute("title","Maximize"),this.contentWrapper.style.display="",null!=a&&(this.minimize.style.display=a),this.div.style.left=`${t}px`,this.div.style.top=`${i}px`,null!=n&&null!=s&&(this.div.style.height=s,this.div.style.width=n),("auto"===getCurrentStyle(this.contentWrapper).overflow||null!=this.resize)&&(this.contentWrapper.style.height=`${this.div.offsetHeight-this.title.offsetHeight}px`),null!=n&&null!=s&&(this.table.style.height=s,this.table.style.width=n),null!=this.resize&&(this.resize.style.visibility=""),this.fireEvent(new EventObject(InternalEvent.NORMALIZE,{event:l}));else{e=!0,this.maximize.setAttribute("src",this.normalizeImage),this.maximize.setAttribute("title","Normalize"),this.contentWrapper.style.display="",a=this.minimize.style.display,this.minimize.style.display="none",t=parseInt(this.div.style.left),i=parseInt(this.div.style.top),s=this.table.style.height,n=this.table.style.width,this.div.style.left="0px",this.div.style.top="0px";let r=Math.max(document.body.clientHeight||0,document.documentElement.clientHeight||0);this.div.style.width=`${document.body.clientWidth-2}px`,this.div.style.height=`${r-2}px`,this.table.style.width=`${document.body.clientWidth-2}px`,this.table.style.height=`${r-2}px`,null!=this.resize&&(this.resize.style.visibility="hidden"),("auto"===getCurrentStyle(this.contentWrapper).overflow||null!=this.resize)&&(this.contentWrapper.style.height=`${this.div.offsetHeight-this.title.offsetHeight}px`),this.fireEvent(new EventObject(InternalEvent.MAXIMIZE,{event:l}))}InternalEvent.consume(l)}};InternalEvent.addGestureListeners(this.maximize,l),InternalEvent.addListener(this.title,"dblclick",l)}installMoveHandler(){this.title.style.cursor="move",InternalEvent.addGestureListeners(this.title,e=>{let t=getClientX(e),i=getClientY(e),s=this.getX(),n=this.getY(),a=e=>{let a=getClientX(e)-t,l=getClientY(e)-i;this.setLocation(s+a,n+l),this.fireEvent(new EventObject(InternalEvent.MOVE,{event:e})),InternalEvent.consume(e)},l=e=>{InternalEvent.removeGestureListeners(document,null,a,l),this.fireEvent(new EventObject(InternalEvent.MOVE_END,{event:e})),InternalEvent.consume(e)};InternalEvent.addGestureListeners(document,null,a,l),this.fireEvent(new EventObject(InternalEvent.MOVE_START,{event:e})),InternalEvent.consume(e)}),Client.IS_POINTER&&(this.title.style.touchAction="none")}setLocation(e,t){this.div.style.left=`${e}px`,this.div.style.top=`${t}px`}getX(){return parseInt(this.div.style.left)}getY(){return parseInt(this.div.style.top)}installCloseHandler(){this.closeImg=document.createElement("img"),this.closeImg.setAttribute("src",this.closeImage),this.closeImg.setAttribute("title","Close"),this.closeImg.style.marginLeft="2px",this.closeImg.style.cursor="pointer",this.closeImg.style.display="none",this.buttons.appendChild(this.closeImg),InternalEvent.addGestureListeners(this.closeImg,e=>{this.fireEvent(new EventObject(InternalEvent.CLOSE,{event:e})),this.destroyOnClose?this.destroy():this.setVisible(!1),InternalEvent.consume(e)})}setImage(e){this.image=document.createElement("img"),this.image.setAttribute("src",e),this.image.setAttribute("align","left"),this.image.style.marginRight="4px",this.image.style.marginLeft="0px",this.image.style.marginTop="-2px",this.title.insertBefore(this.image,this.title.firstChild)}setClosable(e){this.closeImg.style.display=e?"":"none"}isVisible(){return null!=this.div&&"none"!==this.div.style.display}setVisible(e){null!=this.div&&this.isVisible()!==e&&(e?this.show():this.hide())}show(){this.div.style.display="",this.activate(),("auto"==getCurrentStyle(this.contentWrapper).overflow||null!=this.resize)&&"none"!=this.contentWrapper.style.display&&(this.contentWrapper.style.height=`${this.div.offsetHeight-this.title.offsetHeight}px`),this.fireEvent(new EventObject(InternalEvent.SHOW))}hide(){this.div.style.display="none",this.fireEvent(new EventObject(InternalEvent.HIDE))}destroy(){this.fireEvent(new EventObject(InternalEvent.DESTROY)),null!=this.div&&(InternalEvent.release(this.div),this.div.parentNode.removeChild(this.div),this.div=null),this.title=null,this.content=null,this.contentWrapper=null}}class MaxForm{constructor(e){this.table=document.createElement("table"),this.table.className=e,this.body=document.createElement("tbody"),this.table.appendChild(this.body)}getTable(){return this.table}addButtons(e,t){let i=document.createElement("tr"),s=document.createElement("td");i.appendChild(s),s=document.createElement("td");let n=document.createElement("button");write(n,translate("ok")||"OK"),s.appendChild(n),InternalEvent.addListener(n,"click",()=>{e()}),write(n=document.createElement("button"),translate("cancel")||"Cancel"),s.appendChild(n),InternalEvent.addListener(n,"click",()=>{t()}),i.appendChild(s),this.body.appendChild(i)}addText(e,t,i="text"){let s=document.createElement("input");return s.setAttribute("type",i),s.value=t,this.addField(e,s)}addCheckbox(e,t){let i=document.createElement("input");return i.setAttribute("type","checkbox"),this.addField(e,i),t&&(i.checked=!0),i}addTextarea(e,t,i){let s=document.createElement("textarea");return Client.IS_NS&&i--,s.setAttribute("rows",String(i||2)),s.value=t,this.addField(e,s)}addCombo(e,t,i){let s=document.createElement("select");return null!=i&&s.setAttribute("size",String(i)),t&&s.setAttribute("multiple","true"),this.addField(e,s)}addOption(e,t,i,s){let n=document.createElement("option");writeln(n,t),n.setAttribute("value",i),s&&n.setAttribute("selected",String(s)),e.appendChild(n)}addField(e,t){let i=document.createElement("tr"),s=document.createElement("td");return write(s,e),i.appendChild(s),(s=document.createElement("td")).appendChild(t),i.appendChild(s),this.body.appendChild(i),t}}class Clipboard{static setCells(e){Clipboard.cells=e}static getCells(){return Clipboard.cells}static isEmpty(){return!Clipboard.getCells()}static cut(e,t=[]){return t=Clipboard.copy(e,t),Clipboard.insertCount=0,Clipboard.removeCells(e,t),t}static removeCells(e,t){e.removeCells(t)}static copy(e,t){t=t||e.getSelectionCells();let i=getTopmostCells(e.getExportableCells(t));return Clipboard.insertCount=1,Clipboard.setCells(e.cloneCells(i)),i}static paste(e){let t=null;if(!Clipboard.isEmpty()&&Clipboard.getCells()){t=e.getImportableCells(Clipboard.getCells());let i=Clipboard.insertCount*Clipboard.STEPSIZE,s=e.getDefaultParent();t=e.importCells(t,i,i,s),Clipboard.insertCount++,e.setSelectionCells(t)}return t}}Clipboard.STEPSIZE=10,Clipboard.insertCount=1;let popup=(e,t=!1)=>{if(t){let t=document.createElement("div");t.style.overflow="scroll",t.style.width="636px",t.style.height="460px";let i=document.createElement("pre");i.innerHTML=htmlEntities(e,!1).replace(/\n/g,"<br>").replace(/ /g,"&nbsp;"),t.appendChild(i);let s=new MaxWindow("Popup Window",t,document.body.clientWidth/2-320,Math.max(document.body.clientHeight||0,document.documentElement.clientHeight)/2-240,640,480,!1,!0);s.setClosable(!0),s.setVisible(!0)}else if(Client.IS_NS){let t=window.open();if(!t)throw Error("Permission not granted to open popup window");t.document.writeln(`<pre>${htmlEntities(e)}</pre>`),t.document.close()}else{let t=window.open();if(!t)throw Error("Permission not granted to open popup window");let i=t.document.createElement("pre");i.innerHTML=htmlEntities(e,!1).replace(/\n/g,"<br>").replace(/ /g,"&nbsp;"),t.document.body.appendChild(i)}},error=(e,t,i,s=null)=>{let n=document.createElement("div");n.style.padding="20px";let a=document.createElement("img");a.setAttribute("src",s||GuiConfig.errorImage),a.setAttribute("valign","bottom"),a.style.verticalAlign="middle",n.appendChild(a),n.appendChild(document.createTextNode(" ")),n.appendChild(document.createTextNode(" ")),n.appendChild(document.createTextNode(" ")),write(n,e);let l=document.body.clientWidth,r=document.body.clientHeight||document.documentElement.clientHeight,o=new MaxWindow(translate(GuiConfig.errorResource)||GuiConfig.errorResource,n,(l-t)/2,r/4,t,null,!1,!0);if(i){br(n);let e=document.createElement("p"),t=document.createElement("button");t.setAttribute("style","float:right"),InternalEvent.addListener(t,"click",e=>{o.destroy()}),write(t,translate(GuiConfig.closeResource)||GuiConfig.closeResource),e.appendChild(t),n.appendChild(e),br(n),o.setClosable(!0)}return o.setVisible(!0),o},GuiConfig={errorResource:"error",closeResource:"close",errorImage:`${Client.imageBasePath}/error.gif`},guiUtils=Object.freeze(Object.defineProperty({__proto__:null,GuiConfig:GuiConfig,error:error,popup:popup},Symbol.toStringTag,{value:"Module"})),copyTextToClipboard=e=>{navigator.clipboard.writeText(e).then(function(){GlobalConfig.logger.info("Async: Copying to clipboard was successful!")},function(e){GlobalConfig.logger.error("Async: Could not copy text: ",e)})};class MaxLog{static init(){if(null==MaxLog.window&&null!=document.body){let e=`${MaxLog.consoleName} - mxGraph ${VERSION}`,t=document.createElement("table");t.setAttribute("width","100%"),t.setAttribute("height","100%");let i=document.createElement("tbody"),s=document.createElement("tr"),n=document.createElement("td");n.style.verticalAlign="top",MaxLog.textarea=document.createElement("textarea"),MaxLog.textarea.setAttribute("wrap","off"),MaxLog.textarea.setAttribute("readOnly","true"),MaxLog.textarea.style.height="100%",MaxLog.textarea.style.resize="none",MaxLog.textarea.value=MaxLog.buffer,Client.IS_NS&&"BackCompat"!==document.compatMode?MaxLog.textarea.style.width="99%":MaxLog.textarea.style.width="100%",n.appendChild(MaxLog.textarea),s.appendChild(n),i.appendChild(s),s=document.createElement("tr"),MaxLog.td=document.createElement("td"),MaxLog.td.style.verticalAlign="top",MaxLog.td.setAttribute("height","30px"),s.appendChild(MaxLog.td),i.appendChild(s),t.appendChild(i),MaxLog.addButton("Info",function(e){MaxLog.info()}),MaxLog.addButton("DOM",function(e){let t=getInnerHtml(document.body);MaxLog.debug(t)}),MaxLog.addButton("Trace",function(e){MaxLog.TRACE=!MaxLog.TRACE,MaxLog.TRACE?MaxLog.debug("Tracing enabled"):MaxLog.debug("Tracing disabled")}),MaxLog.addButton("Copy",function(e){try{copyTextToClipboard(MaxLog.textarea.value)}catch(e){alert(e)}}),MaxLog.addButton("Show",function(e){try{popup(MaxLog.textarea.value)}catch(e){alert(e)}}),MaxLog.addButton("Clear",function(e){MaxLog.textarea.value=""});let a=0,l=0;if("number"==typeof window.innerWidth?(a=window.innerHeight,l=window.innerWidth):(a=document.documentElement.clientHeight||document.body.clientHeight,l=document.body.clientWidth),MaxLog.window=new MaxWindow(e,t,Math.max(0,l-320),Math.max(0,a-210),300,160),MaxLog.window.setMaximizable(!0),MaxLog.window.setScrollable(!1),MaxLog.window.setResizable(!0),MaxLog.window.setClosable(!0),MaxLog.window.destroyOnClose=!1,Client.IS_NS&&!Client.IS_GC&&!Client.IS_SF&&"BackCompat"!==document.compatMode){let e=MaxLog.window.getElement(),t=(t,i)=>{MaxLog.textarea.style.height=`${Math.max(0,e.offsetHeight-70)}px`};MaxLog.window.addListener(InternalEvent.RESIZE_END,t),MaxLog.window.addListener(InternalEvent.MAXIMIZE,t),MaxLog.window.addListener(InternalEvent.NORMALIZE,t),MaxLog.textarea.style.height="92px"}}}static info(){MaxLog.writeln(toString(navigator))}static addButton(e,t){let i=document.createElement("button");write(i,e),InternalEvent.addListener(i,"click",t),MaxLog.td.appendChild(i)}static isVisible(){return null!=MaxLog.window&&MaxLog.window.isVisible()}static show(){MaxLog.setVisible(!0)}static setVisible(e){null==MaxLog.window&&MaxLog.init(),null!=MaxLog.window&&MaxLog.window.setVisible(e)}static enter(e){if(MaxLog.TRACE)return MaxLog.writeln(`Entering ${e}`),new Date().getTime()}static leave(e,t){if(MaxLog.TRACE){let i=getElapseMillisecondsMessage(t);MaxLog.writeln(`Leaving ${e}${i}`)}}static debug(...e){MaxLog.DEBUG&&MaxLog.writeln(...e)}static trace(...e){MaxLog.TRACE&&MaxLog.writeln(...e)}static warn(...e){MaxLog.WARN&&MaxLog.writeln(...e)}static write(...e){let t="";for(let i=0;i<e.length;i+=1)t+=e[i],i<e.length-1&&(t+=" ");null!=MaxLog.textarea?(MaxLog.textarea.value=MaxLog.textarea.value+t,null!=navigator.userAgent&&navigator.userAgent.indexOf("Presto/2.5")>=0&&(MaxLog.textarea.style.visibility="hidden",MaxLog.textarea.style.visibility="visible"),MaxLog.textarea.scrollTop=MaxLog.textarea.scrollHeight):MaxLog.buffer+=t}static writeln(...e){let t="";for(let i=0;i<e.length;i+=1)t+=e[i],i<e.length-1&&(t+=" ");MaxLog.write(`${t}
`)}}MaxLog.textarea=null,MaxLog.consoleName="Console",MaxLog.TRACE=!1,MaxLog.DEBUG=!0,MaxLog.WARN=!0,MaxLog.buffer="";let getScaleForPageCount=(e,t,i,s=0)=>{if(e<1)return 1;let n=(i=null!=i?i:new Rectangle(...PAGE_FORMAT_A4_PORTRAIT)).width-2*s,a=i.height-2*s,l=t.getGraphBounds().clone(),r=t.getView().getScale();l.width/=r,l.height/=r;let o=l.width,h=l.height,c=1,d=Math.sqrt(e),u=Math.sqrt(o/h/(n/a)),p=d*u,g=d/u;if(p<1&&g>e){let t=g/e;g=e,p/=t}if(g<1&&p>e){let t=p/e;p=e,g/=t}let m=Math.ceil(p)*Math.ceil(g),f=0;for(;m>e;){let e=Math.floor(p)/p,t=Math.floor(g)/g;1==e&&(e=Math.floor(p-1)/p),1==t&&(t=Math.floor(g-1)/g);let i=1;if(p*=i=e>t?e:t,g*=i,m=Math.ceil(p)*Math.ceil(g),++f>10)break}return .99999*(c=n*p/o)},show=(e,t=null,i=0,s=0,n=null,a=null)=>{i=null!=i?i:0,s=null!=s?s:0,null==t?t=window.open().document:t.open();let l=e.getGraphBounds(),r=Math.ceil(i-l.x),o=Math.ceil(s-l.y);null==n&&(n=Math.ceil(l.width+i)+Math.ceil(Math.ceil(l.x)-l.x)),null==a&&(a=Math.ceil(l.height+s)+Math.ceil(Math.ceil(l.y)-l.y)),t.writeln("<html><head>");let h=document.getElementsByTagName("base");for(let e=0;e<h.length;e+=1)t.writeln(getOuterHtml(h[e]));let c=document.getElementsByTagName("link");for(let e=0;e<c.length;e+=1)t.writeln(getOuterHtml(c[e]));let d=document.getElementsByTagName("style");for(let e=0;e<d.length;e+=1)t.writeln(getOuterHtml(d[e]));t.writeln('</head><body style="margin:0px;"></body></html>'),t.close();let u=t.createElement("div");u.style.position="absolute",u.style.overflow="hidden",u.style.width=`${n}px`,u.style.height=`${a}px`;let p=t.createElement("div");if(p.style.position="absolute",p.style.left=`${r}px`,p.style.top=`${o}px`,e.container&&e.view.drawPane){let i=e.container.firstChild,s=null;for(;null!=i;){let t=i.cloneNode(!0);i==e.view.drawPane.ownerSVGElement?(u.appendChild(t),s=t):p.appendChild(t),i=i.nextSibling}t.body.appendChild(u),null!=p.firstChild&&t.body.appendChild(p),null!=s&&(s.style.minWidth="",s.style.minHeight="",s.firstChild&&s.firstChild.setAttribute("transform",`translate(${r},${o})`)),removeCursors(t.body)}return t},printScreen=e=>{let t=window.open();if(!t)return;e.getGraphBounds(),show(e,t.document);let i=()=>{t.focus(),t.print(),t.close()};Client.IS_GC?t.setTimeout(i,500):i()},printUtils=Object.freeze(Object.defineProperty({__proto__:null,getScaleForPageCount:getScaleForPageCount,printScreen:printScreen,show:show},Symbol.toStringTag,{value:"Module"}));class Editor extends EventSource{constructor(e){var t;super(),this.onInit=null,this.lastSnapshot=null,this.ignoredChanges=null,this.rubberband=null,this.isActive=null,this.destroyed=!1,this.askZoomResource=isI18nEnabled()?"askZoom":"",this.lastSavedResource=isI18nEnabled()?"lastSaved":"",this.currentFileResource=isI18nEnabled()?"currentFile":"",this.propertiesResource=isI18nEnabled()?"properties":"",this.tasksResource=isI18nEnabled()?"tasks":"",this.helpResource=isI18nEnabled()?"help":"",this.outlineResource=isI18nEnabled()?"outline":"",this.outline=null,this.graphRenderHint=null,this.toolbar=null,this.status=null,this.popupHandler=null,this.undoManager=null,this.keyHandler=null,this.actions={},this.dblClickAction="edit",this.swimlaneRequired=!1,this.disableContextMenu=!0,this.insertFunction=null,this.forcedInserting=!1,this.templates=null,this.defaultEdge=null,this.defaultEdgeStyle=null,this.defaultGroup=null,this.groupBorderSize=null,this.filename=null,this.linefeed="&#xa;",this.postParameterName="xml",this.escapePostData=!0,this.urlPost=null,this.urlImage=null,this.horizontalFlow=!1,this.layoutDiagram=!1,this.swimlaneSpacing=0,this.maintainSwimlanes=!1,this.layoutSwimlanes=!1,this.cycleAttributeValues=[],this.cycleAttributeIndex=0,this.cycleAttributeName="fillColor",this.tasks=null,this.tasksWindowImage=null,this.tasksTop=20,this.help=null,this.helpWindowImage=null,this.urlHelp=null,this.helpWidth=300,this.helpHeight=260,this.propertiesWidth=240,this.propertiesHeight=null,this.movePropertiesDialog=!1,this.validating=!1,this.modified=!1,this.actions={},this.addActions(),document.body&&(this.cycleAttributeValues=[],this.popupHandler=new EditorPopupMenu,this.undoManager=new UndoManager,this.graph=this.createGraph(),this.toolbar=this.createToolbar(),this.keyHandler=new EditorKeyHandler(this),this.configure(e),this.graph.swimlaneIndicatorColorAttribute=this.cycleAttributeName,null==(t=this.onInit)||t.call(this))}isModified(){return this.modified}setModified(e){this.modified=e}addActions(){this.addAction("save",e=>{e.save()}),this.addAction("print",e=>{new PrintPreview(e.graph,1).open()}),this.addAction("show",e=>{show(e.graph,null,10,10)}),this.addAction("exportImage",e=>{let t=e.getUrlImage();if(null==t||Client.IS_LOCAL)e.execute("show");else{let i=getXml(getViewXml(e.graph,1),"\n");submit(t,`${e.postParameterName}=${encodeURIComponent(i)}`,document,"_blank")}}),this.addAction("refresh",e=>{e.graph.refresh()}),this.addAction("cut",e=>{e.graph.isEnabled()&&Clipboard.cut(e.graph)}),this.addAction("copy",e=>{e.graph.isEnabled()&&Clipboard.copy(e.graph)}),this.addAction("paste",e=>{e.graph.isEnabled()&&Clipboard.paste(e.graph)}),this.addAction("delete",e=>{e.graph.isEnabled()&&e.graph.removeCells()}),this.addAction("group",e=>{e.graph.isEnabled()&&e.graph.setSelectionCell(e.groupCells())}),this.addAction("ungroup",e=>{e.graph.isEnabled()&&e.graph.setSelectionCells(e.graph.ungroupCells())}),this.addAction("removeFromParent",e=>{e.graph.isEnabled()&&e.graph.removeCellsFromParent()}),this.addAction("undo",e=>{e.graph.isEnabled()&&e.undo()}),this.addAction("redo",e=>{e.graph.isEnabled()&&e.redo()}),this.addAction("zoomIn",e=>{e.graph.zoomIn()}),this.addAction("zoomOut",e=>{e.graph.zoomOut()}),this.addAction("actualSize",e=>{e.graph.zoomActual()}),this.addAction("fit",e=>{e.graph.fit()}),this.addAction("showProperties",(e,t)=>{e.showProperties(t)}),this.addAction("selectAll",e=>{e.graph.isEnabled()&&e.graph.selectAll()}),this.addAction("selectNone",e=>{e.graph.isEnabled()&&e.graph.clearSelection()}),this.addAction("selectVertices",e=>{e.graph.isEnabled()&&e.graph.selectVertices()}),this.addAction("selectEdges",e=>{e.graph.isEnabled()&&e.graph.selectEdges()}),this.addAction("edit",(e,t)=>{e.graph.isEnabled()&&e.graph.isCellEditable(t)&&e.graph.startEditingAtCell(t)}),this.addAction("toBack",(e,t)=>{e.graph.isEnabled()&&e.graph.orderCells(!0)}),this.addAction("toFront",(e,t)=>{e.graph.isEnabled()&&e.graph.orderCells(!1)}),this.addAction("enterGroup",(e,t)=>{e.graph.enterGroup(t)}),this.addAction("exitGroup",e=>{e.graph.exitGroup()}),this.addAction("home",e=>{e.graph.home()}),this.addAction("selectPrevious",e=>{e.graph.isEnabled()&&e.graph.selectPreviousCell()}),this.addAction("selectNext",e=>{e.graph.isEnabled()&&e.graph.selectNextCell()}),this.addAction("selectParent",e=>{e.graph.isEnabled()&&e.graph.selectParentCell()}),this.addAction("selectChild",e=>{e.graph.isEnabled()&&e.graph.selectChildCell()}),this.addAction("collapse",e=>{e.graph.isEnabled()&&e.graph.foldCells(!0)}),this.addAction("collapseAll",e=>{if(e.graph.isEnabled()){let t=e.graph.getChildVertices();e.graph.foldCells(!0,!1,t)}}),this.addAction("expand",e=>{e.graph.isEnabled()&&e.graph.foldCells(!1)}),this.addAction("expandAll",e=>{if(e.graph.isEnabled()){let t=e.graph.getChildVertices();e.graph.foldCells(!1,!1,t)}}),this.addAction("bold",e=>{e.graph.isEnabled()&&e.graph.toggleCellStyleFlags("fontStyle",FONT.BOLD)}),this.addAction("italic",e=>{e.graph.isEnabled()&&e.graph.toggleCellStyleFlags("fontStyle",FONT.ITALIC)}),this.addAction("underline",e=>{e.graph.isEnabled()&&e.graph.toggleCellStyleFlags("fontStyle",FONT.UNDERLINE)}),this.addAction("alignCellsLeft",e=>{e.graph.isEnabled()&&e.graph.alignCells(ALIGN.LEFT)}),this.addAction("alignCellsCenter",e=>{e.graph.isEnabled()&&e.graph.alignCells(ALIGN.CENTER)}),this.addAction("alignCellsRight",e=>{e.graph.isEnabled()&&e.graph.alignCells(ALIGN.RIGHT)}),this.addAction("alignCellsTop",e=>{e.graph.isEnabled()&&e.graph.alignCells(ALIGN.TOP)}),this.addAction("alignCellsMiddle",e=>{e.graph.isEnabled()&&e.graph.alignCells(ALIGN.MIDDLE)}),this.addAction("alignCellsBottom",e=>{e.graph.isEnabled()&&e.graph.alignCells(ALIGN.BOTTOM)}),this.addAction("alignFontLeft",e=>{e.graph.setCellStyles("align",ALIGN.LEFT)}),this.addAction("alignFontCenter",e=>{e.graph.isEnabled()&&e.graph.setCellStyles("align",ALIGN.CENTER)}),this.addAction("alignFontRight",e=>{e.graph.isEnabled()&&e.graph.setCellStyles("align",ALIGN.RIGHT)}),this.addAction("alignFontTop",e=>{e.graph.isEnabled()&&e.graph.setCellStyles("verticalAlign",ALIGN.TOP)}),this.addAction("alignFontMiddle",e=>{e.graph.isEnabled()&&e.graph.setCellStyles("verticalAlign",ALIGN.MIDDLE)}),this.addAction("alignFontBottom",e=>{e.graph.isEnabled()&&e.graph.setCellStyles("verticalAlign",ALIGN.BOTTOM)}),this.addAction("zoom",e=>{let t=100*e.graph.getView().scale,i=prompt(translate(e.askZoomResource)||e.askZoomResource,String(t));if(i){let t=parseFloat(i)/100;isNaN(t)||e.graph.getView().setScale(t)}}),this.addAction("toggleTasks",e=>{isNullish(e.tasks)?e.showTasks():e.tasks.setVisible(!e.tasks.isVisible())}),this.addAction("toggleHelp",e=>{isNullish(e.help)?e.showHelp():e.help.setVisible(!e.help.isVisible())}),this.addAction("toggleOutline",e=>{isNullish(e.outline)?e.showOutline():e.outline.setVisible(!e.outline.isVisible())}),this.addAction("toggleConsole",e=>{MaxLog.setVisible(!MaxLog.isVisible())})}configure(e){e&&(new Codec(e.ownerDocument).decode(e,this),this.resetHistory())}resetFirstTime(){document.cookie="mxgraph=seen; expires=Fri, 27 Jul 2001 02:47:11 UTC; path=/"}resetHistory(){this.lastSnapshot=new Date().getTime(),this.undoManager.clear(),this.ignoredChanges=0,this.setModified(!1)}addAction(e,t){this.actions[e]=t}execute(e,t=null,i=null){let s=this.actions[e];if(s)try{let e=[this,t,i];s.apply(this,e)}catch(t){throw error(`Cannot execute ${e}: ${t.message}`,280,!0),t}else error(`Cannot find action ${e}`,280,!0)}addTemplate(e,t){this.templates[e]=t}getTemplate(e){return this.templates[e]}createGraph(){let e=new Graph(void 0);e.setTooltips(!0),e.setPanning(!0),this.installDblClickHandler(e),this.installUndoHandler(e),this.installDrillHandler(e),this.installChangeHandler(e),this.installInsertHandler(e);let t=e.getPlugin("PopupMenuHandler");t&&(t.factoryMethod=(e,t,i)=>this.createPopupMenu(e,t,i));let i=e.getPlugin("ConnectionHandler");return i&&(i.factoryMethod=(e,t)=>this.createEdge(e,t)),this.createSwimlaneManager(e),this.createLayoutManager(e),e}createSwimlaneManager(e){let t=new SwimlaneManager(e,!1);return t.isHorizontal=()=>this.horizontalFlow,t.isEnabled=()=>this.maintainSwimlanes,t}createLayoutManager(e){let t=new LayoutManager(e);return t.getLayout=t=>{var i;let s=null;return this.graph.getDataModel(),t.getParent()&&(this.layoutSwimlanes&&e.isSwimlane(t)?(null==this.swimlaneLayout&&(this.swimlaneLayout=this.createSwimlaneLayout()),s=this.swimlaneLayout):this.layoutDiagram&&(e.isValidRoot(t)||!(null==(i=null==t?void 0:t.getParent())?void 0:i.getParent()))&&(null==this.diagramLayout&&(this.diagramLayout=this.createDiagramLayout()),s=this.diagramLayout)),s},t}setGraphContainer(e){!this.graph.container&&e&&(this.graph.init(e),this.rubberband=new RubberBandHandler(this.graph),this.disableContextMenu&&InternalEvent.disableContextMenu(e))}installDblClickHandler(e){e.addListener(InternalEvent.DOUBLE_CLICK,(t,i)=>{let s=i.getProperty("cell");null!=s&&e.isEnabled()&&null!=this.dblClickAction&&(this.execute(this.dblClickAction,s),i.consume())})}installUndoHandler(e){let t=(e,t)=>{let i=t.getProperty("edit");this.undoManager.undoableEditHappened(i)};e.getDataModel().addListener(InternalEvent.UNDO,t),e.getView().addListener(InternalEvent.UNDO,t);let i=(t,i)=>{let{changes:s}=i.getProperty("edit");e.setSelectionCells(e.getSelectionCellsForChanges(s))};this.undoManager.addListener(InternalEvent.UNDO,i),this.undoManager.addListener(InternalEvent.REDO,i)}installDrillHandler(e){let t=e=>{this.fireEvent(new EventObject(InternalEvent.ROOT))};e.getView().addListener(InternalEvent.DOWN,t),e.getView().addListener(InternalEvent.UP,t)}installChangeHandler(e){let t=(t,i)=>{this.setModified(!0),this.validating&&e.validateGraph();let{changes:s}=i.getProperty("edit");for(let e of s)if(e instanceof RootChange||e instanceof ValueChange&&e.cell===this.graph.model.root||e instanceof CellAttributeChange&&e.cell===this.graph.model.root){this.fireEvent(new EventObject(InternalEvent.ROOT));break}};e.getDataModel().addListener(InternalEvent.CHANGE,t)}installInsertHandler(e){let t={mouseDown:(e,t)=>{this.insertFunction&&!t.isPopupTrigger()&&(this.forcedInserting||null==t.getState())&&(this.graph.clearSelection(),this.insertFunction(t.getEvent(),t.getCell()),this.isActive=!0,t.consume())},mouseMove:(e,t)=>{this.isActive&&t.consume()},mouseUp:(e,t)=>{this.isActive&&(this.isActive=!1,t.consume())}};e.addMouseListener(t)}createDiagramLayout(){let e=this.graph.gridSize,t=new StackLayout(this.graph,!this.horizontalFlow,this.swimlaneSpacing,2*e,2*e);return t.isVertexIgnored=e=>!t.graph.isSwimlane(e),t}createSwimlaneLayout(){return new CompactTreeLayout(this.graph,this.horizontalFlow)}createToolbar(){return new EditorToolbar(null,this)}setToolbarContainer(e){var t;null==(t=this.toolbar)||t.init(e)}setStatusContainer(e){!this.status&&e&&(this.status=e,this.addListener(InternalEvent.SAVE,()=>{let e=new Date().toLocaleString();this.setStatus(`${translate(this.lastSavedResource)||this.lastSavedResource}: ${e}`)}),this.addListener(InternalEvent.OPEN,()=>{this.setStatus(`${translate(this.currentFileResource)||this.currentFileResource}: ${this.filename}`)}))}setStatus(e){this.status&&!isNullish(e)&&(this.status.innerHTML=e)}setTitleContainer(e){this.addListener(InternalEvent.ROOT,t=>{e.innerHTML=this.getTitle()})}treeLayout(e,t){e&&new CompactTreeLayout(this.graph,t).execute(e)}getTitle(){var e;let t="",{graph:i}=this,s=i.getCurrentRoot();for(;null==(e=null==s?void 0:s.getParent())?void 0:e.getParent();)i.isValidRoot(s)&&(t=` > ${i.convertValueToString(s)}${t}`),s=s.getParent();return this.getRootTitle()+t}getRootTitle(){let e=this.graph.getDataModel().getRoot();return this.graph.convertValueToString(e)}undo(){this.undoManager.undo()}redo(){this.undoManager.redo()}groupCells(){let e=this.groupBorderSize??this.graph.gridSize;return this.graph.groupCells(this.createGroup(),e)}createGroup(){return cloneCell(this.defaultGroup)}open(e){if(!isNullish(e)){let t=load(e).getXml();this.readGraphModel(t.documentElement),this.filename=e,this.fireEvent(new EventObject(InternalEvent.OPEN,{filename:e}))}}readGraphModel(e){new ModelXmlSerializer(this.graph.getDataModel()).import(e),this.resetHistory()}save(e=null,t=this.linefeed){if(e=e||this.getUrlPost()){let i=this.writeGraphModel(t);this.postDiagram(e,i),this.setModified(!1)}this.fireEvent(new EventObject(InternalEvent.SAVE,{url:e}))}postDiagram(e,t){this.escapePostData&&(t=encodeURIComponent(t)),post(e,`${this.postParameterName}=${t}`,i=>{this.fireEvent(new EventObject(InternalEvent.POST,{request:i,url:e,data:t}))})}writeGraphModel(e){return new ModelXmlSerializer(this.graph.getDataModel()).export({pretty:!1})}getUrlPost(){return this.urlPost}getUrlImage(){return this.urlImage}swapStyles(e,t){let i=this.graph.getStylesheet().styles[t];this.graph.getView().getStylesheet().putCellStyle(t,this.graph.getStylesheet().styles[e]),this.graph.getStylesheet().putCellStyle(e,i),this.graph.refresh()}showProperties(e=null){if(!(e=e||this.graph.getSelectionCell())&&((e=this.graph.getCurrentRoot())||(e=this.graph.getDataModel().getRoot())),e){this.graph.stopEditing(!0);let t=getOffset(this.graph.container),i=t.x+10,{y:s}=t;if(this.properties&&!this.movePropertiesDialog)i=this.properties.getX(),s=this.properties.getY();else{let t=this.graph.getCellBounds(e);t&&(i+=t.x+Math.min(200,t.width),s+=t.y)}this.hideProperties();let n=this.createProperties(e);n&&(this.properties=new MaxWindow(translate(this.propertiesResource)||this.propertiesResource,n,i,s,this.propertiesWidth,this.propertiesHeight,!1),this.properties.setVisible(!0))}}isPropertiesVisible(){return null!=this.properties}createProperties(e){let t=this.graph.getDataModel(),i=e.getValue();if(isNode(i)){let s=new MaxForm("properties");s.addText("ID",e.getId()).setAttribute("readonly","true");let n=null,a=null,l=null,r=null,o=null;e.isVertex()&&null!=(n=e.getGeometry())&&(a=s.addText("top",n.y),l=s.addText("left",n.x),r=s.addText("width",n.width),o=s.addText("height",n.height));let h=e.getStyle(),c=s.addText("Style",h||""),d=i.attributes,u=[];for(let e=0;e<d.length;e+=1){let t=d[e].value;u.push(s.addTextarea(d[e].nodeName,t,"label"===d[e].nodeName?4:2))}let p=()=>{this.hideProperties(),t.beginUpdate();try{n&&l&&a&&r&&o&&((n=n.clone()).x=parseFloat(l.value),n.y=parseFloat(a.value),n.width=parseFloat(r.value),n.height=parseFloat(o.value),t.setGeometry(e,n)),c.value.length>0?t.setStyle(e,c.value):t.setStyle(e,{});for(let i=0;i<d.length;i+=1){let s=new CellAttributeChange(e,d[i].nodeName,u[i].value);t.execute(s)}this.graph.isAutoSizeCell(e)&&this.graph.updateCellSize(e)}finally{t.endUpdate()}},g=()=>{this.hideProperties()};return s.addButtons(p,g),s.table}return null}hideProperties(){null!=this.properties&&(this.properties.destroy(),this.properties=null)}showTasks(){if(null==this.tasks){let e=document.createElement("div");e.style.padding="4px",e.style.paddingLeft="20px";let t=document.body.clientWidth,i=new MaxWindow(translate(this.tasksResource)||this.tasksResource,e,t-220,this.tasksTop,200);i.setClosable(!0),i.destroyOnClose=!1;let s=t=>{InternalEvent.release(e),e.innerHTML="",this.createTasks(e)};this.graph.getDataModel().addListener(InternalEvent.CHANGE,s),this.graph.getSelectionModel().addListener(InternalEvent.CHANGE,s),this.graph.addListener(InternalEvent.ROOT,s),null!=this.tasksWindowImage&&i.setImage(this.tasksWindowImage),this.tasks=i,this.createTasks(e)}this.tasks.setVisible(!0)}refreshTasks(e){if(null!=this.tasks){let e=this.tasks.content;InternalEvent.release(e),e.innerHTML="",this.createTasks(e)}}createTasks(e){}showHelp(e=null){if(null==this.help){let e=document.createElement("iframe");e.setAttribute("src",translate("urlHelp")||this.urlHelp),e.setAttribute("height","100%"),e.setAttribute("width","100%"),e.setAttribute("frameBorder","0"),e.style.backgroundColor="white";let t=document.body.clientWidth,i=document.body.clientHeight||document.documentElement.clientHeight,s=new MaxWindow(translate(this.helpResource)||this.helpResource,e,(t-this.helpWidth)/2,(i-this.helpHeight)/3,this.helpWidth,this.helpHeight);if(s.setMaximizable(!0),s.setClosable(!0),s.destroyOnClose=!1,s.setResizable(!0),null!=this.helpWindowImage&&s.setImage(this.helpWindowImage),Client.IS_NS){let t=t=>{let i=s.div.offsetHeight;e.setAttribute("height",`${i-26}px`)};s.addListener(InternalEvent.RESIZE_END,t),s.addListener(InternalEvent.MAXIMIZE,t),s.addListener(InternalEvent.NORMALIZE,t),s.addListener(InternalEvent.SHOW,t)}this.help=s}this.help.setVisible(!0)}showOutline(){if(null==this.outline){let e=document.createElement("div");e.style.overflow="hidden",e.style.position="relative",e.style.width="100%",e.style.height="100%",e.style.background="white",e.style.cursor="move";let t=new MaxWindow(translate(this.outlineResource)||this.outlineResource,e,600,480,200,200,!1),i=new Outline(this.graph,e);t.setClosable(!0),t.setResizable(!0),t.destroyOnClose=!1,t.addListener(InternalEvent.RESIZE_END,()=>{i.update()}),this.outline=t,this.outline.Outline=i}this.outline.setVisible(!0),this.outline.outline.update(!0)}setMode(e){let t=this.graph.getPlugin("PanningHandler");"select"===e?(t&&(t.useLeftButtonForPanning=!1),this.graph.setConnectable(!1)):"connect"===e?(t&&(t.useLeftButtonForPanning=!1),this.graph.setConnectable(!0)):"pan"===e&&(t&&(t.useLeftButtonForPanning=!0),this.graph.setConnectable(!1))}createPopupMenu(e,t,i){this.popupHandler.createMenu(this,e,t,i)}createEdge(e,t){let i;if(null!=this.defaultEdge)i=cloneCell(this.defaultEdge);else{(i=new Cell("")).setEdge(!0);let e=new Geometry;e.relative=!0,i.setGeometry(e)}let s=this.getEdgeStyle();return null!=s&&i.setStyle(s),i}getEdgeStyle(){return this.defaultEdgeStyle}consumeCycleAttribute(e){return this.cycleAttributeValues&&this.cycleAttributeValues.length>0&&this.graph.isSwimlane(e)?this.cycleAttributeValues[this.cycleAttributeIndex++%this.cycleAttributeValues.length]:null}cycleAttribute(e){if(!isNullish(this.cycleAttributeName)){let t=this.consumeCycleAttribute(e);isNullish(t)||e.setStyle(`${e.getStyle()};${this.cycleAttributeName}=${t}`)}}addVertex(e,t,i,s){let n=this.graph.getDataModel();for(;e&&!this.graph.isValidDropTarget(e);)e=e.getParent();e??(e=this.graph.getSwimlaneAt(i,s));let{scale:a}=this.graph.getView(),l=t.getGeometry(),r=null==e?void 0:e.getGeometry();if(this.graph.isSwimlane(t)&&!this.graph.swimlaneNesting)e=null;else if(!e&&this.swimlaneRequired)return null;else if(e&&r){let t=this.graph.getView().getState(e);if(t){if(i-=t.origin.x*a,s-=t.origin.y*a,this.graph.isConstrainedMoving){let{width:e}=l,{height:n}=l,a=t.x+t.width;i+e>a&&(i-=i+e-a),a=t.y+t.height,s+n>a&&(s-=s+n-a)}}else i-=r.x*a,s-=r.y*a}(l=l.clone()).x=this.graph.snap(i/a-this.graph.getView().translate.x-this.graph.gridSize/2),l.y=this.graph.snap(s/a-this.graph.getView().translate.y-this.graph.gridSize/2),t.setGeometry(l),e&&(e=this.graph.getDefaultParent()),this.cycleAttribute(t),this.fireEvent(new EventObject(InternalEvent.BEFORE_ADD_VERTEX,{vertex:t,parent:e})),n.beginUpdate();try{(t=this.graph.addCell(t,e))&&(this.graph.constrainChild(t),this.fireEvent(new EventObject(InternalEvent.ADD_VERTEX,{vertex:t})))}finally{n.endUpdate()}return null!=t&&(this.graph.setSelectionCell(t),this.graph.scrollCellToVisible(t),this.fireEvent(new EventObject(InternalEvent.AFTER_ADD_VERTEX,{vertex:t}))),t}destroy(){var e,t,i,s,n,a,l;this.destroyed||(this.destroyed=!0,null==(e=this.tasks)||e.destroy(),null==(t=this.outline)||t.destroy(),null==(i=this.properties)||i.destroy(),null==(s=this.keyHandler)||s.destroy(),null==(n=this.rubberband)||n.onDestroy(),null==(a=this.toolbar)||a.destroy(),null==(l=this.graph)||l.destroy(),this.status=null,this.templates=null)}}class CellTracker extends CellMarker{constructor(e,t,i=null){super(e,t),this.destroyed=!1,this.graph.addMouseListener(this),i&&(this.getCell=i)}mouseDown(e,t){}mouseMove(e,t){this.isEnabled()&&this.process(t)}mouseUp(e,t){}destroy(){this.destroyed||(this.destroyed=!0,this.graph.removeMouseListener(this),super.destroy())}}class VertexHandle{constructor(e,t="default",i=null,s=null){this.dependencies=["snap","cells"],this.cursor="default",this.image=null,this.ignoreGrid=!1,this.active=!0,this.graph=e.view.graph,this.state=e,this.cursor=t,this.image=i,this.shape=s,this.init()}getPosition(e){return new Point}setPosition(e,t,i){}execute(e){}copyStyle(e){this.graph.setCellStyles(e,this.state.style[e],[this.state.cell])}processEvent(e){let{scale:t}=this.graph.view,i=this.graph.view.translate,s=new Point(e.getGraphX()/t-i.x,e.getGraphY()/t-i.y);null!=this.shape&&null!=this.shape.bounds&&(s.x-=this.shape.bounds.width/t/4,s.y-=this.shape.bounds.height/t/4);let n=-toRadians(this.getRotation()),a=-toRadians(this.getTotalRotation())-n;s=this.flipPoint(this.rotatePoint(this.snapPoint(this.rotatePoint(s,n),this.ignoreGrid||!this.graph.isGridEnabledEvent(e.getEvent())),a)),this.setPosition(this.state.getPaintBounds(),s,e),this.redraw()}positionChanged(){null!=this.state.text&&this.state.text.apply(this.state),null!=this.state.shape&&this.state.shape.apply(this.state),this.graph.cellRenderer.redraw(this.state,!0)}getRotation(){return null!=this.state.shape?this.state.shape.getRotation():0}getTotalRotation(){return null!=this.state.shape?this.state.shape.getShapeRotation():0}init(){let e=this.isHtmlRequired();this.image?(this.shape=new ImageShape(new Rectangle(0,0,this.image.width,this.image.height),this.image.src),this.shape.preserveImageAspect=!1):this.shape||(this.shape=this.createShape(e)),this.initShape(e)}createShape(e){let t=HandleConfig.size;return new RectangleShape(new Rectangle(0,0,t,t),HandleConfig.fillColor,HandleConfig.strokeColor)}initShape(e){let t=this.shape;e&&t.isHtmlAllowed()?(t.dialect=DIALECT.STRICTHTML,t.init(this.graph.container)):(t.dialect=this.graph.dialect!==DIALECT.SVG?DIALECT.MIXEDHTML:DIALECT.SVG,this.cursor&&t.init(this.graph.getView().getOverlayPane())),InternalEvent.redirectMouseEvents(t.node,this.graph,this.state),t.node.style.cursor=this.cursor}redraw(){if(this.shape&&this.state.shape){let e=this.getPosition(this.state.getPaintBounds());if(e){let t=toRadians(this.getTotalRotation());e=this.rotatePoint(this.flipPoint(e),t);let{scale:i}=this.graph.view,s=this.graph.view.translate,n=this.shape.bounds;n.x=Math.floor((e.x+s.x)*i-n.width/2),n.y=Math.floor((e.y+s.y)*i-n.height/2),this.shape.redraw()}}}isHtmlRequired(){return!!this.state.text&&this.state.text.node.parentNode===this.graph.container}rotatePoint(e,t){let i=this.state.getCellBounds();return getRotatedPoint(e,Math.cos(t),Math.sin(t),new Point(i.getCenterX(),i.getCenterY()))}flipPoint(e){if(this.state.shape){let t=this.state.getCellBounds();this.state.shape.flipH&&(e.x=2*t.x+t.width-e.x),this.state.shape.flipV&&(e.y=2*t.y+t.height-e.y)}return e}snapPoint(e,t){return t||(e.x=this.graph.snap(e.x),e.y=this.graph.snap(e.y)),e}setVisible(e){this.shape&&this.shape.node&&(this.shape.node.style.display=e?"":"none")}reset(){this.setVisible(!0),this.state.style=this.graph.getCellStyle(this.state.cell),this.positionChanged()}destroy(){this.shape&&(this.shape.destroy(),this.shape=null)}}class CircleLayout extends GraphLayout{constructor(e,t=100){super(e),this.moveCircle=!1,this.x0=0,this.y0=0,this.resetEdges=!0,this.disableEdgeStyle=!0,this.radius=t}execute(e){this.graph.batchUpdate(()=>{let t=0,i=null,s=null,n=[],a=e.getChildCount();for(let l=0;l<a;l+=1){let a=e.getChildAt(l);if(this.isVertexIgnored(a))!this.isEdgeIgnored(a)&&(this.resetEdges&&this.graph.resetEdge(a),this.disableEdgeStyle&&this.setEdgeStyleEnabled(a,!1));else{n.push(a);let e=this.getVertexBounds(a);i=null==i?e.y:Math.min(i,e.y),s=null==s?e.x:Math.min(s,e.x),t=Math.max(t,Math.max(e.width,e.height))}}let l=this.getRadius(n.length,t);this.moveCircle&&(s=this.x0,i=this.y0),this.circle(n,l,s,i)})}getRadius(e,t){return Math.max(e*t/Math.PI,this.radius)}circle(e,t,i,s){let n=2*Math.PI/e.length;e.forEach((e,a)=>{this.isVertexMovable(e)&&this.setVertexLocation(e,Math.round(i+t+t*Math.sin(a*n)),Math.round(s+t+t*Math.cos(a*n)))})}}class CompositeLayout extends GraphLayout{constructor(e,t,i){super(e),this.layouts=t,this.master=i}moveCell(e,t,i){null!=this.master?this.master.moveCell.apply(this.master,[e,t,i]):this.layouts[0].moveCell.apply(this.layouts[0],[e,t,i])}execute(e){this.graph.batchUpdate(()=>{for(let t=0;t<this.layouts.length;t+=1)this.layouts[t].execute.apply(this.layouts[t],[e])})}}class EdgeLabelLayout extends GraphLayout{constructor(e,t){super(e)}execute(e){let{view:t}=this.graph;this.graph.getDataModel();let i=[],s=[],n=e.getChildCount();for(let a=0;a<n;a+=1){let n=e.getChildAt(a),l=t.getState(n);null!=l&&(this.isVertexIgnored(n)?this.isEdgeIgnored(n)||i.push(l):s.push(l))}this.placeLabels(s,i)}placeLabels(e,t){this.graph.batchUpdate(()=>{for(let i=0;i<t.length;i+=1){let s=t[i];if(null!=s&&null!=s.text&&null!=s.text.boundingBox)for(let t=0;t<e.length;t+=1){let i=e[t];null!=i&&this.avoid(s,i)}}})}avoid(e,t){let i=this.graph.getDataModel(),s=e.text.boundingBox;if(intersects$1(s,t)){let n=-s.y-s.height+t.y,a=-s.y+t.y+t.height,l=Math.abs(n)<Math.abs(a)?n:a,r=-s.x-s.width+t.x,o=-s.x+t.x+t.width,h=Math.abs(r)<Math.abs(o)?r:o;Math.abs(h)<Math.abs(l)?l=0:h=0;let c=e.cell.getGeometry();null!=c&&(null!=(c=c.clone()).offset?(c.offset.x+=h,c.offset.y+=l):c.offset=new Point(h,l),i.setGeometry(e.cell,c))}}}class MxFastOrganicLayout extends GraphLayout{constructor(e){super(e),this.useInputOrigin=!0,this.resetEdges=!0,this.disableEdgeStyle=!0,this.forceConstant=50,this.forceConstantSquared=0,this.minDistanceLimit=2,this.maxDistanceLimit=500,this.minDistanceLimitSquared=4,this.initialTemp=200,this.temperature=0,this.maxIterations=0,this.iteration=0,this.vertexArray=[],this.dispX=[],this.dispY=[],this.cellLocation=[],this.radius=[],this.radiusSquared=[],this.isMoveable=[],this.neighbours={},this.indices={},this.allowedToRun=!0}isVertexIgnored(e){return super.isVertexIgnored(e)||0===this.graph.getConnections(e).length}execute(e){this.vertexArray=[];let t=this.graph.getChildVertices(e);for(let e=0;e<t.length;e+=1)this.isVertexIgnored(t[e])||this.vertexArray.push(t[e]);let i=this.useInputOrigin?this.graph.getBoundingBoxFromGeometry(this.vertexArray):null,s=this.vertexArray.length;this.indices={},this.dispX=[],this.dispY=[],this.cellLocation=[],this.isMoveable=[],this.neighbours={},this.radius=[],this.radiusSquared=[],this.forceConstant<.001&&(this.forceConstant=.001),this.forceConstantSquared=this.forceConstant*this.forceConstant;for(let e=0;e<this.vertexArray.length;e+=1){let t=this.vertexArray[e];this.cellLocation[e]=[];let i=ObjectIdentity.get(t);this.indices[i]=e;let s=this.getVertexBounds(t),{width:n}=s,{height:a}=s,{x:l}=s,{y:r}=s;this.cellLocation[e][0]=l+n/2,this.cellLocation[e][1]=r+a/2,this.radius[e]=Math.min(n,a),this.radiusSquared[e]=this.radius[e]*this.radius[e]}this.graph.batchUpdate(()=>{for(let i=0;i<s;i+=1){this.dispX[i]=0,this.dispY[i]=0,this.isMoveable[i]=this.isVertexMovable(this.vertexArray[i]);let s=this.graph.getConnections(this.vertexArray[i],e);t=this.graph.getOpposites(s,this.vertexArray[i]),this.neighbours[i]=[];for(let e=0;e<t.length;e+=1){this.resetEdges&&this.graph.resetEdge(s[e]),this.disableEdgeStyle&&this.setEdgeStyleEnabled(s[e],!1);let n=ObjectIdentity.get(t[e]),a=this.indices[n];null!=a?this.neighbours[i][e]=a:this.neighbours[i][e]=i}}for(this.temperature=this.initialTemp,0===this.maxIterations&&(this.maxIterations=20*Math.sqrt(s)),this.iteration=0;this.iteration<this.maxIterations;this.iteration+=1){if(!this.allowedToRun)return;this.calcRepulsion(),this.calcAttraction(),this.calcPositions(),this.reduceTemperature()}let n=null,a=null;for(let e=0;e<this.vertexArray.length;e+=1){let t=this.vertexArray[e];if(this.isVertexMovable(t)){let i=this.getVertexBounds(t);if(null!=i){this.cellLocation[e][0]-=i.width/2,this.cellLocation[e][1]-=i.height/2;let s=this.graph.snap(Math.round(this.cellLocation[e][0])),l=this.graph.snap(Math.round(this.cellLocation[e][1]));this.setVertexLocation(t,s,l),n=null==n?s:Math.min(n,s),a=null==a?l:Math.min(a,l)}}}let l=-(n||0)+1,r=-(a||0)+1;null!=i&&(l+=i.x,r+=i.y),this.graph.moveCells(this.vertexArray,l,r)})}calcPositions(){for(let e=0;e<this.vertexArray.length;e+=1)if(this.isMoveable[e]){let t=Math.sqrt(this.dispX[e]*this.dispX[e]+this.dispY[e]*this.dispY[e]);t<.001&&(t=.001);let i=this.dispX[e]/t*Math.min(t,this.temperature),s=this.dispY[e]/t*Math.min(t,this.temperature);this.dispX[e]=0,this.dispY[e]=0,this.cellLocation[e][0]+=i,this.cellLocation[e][1]+=s}}calcAttraction(){for(let e=0;e<this.vertexArray.length;e+=1)for(let t=0;t<this.neighbours[e].length;t+=1){let i=this.neighbours[e][t];if(e!==i&&this.isMoveable[e]&&this.isMoveable[i]){let t=this.cellLocation[e][0]-this.cellLocation[i][0],s=this.cellLocation[e][1]-this.cellLocation[i][1],n=t*t+s*s-this.radiusSquared[e]-this.radiusSquared[i];n<this.minDistanceLimitSquared&&(n=this.minDistanceLimitSquared);let a=Math.sqrt(n),l=n/this.forceConstant,r=t/a*l,o=s/a*l;this.dispX[e]-=r,this.dispY[e]-=o,this.dispX[i]+=r,this.dispY[i]+=o}}}calcRepulsion(){let e=this.vertexArray.length;for(let t=0;t<e;t+=1)for(let i=t;i<e;i+=1){if(!this.allowedToRun)return;if(i!==t&&this.isMoveable[t]&&this.isMoveable[i]){let e=this.cellLocation[t][0]-this.cellLocation[i][0],s=this.cellLocation[t][1]-this.cellLocation[i][1];0===e&&(e=.01+Math.random()),0===s&&(s=.01+Math.random());let n=Math.sqrt(e*e+s*s),a=n-this.radius[t]-this.radius[i];if(a>this.maxDistanceLimit)continue;a<this.minDistanceLimit&&(a=this.minDistanceLimit);let l=this.forceConstantSquared/a,r=e/n*l,o=s/n*l;this.dispX[t]+=r,this.dispY[t]+=o,this.dispX[i]-=r,this.dispY[i]-=o}}}reduceTemperature(){this.temperature=this.initialTemp*(1-this.iteration/this.maxIterations)}}class ParallelEdgeLayout extends GraphLayout{constructor(e){super(e),this.spacing=20,this.checkOverlap=!1}execute(e,t=null){let i=this.findParallels(e,t);this.graph.batchUpdate(()=>{for(let e in i){let t=i[e];t.length>1&&this.layout(t)}})}findParallels(e,t=null){let i=[],s=e=>{if(!this.isEdgeIgnored(e)){let t=this.getEdgeId(e);null!=t&&(null==i[t]&&(i[t]=[]),i[t].push(e))}};if(null!=t)for(let e=0;e<t.length;e+=1)s(t[e]);else{this.graph.getDataModel();let t=e.getChildCount();for(let i=0;i<t;i+=1)s(e.getChildAt(i))}return i}getEdgeId(e){let t=this.graph.getView(),i=t.getVisibleTerminal(e,!0),s=t.getVisibleTerminal(e,!1),n="";if(null!=i&&null!=s){if(i=ObjectIdentity.get(i),s=ObjectIdentity.get(s),this.checkOverlap){let t=this.graph.view.getState(e);if(null!=t&&null!=t.absolutePoints){let e=[];for(let i=0;i<t.absolutePoints.length;i+=1){let s=t.absolutePoints[i];null!=s&&e.push(s.x,s.y)}n=e.join(",")}}return(i>s?`${s}-${i}`:`${i}-${s}`)+n}return null}layout(e){let t,i,s=e[0],n=this.graph.getView();this.graph.getDataModel();let a=n.getVisibleTerminal(s,!0).getGeometry(),l=n.getVisibleTerminal(s,!1).getGeometry();if(a===l){t=a.x+a.width+this.spacing,i=a.y+a.height/2;for(let s=0;s<e.length;s+=1)this.route(e[s],t,i),t+=this.spacing}else if(null!=a&&null!=l){let s=a.x+a.width/2,n=a.y+a.height/2,r=l.x+l.width/2,o=l.y+l.height/2,h=r-s,c=o-n,d=Math.sqrt(h*h+c*c);if(d>0){t=s+h/2,i=n+c/2;let a=c*this.spacing/d,l=h*this.spacing/d;t+=a*(e.length-1)/2,i-=l*(e.length-1)/2;for(let s=0;s<e.length;s+=1)this.route(e[s],t,i),t-=a,i+=l}}}route(e,t,i){this.graph.isCellMovable(e)&&this.setEdgePoints(e,[new Point(t,i)])}}class PartitionLayout extends GraphLayout{constructor(e,t=!0,i=0,s=0){super(e),this.resizeVertices=!0,this.horizontal=null==t||t,this.spacing=i||0,this.border=s||0}isHorizontal(){return this.horizontal}moveCell(e,t,i){let s=this.graph.getDataModel(),n=e.getParent();if(null!=e&&null!=n){let i=0,a=0,l=n.getChildCount();for(i=0;i<l;i+=1){let e=n.getChildAt(i),s=this.getVertexBounds(e);if(null!=s){let e=s.x+s.width/2;if(a<t&&e>t)break;a=e}}let r=n.getIndex(e);r=Math.max(0,i-+(i>r)),s.add(n,e,r)}}execute(e){let t=this.isHorizontal(),i=this.graph.getDataModel(),s=e.getGeometry();if(null!=this.graph.container&&(null==s&&i.isLayer(e)||e===this.graph.getView().currentRoot)&&(s=new Rectangle(0,0,this.graph.container.offsetWidth-1,this.graph.container.offsetHeight-1)),null!=s){let n=[],a=e.getChildCount();for(let t=0;t<a;t+=1){let i=e.getChildAt(t);!this.isVertexIgnored(i)&&this.isVertexMovable(i)&&n.push(i)}let l=n.length;if(l>0){let a=this.border,r=this.border,o=t?s.height:s.width;o-=2*this.border;let h=this.graph.isSwimlane(e)?this.graph.getStartSize(e):new Rectangle;o-=t?h.height:h.width,a+=h.width,r+=h.height;let c=this.border+(l-1)*this.spacing,d=t?(s.width-a-c)/l:(s.height-r-c)/l;if(d>0){i.beginUpdate();try{for(let e=0;e<l;e+=1){let s=n[e],l=s.getGeometry();null!=l&&((l=l.clone()).x=a,l.y=r,t?(this.resizeVertices&&(l.width=d,l.height=o),a+=d+this.spacing):(this.resizeVertices&&(l.height=d,l.width=o),r+=d+this.spacing),i.setGeometry(s,l))}}finally{i.endUpdate()}}}}}}class RadialTreeLayout extends CompactTreeLayout{constructor(e){super(e,!1),this.centerX=null,this.centerY=null,this.angleOffset=.5,this.rootx=0,this.rooty=0,this.levelDistance=120,this.nodeDistance=10,this.autoRadius=!1,this.sortEdges=!1,this.rowMinX={},this.rowMaxX={},this.rowMinCenX={},this.rowMaxCenX={},this.rowRadi={},this.row=[]}isVertexIgnored(e){return super.isVertexIgnored(e)||0===this.graph.getConnections(e).length}execute(e,t=null){this.parent=e,this.useBoundingBox=!1,this.edgeRouting=!1,super.execute(e,t||void 0);let i=null,s=this.getVertexBounds(this.root);for(let e in this.centerX=s.x+s.width/2,this.centerY=s.y+s.height/2,this.visited){let t=this.getVertexBounds(this.visited[e]);(i=null!=i?i:t.clone()).add(t)}this.calcRowDims([this.node],0);let n=0,a=0;for(let e=0;e<this.row.length;e+=1){let t=(this.centerX-this.rowMinX[e]-this.nodeDistance)/this.rowRadi[e],i=(this.rowMaxX[e]-this.centerX-this.nodeDistance)/this.rowRadi[e];n=Math.max(n,t),a=Math.max(a,i)}for(let e=0;e<this.row.length;e+=1){let t=this.centerX-this.nodeDistance-n*this.rowRadi[e],i=this.centerX+this.nodeDistance+a*this.rowRadi[e]-t;for(let s=0;s<this.row[e].length;s++){let n=this.row[e][s],a=this.getVertexBounds(n.cell);n.theta=2*Math.PI*((a.x+a.width/2-t)/i)}}for(let e=this.row.length-2;e>=0;e--){let t=this.row[e];for(let e=0;e<t.length;e++){let i=t[e],{child:s}=i,n=0,a=0;for(;null!=s;)a+=s.theta,n++,s=s.next;if(n>0){let s=a/n;s>i.theta&&e<t.length-1?i.theta=Math.min(s,t[e+1].theta-Math.PI/10):s<i.theta&&e>0&&(i.theta=Math.max(s,t[e-1].theta+Math.PI/10))}}}for(let e=0;e<this.row.length;e+=1)for(let t=0;t<this.row[e].length;t++){let i=this.row[e][t],s=this.getVertexBounds(i.cell);this.setVertexLocation(i.cell,this.centerX-s.width/2+this.rowRadi[e]*Math.cos(i.theta),this.centerY-s.height/2+this.rowRadi[e]*Math.sin(i.theta))}}calcRowDims(e,t){if(null==e||0===e.length)return;this.rowMinX[t]=this.centerX,this.rowMaxX[t]=this.centerX,this.rowMinCenX[t]=this.centerX,this.rowMaxCenX[t]=this.centerX,this.row[t]=[];let i=!1;for(let s=0;s<e.length;s+=1){let n=null!=e[s]?e[s].child:null;for(;null!=n;){let{cell:e}=n,s=this.getVertexBounds(e);this.rowMinX[t]=Math.min(s.x,this.rowMinX[t]),this.rowMaxX[t]=Math.max(s.x+s.width,this.rowMaxX[t]),this.rowMinCenX[t]=Math.min(s.x+s.width/2,this.rowMinCenX[t]),this.rowMaxCenX[t]=Math.max(s.x+s.width/2,this.rowMaxCenX[t]),this.rowRadi[t]=s.y-this.getVertexBounds(this.root).y,null!=n.child&&(i=!0),this.row[t].push(n),n=n.next}}i&&this.calcRowDims(this.row[t],t+1)}}let HierarchicalEdgeStyle={ORTHOGONAL:1,POLYLINE:2,STRAIGHT:3,CURVE:4};class GraphAbstractHierarchyCell extends Cell{constructor(){super(),this.swimlaneIndex=null,this.maxRank=-1,this.minRank=-1,this.width=0,this.height=0,this.nextLayerConnectedCells=null,this.previousLayerConnectedCells=null,this.x=[],this.y=[],this.temp=[]}isEdge(){return!1}isVertex(){return!1}setX(e,t){this.isVertex()?this.x[0]=t:this.isEdge()&&(this.x[e-this.minRank-1]=t)}getX(e){return this.isVertex()?this.x[0]:this.isEdge()?this.x[e-this.minRank-1]:0}setY(e,t){this.isVertex()?this.y[0]=t:this.isEdge()&&(this.y[e-this.minRank-1]=t)}}class GraphHierarchyNode extends GraphAbstractHierarchyCell{constructor(e){super(),this.ids=[],this.hashCode=!1,this.cell=e,this.id=ObjectIdentity.get(e),this.connectsAsTarget=[],this.connectsAsSource=[]}getRankValue(e){return this.maxRank}getNextLayerConnectedCells(e){if(null==this.nextLayerConnectedCells){this.nextLayerConnectedCells={},this.nextLayerConnectedCells[0]=[];for(let t=0;t<this.connectsAsTarget.length;t+=1){let i=this.connectsAsTarget[t];-1===i.maxRank||i.maxRank===e+1?this.nextLayerConnectedCells[0].push(i.source):this.nextLayerConnectedCells[0].push(i)}}return this.nextLayerConnectedCells[0]}getPreviousLayerConnectedCells(e){if(null==this.previousLayerConnectedCells){this.previousLayerConnectedCells=[],this.previousLayerConnectedCells[0]=[];for(let t=0;t<this.connectsAsSource.length;t+=1){let i=this.connectsAsSource[t];-1===i.minRank||i.minRank===e-1?this.previousLayerConnectedCells[0].push(i.target):this.previousLayerConnectedCells[0].push(i)}}return this.previousLayerConnectedCells[0]}isVertex(){return!0}getGeneralPurposeVariable(e){return this.temp[0]}setGeneralPurposeVariable(e,t){this.temp[0]=t}isAncestor(e){if(null!=e&&null!=this.hashCode&&null!=e.hashCode&&this.hashCode.length<e.hashCode.length){if(this.hashCode===e.hashCode)return!0;if(null==this.hashCode||null==this.hashCode)return!1;for(let t=0;t<this.hashCode.length;t+=1)if(this.hashCode[t]!==e.hashCode[t])return!1;return!0}return!1}getCoreCell(){return this.cell}}class GraphHierarchyEdge extends GraphAbstractHierarchyCell{constructor(e){super(),this.source=null,this.target=null,this.isReversed=!1,this.edges=e,this.ids=[];for(let t=0;t<e.length;t+=1)this.ids.push(ObjectIdentity.get(e[t]))}invert(){let e=this.source;this.source=this.target,this.target=e,this.isReversed=!this.isReversed}getNextLayerConnectedCells(e){if(null==this.nextLayerConnectedCells){this.nextLayerConnectedCells=[];for(let e=0;e<this.temp.length;e+=1)this.nextLayerConnectedCells[e]=[],e===this.temp.length-1?this.nextLayerConnectedCells[e].push(this.source):this.nextLayerConnectedCells[e].push(this)}return this.nextLayerConnectedCells[e-this.minRank-1]}getPreviousLayerConnectedCells(e){if(null==this.previousLayerConnectedCells){this.previousLayerConnectedCells=[];for(let e=0;e<this.temp.length;e+=1)this.previousLayerConnectedCells[e]=[],0===e?this.previousLayerConnectedCells[e].push(this.target):this.previousLayerConnectedCells[e].push(this)}return this.previousLayerConnectedCells[e-this.minRank-1]}isEdge(){return!0}getGeneralPurposeVariable(e){return this.temp[e-this.minRank-1]}setGeneralPurposeVariable(e,t){this.temp[e-this.minRank-1]=t}getCoreCell(){return this.edges.length>0?this.edges[0]:null}}class GraphHierarchyModel{constructor(e,t,i,s,n){this.ranks=null,this.roots=null,this.parent=null,this.dfsCount=0,this.SOURCESCANSTARTRANK=1e8,this.tightenToSource=!1;let a=e.getGraph();this.tightenToSource=n,this.roots=i,this.parent=s,this.vertexMapper=new Dictionary,this.edgeMapper=new Dictionary,this.maxRank=0;let l={};null==t&&(t=a.getChildVertices(s)),this.maxRank=this.SOURCESCANSTARTRANK,this.createInternalCells(e,t,l);for(let i=0;i<t.length;i+=1){let t=l[i].connectsAsSource;for(let s=0;s<t.length;s++){let n=t[s],a=n.edges;if(null!=a&&a.length>0){let t=a[0],s=e.getVisibleTerminal(t,!1),r=this.vertexMapper.get(s);l[i]===r&&(s=e.getVisibleTerminal(t,!0),r=this.vertexMapper.get(s)),null!=r&&l[i]!==r&&(n.target=r,0===r.connectsAsTarget.length&&(r.connectsAsTarget=[]),0>r.connectsAsTarget.indexOf(n)&&r.connectsAsTarget.push(n))}}l[i].temp[0]=1}}createInternalCells(e,t,i){let s=e.getGraph();for(let n=0;n<t.length;n+=1){i[n]=new GraphHierarchyNode(t[n]),this.vertexMapper.put(t[n],i[n]);let a=e.getEdges(t[n]);i[n].connectsAsSource=[];for(let l=0;l<a.length;l++){let r=e.getVisibleTerminal(a[l],!1);if(r!==t[n]&&r.isVertex()&&!e.isVertexIgnored(r)){let a=e.getEdgesBetween(t[n],r,!1),l=e.getEdgesBetween(t[n],r,!0);if(null!=a&&a.length>0&&null==this.edgeMapper.get(a[0])&&2*l.length>=a.length){let t=new GraphHierarchyEdge(a);for(let i=0;i<a.length;i++){let n=a[i];this.edgeMapper.put(n,t),s.resetEdge(n),e.disableEdgeStyle&&(e.setEdgeStyleEnabled(n,!1),e.setOrthogonalEdge(n,!0))}t.source=i[n],0>i[n].connectsAsSource.indexOf(t)&&i[n].connectsAsSource.push(t)}}}i[n].temp[0]=0}}initialRank(){let e=[];if(null!=this.roots)for(let t=0;t<this.roots.length;t+=1){let i=this.vertexMapper.get(this.roots[t]);null!=i&&e.push(i)}let t=this.vertexMapper.getValues();for(let e=0;e<t.length;e+=1)t[e].temp[0]=-1;let i=e.slice();for(;e.length>0;){let t=e[0],i=t.connectsAsTarget,s=t.connectsAsSource,n=!0,a=this.SOURCESCANSTARTRANK;for(let e=0;e<i.length;e+=1){let t=i[e];if(5270620===t.temp[0])a=Math.min(a,t.source.temp[0]-1);else{n=!1;break}}if(n){if(t.temp[0]=a,this.maxRank=Math.min(this.maxRank,a),null!=s)for(let t=0;t<s.length;t+=1){let i=s[t];i.temp[0]=5270620;let n=i.target;-1===n.temp[0]&&(e.push(n),n.temp[0]=-2)}e.shift()}else{let i=e.shift();if(e.push(t),i===t&&1===e.length)break}}for(let e=0;e<t.length;e+=1)t[e].temp[0]-=this.maxRank;for(let e=0;e<i.length;e+=1){let t=i[e],s=0,n=t.connectsAsSource;for(let e=0;e<n.length;e++){let i=n[e].target;t.temp[0]=Math.max(s,i.temp[0]+1),s=t.temp[0]}}this.maxRank=this.SOURCESCANSTARTRANK-this.maxRank}fixRanks(){let e={};this.ranks=[];for(let t=0;t<this.maxRank+1;t+=1)e[t]=[],this.ranks.push(e[t]);let t=null;if(null!=this.roots){let e=this.roots;t=[];for(let i=0;i<e.length;i+=1){let s=e[i],n=this.vertexMapper.get(s);t[i]=n}}this.visit((t,i,s,n,a)=>{if(0==a&&i.maxRank<0&&i.minRank<0&&(e[i.temp[0]].push(i),i.maxRank=i.temp[0],i.minRank=i.temp[0],i.temp[0]=e[i.maxRank].length-1),null!=t&&null!=s&&t.maxRank-i.maxRank>1){s.maxRank=t.maxRank,s.minRank=i.maxRank,s.temp=[],s.x=[],s.y=[];for(let t=s.minRank+1;t<s.maxRank;t+=1)e[t].push(s),s.setGeneralPurposeVariable(t,e[t].length-1)}},t,!1,null)}visit(e,t,i,s=null){if(null!=t){for(let n=0;n<t.length;n+=1){let a=t[n];null!=a&&(null==s&&(s={}),i?(a.hashCode=[],a.hashCode[0]=this.dfsCount,a.hashCode[1]=n,this.extendedDfs(null,a,null,e,s,a.hashCode,n,0)):this.dfs(null,a,null,e,s,0))}this.dfsCount++}}dfs(e,t,i,s,n,a){if(null!=t){let l=t.id;if(null==n[l]){n[l]=t,s(e,t,i,a,0);let r=t.connectsAsSource.slice();for(let e=0;e<r.length;e+=1){let i=r[e],l=i.target;this.dfs(t,l,i,s,n,a+1)}}else s(e,t,i,a,1)}}extendedDfs(e,t,i,s,n,a,l,r){if(null!=t){if(null!=e&&(null==t.hashCode||t.hashCode[0]!=e.hashCode[0])){let i=e.hashCode.length+1;t.hashCode=e.hashCode.slice(),t.hashCode[i-1]=l}let a=t.id;if(null==n[a]){n[a]=t,s(e,t,i,r,0);let l=t.connectsAsSource.slice();for(let e=0;e<l.length;e+=1){let i=l[e],a=i.target;this.extendedDfs(t,a,i,s,n,t.hashCode,e,r+1)}}else s(e,t,i,r,1)}}}class HierarchicalLayoutStage{}class MinimumCycleRemover extends HierarchicalLayoutStage{constructor(e){super(),this.layout=e}execute(e){let t=this.layout.getDataModel(),i={},s=t.vertexMapper.getValues(),n={};for(let e=0;e<s.length;e+=1)n[s[e].id]=s[e];let a=null;if(null!=t.roots){let e=t.roots;a=[];for(let i=0;i<e.length;i+=1)a[i]=t.vertexMapper.get(e[i])}t.visit((e,t,s,a,l)=>{t.isAncestor(e)&&(s.invert(),remove(s,e.connectsAsSource),e.connectsAsTarget.push(s),remove(s,t.connectsAsTarget),t.connectsAsSource.push(s)),i[t.id]=t,delete n[t.id]},a,!0,null);let l=clone(i,null,!0);t.visit((e,t,s,a,l)=>{t.isAncestor(e)&&(s.invert(),remove(s,e.connectsAsSource),t.connectsAsSource.push(s),e.connectsAsTarget.push(s),remove(s,t.connectsAsTarget)),i[t.id]=t,delete n[t.id]},Object.values(n),!0,l)}}class MedianCellSorter{constructor(){this.medianValue=0,this.cell=!1}compare(e,t){if(null!=e&&null!=t){if(t.medianValue>e.medianValue)return -1;if(t.medianValue<e.medianValue)return 1}return 0}}class MedianHybridCrossingReduction extends HierarchicalLayoutStage{constructor(e){super(),this.maxIterations=24,this.nestedBestRanks=null,this.currentBestCrossings=0,this.iterationsWithoutImprovement=0,this.maxNoImprovementIterations=2,this.layout=e}execute(e){let t=this.layout.getDataModel(),i=t.ranks;this.nestedBestRanks=[];for(let e=0;e<i.length;e+=1)this.nestedBestRanks[e]=i[e].slice();let s=0,n=this.calculateCrossings(t);for(let e=0;e<this.maxIterations&&s<this.maxNoImprovementIterations;e++){this.weightedMedian(e,t),this.transpose(e,t);let a=this.calculateCrossings(t);if(a<n){n=a,s=0;for(let e=0;e<this.nestedBestRanks.length;e+=1){let t=i[e];for(let i=0;i<t.length;i+=1){let s=t[i];this.nestedBestRanks[e][s.getGeneralPurposeVariable(e)]=s}}}else{s+=1;for(let e=0;e<this.nestedBestRanks.length;e+=1){let t=i[e];for(let i=0;i<t.length;i+=1)t[i].setGeneralPurposeVariable(e,i)}}if(0===n)break}i=[];let a=[];for(let e=0;e<t.maxRank+1;e+=1)a[e]=[],i[e]=a[e];for(let e=0;e<this.nestedBestRanks.length;e+=1)for(let t=0;t<this.nestedBestRanks[e].length;t+=1)a[e].push(this.nestedBestRanks[e][t]);t.ranks=i}calculateCrossings(e){let t=e.ranks.length,i=0;for(let s=1;s<t;s+=1)i+=this.calculateRankCrossing(s,e);return i}calculateRankCrossing(e,t){let i=0,s=t.ranks,n=s[e],a=s[e-1],l=[];for(let t=0;t<n.length;t+=1){let i=n[t],s=i.getGeneralPurposeVariable(e),a=i.getPreviousLayerConnectedCells(e),r=[];for(let t=0;t<a.length;t+=1){let i=a[t].getGeneralPurposeVariable(e-1);r.push(i)}r.sort((e,t)=>e-t),l[s]=r}let r=[];for(let e=0;e<l.length;e++)r=r.concat(l[e]);let o=1;for(;o<a.length;)o<<=1;let h=2*o-1;o-=1;let c=[];for(let e=0;e<h;++e)c[e]=0;for(let e=0;e<r.length;e+=1){let t=r[e]+o;for(++c[t];t>0;)t%2&&(i+=c[t+1]),t=t-1>>1,++c[t]}return i}transpose(e,t){let i=!0,s=0,n=10;for(;i&&s++<n;){let n=e%2==1&&s%2==1;i=!1;let a=t.ranks;for(let e=0;e<a.length;e+=1){let t=a[e],s=[];for(let i=0;i<t.length;i++){let n=t[i],a=n.getGeneralPurposeVariable(e);a<0&&(a=i),s[a]=n}let l=null,r=null,o=null,h=null,c=null,d=null,u=null,p=null,g=null,m=null;for(let a=0;a<t.length-1;a++){if(0===a){l=(g=s[a]).getNextLayerConnectedCells(e),r=g.getPreviousLayerConnectedCells(e),c=[],d=[];for(let t=0;t<l.length;t++)c[t]=l[t].getGeneralPurposeVariable(e+1);for(let t=0;t<r.length;t++)d[t]=r[t].getGeneralPurposeVariable(e-1)}else l=o,r=h,c=u,d=p,g=m;o=(m=s[a+1]).getNextLayerConnectedCells(e),h=m.getPreviousLayerConnectedCells(e),u=[],p=[];for(let t=0;t<o.length;t++)u[t]=o[t].getGeneralPurposeVariable(e+1);for(let t=0;t<h.length;t++)p[t]=h[t].getGeneralPurposeVariable(e-1);let t=0,f=0;for(let e=0;e<c.length;e+=1)for(let i=0;i<u.length;i+=1)c[e]>u[i]&&(t+=1),c[e]<u[i]&&(f+=1);for(let e=0;e<d.length;e+=1)for(let i=0;i<p.length;i+=1)d[e]>p[i]&&(t+=1),d[e]<p[i]&&(f+=1);if(f<t||f===t&&n){let t=g.getGeneralPurposeVariable(e);g.setGeneralPurposeVariable(e,m.getGeneralPurposeVariable(e)),m.setGeneralPurposeVariable(e,t),o=l,h=r,u=c,p=d,m=g,n||(i=!0)}}}}}weightedMedian(e,t){let i=e%2==0;if(i)for(let e=t.maxRank-1;e>=0;e-=1)this.medianRank(e,i);else for(let e=1;e<t.maxRank;e+=1)this.medianRank(e,i)}medianRank(e,t){let i=this.nestedBestRanks,s=i[e].length,n=[],a={};for(let l=0;l<s;l+=1){let s=i[e][l],r=new MedianCellSorter;r.cell=s;let o=t?s.getNextLayerConnectedCells(e):s.getPreviousLayerConnectedCells(e),h=t?e+1:e-1;null!=o&&0!==o.length?(r.medianValue=this.medianValue(o,h),n.push(r)):a[s.getGeneralPurposeVariable(e)]=!0}n.sort(new MedianCellSorter().compare);for(let t=0;t<s;t+=1)null==a[t]&&n.shift().cell.setGeneralPurposeVariable(e,t)}medianValue(e,t){let i=[],s=0;for(let n=0;n<e.length;n+=1){let a=e[n];i[s++]=a.getGeneralPurposeVariable(t)}if(i.sort((e,t)=>e-t),s%2==1)return i[Math.floor(s/2)];if(2===s)return(i[0]+i[1])/2;let n=s/2,a=i[n-1]-i[0],l=i[s-1]-i[n];return(i[n-1]*l+i[n]*a)/(a+l)}}class CoordinateAssignment extends HierarchicalLayoutStage{constructor(e,t=30,i=100,s,n,a=10){super(),this.intraCellSpacing=30,this.interRankCellSpacing=100,this.parallelEdgeSpacing=10,this.maxIterations=8,this.prefHozEdgeSep=5,this.prefVertEdgeOff=2,this.minEdgeJetty=12,this.channelBuffer=4,this.jettyPositions=null,this.orientation=DIRECTION.NORTH,this.limitX=null,this.currentXDelta=null,this.widestRank=null,this.rankTopY=null,this.rankBottomY=null,this.widestRankValue=null,this.rankWidths=null,this.rankY=null,this.fineTuning=!0,this.nextLayerConnectedCache=null,this.previousLayerConnectedCache=null,this.groupPadding=10,this.layout=e,this.intraCellSpacing=t,this.interRankCellSpacing=i,this.orientation=s,this.initialX=n,this.parallelEdgeSpacing=a}printStatus(){let e=this.layout.getDataModel().ranks,t=GlobalConfig.logger;t.show(),t.info("======Coord assignment debug=======");for(let i=0;i<e.length;i++){let s=e[i].map(e=>String(e.getGeneralPurposeVariable(i))).join("  ");t.info(`Rank ${i} : ${s}`)}t.info("====================================")}execute(e){this.jettyPositions={};let t=this.layout.getDataModel();this.currentXDelta=0,this.initialCoords(this.layout.getGraph(),t),this.fineTuning&&this.minNode(t);let i=1e8;if(this.fineTuning)for(let e=0;e<this.maxIterations;e+=1){0!==e&&(this.medianPos(e,t),this.minNode(t));let s=t.ranks;if(this.currentXDelta<i){for(let e=0;e<s.length;e++){let t=s[e];for(let i=0;i<t.length;i++){let s=t[i];s.setX(e,s.getGeneralPurposeVariable(e))}}i=this.currentXDelta}else for(let e=0;e<s.length;e++){let t=s[e];for(let i=0;i<t.length;i++){let s=t[i];s.setGeneralPurposeVariable(e,s.getX(e))}}this.minPath(this.layout.getGraph(),t),this.currentXDelta=0}this.setCellLocations(this.layout.getGraph(),t)}minNode(e){let t=[],i=new Dictionary,s=[];for(let n=0;n<=e.maxRank;n+=1){s[n]=e.ranks[n];for(let e=0;e<s[n].length;e+=1){let a=s[n][e],l=new WeightedCellSorter(a,n);l.rankIndex=e,l.visited=!0,t.push(l),i.put(a,l)}}let n=10*t.length,a=0,l=1;for(;t.length>0&&a<=n;){let e=t.shift(),n=e.cell,r=e.weightedValue,o=parseInt(String(e.rankIndex)),h=n.getNextLayerConnectedCells(r),c=n.getPreviousLayerConnectedCells(r),d=h.length,u=c.length,p=this.medianXValue(h,r+1),g=this.medianXValue(c,r-1),m=d+u,f=n.getGeneralPurposeVariable(r),x=f;m>0&&(x=(p*d+g*u)/m);let v=!1;if(x<f-l)if(0===o)n.setGeneralPurposeVariable(r,x),v=!0;else{let e=s[r][o-1],t=e.getGeneralPurposeVariable(r);(t=t+e.width/2+this.intraCellSpacing+n.width/2)<x?(n.setGeneralPurposeVariable(r,x),v=!0):t<n.getGeneralPurposeVariable(r)-l&&(n.setGeneralPurposeVariable(r,t),v=!0)}else if(x>f+l)if(o===s[r].length-1)n.setGeneralPurposeVariable(r,x),v=!0;else{let e=s[r][o+1],t=e.getGeneralPurposeVariable(r);(t=t-e.width/2-this.intraCellSpacing-n.width/2)>x?(n.setGeneralPurposeVariable(r,x),v=!0):t>n.getGeneralPurposeVariable(r)+l&&(n.setGeneralPurposeVariable(r,t),v=!0)}if(v){for(let e=0;e<h.length;e+=1){let s=h[e],n=i.get(s);null!=n&&!1==n.visited&&(n.visited=!0,t.push(n))}for(let e=0;e<c.length;e+=1){let s=c[e],n=i.get(s);null!=n&&!1==n.visited&&(n.visited=!0,t.push(n))}}e.visited=!1,a+=1}}medianPos(e,t){if(e%2==0)for(let e=t.maxRank;e>0;e--)this.rankMedianPosition(e-1,t,e);else for(let e=0;e<t.maxRank-1;e++)this.rankMedianPosition(e+1,t,e)}rankMedianPosition(e,t,i){let s=t.ranks[e],n=[],a={};for(let t=0;t<s.length;t+=1){let l=s[t];n[t]=new WeightedCellSorter(l),n[t].rankIndex=t,a[l.id]=n[t];let r=null;r=i<e?l.getPreviousLayerConnectedCells(e):l.getNextLayerConnectedCells(e),n[t].weightedValue=this.calculatedWeightedValue(l,r)}n.sort(WeightedCellSorter.compare);for(let t=0;t<n.length;t+=1){let l=0,r=n[t].cell,o=null,h=0;null!=(o=i<e?r.getPreviousLayerConnectedCells(e).slice():r.getNextLayerConnectedCells(e).slice())&&(h=(l=o.length)>0?this.medianXValue(o,i):r.getGeneralPurposeVariable(e));let c=0,d=-1e8;for(let i=n[t].rankIndex-1;i>=0;){let t=a[s[i].id];if(null!=t){let s=t.cell;t.visited?(d=s.getGeneralPurposeVariable(e)+s.width/2+this.intraCellSpacing+c+r.width/2,i=-1):(c+=s.width+this.intraCellSpacing,i--)}}let u=0,p=1e8;for(let i=n[t].rankIndex+1;i<n.length;){let t=a[s[i].id];if(null!=t){let s=t.cell;t.visited?(p=s.getGeneralPurposeVariable(e)-s.width/2-this.intraCellSpacing-u-r.width/2,i=n.length):(u+=s.width+this.intraCellSpacing,i++)}}h>=d&&h<=p?r.setGeneralPurposeVariable(e,h):h<d?(r.setGeneralPurposeVariable(e,d),this.currentXDelta=this.currentXDelta+d-h):h>p&&(r.setGeneralPurposeVariable(e,p),this.currentXDelta=this.currentXDelta+h-p),n[t].visited=!0}}calculatedWeightedValue(e,t){let i=0;for(let s=0;s<t.length;s+=1){let n=t[s];e.isVertex()&&n.isVertex()?i+=1:e.isEdge()&&n.isEdge()?i+=8:i+=2}return i}medianXValue(e,t){if(0===e.length)return 0;let i=[];for(let s=0;s<e.length;s+=1)i[s]=e[s].getGeneralPurposeVariable(t);if(i.sort((e,t)=>e-t),e.length%2==1)return i[Math.floor(e.length/2)];let s=e.length/2;return(i[s-1]+i[s])/2}initialCoords(e,t){this.calculateWidestRank(e,t);for(let i=this.widestRank;i>=0;i--)i<t.maxRank&&this.rankCoordinates(i,e,t);for(let i=this.widestRank+1;i<=t.maxRank;i+=1)i>0&&this.rankCoordinates(i,e,t)}rankCoordinates(e,t,i){let s=i.ranks[e],n=0,a=this.initialX+(this.widestRankValue-this.rankWidths[e])/2,l=!1;for(let t=0;t<s.length;t+=1){let i=s[t];if(i.isVertex()){let e=this.layout.getVertexBounds(i.cell);null!=e?this.orientation===DIRECTION.NORTH||this.orientation===DIRECTION.SOUTH?(i.width=e.width,i.height=e.height):(i.width=e.height,i.height=e.width):l=!0,n=Math.max(n,i.height)}else if(i.isEdge()){let e=1;null!=i.edges?e=i.edges.length:GlobalConfig.logger.warn("edge.edges is null"),i.width=(e-1)*this.parallelEdgeSpacing}a+=i.width/2,i.setX(e,a),i.setGeneralPurposeVariable(e,a),a+=i.width/2,a+=this.intraCellSpacing}l&&GlobalConfig.logger.warn("At least one cell has no bounds")}calculateWidestRank(e,t){let i=-this.interRankCellSpacing,s=0;this.rankWidths=[],this.rankY=[];for(let e=t.maxRank;e>=0;e-=1){let n=0,a=t.ranks[e],l=this.initialX,r=!1;for(let t=0;t<a.length;t+=1){let i=a[t];if(i.isVertex()){let e=this.layout.getVertexBounds(i.cell);null!=e?this.orientation===DIRECTION.NORTH||this.orientation===DIRECTION.SOUTH?(i.width=e.width,i.height=e.height):(i.width=e.height,i.height=e.width):r=!0,n=Math.max(n,i.height)}else if(i.isEdge()){let e=1;null!=i.edges?e=i.edges.length:GlobalConfig.logger.warn("edge.edges is null"),i.width=(e-1)*this.parallelEdgeSpacing}l+=i.width/2,i.setX(e,l),i.setGeneralPurposeVariable(e,l),l+=i.width/2,(l+=this.intraCellSpacing)>this.widestRankValue&&(this.widestRankValue=l,this.widestRank=e),this.rankWidths[e]=l}r&&GlobalConfig.logger.warn("At least one cell has no bounds"),this.rankY[e]=i;let o=n/2+s/2+this.interRankCellSpacing;s=n,this.orientation===DIRECTION.NORTH||this.orientation===DIRECTION.WEST?i+=o:i-=o;for(let t=0;t<a.length;t+=1)a[t].setY(e,i)}}minPath(e,t){let i=t.edgeMapper.getValues();for(let e=0;e<i.length;e++){let s=i[e];if(s.maxRank-s.minRank-1<1)continue;let n=s.getGeneralPurposeVariable(s.minRank+1),a=!0,l=0;for(let e=s.minRank+2;e<s.maxRank;e+=1){let t=s.getGeneralPurposeVariable(e);n!==t?(a=!1,n=t):l+=1}if(!a){let e=0,i=0,n=[],a=[],r=0,o=s.getGeneralPurposeVariable(s.minRank+1);for(r=s.minRank+1;r<s.maxRank-1;r+=1){let i=s.getX(r+1);o===i||this.repositionValid(t,s,r+1,o)?(n[r-s.minRank-1]=o,e+=1):(n[r-s.minRank-1]=i,o=i)}o=s.getX(r);for(let e=s.maxRank-1;e>s.minRank+1;e--){let n=s.getX(e-1);o===n||this.repositionValid(t,s,e-1,o)?(a[e-s.minRank-2]=o,i+=1):(a[e-s.minRank-2]=s.getX(e-1),o=n)}if(i>l||e>l){if(i>=e)for(let e=s.maxRank-2;e>s.minRank;e--)s.setX(e,a[e-s.minRank-1]);else if(e>i)for(let e=s.minRank+2;e<s.maxRank;e+=1)s.setX(e,n[e-s.minRank-2])}}}}repositionValid(e,t,i,s){let n=e.ranks[i],a=-1;for(let e=0;e<n.length;e+=1)if(t===n[e]){a=e;break}if(a<0)return!1;let l=t.getGeneralPurposeVariable(i);if(s<l){if(0===a)return!0;let e=n[a-1],l=e.getGeneralPurposeVariable(i);return(l=l+e.width/2+this.intraCellSpacing+t.width/2)<=s}if(s>l){if(a===n.length-1)return!0;let e=n[a+1],l=e.getGeneralPurposeVariable(i);return(l=l-e.width/2-this.intraCellSpacing-t.width/2)>=s}return!0}setCellLocations(e,t){this.rankTopY=[],this.rankBottomY=[];let i=t.ranks;for(let e=0;e<i.length;e+=1)this.rankTopY[e]=Number.MAX_VALUE,this.rankBottomY[e]=-Number.MAX_VALUE;let s=t.vertexMapper.getValues();for(let e=0;e<s.length;e+=1)this.setVertexLocation(s[e]);(this.layout.edgeStyle===HierarchicalEdgeStyle.ORTHOGONAL||this.layout.edgeStyle===HierarchicalEdgeStyle.POLYLINE||this.layout.edgeStyle===HierarchicalEdgeStyle.CURVE)&&this.localEdgeProcessing(t);let n=t.edgeMapper.getValues();for(let e=0;e<n.length;e+=1)this.setEdgePosition(n[e])}localEdgeProcessing(e){let t=e.ranks;for(let e=0;e<t.length;e+=1){let i=t[e];for(let s=0;s<i.length;s+=1){let n=i[s];if(n.isVertex()){let i=n.getPreviousLayerConnectedCells(e),s=e-1;for(let a=0;a<2;a+=1){if(s>-1&&s<t.length&&null!=i&&i.length>0){let e=[];for(let t=0;t<i.length;t++){let n=new WeightedCellSorter(i[t],i[t].getX(s));e.push(n)}e.sort(WeightedCellSorter.compare);let t=n.x[0]-n.width/2,l=t+n.width,r=0,o=[];for(let t=0;t<e.length;t++){let i,s=e[t].cell;if(s.isVertex()){i=0===a?n.connectsAsSource:n.connectsAsTarget;for(let e=0;e<i.length;e+=1)(i[e].source===s||i[e].target===s)&&(r+=i[e].edges.length,o.push(i[e]))}else r+=s.edges.length,o.push(s)}let h=(r+1)*this.prefHozEdgeSep;n.width>h+2*this.prefHozEdgeSep&&(t+=this.prefHozEdgeSep,l-=this.prefHozEdgeSep);let c=(l-t)/r,d=t+c/2,u=this.minEdgeJetty-this.prefVertEdgeOff;for(let e=0;e<o.length;e++){let t=o[e].edges.length,i=this.jettyPositions,s=i[o[e].ids[0]];null==s&&(s=[],i[o[e].ids[0]]=s),e<r/2?u+=this.prefVertEdgeOff:e>r/2&&(u-=this.prefVertEdgeOff);for(let e=0;e<t;e+=1)s[4*e+2*a]=d,d+=c,s[4*e+2*a+1]=u}}i=n.getNextLayerConnectedCells(e),s=e+1}}}}}setEdgePosition(e){let t=0;if(101207!==e.temp[0]){let{maxRank:i}=e,{minRank:s}=e;i===s&&(i=e.source.maxRank,s=e.target.minRank);let n=0,a=this.jettyPositions[e.ids[0]],l=e.isReversed?e.target.cell:e.source.cell,{graph:r}=this.layout,o=this.orientation===DIRECTION.EAST||this.orientation===DIRECTION.SOUTH;for(let h=0;h<e.edges.length;h+=1){let c=e.edges[h],d=this.layout.getVisibleTerminal(c,!0),u=[],p=e.isReversed;if(d!==l&&(p=!p),null!=a){let t=2*!!p,l=this.rankBottomY,h=this.rankTopY,g=p?o?l[s]:h[s]:o?h[i]:l[i],m=a[4*n+1+t];p!==o&&(m=-m),g+=m;let f=a[4*n+t],x=c.getTerminal(!0);if(this.layout.isPort(x)&&x.getParent()===d){let t=r.view.getState(x);f=null!=t?t.x:d.geometry.x+e.source.width*x.geometry.x}this.orientation===DIRECTION.NORTH||this.orientation===DIRECTION.SOUTH?(u.push(new Point(f,g)),this.layout.edgeStyle===HierarchicalEdgeStyle.CURVE&&u.push(new Point(f,g+m))):(u.push(new Point(g,f)),this.layout.edgeStyle===HierarchicalEdgeStyle.CURVE&&u.push(new Point(g+m,f)))}let g=e.x.length-1,m=-1,f=-1,x=e.maxRank-1;p&&(g=0,m=e.x.length,f=1,x=e.minRank+1);for(let i=g;e.maxRank!==e.minRank&&i!==m;i+=f){let s=e.x[i]+t,n=this.rankTopY,a=this.rankBottomY,l=(n[x]+a[x+1])/2,r=(n[x-1]+a[x])/2;if(p){let e=l;l=r,r=e}this.orientation===DIRECTION.NORTH||this.orientation===DIRECTION.SOUTH?(u.push(new Point(s,l)),u.push(new Point(s,r))):(u.push(new Point(l,s)),u.push(new Point(r,s))),this.limitX=Math.max(this.limitX,s),x+=f}if(null!=a){let t=2*!!p,l=this.rankTopY,h=this.rankBottomY,d=p?o?l[i]:h[i]:o?h[s]:l[s],g=a[4*n+3-t];p!==o&&(g=-g);let m=d-g,f=a[4*n+2-t],x=c.getTerminal(!1),v=this.layout.getVisibleTerminal(c,!1);if(this.layout.isPort(x)&&x.getParent()===v){let t=r.view.getState(x);f=null!=t?t.x:v.geometry.x+e.target.width*x.geometry.x}this.orientation===DIRECTION.NORTH||this.orientation===DIRECTION.SOUTH?(this.layout.edgeStyle===HierarchicalEdgeStyle.CURVE&&u.push(new Point(f,m-g)),u.push(new Point(f,m))):(this.layout.edgeStyle===HierarchicalEdgeStyle.CURVE&&u.push(new Point(m-g,f)),u.push(new Point(m,f)))}e.isReversed&&this.processReversedEdge(e,c),this.layout.setEdgePoints(c,u),t=0===t?this.parallelEdgeSpacing:t>0?-t:-t+this.parallelEdgeSpacing,n++}e.temp[0]=101207}}setVertexLocation(e){let t=e.cell,i=e.x[0]-e.width/2,s=e.y[0]-e.height/2,n=this.rankTopY,a=this.rankBottomY;n[e.minRank]=Math.min(n[e.minRank],s),a[e.minRank]=Math.max(a[e.minRank],s+e.height),this.orientation===DIRECTION.NORTH||this.orientation===DIRECTION.SOUTH?this.layout.setVertexLocation(t,i,s):this.layout.setVertexLocation(t,s,i),this.limitX=Math.max(this.limitX,i+e.width)}processReversedEdge(e,t){}}class HierarchicalLayout extends GraphLayout{constructor(e,t=DIRECTION.NORTH,i=!0){super(e),this.parentX=null,this.parentY=null,this.roots=null,this.resizeParent=!1,this.maintainParentLocation=!1,this.moveParent=!1,this.parentBorder=0,this.intraCellSpacing=30,this.interRankCellSpacing=100,this.interHierarchySpacing=60,this.parallelEdgeSpacing=10,this.orientation=DIRECTION.NORTH,this.fineTuning=!0,this.tightenToSource=!0,this.disableEdgeStyle=!0,this.traverseAncestors=!0,this.model=null,this.edgesCache=new Dictionary,this.edgeSourceTermCache=new Dictionary,this.edgesTargetTermCache=new Dictionary,this.edgeStyle=HierarchicalEdgeStyle.POLYLINE,this.orientation=t,this.deterministic=i}getDataModel(){return this.model}execute(e,t=null){if(this.parent=e,this.edgesCache=new Dictionary,this.edgeSourceTermCache=new Dictionary,this.edgesTargetTermCache=new Dictionary,null==t||t instanceof Array||(t=[t]),null==t&&null==e)return;if(this.parentX=null,this.parentY=null,e!==this.graph.getDataModel().root&&null!=e.isVertex()&&this.maintainParentLocation){let t=e.getGeometry();null!=t&&(this.parentX=t.x,this.parentY=t.y)}if(null!=t){let i=[];for(let s=0;s<t.length;s+=1)(null==e||e.isAncestor(t[s]))&&t[s].isVertex()&&i.push(t[s]);this.roots=i}let{model:i}=this.graph;i.batchUpdate(()=>{if(this.run(e),this.resizeParent&&!e.isCollapsed()&&this.graph.updateGroupBounds([e],this.parentBorder,this.moveParent),null!=this.parentX&&null!=this.parentY){let t=e.getGeometry();null!=t&&((t=t.clone()).x=this.parentX,t.y=this.parentY,i.setGeometry(e,t))}})}findRoots(e,t){let i=[];if(null!=e&&null!=t){let{model:e}=this.graph,s=null,n=-1e5;for(let e in t){let a=t[e];if(a.isVertex()&&a.isVisible()){let e=this.getEdges(a),t=0,l=0;for(let i=0;i<e.length;i++)this.getVisibleTerminal(e[i],!0)===a?t++:l++;0===l&&t>0&&i.push(a);let r=t-l;r>n&&(n=r,s=a)}}0===i.length&&null!=s&&i.push(s)}return i}getEdges(e){let t=this.edgesCache.get(e);if(null!=t)return t;let{model:i}=this.graph,s=[],n=e.isCollapsed(),a=e.getChildCount();for(let t=0;t<a;t+=1){let i=e.getChildAt(t);this.isPort(i)?s=s.concat(i.getEdges(!0,!0)):(n||!i.isVisible())&&(s=s.concat(i.getEdges(!0,!0)))}s=s.concat(e.getEdges(!0,!0));let l=[];for(let t=0;t<s.length;t+=1){let i=this.getVisibleTerminal(s[t],!0),n=this.getVisibleTerminal(s[t],!1);(i===n||i!==n&&(n===e&&(null==this.parent||this.isAncestor(this.parent,i,this.traverseAncestors))||i===e&&(null==this.parent||this.isAncestor(this.parent,n,this.traverseAncestors))))&&l.push(s[t])}return this.edgesCache.put(e,l),l}getVisibleTerminal(e,t){let i,s=(i=t?this.edgeSourceTermCache:this.edgesTargetTermCache).get(e);if(null!=s)return s;let n=this.graph.view.getState(e),a=null!=n?n.getVisibleTerminal(t):this.graph.view.getVisibleTerminal(e,t);return null==a&&(a=null!=n?n.getVisibleTerminal(t):this.graph.view.getVisibleTerminal(e,t)),null!=a&&(this.isPort(a)&&(a=a.getParent()),i.put(e,a)),a}run(e){let t=[],i={};if(null==this.roots&&null!=e){let s={};this.filterDescendants(e,s),this.roots=[];let n=!0;for(let e in s)if(null!=s[e]){n=!1;break}for(;!n;){let a=this.findRoots(e,s);for(let e=0;e<a.length;e+=1){let n={};t.push(n),this.traverse({vertex:a[e],directed:!0,edge:null,allVertices:i,currentComp:n,hierarchyVertices:t,filledVertexSet:s,func:null,visited:null})}for(let e=0;e<a.length;e+=1)this.roots.push(a[e]);for(let e in n=!0,s)if(null!=s[e]){n=!1;break}}}else{let e=this.roots;for(let s=0;s<e.length;s+=1){let n={};t.push(n),this.traverse({vertex:e[s],directed:!0,edge:null,allVertices:i,currentComp:n,hierarchyVertices:t,filledVertexSet:null,func:null,visited:null})}}let s=0;for(let i=0;i<t.length;i+=1){let n=t[i],a=[];for(let e in n)a.push(n[e]);this.model=new GraphHierarchyModel(this,a,this.roots,e,this.tightenToSource),this.cycleStage(e),this.layeringStage(),this.crossingStage(e),s=this.placementStage(s,e)}}filterDescendants(e,t){let{model:i}=this.graph;if(e.isVertex()&&e!==this.parent&&e.isVisible()&&(t[ObjectIdentity.get(e)]=e),this.traverseAncestors||e===this.parent&&e.isVisible()){let i=e.getChildCount();for(let s=0;s<i;s+=1){let i=e.getChildAt(s);this.isPort(i)||this.filterDescendants(i,t)}}}isPort(e){return null!=e&&null!=e.geometry&&e.geometry.relative}getEdgesBetween(e,t,i){i=null!=i&&i;let s=this.getEdges(e),n=[];for(let a=0;a<s.length;a+=1){let l=this.getVisibleTerminal(s[a],!0),r=this.getVisibleTerminal(s[a],!1);(l!==e||r!==t)&&(i||l!==t||r!==e)||n.push(s[a])}return n}traverse({vertex:e,directed:t,allVertices:i,currentComp:s,hierarchyVertices:n,filledVertexSet:a}){if(null!=e&&null!=i){let l=ObjectIdentity.get(e);if(null==i[l]&&(null==a||null!=a[l])){null==s[l]&&(s[l]=e),null==i[l]&&(i[l]=e),null!==a&&delete a[l];let r=this.getEdges(e),o=[];for(let t=0;t<r.length;t+=1)o[t]=this.getVisibleTerminal(r[t],!0)==e;for(let e=0;e<r.length;e+=1)if(!t||o[e]){let l=this.getVisibleTerminal(r[e],!o[e]),h=1;for(let t=0;t<r.length;t++)if(t!==e){let e=o[t];this.getVisibleTerminal(r[t],!e)===l&&(e?h++:h--)}h>=0&&(s=this.traverse({vertex:l,directed:t,edge:r[e],allVertices:i,currentComp:s,hierarchyVertices:n,filledVertexSet:a,func:null,visited:null}))}}else if(null==s[l])for(let e=0;e<n.length;e+=1){let t=n[e];if(null!=t[l]){for(let e in t)s[e]=t[e];n.splice(e,1);break}}}return s}cycleStage(e){new MinimumCycleRemover(this).execute(e)}layeringStage(){let e=this.model;e.initialRank(),e.fixRanks()}crossingStage(e){new MedianHybridCrossingReduction(this).execute(e)}placementStage(e,t){let i=new CoordinateAssignment(this,this.intraCellSpacing,this.interRankCellSpacing,this.orientation,e,this.parallelEdgeSpacing);return i.fineTuning=this.fineTuning,i.execute(t),i.limitX+this.interHierarchySpacing}}class SwimlaneModel{constructor(e,t,i,s,n){this.ranks=[],this.dfsCount=0,this.SOURCESCANSTARTRANK=1e8,this.tightenToSource=!1,this.ranksPerGroup=null;let a=e.getGraph();this.tightenToSource=n,this.roots=i,this.parent=s,this.vertexMapper=new Dictionary,this.edgeMapper=new Dictionary,this.maxRank=0;let l=[];null==t&&(t=a.getChildVertices(s)),this.maxRank=this.SOURCESCANSTARTRANK,this.createInternalCells(e,t,l);for(let i=0;i<t.length;i+=1){let t=l[i].connectsAsSource;for(let s=0;s<t.length;s++){let n=t[s],a=n.edges;if(null!=a&&a.length>0){let t=a[0],s=e.getVisibleTerminal(t,!1),r=this.vertexMapper.get(s);l[i]==r&&(s=e.getVisibleTerminal(t,!0),r=this.vertexMapper.get(s)),null!=r&&l[i]!==r&&(n.target=r,0==r.connectsAsTarget.length&&(r.connectsAsTarget=[]),0>r.connectsAsTarget.indexOf(n)&&r.connectsAsTarget.push(n))}}l[i].temp[0]=1}}createInternalCells(e,t,i){let s=e.getGraph(),n=e.swimlanes;for(let a=0;a<t.length;a+=1){i[a]=new GraphHierarchyNode(t[a]),this.vertexMapper.put(t[a],i[a]),i[a].swimlaneIndex=-1;for(let e=0;e<n.length;e+=1)if(t[a].getParent()===n[e]){i[a].swimlaneIndex=e;break}let l=e.getEdges(t[a]);i[a].connectsAsSource=[];for(let n=0;n<l.length;n+=1){let r=e.getVisibleTerminal(l[n],!1);if(r!==t[a]&&r.isVertex()&&!e.isVertexIgnored(r)){let n=e.getEdgesBetween(t[a],r,!1),l=e.getEdgesBetween(t[a],r,!0);if(null!=n&&n.length>0&&null==this.edgeMapper.get(n[0])&&2*l.length>=n.length){let t=new GraphHierarchyEdge(n);for(let i=0;i<n.length;i+=1){let a=n[i];this.edgeMapper.put(a,t),s.resetEdge(a),e.disableEdgeStyle&&(e.setEdgeStyleEnabled(a,!1),e.setOrthogonalEdge(a,!0))}t.source=i[a],0>i[a].connectsAsSource.indexOf(t)&&i[a].connectsAsSource.push(t)}}}i[a].temp[0]=0}}initialRank(){this.ranksPerGroup=[];let e=[],t={};if(null!=this.roots)for(let i=0;i<this.roots.length;i+=1){let s=this.vertexMapper.get(this.roots[i]);this.maxChainDfs(null,s,null,t,0),null!=s&&e.push(s)}let i={},s={};for(let e=this.ranksPerGroup.length-1;e>=0;e--)e===this.ranksPerGroup.length-1?i[e]=0:i[e]=s[e+1]+1,s[e]=i[e]+this.ranksPerGroup[e];this.maxRank=s[0];let n=this.vertexMapper.getValues();for(let e=0;e<n.length;e+=1)n[e].temp[0]=-1;for(;e.length>0;){let t=e[0],i=t.connectsAsTarget,n=t.connectsAsSource,a=!0,l=s[0];for(let e=0;e<i.length;e+=1){let t=i[e];if(5270620===t.temp[0])l=Math.min(l,t.source.temp[0]-1);else{a=!1;break}}if(a){if(l>s[t.swimlaneIndex]&&(l=s[t.swimlaneIndex]),t.temp[0]=l,null!=n)for(let t=0;t<n.length;t+=1){let i=n[t];i.temp[0]=5270620;let s=i.target;-1===s.temp[0]&&(e.push(s),s.temp[0]=-2)}e.shift()}else{let i=e.shift();if(e.push(t),i===t&&1===e.length)break}}}maxChainDfs(e,t,i,s,n){if(null!=t){let e=CellPath.create(t.cell);if(null==s[e]){s[e]=t;let i=t.swimlaneIndex,a=this.ranksPerGroup;(null==a[i]||a[i]<n)&&(a[i]=n);let l=t.connectsAsSource.slice();for(let e=0;e<l.length;e+=1){let i=l[e],a=i.target;t.swimlaneIndex<a.swimlaneIndex?this.maxChainDfs(t,a,i,clone(s,null,!0),0):t.swimlaneIndex===a.swimlaneIndex&&this.maxChainDfs(t,a,i,clone(s,null,!0),n+1)}}}}fixRanks(){let e=[];this.ranks=[];for(let t=0;t<this.maxRank+1;t+=1)e[t]=[],this.ranks[t]=e[t];let t=null;if(null!=this.roots){let e=this.roots;t=[];for(let i=0;i<e.length;i+=1){let s=e[i],n=this.vertexMapper.get(s);t[i]=n}}this.visit((t,i,s,n,a)=>{if(0===a&&i.maxRank<0&&i.minRank<0&&(e[i.temp[0]].push(i),i.maxRank=i.temp[0],i.minRank=i.temp[0],i.temp[0]=e[i.maxRank].length-1),null!=t&&null!=s&&t.maxRank-i.maxRank>1){s.maxRank=t.maxRank,s.minRank=i.maxRank,s.temp=[],s.x=[],s.y=[];for(let t=s.minRank+1;t<s.maxRank;t+=1)e[t].push(s),s.setGeneralPurposeVariable(t,e[t].length-1)}},t,!1,null)}visit(e,t,i,s){if(null!=t){for(let n=0;n<t.length;n+=1){let a=t[n];null!=a&&(null==s&&(s={}),i?(a.hashCode=[],a.hashCode[0]=this.dfsCount,a.hashCode[1]=n,this.extendedDfs(null,a,null,e,s,a.hashCode,n,0)):this.dfs(null,a,null,e,s,0))}this.dfsCount+=1}}dfs(e,t,i,s,n,a){if(null!=t){let l=t.id;if(null==n[l]){n[l]=t,s(e,t,i,a,0);let r=t.connectsAsSource.slice();for(let e=0;e<r.length;e+=1){let i=r[e],l=i.target;this.dfs(t,l,i,s,n,a+1)}}else s(e,t,i,a,1)}}extendedDfs(e,t,i,s,n,a,l,r){if(null!=t){if(null!=e&&(null==t.hashCode||t.hashCode[0]!==e.hashCode[0])){let i=e.hashCode.length+1;t.hashCode=e.hashCode.slice(),t.hashCode[i-1]=l}let a=t.id;if(null==n[a]){n[a]=t,s(e,t,i,r,0);let l=t.connectsAsSource.slice(),o=t.connectsAsTarget.slice();for(let e=0;e<l.length;e+=1){let i=l[e],a=i.target;t.swimlaneIndex<=a.swimlaneIndex&&this.extendedDfs(t,a,i,s,n,t.hashCode,e,r+1)}for(let e=0;e<o.length;e+=1){let i=o[e],a=i.source;t.swimlaneIndex<a.swimlaneIndex&&this.extendedDfs(t,a,i,s,n,t.hashCode,e,r+1)}}else s(e,t,i,r,1)}}}class SwimlaneOrdering extends HierarchicalLayoutStage{constructor(e){super(),this.layout=e}execute(e){let t=this.layout.getDataModel(),i=clone(t.vertexMapper,null,!0),s=null;if(null!=t.roots){let e=t.roots;s=[];for(let i=0;i<e.length;i+=1)s[i]=t.vertexMapper.get(e[i])}t.visit((e,t,s,n,a)=>{let l=null!=e&&e.swimlaneIndex===t.swimlaneIndex&&t.isAncestor(e),r=null!=e&&null!=s&&e.swimlaneIndex<t.swimlaneIndex&&s.source===t;l?(s.invert(),remove(s,e.connectsAsSource),t.connectsAsSource.push(s),e.connectsAsTarget.push(s),remove(s,t.connectsAsTarget)):r&&(s.invert(),remove(s,e.connectsAsTarget),t.connectsAsTarget.push(s),e.connectsAsSource.push(s),remove(s,t.connectsAsSource));let o=CellPath.create(t.cell);delete i[o]},s,!0,null)}}class SwimlaneLayout extends GraphLayout{constructor(e,t,i=!0){super(e),this.parentX=null,this.parentY=null,this.roots=null,this.swimlanes=null,this.dummyVertexWidth=50,this.resizeParent=!1,this.maintainParentLocation=!1,this.moveParent=!1,this.parentBorder=30,this.intraCellSpacing=30,this.interRankCellSpacing=100,this.interHierarchySpacing=60,this.parallelEdgeSpacing=10,this.orientation=DIRECTION.NORTH,this.fineTuning=!0,this.tightenToSource=!0,this.disableEdgeStyle=!0,this.traverseAncestors=!0,this.model=null,this.edgesCache=new Dictionary,this.edgeSourceTermCache=new Dictionary,this.edgesTargetTermCache=new Dictionary,this.edgeStyle=HierarchicalEdgeStyle.POLYLINE,this.orientation=null!=t?t:DIRECTION.NORTH,this.deterministic=null==i||i}getDataModel(){return this.model}execute(e,t=null){this.parent=e;let{model:i}=this.graph;if(this.edgesCache=new Dictionary,this.edgeSourceTermCache=new Dictionary,this.edgesTargetTermCache=new Dictionary,null==t||t.length<1)return;if(null==e&&(e=t[0].getParent()),this.parentX=null,this.parentY=null,e!==this.graph.getDataModel().root&&null!=e.isVertex()&&this.maintainParentLocation){let t=e.getGeometry();null!=t&&(this.parentX=t.x,this.parentY=t.y)}this.swimlanes=t;let s=[];for(let e=0;e<t.length;e+=1){let i=this.graph.getChildCells(t[e]);if(null==i||0===i.length){let i=this.graph.insertVertex(t[e],null,null,0,0,this.dummyVertexWidth,0);s.push(i)}}i.beginUpdate();try{if(this.run(e),this.resizeParent&&!e.isCollapsed()&&this.graph.updateGroupBounds([e],this.parentBorder,this.moveParent),null!=this.parentX&&null!=this.parentY){let t=e.getGeometry();null!=t&&((t=t.clone()).x=this.parentX,t.y=this.parentY,i.setGeometry(e,t))}this.graph.removeCells(s)}finally{i.endUpdate()}}updateGroupBounds(){let e=[],t=this.model;for(let i in t.edgeMapper){let s=t.edgeMapper[i];for(let t=0;t<s.edges.length;t+=1)e.push(s.edges[t])}let i=this.graph.getBoundingBoxFromGeometry(e,!0),s=[],n=this.swimlanes;for(let e=0;e<n.length;e+=1){let t=n[e],a=t.getGeometry();if(null!=a){let n=this.graph.getChildCells(t),l=this.graph.isSwimlane(t)?this.graph.getStartSize(t):new Rectangle,r=this.graph.getBoundingBoxFromGeometry(n);s[e]=r;let o=r.y+a.y-l.height-this.parentBorder,h=r.y+a.y+r.height;if(null==i)i=new Rectangle(0,o,0,h-o);else{i.y=Math.min(i.y,o);let e=Math.max(i.y+i.height,h);i.height=e-i.y}}}for(let e=0;e<n.length;e+=1){let t=n[e],a=t.getGeometry();if(null!=a){let n=this.graph.getChildCells(t),l=this.graph.isSwimlane(t)?this.graph.getStartSize(t):new Rectangle,r=a.clone(),o=0===e?this.parentBorder:this.interRankCellSpacing/2,h=l.width+o,c=s[e].x-h,d=i.y-this.parentBorder;r.x+=c,r.y=d,r.width=s[e].width+h+this.interRankCellSpacing/2,r.height=i.height+l.height+2*this.parentBorder,this.graph.model.setGeometry(t,r),this.graph.moveCells(n,-c,a.y-d)}}}findRoots(e,t){let i=[];if(null!=e&&null!=t){let{model:s}=this.graph,n=null,a=-1e5;for(let s in t){let l=t[s];if(null!=l&&l.isVertex()&&l.isVisible()&&e.isAncestor(l)){let t=this.getEdges(l),s=0,r=0;for(let i=0;i<t.length;i++){let n=this.getVisibleTerminal(t[i],!0);if(n===l){let n=this.getVisibleTerminal(t[i],!1);e.isAncestor(n)&&(s+=1)}else e.isAncestor(n)&&(r+=1)}0===r&&s>0&&i.push(l);let o=s-r;o>a&&(a=o,n=l)}}0===i.length&&null!=n&&i.push(n)}return i}getEdges(e){let t=this.edgesCache.get(e);if(null!=t)return t;let i=[],s=e.isCollapsed(),n=e.getChildCount();for(let t=0;t<n;t+=1){let n=e.getChildAt(t);this.isPort(n)?i=i.concat(n.getEdges(!0,!0)):(s||!n.isVisible())&&(i=i.concat(n.getEdges(!0,!0)))}i=i.concat(e.getEdges(!0,!0));let a=[];for(let t=0;t<i.length;t+=1){let s=this.getVisibleTerminal(i[t],!0),n=this.getVisibleTerminal(i[t],!1);(s===n||s!==n&&(n===e&&(null==this.parent||this.graph.isValidAncestor(s,this.parent,this.traverseAncestors))||s===e&&(null==this.parent||this.graph.isValidAncestor(n,this.parent,this.traverseAncestors))))&&a.push(i[t])}return this.edgesCache.put(e,a),a}getVisibleTerminal(e,t){let i=this.edgesTargetTermCache;t&&(i=this.edgeSourceTermCache);let s=i.get(e);if(null!=s)return s;let n=this.graph.view.getState(e),a=null!=n?n.getVisibleTerminal(t):this.graph.view.getVisibleTerminal(e,t);return null==a&&(a=null!=n?n.getVisibleTerminal(t):this.graph.view.getVisibleTerminal(e,t)),null!=a&&(this.isPort(a)&&(a=a.getParent()),i.put(e,a)),a}run(e){let t=[],i={};if(null!=this.swimlanes&&this.swimlanes.length>0&&null!=e){let e={};for(let t=0;t<this.swimlanes.length;t+=1)this.filterDescendants(this.swimlanes[t],e);this.roots=[];let s=!0;for(let t in e)if(null!=e[t]){s=!1;break}let n=0;for(;!s&&n<this.swimlanes.length;){let a=this.findRoots(this.swimlanes[n],e);if(0===a.length){n++;continue}for(let s=0;s<a.length;s+=1){let l={};t.push(l),this.traverse({vertex:a[s],directed:!0,edge:null,allVertices:i,currentComp:l,hierarchyVertices:t,filledVertexSet:e,swimlaneIndex:n,func:null,visited:null})}for(let e=0;e<a.length;e+=1)this.roots.push(a[e]);for(let t in s=!0,e)if(null!=e[t]){s=!1;break}}}else{let e=this.roots;for(let s=0;s<e.length;s+=1){let n={};t.push(n),this.traverse({vertex:e[s],directed:!0,edge:null,allVertices:i,currentComp:n,hierarchyVertices:t,filledVertexSet:null,swimlaneIndex:s,func:null,visited:null})}}let s=[];for(let e in i)s.push(i[e]);this.model=new SwimlaneModel(this,s,this.roots,e,this.tightenToSource),this.cycleStage(e),this.layeringStage(),this.crossingStage(e),this.placementStage(0,e)}filterDescendants(e,t){let{model:i}=this.graph;if(e.isVertex()&&e!==this.parent&&e.getParent()!==this.parent&&e.isVisible()&&(t[ObjectIdentity.get(e)]=e),this.traverseAncestors||e===this.parent&&e.isVisible()){let i=e.getChildCount();for(let s=0;s<i;s+=1){let i=e.getChildAt(s);this.isPort(i)||this.filterDescendants(i,t)}}}isPort(e){return!!e.geometry.relative}getEdgesBetween(e,t,i=!1){let s=this.getEdges(e),n=[];for(let a=0;a<s.length;a+=1){let l=this.getVisibleTerminal(s[a],!0),r=this.getVisibleTerminal(s[a],!1);(l!==e||r!==t)&&(i||l!==t||r!==e)||n.push(s[a])}return n}traverse({vertex:e,directed:t,allVertices:i,currentComp:s,hierarchyVertices:n,filledVertexSet:a,swimlaneIndex:l}){if(null!=e&&null!=i){let r=ObjectIdentity.get(e);if(null==i[r]&&(null==a||null!=a[r])){null==s[r]&&(s[r]=e),null==i[r]&&(i[r]=e),null!==a&&delete a[r];let o=this.getEdges(e);for(let r=0;r<o.length;r+=1){let h=this.getVisibleTerminal(o[r],!0),c=h===e;c&&(h=this.getVisibleTerminal(o[r],!1));let d=0;for(d=0;d<this.swimlanes.length&&!this.swimlanes[d].isAncestor(h);d++);!(d>=this.swimlanes.length)&&(d>l||(!t||c)&&d===l)&&(s=this.traverse({vertex:h,directed:t,edge:o[r],allVertices:i,currentComp:s,hierarchyVertices:n,filledVertexSet:a,swimlaneIndex:d,func:null,visited:null}))}}else if(null==s[r])for(let e=0;e<n.length;e+=1){let t=n[e];if(null!=t[r]){for(let e in t)s[e]=t[e];n.splice(e,1);break}}}return s}cycleStage(e){new SwimlaneOrdering(this).execute(e)}layeringStage(){let e=this.model;e.initialRank(),e.fixRanks()}crossingStage(e){new MedianHybridCrossingReduction(this).execute(e)}placementStage(e,t){let i=new CoordinateAssignment(this,this.intraCellSpacing,this.interRankCellSpacing,this.orientation,e,this.parallelEdgeSpacing);return i.fineTuning=this.fineTuning,i.execute(t),i.limitX+this.interHierarchySpacing}}class EditorCodec extends ObjectCodec{constructor(){super(new Editor(void 0),["modified","lastSnapshot","ignoredChanges","undoManager","graphContainer","toolbarContainer"])}afterDecode(e,t,i){let s=t.getAttribute("defaultEdge");null!=s&&(t.removeAttribute("defaultEdge"),i.defaultEdge=i.templates[s]);let n=t.getAttribute("defaultGroup");return null!=n&&(t.removeAttribute("defaultGroup"),i.defaultGroup=i.templates[n]),i}decodeChild(e,t,i){if("Array"===t.nodeName){if("templates"===t.getAttribute("as")){this.decodeTemplates(e,t,i);return}}else if("ui"===t.nodeName){this.decodeUi(e,t,i);return}super.decodeChild.apply(this,[e,t,i])}decodeUi(e,t,i){let s=t.firstChild;for(;null!=s;){if("add"===s.nodeName){let e=s.getAttribute("as"),t=s.getAttribute("element"),n=s.getAttribute("style"),a=null;if(null!=t)null!=(a=document.getElementById(t))&&null!=n&&(a.style.cssText+=`;${n}`);else{let t=parseInt(s.getAttribute("x")),i=parseInt(s.getAttribute("y")),l=s.getAttribute("width")||null,r=s.getAttribute("height")||null;a=document.createElement("div"),null!=n&&(a.style.cssText=n),new MaxWindow(translate(e)||e,a,t,i,l?parseInt(l):null,r?parseInt(r):null,!1,!0).setVisible(!0)}if("graph"===e)i.setGraphContainer(a);else if("toolbar"===e)i.setToolbarContainer(a);else if("title"===e)i.setTitleContainer(a);else if("status"===e)i.setStatusContainer(a);else if("map"===e)throw Error("Unimplemented")}else"resource"===s.nodeName?GlobalConfig.i18n.addResource(s.getAttribute("basename")):"stylesheet"===s.nodeName&&addLinkToHead("stylesheet",s.getAttribute("name"));s=s.nextSibling}}decodeTemplates(e,t,i){null==i.templates&&(i.templates=[]);let s=getChildNodes(t);for(let t=0;t<s.length;t++){let n=s[t].getAttribute("as"),a=s[t].firstChild;for(;null!=a&&1!==a.nodeType;)a=a.nextSibling;null!=a&&(i.templates[n]=e.decodeCell(a))}}}class EditorKeyHandlerCodec extends ObjectCodec{constructor(){super(new EditorKeyHandler)}encode(e,t){return null}decode(e,t,i){if(null!=i){let{editor:s}=i,n=t.firstChild;for(;null!=n;){if(!this.processInclude(e,n,i)&&"add"===n.nodeName){let e=n.getAttribute("as"),t=n.getAttribute("action"),s=n.getAttribute("control");i.bindAction(e,t,s)}n=n.nextSibling}}return i}}class EditorPopupMenuCodec extends ObjectCodec{constructor(){super(new EditorPopupMenu)}encode(e,t){return null}decode(e,t,i){let s=t.getElementsByTagName("include")[0];return null!=s?this.processInclude(e,s,i):null!=i&&(i.config=t),i}}class EditorToolbarCodec extends ObjectCodec{constructor(){super(new EditorToolbar)}encode(e,t){return null}decode(e,t,i){if(null!=i){let s=i.editor,n=t.firstChild;for(;null!=n;){if(isElement(n)&&!this.processInclude(e,n,i)){if("separator"===n.nodeName)i.addSeparator();else if("br"===n.nodeName)i.toolbar.addBreak();else if("hr"===n.nodeName)i.toolbar.addLine();else if("add"===n.nodeName){let e,t=n.getAttribute("as");t=translate(t)||t;let a=n.getAttribute("icon"),l=n.getAttribute("pressedIcon"),r=n.getAttribute("action"),o=n.getAttribute("mode"),h=n.getAttribute("template"),c="0"!=n.getAttribute("toggle"),d=getTextContent(n),u=null;if(null!=r)u=i.addItem(t,a,r,l);else if(null!=o)e=EditorToolbarCodec.allowEval?doEval(d):null,u=i.addMode(t,a,o,l,e);else if(null!=h||null!=d&&d.length>0){let e=h?s.templates[h]:null,r=n.getAttribute("style");null!=e&&null!=r&&(e=s.graph.cloneCell(e)).setStyle(r);let o=null;null!=d&&d.length>0&&EditorToolbarCodec.allowEval&&(o=doEval(d)),u=i.addPrototype(t,a,e,l,o,c)}else{let l=getChildNodes(n);if(l.length>0)if(null==a){let e=i.addActionCombo(t);for(let t=0;t<l.length;t+=1){let s=l[t];if("separator"===s.nodeName)i.addOption(e,"---");else if("add"===s.nodeName){let t=s.getAttribute("as"),n=s.getAttribute("action");i.addActionOption(e,t,n)}}}else{let n=i.addCombo(),r=()=>{let e=s.templates[n.value];if(null!=e){let t=e.clone(),i=n.options[n.selectedIndex].cellStyle;return null!=i&&t.setStyle(i),t}return GlobalConfig.logger.warn(`Template ${e} not found`),null},o=i.addPrototype(t,a,r,null,null,c);InternalEvent.addListener(n,"change",()=>{i.toolbar.selectMode(o,t=>{let i=convertPoint(s.graph.container,getClientX(t),getClientY(t));return s.addVertex(null,e(),i.x,i.y)}),i.toolbar.noReset=!1});for(let e=0;e<l.length;e+=1){let t=l[e];if("separator"===t.nodeName)i.addOption(n,"---");else if("add"===t.nodeName){let e=t.getAttribute("as"),s=t.getAttribute("template");i.addOption(n,e,s||h).cellStyle=t.getAttribute("style")}}}}if(null!=u){let e=n.getAttribute("id");null!=e&&e.length>0&&u.setAttribute("id",e)}}}n=n.nextSibling}}return i}}class ChildChangeCodec extends ObjectCodec{constructor(){let e=void 0;super(new ChildChange(e,e,e),["model","child","previousIndex"],["parent","previous"])}isReference(e,t,i,s){return!!("child"===t&&(!s||e.model.contains(e.previous)))||this.idrefs.indexOf(t)>=0}isExcluded(e,t,i,s){return super.isExcluded(e,t,i,s)||s&&null!=i&&("previous"===t||"parent"===t)&&!e.model.contains(i)}afterEncode(e,t,i){return this.isReference(t,"child",t.child,!0)?i.setAttribute("child",e.getId(t.child)):e.encodeCell(t.child,i),i}beforeDecode(e,t,i){var s;if(isElement(t.firstChild)){let n=t.cloneNode(!0),a=n.firstChild;i.child=e.decodeCell(a,!1);let l=a.nextSibling;for(a.parentNode.removeChild(a),a=l;a;){if(l=a.nextSibling,isElement(a)){let t=a.getAttribute("id");null==e.lookup(t)&&e.decodeCell(a)}null==(s=a.parentNode)||s.removeChild(a),a=l}return n}{let s=t.getAttribute("child");return i.child=e.getObject(s),t}}afterDecode(e,t,i){return null!=i.child&&(null!=i.child.parent&&null!=i.previous&&i.child.parent!==i.previous&&(i.previous=i.child.parent),i.child.parent=i.previous,i.previous=i.parent,i.previousIndex=i.index),i}}class GenericChangeCodec extends ObjectCodec{constructor(e,t){super(e,["model","previous"],["cell"]),this.variable=t}afterDecode(e,t,i){return isNode(i.cell)&&(i.cell=e.decodeCell(i.cell,!1)),i.previous=i[this.variable],i}}class GraphCodec extends ObjectCodec{constructor(){super(new Graph(void 0),["graphListeners","eventListeners","view","container","cellRenderer","editor","selection"])}}class GraphViewCodec extends ObjectCodec{constructor(){super(new GraphView(void 0))}encode(e,t){return this.encodeCell(e,t,t.graph.getDataModel().getRoot())}encodeCell(e,t,i){let s,n=t.graph.getDataModel(),a=t.getState(i),l=i.getParent();if(null==l||null!=a){let r=i.getChildCount(),o=i.getGeometry(),h=null;if(l===n.getRoot()?h="layer":null==l?h="graph":i.isEdge()?h="edge":r>0&&null!=o?h="group":i.isVertex()&&(h="vertex"),null!=h){if(s=e.document.createElement(h),null!=t.graph.getLabel(i)&&(s.setAttribute("label",t.graph.getLabel(i)),t.graph.isHtmlLabel(i)&&s.setAttribute("html",!0)),null==l){let e=t.getGraphBounds();null!=e&&(s.setAttribute("x",Math.round(e.x)),s.setAttribute("y",Math.round(e.y)),s.setAttribute("width",Math.round(e.width)),s.setAttribute("height",Math.round(e.height))),s.setAttribute("scale",t.scale)}else if(null!=a&&null!=o){for(let e in a.style){let t=a.style[e];"function"==typeof t&&"object"==typeof t&&(t=StyleRegistry.getName(t)),null!=t&&"function"!=typeof t&&"object"!=typeof t&&s.setAttribute(e,t)}let e=a.absolutePoints;if(null!=e&&e.length>0){let t=`${Math.round(e[0].x)},${Math.round(e[0].y)}`;for(let i=1;i<e.length;i+=1)t+=` ${Math.round(e[i].x)},${Math.round(e[i].y)}`;s.setAttribute("points",t)}else s.setAttribute("x",Math.round(a.x)),s.setAttribute("y",Math.round(a.y)),s.setAttribute("width",Math.round(a.width)),s.setAttribute("height",Math.round(a.height));let t=a.absoluteOffset;null!=t&&(0!==t.x&&s.setAttribute("dx",Math.round(t.x)),0!==t.y&&s.setAttribute("dy",Math.round(t.y)))}for(let n=0;n<r;n+=1){let a=this.encodeCell(e,t,i.getChildAt(n));null!=a&&s.appendChild(a)}}}return s}}class RootChangeCodec extends ObjectCodec{constructor(){let e=void 0;super(new RootChange(e,e),["model","previous","root"])}afterEncode(e,t,i){return e.encodeCell(t.root,i),i}beforeDecode(e,t,i){var s,n;if(isElement(t.firstChild)){let a=(t=t.cloneNode(!0)).firstChild;i.root=e.decodeCell(a,!1);let l=a.nextSibling;for(null==(s=a.parentNode)||s.removeChild(a),a=l;null!=a;)l=a.nextSibling,e.decodeCell(a),null==(n=a.parentNode)||n.removeChild(a),a=l}return t}afterDecode(e,t,i){return i.previous=i.root,i}}class StylesheetCodec extends ObjectCodec{constructor(){super(new Stylesheet)}encode(e,t){let i=e.document.createElement(this.getName());for(let s in t.styles){let n=t.styles[s],a=e.document.createElement("add");if(null!=s){for(let t in a.setAttribute("as",s),n){let i=this.getStringValue(t,n[t]);if(null!=i){let s=e.document.createElement("add");s.setAttribute("value",i),s.setAttribute("as",t),a.appendChild(s)}}a.childNodes.length>0&&i.appendChild(a)}}return i}getStringValue(e,t){let i=typeof t;return"function"===i?t=StyleRegistry.getName(t):"object"===i&&(t=null),t}decode(e,t,i){let s=i||new this.template.constructor,n=t.getAttribute("id");n&&(e.objects[n]=s);let a=t.firstChild;for(;a;){if(!this.processInclude(e,a,s)&&"add"===a.nodeName){let e=a.getAttribute("as");if(e){let t=a.getAttribute("extend"),i=t?clone(s.styles[t]):null;i||(t&&GlobalConfig.logger.warn(`StylesheetCodec.decode: stylesheet ${t} not found to extend`),i={});let n=a.firstChild;for(;n;){if(isElement(n)){let e=n.getAttribute("as");if("add"===n.nodeName){let t=getTextContent(n),s=null;t&&StylesheetCodec.allowEval?s=doEval(t):isNumeric(s=n.getAttribute("value"))&&(s=parseFloat(s)),s&&(i[e]=s)}else"remove"===n.nodeName&&delete i[e]}n=n.nextSibling}s.putCellStyle(e,i)}}a=a.nextSibling}return s}}StylesheetCodec.allowEval=!1;class TerminalChangeCodec extends ObjectCodec{constructor(){let e=void 0;super(new TerminalChange(e,e,e,e),["model","previous"],["cell","terminal"])}afterDecode(e,t,i){return i.previous=i.terminal,i}}let registerGenericChangeCodecs=()=>{let e=void 0;CodecRegistry.register(new GenericChangeCodec(new CellAttributeChange(e,e,e),"value")),CodecRegistry.register(new GenericChangeCodec(new CollapseChange(e,e,e),"collapsed")),CodecRegistry.register(new GenericChangeCodec(new GeometryChange(e,e,e),"geometry")),CodecRegistry.register(new GenericChangeCodec(new StyleChange(e,e,e),"style")),CodecRegistry.register(new GenericChangeCodec(new ValueChange(e,e,e),"value")),CodecRegistry.register(new GenericChangeCodec(new VisibleChange(e,e,e),"visible"))},isCoreCodecsRegistered=!1,registerCoreCodecs=(e=!1)=>{(!isCoreCodecsRegistered||e)&&(CodecRegistry.register(new ChildChangeCodec),CodecRegistry.register(new GraphCodec),CodecRegistry.register(new GraphViewCodec),CodecRegistry.register(new RootChangeCodec),CodecRegistry.register(new StylesheetCodec),CodecRegistry.register(new TerminalChangeCodec),registerGenericChangeCodecs(),registerModelCodecs(e),isCoreCodecsRegistered=!0)},isEditorCodecsRegistered=!1,registerEditorCodecs=(e=!1)=>{(!isEditorCodecsRegistered||e)&&(registerBaseCodecs(e),CodecRegistry.register(new EditorCodec),CodecRegistry.register(new EditorKeyHandlerCodec),CodecRegistry.register(new EditorPopupMenuCodec),CodecRegistry.register(new EditorToolbarCodec),isEditorCodecsRegistered=!0)},registerAllCodecs=(e=!1)=>{registerCoreCodecs(e),registerEditorCodecs(e)},StencilShapeConfig={allowEval:!1,defaultLocalized:!1};class StencilShape extends Shape{constructor(e){super(),this.constraints=[],this.aspect="auto",this.w0=100,this.h0=100,this.bgNode=null,this.fgNode=null,this.strokeWidthValue=null,this.desc=e,this.parseDescription(),this.parseConstraints()}parseDescription(){this.fgNode=this.desc.getElementsByTagName("foreground")[0],this.bgNode=this.desc.getElementsByTagName("background")[0],this.w0=Number(this.desc.getAttribute("w")||100),this.h0=Number(this.desc.getAttribute("h")||100);let e=this.desc.getAttribute("aspect");this.aspect=e??"variable";let t=this.desc.getAttribute("strokewidth");this.strokeWidthValue=isNullish(t)?"1":t}parseConstraints(){let e=this.desc.getElementsByTagName("connections")[0];if(e){let t=getChildNodes(e);if(t.length>0){this.constraints=[];for(let e=0;e<t.length;e+=1)this.constraints.push(this.parseConstraint(t[e]))}}}parseConstraint(e){let t=Number(e.getAttribute("x")),i=Number(e.getAttribute("y")),s="1"===e.getAttribute("perimeter"),n=e.getAttribute("name");return new ConnectionConstraint(new Point(t,i),s,n)}evaluateTextAttribute(e,t,i){let s=this.evaluateAttribute(e,t,i),n=e.getAttribute("localized");return(StencilShapeConfig.defaultLocalized&&!n||"1"===n)&&(s=translate(s)),s}evaluateAttribute(e,t,i){let s=e.getAttribute(t);if(!s){let t=getTextContent(e);if(t&&StencilShapeConfig.allowEval){let e=doEval(t);"function"==typeof e&&(s=e(i))}}return s}drawShape(e,t,i,s,n,a){var l,r,o;let h=e.states.slice(),c=null==(l=t.style)?void 0:l.direction,d=this.computeAspect(t,i,s,n,a,c),u=Math.min(d.width,d.height),p="inherit"===this.strokeWidthValue?(null==(r=t.style)?void 0:r.strokeWidth)??1:Number(this.strokeWidthValue)*u;e.setStrokeWidth(p),(null==(o=t.style)?void 0:o.pointerEvents)&&(e.setStrokeColor(NONE),e.rect(i,s,n,a),e.stroke(),e.setStrokeColor(t.stroke)),this.drawChildren(e,t,i,s,n,a,this.bgNode,d,!1,!0),this.drawChildren(e,t,i,s,n,a,this.fgNode,d,!0,!t.outline||null==t.style||!t.style.backgroundOutline),e.states.length!=h.length&&(e.states=h)}drawChildren(e,t,i,s,n,a,l,r,o,h){if(l&&n>0&&a>0){let i=l.firstChild;for(;i;)isElement(i)&&this.drawNode(e,t,i,r,o,h),i=i.nextSibling}}computeAspect(e=null,t,i,s,n,a){let l=t,r=i,o=s/this.w0,h=n/this.h0,c=a===DIRECTION.NORTH||a===DIRECTION.SOUTH;if(c){h=s/this.h0,o=n/this.w0;let e=(s-n)/2;l+=e,r-=e}return"fixed"===this.aspect&&(o=h=Math.min(o,h),c?(l+=(n-this.w0*o)/2,r+=(s-this.h0*h)/2):(l+=(s-this.w0*o)/2,r+=(n-this.h0*h)/2)),new Rectangle(l,r,o,h)}drawNode(e,t,i,s,n,a){var l,r;let o=i.nodeName,h=s.x,c=s.y,d=s.width,u=s.height,p=Math.min(d,u);if("save"===o)e.save();else if("restore"===o)e.restore();else if(a){if("path"===o){e.begin();let l=!0;if("1"==i.getAttribute("rounded")){l=!1;let t=Number(i.getAttribute("arcSize")),s=0,n=[],a=i.firstChild;for(;null!=a;){if(isElement(a)){let e=a.nodeName;if("move"===e||"line"===e)("move"===e||0===n.length)&&n.push([]),n[n.length-1].push(new Point(h+Number(a.getAttribute("x"))*d,c+Number(a.getAttribute("y"))*u)),s++;else{l=!0;break}}a=a.nextSibling}if(!l&&s>0)for(let i=0;i<n.length;i+=1){let s=!1,a=n[i][0],l=n[i][n[i].length-1];a.x===l.x&&a.y===l.y&&(n[i].pop(),s=!0),this.addPoints(e,n[i],!0,t,s)}else l=!0}if(l){let l=i.firstChild;for(;l;)isElement(l)&&this.drawNode(e,t,l,s,n,a),l=l.nextSibling}}else if("close"===o)e.close();else if("move"===o)e.moveTo(h+Number(i.getAttribute("x"))*d,c+Number(i.getAttribute("y"))*u);else if("line"===o)e.lineTo(h+Number(i.getAttribute("x"))*d,c+Number(i.getAttribute("y"))*u);else if("quad"===o)e.quadTo(h+Number(i.getAttribute("x1"))*d,c+Number(i.getAttribute("y1"))*u,h+Number(i.getAttribute("x2"))*d,c+Number(i.getAttribute("y2"))*u);else if("curve"===o)e.curveTo(h+Number(i.getAttribute("x1"))*d,c+Number(i.getAttribute("y1"))*u,h+Number(i.getAttribute("x2"))*d,c+Number(i.getAttribute("y2"))*u,h+Number(i.getAttribute("x3"))*d,c+Number(i.getAttribute("y3"))*u);else if("arc"===o)e.arcTo(Number(i.getAttribute("rx"))*d,Number(i.getAttribute("ry"))*u,Number(i.getAttribute("x-axis-rotation")),!!i.getAttribute("large-arc-flag"),!!i.getAttribute("sweep-flag"),h+Number(i.getAttribute("x"))*d,c+Number(i.getAttribute("y"))*u);else if("rect"===o)e.rect(h+Number(i.getAttribute("x"))*d,c+Number(i.getAttribute("y"))*u,Number(i.getAttribute("w"))*d,Number(i.getAttribute("h"))*u);else if("roundrect"===o){let t=Number(i.getAttribute("arcsize"));0===t&&(t=100*RECTANGLE_ROUNDING_FACTOR);let s=Number(i.getAttribute("w"))*d,n=Number(i.getAttribute("h"))*u,a=Number(t)/100,l=Math.min(s*a,n*a);e.roundrect(h+Number(i.getAttribute("x"))*d,c+Number(i.getAttribute("y"))*u,s,n,l,l)}else if("ellipse"===o)e.ellipse(h+Number(i.getAttribute("x"))*d,c+Number(i.getAttribute("y"))*u,Number(i.getAttribute("w"))*d,Number(i.getAttribute("h"))*u);else if("image"===o){if(!t.outline){let s=this.evaluateAttribute(i,"src",t);e.image(h+Number(i.getAttribute("x"))*d,c+Number(i.getAttribute("y"))*u,Number(i.getAttribute("w"))*d,Number(i.getAttribute("h"))*u,s,!1,"1"===i.getAttribute("flipH"),"1"===i.getAttribute("flipV"))}}else if("text"===o){if(!t.outline){let s=this.evaluateTextAttribute(i,"str",t),n="1"==i.getAttribute("vertical")?-90:0;if("0"===i.getAttribute("align-shape")){let e=t.rotation,i=(null==(l=t.style)?void 0:l.flipH)??!1,s=(null==(r=t.style)?void 0:r.flipV)??!1;i&&s?n-=e:i||s?n+=e:n-=e}n-=Number(i.getAttribute("rotation")),e.text(h+Number(i.getAttribute("x"))*d,c+Number(i.getAttribute("y"))*u,0,0,s,i.getAttribute("align")||ALIGN.LEFT,i.getAttribute("valign")||ALIGN.TOP,!1,"","auto",!1,n,TEXT_DIRECTION.AUTO)}}else if("include-shape"===o){let s=StencilShapeRegistry.getStencil(i.getAttribute("name"));if(s){let n=h+Number(i.getAttribute("x"))*d,a=c+Number(i.getAttribute("y"))*u,l=Number(i.getAttribute("w"))*d,r=Number(i.getAttribute("h"))*u;s.drawShape(e,t,n,a,l,r)}}else if("fillstroke"===o)e.fillAndStroke();else if("fill"===o)e.fill();else if("stroke"===o)e.stroke();else if("strokewidth"===o){let t="1"===i.getAttribute("fixed")?1:p;e.setStrokeWidth(Number(i.getAttribute("width"))*t)}else if("dashed"===o)e.setDashed("1"===i.getAttribute("dashed"));else if("dashpattern"===o){let t=i.getAttribute("pattern");if(null!=t){let i=t.split(" "),s=[];for(let e=0;e<i.length;e+=1)i[e].length>0&&s.push(Number(i[e])*p);t=s.join(" "),e.setDashPattern(t)}}else"strokecolor"===o?e.setStrokeColor(i.getAttribute("color")):"linecap"===o?e.setLineCap(i.getAttribute("cap")):"linejoin"===o?e.setLineJoin(i.getAttribute("join")):"miterlimit"===o?e.setMiterLimit(Number(i.getAttribute("limit"))):"fillcolor"===o?e.setFillColor(i.getAttribute("color")):"alpha"===o||"fillalpha"===o||"strokealpha"===o?e.setAlpha(Number(i.getAttribute("alpha"))):"fontcolor"===o?e.setFontColor(i.getAttribute("color")):"fontstyle"===o?e.setFontStyle(Number(i.getAttribute("style"))):"fontfamily"===o?e.setFontFamily(i.getAttribute("family")):"fontsize"===o&&e.setFontSize(Number(i.getAttribute("size"))*p);n&&("fillstroke"===o||"fill"===o||"stroke"===o)&&(n=!1,e.setShadow(!1))}}}function getNavigatorLanguage(){return"undefined"!=typeof window?navigator.language:"en"}let values={defaultLanguage:"en",language:getNavigatorLanguage(),languages:[]},originalValues={};shallowCopy(values,originalValues);let resetTranslationsConfig=()=>{shallowCopy(originalValues,values)},TranslationsConfig={isEnabled(){return"none"!==this.getLanguage()},getLanguage:()=>values.language,setLanguage(e){values.language=isNullish(e)?getNavigatorLanguage():e},getLanguages:()=>values.languages,setLanguages(e){isNullish(e)||(values.languages=e)},getDefaultLanguage:()=>values.defaultLanguage,setDefaultLanguage(e){values.defaultLanguage=isNullish(e)?"en":e}};class Translations{}Translations.resources={},Translations.extension=".txt",Translations.resourcesEncoded=!1,Translations.loadDefaultBundle=!0,Translations.loadSpecialBundle=!0,Translations.isLanguageSupported=e=>{let t=TranslationsConfig.getLanguages();return!t||t.indexOf(e)>=0},Translations.getDefaultBundle=(e,t)=>Translations.loadDefaultBundle||!Translations.isLanguageSupported(t)?e+Translations.extension:null,Translations.getSpecialBundle=(e,t)=>{if(!TranslationsConfig.getLanguages()||!Translations.isLanguageSupported(t)){let e=t.indexOf("-");e>0&&(t=t.substring(0,e))}return Translations.loadSpecialBundle&&Translations.isLanguageSupported(t)&&t!=TranslationsConfig.getDefaultLanguage()?`${e}_${t}${Translations.extension}`:null},Translations.add=(e=null,t=null,i=null)=>{var s;if(t??(t=(null==(s=TranslationsConfig.getLanguage())?void 0:s.toLowerCase())??NONE),!isNullish(e)&&t!==NONE){let s=Translations.getDefaultBundle(e,t),n=Translations.getSpecialBundle(e,t),a=()=>{if(null!=n)if(i)get(n,e=>{Translations.parse(e.getText()),i()},()=>{i()});else try{let e=load(n);e.isReady()&&Translations.parse(e.getText())}catch(e){}else null!=i&&i()};if(null!=s)if(i)get(s,e=>{Translations.parse(e.getText()),a()},()=>{a()});else try{let e=load(s);e.isReady()&&Translations.parse(e.getText()),a()}catch(e){}else a()}},Translations.parse=e=>{if(null!=e){let t=e.split("\n");for(let e=0;e<t.length;e+=1)if("#"!==t[e].charAt(0)){let i=t[e].indexOf("=");if(i>0){let s=t[e].substring(0,i),n=t[e].length;13===t[e].charCodeAt(n-1)&&n--;let a=t[e].substring(i+1,n);Translations.resourcesEncoded?(a=a.replace(/\\(?=u[a-fA-F\d]{4})/g,"%"),Translations.resources[s]=unescape(a)):Translations.resources[s]=a}}}},Translations.get=(e=null,t=null,i=null)=>{let s=e?Translations.resources[e]:null;return isNullish(s)&&(s=i),!isNullish(s)&&t&&(s=Translations.replacePlaceholders(s,t)),s},Translations.replacePlaceholders=(e,t)=>{let i=[],s=null;for(let n=0;n<e.length;n+=1){let a=e.charAt(n);"{"===a?s="":null!=s&&"}"===a?((s=parseInt(s)-1)>=0&&s<t.length&&i.push(t[s]),s=null):null!=s?s+=a:i.push(a)}return i.join("")},Translations.loadResources=e=>{Translations.add(`${Client.basePath}/resources/editor`,null,()=>{Translations.add(`${Client.basePath}/resources/graph`,null,e)})};class TranslationsAsI18n{isEnabled(){return TranslationsConfig.isEnabled()}get(e,t,i){return Translations.get(e,t,i)}addResource(e,t,i){Translations.add(e,t,i)}}class Animation extends EventSource{constructor(e=20){super(),this.thread=null,this.delay=e}isRunning(){return null!=this.thread}startAnimation(){null==this.thread&&(this.thread=window.setInterval(this.updateAnimation.bind(this),this.delay))}updateAnimation(){this.fireEvent(new EventObject(InternalEvent.EXECUTE))}stopAnimation(){null!=this.thread&&(window.clearInterval(this.thread),this.thread=null,this.fireEvent(new EventObject(InternalEvent.DONE)))}}class Effects{static animateChanges(e,t,i){let s=10,n=0,a=()=>{let r=!1;for(let i=0;i<t.length;i+=1){let a=t[i];if(a instanceof GeometryChange||a instanceof TerminalChange||a instanceof ValueChange||a instanceof ChildChange||a instanceof StyleChange){let t=e.getView().getState(a.cell||a.child,!1);if(null!=t)if(r=!0,a.constructor!==GeometryChange||a.cell.isEdge())setOpacity(t.shape.node,100*n/s);else{let{scale:i}=e.getView(),l=a.geometry,r=a.previous,o=(l.x-r.x)*i,h=(l.y-r.y)*i,c=(l.width-r.width)*i,d=(l.height-r.height)*i;0===n?(t.x-=o,t.y-=h,t.width-=c,t.height-=d):(t.x+=o/s,t.y+=h/s,t.width+=c/s,t.height+=d/s),e.cellRenderer.redraw(t),Effects.cascadeOpacity(e,a.cell,100*n/s)}}}n<s&&r?(n++,window.setTimeout(a,l)):null!=i&&i()},l=30;a()}static cascadeOpacity(e,t,i){let s=t.getChildCount();for(let n=0;n<s;n+=1){let s=t.getChildAt(n),a=e.getView().getState(s);null!=a&&(setOpacity(a.shape.node,i),Effects.cascadeOpacity(e,s,i))}let n=t.getEdges();if(null!=n)for(let t=0;t<n.length;t+=1){let s=e.getView().getState(n[t]);null!=s&&setOpacity(s.shape.node,i)}}static fadeOut(e,t,i,s,n,a){s=s||40,n=n||30;let l=t||100;if(setOpacity(e,l),a||null==a){let t=()=>{setOpacity(e,l=Math.max(l-s,0)),l>0?window.setTimeout(t,n):(e.style.visibility="hidden",i&&e.parentNode&&e.parentNode.removeChild(e))};window.setTimeout(t,n)}else e.style.visibility="hidden",i&&e.parentNode&&e.parentNode.removeChild(e)}}class CellStatePreview{constructor(e){this.count=0,this.deltas=new Dictionary,this.graph=e}isEmpty(){return 0===this.count}moveState(e,t,i,s=!0,n=!0){let a=this.deltas.get(e.cell);return null==a?(a={point:new Point(t,i),state:e},this.deltas.put(e.cell,a),this.count++):s?(a.point.x+=t,a.point.y+=i):(a.point.x=t,a.point.y=i),n&&this.addEdges(e),a.point}show(e=null){this.deltas.visit((e,t)=>{this.translateState(t.state,t.point.x,t.point.y)}),this.deltas.visit((t,i)=>{this.revalidateState(i.state,i.point.x,i.point.y,e)})}translateState(e,t,i){if(null!=e){if(e.cell.isVertex()){e.view.updateCellState(e);let s=e.cell.getGeometry();0===t&&0===i||null==s||s.relative&&null==this.deltas.get(e.cell)||(e.x+=t,e.y+=i)}for(let s of e.cell.getChildren())this.translateState(e.view.getState(s),t,i)}}revalidateState(e,t,i,s=null){e.cell.isEdge()&&e.view.updateCellState(e);let n=e.cell.getGeometry(),a=e.view.getState(e.cell.getParent());for(let l of((0!==t||0!==i)&&null!=n&&n.relative&&e.cell.isVertex()&&(null==a||a.cell.isVertex()||null!=this.deltas.get(e.cell))&&(e.x+=t,e.y+=i),this.graph.cellRenderer.redraw(e),null!=s&&s(e),e.cell.getChildren()))this.revalidateState(this.graph.view.getState(l),t,i,s)}addEdges(e){let t=e.cell.getEdgeCount();for(let i=0;i<t;i+=1){let t=e.view.getState(e.cell.getEdgeAt(i));null!=t&&this.moveState(t,0,0)}}}class Morphing extends Animation{constructor(e,t=6,i=1.5,s){super(s),this.step=0,this.cells=null,this.graph=e,this.steps=t,this.ease=i}updateAnimation(){super.updateAnimation();let e=new CellStatePreview(this.graph);if(null!=this.cells)for(let t of this.cells)this.animateCell(t,e,!1);else this.animateCell(this.graph.getDataModel().getRoot(),e,!0);this.show(e),(e.isEmpty()||this.step++>=this.steps)&&this.stopAnimation()}show(e){e.show()}animateCell(e,t,i=!1){let s=this.graph.getView().getState(e),n=null;if(null!=s&&(n=this.getDelta(s),e.isVertex()&&(0!=n.x||0!=n.y))){let e=this.graph.view.getTranslate(),i=this.graph.view.getScale();n.x+=e.x*i,n.y+=e.y*i,t.moveState(s,-n.x/this.ease,-n.y/this.ease)}if(i&&!this.stopRecursion(s,n)){let s=e.getChildCount();for(let n=0;n<s;n+=1)this.animateCell(e.getChildAt(n),t,i)}}stopRecursion(e=null,t=null){return null!=t&&(0!=t.x||0!=t.y)}getDelta(e){let t=this.getOriginForCell(e.cell),i=this.graph.getView().getTranslate(),s=this.graph.getView().getScale(),n=e.x/s-i.x,a=e.y/s-i.y;return new Point((t.x-n)*s,(t.y-a)*s)}getOriginForCell(e=null){let t=null;if(null!=e){let i=e.getParent(),s=e.getGeometry();if(t=this.getOriginForCell(i),null!=s&&null!=i)if(s.relative){let e=i.getGeometry();null!=e&&(t.x+=s.x*e.width,t.y+=s.y*e.height)}else t.x+=s.x,t.y+=s.y}if(null==t){let e=this.graph.view.getTranslate();t=new Point(-e.x,-e.y)}return t}}class XmlCanvas2D extends AbstractCanvas2D{constructor(e){super(),this.textEnabled=!0,this.compressed=!0,this.root=e,this.writeDefaults()}writeDefaults(){let e;(e=this.createElement("fontfamily")).setAttribute("family",DEFAULT_FONTFAMILY),this.root.appendChild(e),(e=this.createElement("fontsize")).setAttribute("size",String(DEFAULT_FONTSIZE)),this.root.appendChild(e),(e=this.createElement("shadowcolor")).setAttribute("color",StyleDefaultsConfig.shadowColor),this.root.appendChild(e),(e=this.createElement("shadowalpha")).setAttribute("alpha",String(StyleDefaultsConfig.shadowOpacity)),this.root.appendChild(e),(e=this.createElement("shadowoffset")).setAttribute("dx",String(StyleDefaultsConfig.shadowOffsetX)),e.setAttribute("dy",String(StyleDefaultsConfig.shadowOffsetY)),this.root.appendChild(e)}format(e){return"string"==typeof e?parseFloat(parseFloat(e).toFixed(2)):parseFloat(e.toFixed(2))}createElement(e){return this.root.ownerDocument.createElement(e)}save(){this.compressed&&super.save(),this.root.appendChild(this.createElement("save"))}restore(){this.compressed&&super.restore(),this.root.appendChild(this.createElement("restore"))}scale(e){let t=this.createElement("scale");t.setAttribute("scale",String(e)),this.root.appendChild(t)}translate(e,t){let i=this.createElement("translate");i.setAttribute("dx",String(this.format(e))),i.setAttribute("dy",String(this.format(t))),this.root.appendChild(i)}rotate(e,t,i,s,n){let a=this.createElement("rotate");(0!==e||t||i)&&(a.setAttribute("theta",String(this.format(e))),a.setAttribute("flipH",t?"1":"0"),a.setAttribute("flipV",i?"1":"0"),a.setAttribute("cx",String(this.format(s))),a.setAttribute("cy",String(this.format(n))),this.root.appendChild(a))}setAlpha(e){if(this.compressed){if(this.state.alpha===e)return;super.setAlpha(e)}let t=this.createElement("alpha");t.setAttribute("alpha",String(this.format(e))),this.root.appendChild(t)}setFillAlpha(e){if(this.compressed){if(this.state.fillAlpha===e)return;super.setFillAlpha(e)}let t=this.createElement("fillalpha");t.setAttribute("alpha",String(this.format(e))),this.root.appendChild(t)}setStrokeAlpha(e){if(this.compressed){if(this.state.strokeAlpha===e)return;super.setStrokeAlpha(e)}let t=this.createElement("strokealpha");t.setAttribute("alpha",String(this.format(e))),this.root.appendChild(t)}setFillColor(e=null){if(e===NONE&&(e=null),this.compressed){if(this.state.fillColor===e)return;super.setFillColor(e)}let t=this.createElement("fillcolor");t.setAttribute("color",null!=e?e:NONE),this.root.appendChild(t)}setGradient(e,t,i,s,n,a,l,r=1,o=1){if(null!=e&&null!=t){super.setGradient(e,t,i,s,n,a,l,r,o);let h=this.createElement("gradient");h.setAttribute("c1",e),h.setAttribute("c2",t),h.setAttribute("x",String(this.format(i))),h.setAttribute("y",String(this.format(s))),h.setAttribute("w",String(this.format(n))),h.setAttribute("h",String(this.format(a))),null!=l&&h.setAttribute("direction",l),null!=r&&h.setAttribute("alpha1",String(r)),null!=o&&h.setAttribute("alpha2",String(o)),this.root.appendChild(h)}}setStrokeColor(e=null){if(e===NONE&&(e=null),this.compressed){if(this.state.strokeColor===e)return;super.setStrokeColor(e)}let t=this.createElement("strokecolor");t.setAttribute("color",null!=e?e:NONE),this.root.appendChild(t)}setStrokeWidth(e){if(this.compressed){if(this.state.strokeWidth===e)return;super.setStrokeWidth(e)}let t=this.createElement("strokewidth");t.setAttribute("width",String(this.format(e))),this.root.appendChild(t)}setDashed(e,t){if(this.compressed){if(this.state.dashed===e)return;super.setDashed(e,t)}let i=this.createElement("dashed");i.setAttribute("dashed",e?"1":"0"),null!=t&&i.setAttribute("fixDash",t?"1":"0"),this.root.appendChild(i)}setDashPattern(e){if(this.compressed){if(this.state.dashPattern===e)return;super.setDashPattern(e)}let t=this.createElement("dashpattern");t.setAttribute("pattern",e),this.root.appendChild(t)}setLineCap(e){if(this.compressed){if(this.state.lineCap===e)return;super.setLineCap(e)}let t=this.createElement("linecap");t.setAttribute("cap",e),this.root.appendChild(t)}setLineJoin(e){if(this.compressed){if(this.state.lineJoin===e)return;super.setLineJoin(e)}let t=this.createElement("linejoin");t.setAttribute("join",e),this.root.appendChild(t)}setMiterLimit(e){if(this.compressed){if(this.state.miterLimit===e)return;super.setMiterLimit(e)}let t=this.createElement("miterlimit");t.setAttribute("limit",String(e)),this.root.appendChild(t)}setFontColor(e=null){if(this.textEnabled){if(e===NONE&&(e=null),this.compressed){if(this.state.fontColor===e)return;super.setFontColor(e)}let t=this.createElement("fontcolor");t.setAttribute("color",null!=e?e:NONE),this.root.appendChild(t)}}setFontBackgroundColor(e=null){if(this.textEnabled){if(e===NONE&&(e=null),this.compressed){if(this.state.fontBackgroundColor===e)return;super.setFontBackgroundColor(e)}let t=this.createElement("fontbackgroundcolor");t.setAttribute("color",null!=e?e:NONE),this.root.appendChild(t)}}setFontBorderColor(e=null){if(this.textEnabled){if(e===NONE&&(e=null),this.compressed){if(this.state.fontBorderColor===e)return;super.setFontBorderColor(e)}let t=this.createElement("fontbordercolor");t.setAttribute("color",null!=e?e:NONE),this.root.appendChild(t)}}setFontSize(e){if(this.textEnabled){if(this.compressed){if(this.state.fontSize===e)return;super.setFontSize(e)}let t=this.createElement("fontsize");t.setAttribute("size",String(e)),this.root.appendChild(t)}}setFontFamily(e){if(this.textEnabled){if(this.compressed){if(this.state.fontFamily===e)return;super.setFontFamily(e)}let t=this.createElement("fontfamily");t.setAttribute("family",e),this.root.appendChild(t)}}setFontStyle(e=0){if(this.textEnabled){if(null==e&&(e=0),this.compressed){if(this.state.fontStyle===e)return;super.setFontStyle(e)}let t=this.createElement("fontstyle");t.setAttribute("style",String(e)),this.root.appendChild(t)}}setShadow(e){if(this.compressed){if(this.state.shadow===e)return;super.setShadow(e)}let t=this.createElement("shadow");t.setAttribute("enabled",e?"1":"0"),this.root.appendChild(t)}setShadowColor(e=null){if(this.compressed){if(e===NONE&&(e=null),this.state.shadowColor===e)return;super.setShadowColor(e)}let t=this.createElement("shadowcolor");t.setAttribute("color",null!=e?e:NONE),this.root.appendChild(t)}setShadowAlpha(e){if(this.compressed){if(this.state.shadowAlpha===e)return;super.setShadowAlpha(e)}let t=this.createElement("shadowalpha");t.setAttribute("alpha",String(e)),this.root.appendChild(t)}setShadowOffset(e,t){if(this.compressed){if(this.state.shadowDx===e&&this.state.shadowDy===t)return;super.setShadowOffset(e,t)}let i=this.createElement("shadowoffset");i.setAttribute("dx",String(e)),i.setAttribute("dy",String(t)),this.root.appendChild(i)}rect(e,t,i,s){let n=this.createElement("rect");n.setAttribute("x",String(this.format(e))),n.setAttribute("y",String(this.format(t))),n.setAttribute("w",String(this.format(i))),n.setAttribute("h",String(this.format(s))),this.root.appendChild(n)}roundrect(e,t,i,s,n,a){let l=this.createElement("roundrect");l.setAttribute("x",String(this.format(e))),l.setAttribute("y",String(this.format(t))),l.setAttribute("w",String(this.format(i))),l.setAttribute("h",String(this.format(s))),l.setAttribute("dx",String(this.format(n))),l.setAttribute("dy",String(this.format(a))),this.root.appendChild(l)}ellipse(e,t,i,s){let n=this.createElement("ellipse");n.setAttribute("x",String(this.format(e))),n.setAttribute("y",String(this.format(t))),n.setAttribute("w",String(this.format(i))),n.setAttribute("h",String(this.format(s))),this.root.appendChild(n)}image(e,t,i,s,n,a=!0,l=!1,r=!1){n=this.converter.convert(n);let o=this.createElement("image");o.setAttribute("x",String(this.format(e))),o.setAttribute("y",String(this.format(t))),o.setAttribute("w",String(this.format(i))),o.setAttribute("h",String(this.format(s))),o.setAttribute("src",n),o.setAttribute("aspect",a?"1":"0"),o.setAttribute("flipH",l?"1":"0"),o.setAttribute("flipV",r?"1":"0"),this.root.appendChild(o)}updateText(){}begin(){this.root.appendChild(this.createElement("begin")),this.lastX=0,this.lastY=0}end(){}moveTo(e,t){let i=this.createElement("move");i.setAttribute("x",String(this.format(e))),i.setAttribute("y",String(this.format(t))),this.root.appendChild(i),this.lastX=e,this.lastY=t}lineTo(e,t){let i=this.createElement("line");i.setAttribute("x",String(this.format(e))),i.setAttribute("y",String(this.format(t))),this.root.appendChild(i),this.lastX=e,this.lastY=t}quadTo(e,t,i,s){let n=this.createElement("quad");n.setAttribute("x1",String(this.format(e))),n.setAttribute("y1",String(this.format(t))),n.setAttribute("x2",String(this.format(i))),n.setAttribute("y2",String(this.format(s))),this.root.appendChild(n),this.lastX=i,this.lastY=s}curveTo(e,t,i,s,n,a){let l=this.createElement("curve");l.setAttribute("x1",String(this.format(e))),l.setAttribute("y1",String(this.format(t))),l.setAttribute("x2",String(this.format(i))),l.setAttribute("y2",String(this.format(s))),l.setAttribute("x3",String(this.format(n))),l.setAttribute("y3",String(this.format(a))),this.root.appendChild(l),this.lastX=n,this.lastY=a}close(){this.root.appendChild(this.createElement("close"))}text(e,t,i,s,n,a=null,l=null,r=null,o=null,h=null,c=null,d=null,u=null){if(this.textEnabled&&null!=n){isNode(n)&&(n=getOuterHtml(n));let p=this.createElement("text");p.setAttribute("x",String(this.format(e))),p.setAttribute("y",String(this.format(t))),p.setAttribute("w",String(this.format(i))),p.setAttribute("h",String(this.format(s))),p.setAttribute("str",n),null!=a&&p.setAttribute("align",a),null!=l&&p.setAttribute("valign",l),p.setAttribute("wrap",r?"1":"0"),null==o&&(o=""),p.setAttribute("format",o),null!=h&&p.setAttribute("overflow",h),null!=c&&p.setAttribute("clip",c?"1":"0"),null!=d&&p.setAttribute("rotation",String(d)),null!=u&&p.setAttribute("dir",u),this.root.appendChild(p)}}stroke(){this.root.appendChild(this.createElement("stroke"))}fill(){this.root.appendChild(this.createElement("fill"))}fillAndStroke(){this.root.appendChild(this.createElement("fillstroke"))}}let linkAction=(e,t,i,s,n=0)=>link(e,t,()=>{i.execute(s)},n),linkInvoke=(e,t,i,s,n,a=0)=>link(e,t,()=>{i[s](n)},a),link=(e,t,i,s=0)=>{let n=document.createElement("span");return n.style.color="blue",n.style.textDecoration="underline",n.style.cursor="pointer",n.style.paddingLeft=`${s}px`,InternalEvent.addListener(n,"click",i),write(n,t),null!=e&&e.appendChild(n),n},button=(e,t,i=null)=>{let s=(i=null!=i?i:document).createElement("button");return write(s,e),InternalEvent.addListener(s,"click",e=>{t(e)}),s},domHelpers=Object.freeze(Object.defineProperty({__proto__:null,button:button,link:link,linkAction:linkAction,linkInvoke:linkInvoke},Symbol.toStringTag,{value:"Module"}));class MaxLogAsLogger{enter(e){return MaxLog.enter(e)}leave(e,t){MaxLog.leave(e,t)}show(){MaxLog.show()}info(e){MaxLog.writeln(e)}debug(e){MaxLog.debug(e)}error(e,...t){let i=null==t?void 0:t.map(e=>String(e));MaxLog.writeln(`[ERROR] ${e}`,...i)}trace(e){MaxLog.trace(e)}warn(e){MaxLog.warn(e)}}class ImageBundle{constructor(e=!1){this.images={},this.alt=e}putImage(e,t,i){this.images[e]={value:t,fallback:i}}getImage(e){let t=null;if(e){let i=this.images[e];i&&(t=this.alt?i.fallback:i.value)}return t}}class ImageExport{constructor(){this.includeOverlays=!1}drawState(e,t){e&&(this.visitStatesRecursive(e,t,this.drawCellState.bind(this)),this.includeOverlays&&this.visitStatesRecursive(e,t,this.drawOverlays.bind(this)))}visitStatesRecursive(e,t,i){if(e){i(e,t);let s=e.view.graph,n=e.cell.getChildCount();for(let a=0;a<n;a+=1){let n=s.view.getState(e.cell.getChildAt(a));n&&this.visitStatesRecursive(n,t,i)}}}getLinkForCellState(e,t){return null}drawCellState(e,t){let i=this.getLinkForCellState(e,t);i&&t.setLink(i),this.drawShape(e,t),this.drawText(e,t),i&&t.setLink(null)}drawShape(e,t){e.shape instanceof Shape&&e.shape.checkBounds()&&(t.save(),e.shape.beforePaint(t),e.shape.paint(t),e.shape.afterPaint(t),t.restore())}drawText(e,t){e.text&&e.text.checkBounds()&&(t.save(),e.text.beforePaint(t),e.text.paint(t),e.text.afterPaint(t),t.restore())}drawOverlays(e,t){null!=e.overlays&&e.overlays.visit((e,i)=>{i instanceof Shape&&i.paint(t)})}}class AutoSaveManager extends EventSource{constructor(e){super(),this.graph=null,this.autoSaveDelay=10,this.autoSaveThrottle=2,this.autoSaveThreshold=5,this.ignoredChanges=0,this.lastSnapshot=0,this.enabled=!0,this.changeHandler=(e,t)=>{this.isEnabled()&&this.graphModelChanged(t.getProperty("edit").changes)},this.setGraph(e)}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}setGraph(e){null!=this.graph&&this.graph.getDataModel().removeListener(this.changeHandler),this.graph=e,null!=this.graph&&this.graph.getDataModel().addListener(InternalEvent.CHANGE,this.changeHandler)}save(){}graphModelChanged(e){let t=(new Date().getTime()-this.lastSnapshot)/1e3;t>this.autoSaveDelay||this.ignoredChanges>=this.autoSaveThreshold&&t>this.autoSaveThrottle?(this.save(),this.reset()):this.ignoredChanges++}reset(){this.lastSnapshot=new Date().getTime(),this.ignoredChanges=0}destroy(){this.setGraph(null)}}class Multiplicity{constructor(e,t,i,s,n,a,l,r,o,h=!0){this.validNeighborsAllowed=!0,this.source=e,this.type=t,this.attr=i,this.value=s,this.min=n??0,this.max=a??Number.MAX_VALUE,this.validNeighbors=l,this.countError=translate(r)||r,this.typeError=translate(o)||o,this.validNeighborsAllowed=h}check(e,t,i,s,n,a){let l="";return(this.source&&this.checkTerminal(e,i,t)||!this.source&&this.checkTerminal(e,s,t))&&(null!=this.countError&&(this.source&&(0===this.max||n>=this.max)||!this.source&&(0===this.max||a>=this.max))&&(l+=`${this.countError}
`),null!=this.validNeighbors&&null!=this.typeError&&this.validNeighbors.length>0&&(this.checkNeighbors(e,t,i,s)||(l+=`${this.typeError}
`))),l.length>0?l:null}checkNeighbors(e,t,i,s){let n=i.getValue(),a=s.getValue(),l=!this.validNeighborsAllowed,r=this.validNeighbors;for(let t=0;t<r.length;t++)if(this.source&&this.checkType(e,a,r[t])){l=this.validNeighborsAllowed;break}else if(!this.source&&this.checkType(e,n,r[t])){l=this.validNeighborsAllowed;break}return l}checkTerminal(e,t,i){let s=(null==i?void 0:i.getValue())??null;return this.checkType(e,s,this.type,this.attr,this.value)}checkType(e,t,i,s,n){return null!=t&&("string"!=typeof t&&"nodeType"in t&&!Number.isNaN(t.nodeType)?isNode(t,i,s,n):t===i)}}function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var mimeTypes={};let require$$0={"application/1d-interleaved-parityfec":{source:"iana"},"application/3gpdash-qoe-report+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/3gpp-ims+xml":{source:"iana",compressible:!0},"application/3gpphal+json":{source:"iana",compressible:!0},"application/3gpphalforms+json":{source:"iana",compressible:!0},"application/a2l":{source:"iana"},"application/ace+cbor":{source:"iana"},"application/ace+json":{source:"iana",compressible:!0},"application/ace-groupcomm+cbor":{source:"iana"},"application/ace-trl+cbor":{source:"iana"},"application/activemessage":{source:"iana"},"application/activity+json":{source:"iana",compressible:!0},"application/aif+cbor":{source:"iana"},"application/aif+json":{source:"iana",compressible:!0},"application/alto-cdni+json":{source:"iana",compressible:!0},"application/alto-cdnifilter+json":{source:"iana",compressible:!0},"application/alto-costmap+json":{source:"iana",compressible:!0},"application/alto-costmapfilter+json":{source:"iana",compressible:!0},"application/alto-directory+json":{source:"iana",compressible:!0},"application/alto-endpointcost+json":{source:"iana",compressible:!0},"application/alto-endpointcostparams+json":{source:"iana",compressible:!0},"application/alto-endpointprop+json":{source:"iana",compressible:!0},"application/alto-endpointpropparams+json":{source:"iana",compressible:!0},"application/alto-error+json":{source:"iana",compressible:!0},"application/alto-networkmap+json":{source:"iana",compressible:!0},"application/alto-networkmapfilter+json":{source:"iana",compressible:!0},"application/alto-propmap+json":{source:"iana",compressible:!0},"application/alto-propmapparams+json":{source:"iana",compressible:!0},"application/alto-tips+json":{source:"iana",compressible:!0},"application/alto-tipsparams+json":{source:"iana",compressible:!0},"application/alto-updatestreamcontrol+json":{source:"iana",compressible:!0},"application/alto-updatestreamparams+json":{source:"iana",compressible:!0},"application/aml":{source:"iana"},"application/andrew-inset":{source:"iana",extensions:["ez"]},"application/appinstaller":{compressible:!1,extensions:["appinstaller"]},"application/applefile":{source:"iana"},"application/applixware":{source:"apache",extensions:["aw"]},"application/appx":{compressible:!1,extensions:["appx"]},"application/appxbundle":{compressible:!1,extensions:["appxbundle"]},"application/at+jwt":{source:"iana"},"application/atf":{source:"iana"},"application/atfx":{source:"iana"},"application/atom+xml":{source:"iana",compressible:!0,extensions:["atom"]},"application/atomcat+xml":{source:"iana",compressible:!0,extensions:["atomcat"]},"application/atomdeleted+xml":{source:"iana",compressible:!0,extensions:["atomdeleted"]},"application/atomicmail":{source:"iana"},"application/atomsvc+xml":{source:"iana",compressible:!0,extensions:["atomsvc"]},"application/atsc-dwd+xml":{source:"iana",compressible:!0,extensions:["dwd"]},"application/atsc-dynamic-event-message":{source:"iana"},"application/atsc-held+xml":{source:"iana",compressible:!0,extensions:["held"]},"application/atsc-rdt+json":{source:"iana",compressible:!0},"application/atsc-rsat+xml":{source:"iana",compressible:!0,extensions:["rsat"]},"application/atxml":{source:"iana"},"application/auth-policy+xml":{source:"iana",compressible:!0},"application/automationml-aml+xml":{source:"iana",compressible:!0,extensions:["aml"]},"application/automationml-amlx+zip":{source:"iana",compressible:!1,extensions:["amlx"]},"application/bacnet-xdd+zip":{source:"iana",compressible:!1},"application/batch-smtp":{source:"iana"},"application/bdoc":{compressible:!1,extensions:["bdoc"]},"application/beep+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/bufr":{source:"iana"},"application/c2pa":{source:"iana"},"application/calendar+json":{source:"iana",compressible:!0},"application/calendar+xml":{source:"iana",compressible:!0,extensions:["xcs"]},"application/call-completion":{source:"iana"},"application/cals-1840":{source:"iana"},"application/captive+json":{source:"iana",compressible:!0},"application/cbor":{source:"iana"},"application/cbor-seq":{source:"iana"},"application/cccex":{source:"iana"},"application/ccmp+xml":{source:"iana",compressible:!0},"application/ccxml+xml":{source:"iana",compressible:!0,extensions:["ccxml"]},"application/cda+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/cdfx+xml":{source:"iana",compressible:!0,extensions:["cdfx"]},"application/cdmi-capability":{source:"iana",extensions:["cdmia"]},"application/cdmi-container":{source:"iana",extensions:["cdmic"]},"application/cdmi-domain":{source:"iana",extensions:["cdmid"]},"application/cdmi-object":{source:"iana",extensions:["cdmio"]},"application/cdmi-queue":{source:"iana",extensions:["cdmiq"]},"application/cdni":{source:"iana"},"application/ce+cbor":{source:"iana"},"application/cea":{source:"iana"},"application/cea-2018+xml":{source:"iana",compressible:!0},"application/cellml+xml":{source:"iana",compressible:!0},"application/cfw":{source:"iana"},"application/cid-edhoc+cbor-seq":{source:"iana"},"application/city+json":{source:"iana",compressible:!0},"application/city+json-seq":{source:"iana"},"application/clr":{source:"iana"},"application/clue+xml":{source:"iana",compressible:!0},"application/clue_info+xml":{source:"iana",compressible:!0},"application/cms":{source:"iana"},"application/cnrp+xml":{source:"iana",compressible:!0},"application/coap-eap":{source:"iana"},"application/coap-group+json":{source:"iana",compressible:!0},"application/coap-payload":{source:"iana"},"application/commonground":{source:"iana"},"application/concise-problem-details+cbor":{source:"iana"},"application/conference-info+xml":{source:"iana",compressible:!0},"application/cose":{source:"iana"},"application/cose-key":{source:"iana"},"application/cose-key-set":{source:"iana"},"application/cose-x509":{source:"iana"},"application/cpl+xml":{source:"iana",compressible:!0,extensions:["cpl"]},"application/csrattrs":{source:"iana"},"application/csta+xml":{source:"iana",compressible:!0},"application/cstadata+xml":{source:"iana",compressible:!0},"application/csvm+json":{source:"iana",compressible:!0},"application/cu-seeme":{source:"apache",extensions:["cu"]},"application/cwl":{source:"iana",extensions:["cwl"]},"application/cwl+json":{source:"iana",compressible:!0},"application/cwl+yaml":{source:"iana"},"application/cwt":{source:"iana"},"application/cybercash":{source:"iana"},"application/dart":{compressible:!0},"application/dash+xml":{source:"iana",compressible:!0,extensions:["mpd"]},"application/dash-patch+xml":{source:"iana",compressible:!0,extensions:["mpp"]},"application/dashdelta":{source:"iana"},"application/davmount+xml":{source:"iana",compressible:!0,extensions:["davmount"]},"application/dca-rft":{source:"iana"},"application/dcd":{source:"iana"},"application/dec-dx":{source:"iana"},"application/dialog-info+xml":{source:"iana",compressible:!0},"application/dicom":{source:"iana",extensions:["dcm"]},"application/dicom+json":{source:"iana",compressible:!0},"application/dicom+xml":{source:"iana",compressible:!0},"application/dii":{source:"iana"},"application/dit":{source:"iana"},"application/dns":{source:"iana"},"application/dns+json":{source:"iana",compressible:!0},"application/dns-message":{source:"iana"},"application/docbook+xml":{source:"apache",compressible:!0,extensions:["dbk"]},"application/dots+cbor":{source:"iana"},"application/dpop+jwt":{source:"iana"},"application/dskpp+xml":{source:"iana",compressible:!0},"application/dssc+der":{source:"iana",extensions:["dssc"]},"application/dssc+xml":{source:"iana",compressible:!0,extensions:["xdssc"]},"application/dvcs":{source:"iana"},"application/eat+cwt":{source:"iana"},"application/eat+jwt":{source:"iana"},"application/eat-bun+cbor":{source:"iana"},"application/eat-bun+json":{source:"iana",compressible:!0},"application/eat-ucs+cbor":{source:"iana"},"application/eat-ucs+json":{source:"iana",compressible:!0},"application/ecmascript":{source:"apache",compressible:!0,extensions:["ecma"]},"application/edhoc+cbor-seq":{source:"iana"},"application/edi-consent":{source:"iana"},"application/edi-x12":{source:"iana",compressible:!1},"application/edifact":{source:"iana",compressible:!1},"application/efi":{source:"iana"},"application/elm+json":{source:"iana",charset:"UTF-8",compressible:!0},"application/elm+xml":{source:"iana",compressible:!0},"application/emergencycalldata.cap+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/emergencycalldata.comment+xml":{source:"iana",compressible:!0},"application/emergencycalldata.control+xml":{source:"iana",compressible:!0},"application/emergencycalldata.deviceinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.ecall.msd":{source:"iana"},"application/emergencycalldata.legacyesn+json":{source:"iana",compressible:!0},"application/emergencycalldata.providerinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.serviceinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.subscriberinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.veds+xml":{source:"iana",compressible:!0},"application/emma+xml":{source:"iana",compressible:!0,extensions:["emma"]},"application/emotionml+xml":{source:"iana",compressible:!0,extensions:["emotionml"]},"application/encaprtp":{source:"iana"},"application/entity-statement+jwt":{source:"iana"},"application/epp+xml":{source:"iana",compressible:!0},"application/epub+zip":{source:"iana",compressible:!1,extensions:["epub"]},"application/eshop":{source:"iana"},"application/exi":{source:"iana",extensions:["exi"]},"application/expect-ct-report+json":{source:"iana",compressible:!0},"application/express":{source:"iana",extensions:["exp"]},"application/fastinfoset":{source:"iana"},"application/fastsoap":{source:"iana"},"application/fdf":{source:"iana",extensions:["fdf"]},"application/fdt+xml":{source:"iana",compressible:!0,extensions:["fdt"]},"application/fhir+json":{source:"iana",charset:"UTF-8",compressible:!0},"application/fhir+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/fido.trusted-apps+json":{compressible:!0},"application/fits":{source:"iana"},"application/flexfec":{source:"iana"},"application/font-sfnt":{source:"iana"},"application/font-tdpfr":{source:"iana",extensions:["pfr"]},"application/font-woff":{source:"iana",compressible:!1},"application/framework-attributes+xml":{source:"iana",compressible:!0},"application/geo+json":{source:"iana",compressible:!0,extensions:["geojson"]},"application/geo+json-seq":{source:"iana"},"application/geopackage+sqlite3":{source:"iana"},"application/geopose+json":{source:"iana",compressible:!0},"application/geoxacml+json":{source:"iana",compressible:!0},"application/geoxacml+xml":{source:"iana",compressible:!0},"application/gltf-buffer":{source:"iana"},"application/gml+xml":{source:"iana",compressible:!0,extensions:["gml"]},"application/gnap-binding-jws":{source:"iana"},"application/gnap-binding-jwsd":{source:"iana"},"application/gnap-binding-rotation-jws":{source:"iana"},"application/gnap-binding-rotation-jwsd":{source:"iana"},"application/gpx+xml":{source:"apache",compressible:!0,extensions:["gpx"]},"application/grib":{source:"iana"},"application/gxf":{source:"apache",extensions:["gxf"]},"application/gzip":{source:"iana",compressible:!1,extensions:["gz"]},"application/h224":{source:"iana"},"application/held+xml":{source:"iana",compressible:!0},"application/hjson":{extensions:["hjson"]},"application/hl7v2+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/http":{source:"iana"},"application/hyperstudio":{source:"iana",extensions:["stk"]},"application/ibe-key-request+xml":{source:"iana",compressible:!0},"application/ibe-pkg-reply+xml":{source:"iana",compressible:!0},"application/ibe-pp-data":{source:"iana"},"application/iges":{source:"iana"},"application/im-iscomposing+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/index":{source:"iana"},"application/index.cmd":{source:"iana"},"application/index.obj":{source:"iana"},"application/index.response":{source:"iana"},"application/index.vnd":{source:"iana"},"application/inkml+xml":{source:"iana",compressible:!0,extensions:["ink","inkml"]},"application/iotp":{source:"iana"},"application/ipfix":{source:"iana",extensions:["ipfix"]},"application/ipp":{source:"iana"},"application/isup":{source:"iana"},"application/its+xml":{source:"iana",compressible:!0,extensions:["its"]},"application/java-archive":{source:"iana",compressible:!1,extensions:["jar","war","ear"]},"application/java-serialized-object":{source:"apache",compressible:!1,extensions:["ser"]},"application/java-vm":{source:"apache",compressible:!1,extensions:["class"]},"application/javascript":{source:"apache",charset:"UTF-8",compressible:!0,extensions:["js"]},"application/jf2feed+json":{source:"iana",compressible:!0},"application/jose":{source:"iana"},"application/jose+json":{source:"iana",compressible:!0},"application/jrd+json":{source:"iana",compressible:!0},"application/jscalendar+json":{source:"iana",compressible:!0},"application/jscontact+json":{source:"iana",compressible:!0},"application/json":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["json","map"]},"application/json-patch+json":{source:"iana",compressible:!0},"application/json-seq":{source:"iana"},"application/json5":{extensions:["json5"]},"application/jsonml+json":{source:"apache",compressible:!0,extensions:["jsonml"]},"application/jsonpath":{source:"iana"},"application/jwk+json":{source:"iana",compressible:!0},"application/jwk-set+json":{source:"iana",compressible:!0},"application/jwk-set+jwt":{source:"iana"},"application/jwt":{source:"iana"},"application/kpml-request+xml":{source:"iana",compressible:!0},"application/kpml-response+xml":{source:"iana",compressible:!0},"application/ld+json":{source:"iana",compressible:!0,extensions:["jsonld"]},"application/lgr+xml":{source:"iana",compressible:!0,extensions:["lgr"]},"application/link-format":{source:"iana"},"application/linkset":{source:"iana"},"application/linkset+json":{source:"iana",compressible:!0},"application/load-control+xml":{source:"iana",compressible:!0},"application/logout+jwt":{source:"iana"},"application/lost+xml":{source:"iana",compressible:!0,extensions:["lostxml"]},"application/lostsync+xml":{source:"iana",compressible:!0},"application/lpf+zip":{source:"iana",compressible:!1},"application/lxf":{source:"iana"},"application/mac-binhex40":{source:"iana",extensions:["hqx"]},"application/mac-compactpro":{source:"apache",extensions:["cpt"]},"application/macwriteii":{source:"iana"},"application/mads+xml":{source:"iana",compressible:!0,extensions:["mads"]},"application/manifest+json":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["webmanifest"]},"application/marc":{source:"iana",extensions:["mrc"]},"application/marcxml+xml":{source:"iana",compressible:!0,extensions:["mrcx"]},"application/mathematica":{source:"iana",extensions:["ma","nb","mb"]},"application/mathml+xml":{source:"iana",compressible:!0,extensions:["mathml"]},"application/mathml-content+xml":{source:"iana",compressible:!0},"application/mathml-presentation+xml":{source:"iana",compressible:!0},"application/mbms-associated-procedure-description+xml":{source:"iana",compressible:!0},"application/mbms-deregister+xml":{source:"iana",compressible:!0},"application/mbms-envelope+xml":{source:"iana",compressible:!0},"application/mbms-msk+xml":{source:"iana",compressible:!0},"application/mbms-msk-response+xml":{source:"iana",compressible:!0},"application/mbms-protection-description+xml":{source:"iana",compressible:!0},"application/mbms-reception-report+xml":{source:"iana",compressible:!0},"application/mbms-register+xml":{source:"iana",compressible:!0},"application/mbms-register-response+xml":{source:"iana",compressible:!0},"application/mbms-schedule+xml":{source:"iana",compressible:!0},"application/mbms-user-service-description+xml":{source:"iana",compressible:!0},"application/mbox":{source:"iana",extensions:["mbox"]},"application/media-policy-dataset+xml":{source:"iana",compressible:!0,extensions:["mpf"]},"application/media_control+xml":{source:"iana",compressible:!0},"application/mediaservercontrol+xml":{source:"iana",compressible:!0,extensions:["mscml"]},"application/merge-patch+json":{source:"iana",compressible:!0},"application/metalink+xml":{source:"apache",compressible:!0,extensions:["metalink"]},"application/metalink4+xml":{source:"iana",compressible:!0,extensions:["meta4"]},"application/mets+xml":{source:"iana",compressible:!0,extensions:["mets"]},"application/mf4":{source:"iana"},"application/mikey":{source:"iana"},"application/mipc":{source:"iana"},"application/missing-blocks+cbor-seq":{source:"iana"},"application/mmt-aei+xml":{source:"iana",compressible:!0,extensions:["maei"]},"application/mmt-usd+xml":{source:"iana",compressible:!0,extensions:["musd"]},"application/mods+xml":{source:"iana",compressible:!0,extensions:["mods"]},"application/moss-keys":{source:"iana"},"application/moss-signature":{source:"iana"},"application/mosskey-data":{source:"iana"},"application/mosskey-request":{source:"iana"},"application/mp21":{source:"iana",extensions:["m21","mp21"]},"application/mp4":{source:"iana",extensions:["mp4","mpg4","mp4s","m4p"]},"application/mpeg4-generic":{source:"iana"},"application/mpeg4-iod":{source:"iana"},"application/mpeg4-iod-xmt":{source:"iana"},"application/mrb-consumer+xml":{source:"iana",compressible:!0},"application/mrb-publish+xml":{source:"iana",compressible:!0},"application/msc-ivr+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/msc-mixer+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/msix":{compressible:!1,extensions:["msix"]},"application/msixbundle":{compressible:!1,extensions:["msixbundle"]},"application/msword":{source:"iana",compressible:!1,extensions:["doc","dot"]},"application/mud+json":{source:"iana",compressible:!0},"application/multipart-core":{source:"iana"},"application/mxf":{source:"iana",extensions:["mxf"]},"application/n-quads":{source:"iana",extensions:["nq"]},"application/n-triples":{source:"iana",extensions:["nt"]},"application/nasdata":{source:"iana"},"application/news-checkgroups":{source:"iana",charset:"US-ASCII"},"application/news-groupinfo":{source:"iana",charset:"US-ASCII"},"application/news-transmission":{source:"iana"},"application/nlsml+xml":{source:"iana",compressible:!0},"application/node":{source:"iana",extensions:["cjs"]},"application/nss":{source:"iana"},"application/oauth-authz-req+jwt":{source:"iana"},"application/oblivious-dns-message":{source:"iana"},"application/ocsp-request":{source:"iana"},"application/ocsp-response":{source:"iana"},"application/octet-stream":{source:"iana",compressible:!0,extensions:["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"]},"application/oda":{source:"iana",extensions:["oda"]},"application/odm+xml":{source:"iana",compressible:!0},"application/odx":{source:"iana"},"application/oebps-package+xml":{source:"iana",compressible:!0,extensions:["opf"]},"application/ogg":{source:"iana",compressible:!1,extensions:["ogx"]},"application/ohttp-keys":{source:"iana"},"application/omdoc+xml":{source:"apache",compressible:!0,extensions:["omdoc"]},"application/onenote":{source:"apache",extensions:["onetoc","onetoc2","onetmp","onepkg","one","onea"]},"application/opc-nodeset+xml":{source:"iana",compressible:!0},"application/oscore":{source:"iana"},"application/oxps":{source:"iana",extensions:["oxps"]},"application/p21":{source:"iana"},"application/p21+zip":{source:"iana",compressible:!1},"application/p2p-overlay+xml":{source:"iana",compressible:!0,extensions:["relo"]},"application/parityfec":{source:"iana"},"application/passport":{source:"iana"},"application/patch-ops-error+xml":{source:"iana",compressible:!0,extensions:["xer"]},"application/pdf":{source:"iana",compressible:!1,extensions:["pdf"]},"application/pdx":{source:"iana"},"application/pem-certificate-chain":{source:"iana"},"application/pgp-encrypted":{source:"iana",compressible:!1,extensions:["pgp"]},"application/pgp-keys":{source:"iana",extensions:["asc"]},"application/pgp-signature":{source:"iana",extensions:["sig","asc"]},"application/pics-rules":{source:"apache",extensions:["prf"]},"application/pidf+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/pidf-diff+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/pkcs10":{source:"iana",extensions:["p10"]},"application/pkcs12":{source:"iana"},"application/pkcs7-mime":{source:"iana",extensions:["p7m","p7c"]},"application/pkcs7-signature":{source:"iana",extensions:["p7s"]},"application/pkcs8":{source:"iana",extensions:["p8"]},"application/pkcs8-encrypted":{source:"iana"},"application/pkix-attr-cert":{source:"iana",extensions:["ac"]},"application/pkix-cert":{source:"iana",extensions:["cer"]},"application/pkix-crl":{source:"iana",extensions:["crl"]},"application/pkix-pkipath":{source:"iana",extensions:["pkipath"]},"application/pkixcmp":{source:"iana",extensions:["pki"]},"application/pls+xml":{source:"iana",compressible:!0,extensions:["pls"]},"application/poc-settings+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/postscript":{source:"iana",compressible:!0,extensions:["ai","eps","ps"]},"application/ppsp-tracker+json":{source:"iana",compressible:!0},"application/private-token-issuer-directory":{source:"iana"},"application/private-token-request":{source:"iana"},"application/private-token-response":{source:"iana"},"application/problem+json":{source:"iana",compressible:!0},"application/problem+xml":{source:"iana",compressible:!0},"application/provenance+xml":{source:"iana",compressible:!0,extensions:["provx"]},"application/provided-claims+jwt":{source:"iana"},"application/prs.alvestrand.titrax-sheet":{source:"iana"},"application/prs.cww":{source:"iana",extensions:["cww"]},"application/prs.cyn":{source:"iana",charset:"7-BIT"},"application/prs.hpub+zip":{source:"iana",compressible:!1},"application/prs.implied-document+xml":{source:"iana",compressible:!0},"application/prs.implied-executable":{source:"iana"},"application/prs.implied-object+json":{source:"iana",compressible:!0},"application/prs.implied-object+json-seq":{source:"iana"},"application/prs.implied-object+yaml":{source:"iana"},"application/prs.implied-structure":{source:"iana"},"application/prs.mayfile":{source:"iana"},"application/prs.nprend":{source:"iana"},"application/prs.plucker":{source:"iana"},"application/prs.rdf-xml-crypt":{source:"iana"},"application/prs.vcfbzip2":{source:"iana"},"application/prs.xsf+xml":{source:"iana",compressible:!0,extensions:["xsf"]},"application/pskc+xml":{source:"iana",compressible:!0,extensions:["pskcxml"]},"application/pvd+json":{source:"iana",compressible:!0},"application/qsig":{source:"iana"},"application/raml+yaml":{compressible:!0,extensions:["raml"]},"application/raptorfec":{source:"iana"},"application/rdap+json":{source:"iana",compressible:!0},"application/rdf+xml":{source:"iana",compressible:!0,extensions:["rdf","owl"]},"application/reginfo+xml":{source:"iana",compressible:!0,extensions:["rif"]},"application/relax-ng-compact-syntax":{source:"iana",extensions:["rnc"]},"application/remote-printing":{source:"apache"},"application/reputon+json":{source:"iana",compressible:!0},"application/resolve-response+jwt":{source:"iana"},"application/resource-lists+xml":{source:"iana",compressible:!0,extensions:["rl"]},"application/resource-lists-diff+xml":{source:"iana",compressible:!0,extensions:["rld"]},"application/rfc+xml":{source:"iana",compressible:!0},"application/riscos":{source:"iana"},"application/rlmi+xml":{source:"iana",compressible:!0},"application/rls-services+xml":{source:"iana",compressible:!0,extensions:["rs"]},"application/route-apd+xml":{source:"iana",compressible:!0,extensions:["rapd"]},"application/route-s-tsid+xml":{source:"iana",compressible:!0,extensions:["sls"]},"application/route-usd+xml":{source:"iana",compressible:!0,extensions:["rusd"]},"application/rpki-checklist":{source:"iana"},"application/rpki-ghostbusters":{source:"iana",extensions:["gbr"]},"application/rpki-manifest":{source:"iana",extensions:["mft"]},"application/rpki-publication":{source:"iana"},"application/rpki-roa":{source:"iana",extensions:["roa"]},"application/rpki-signed-tal":{source:"iana"},"application/rpki-updown":{source:"iana"},"application/rsd+xml":{source:"apache",compressible:!0,extensions:["rsd"]},"application/rss+xml":{source:"apache",compressible:!0,extensions:["rss"]},"application/rtf":{source:"iana",compressible:!0,extensions:["rtf"]},"application/rtploopback":{source:"iana"},"application/rtx":{source:"iana"},"application/samlassertion+xml":{source:"iana",compressible:!0},"application/samlmetadata+xml":{source:"iana",compressible:!0},"application/sarif+json":{source:"iana",compressible:!0},"application/sarif-external-properties+json":{source:"iana",compressible:!0},"application/sbe":{source:"iana"},"application/sbml+xml":{source:"iana",compressible:!0,extensions:["sbml"]},"application/scaip+xml":{source:"iana",compressible:!0},"application/scim+json":{source:"iana",compressible:!0},"application/scvp-cv-request":{source:"iana",extensions:["scq"]},"application/scvp-cv-response":{source:"iana",extensions:["scs"]},"application/scvp-vp-request":{source:"iana",extensions:["spq"]},"application/scvp-vp-response":{source:"iana",extensions:["spp"]},"application/sdp":{source:"iana",extensions:["sdp"]},"application/secevent+jwt":{source:"iana"},"application/senml+cbor":{source:"iana"},"application/senml+json":{source:"iana",compressible:!0},"application/senml+xml":{source:"iana",compressible:!0,extensions:["senmlx"]},"application/senml-etch+cbor":{source:"iana"},"application/senml-etch+json":{source:"iana",compressible:!0},"application/senml-exi":{source:"iana"},"application/sensml+cbor":{source:"iana"},"application/sensml+json":{source:"iana",compressible:!0},"application/sensml+xml":{source:"iana",compressible:!0,extensions:["sensmlx"]},"application/sensml-exi":{source:"iana"},"application/sep+xml":{source:"iana",compressible:!0},"application/sep-exi":{source:"iana"},"application/session-info":{source:"iana"},"application/set-payment":{source:"iana"},"application/set-payment-initiation":{source:"iana",extensions:["setpay"]},"application/set-registration":{source:"iana"},"application/set-registration-initiation":{source:"iana",extensions:["setreg"]},"application/sgml":{source:"iana"},"application/sgml-open-catalog":{source:"iana"},"application/shf+xml":{source:"iana",compressible:!0,extensions:["shf"]},"application/sieve":{source:"iana",extensions:["siv","sieve"]},"application/simple-filter+xml":{source:"iana",compressible:!0},"application/simple-message-summary":{source:"iana"},"application/simplesymbolcontainer":{source:"iana"},"application/sipc":{source:"iana"},"application/slate":{source:"iana"},"application/smil":{source:"apache"},"application/smil+xml":{source:"iana",compressible:!0,extensions:["smi","smil"]},"application/smpte336m":{source:"iana"},"application/soap+fastinfoset":{source:"iana"},"application/soap+xml":{source:"iana",compressible:!0},"application/sparql-query":{source:"iana",extensions:["rq"]},"application/sparql-results+xml":{source:"iana",compressible:!0,extensions:["srx"]},"application/spdx+json":{source:"iana",compressible:!0},"application/spirits-event+xml":{source:"iana",compressible:!0},"application/sql":{source:"iana",extensions:["sql"]},"application/srgs":{source:"iana",extensions:["gram"]},"application/srgs+xml":{source:"iana",compressible:!0,extensions:["grxml"]},"application/sru+xml":{source:"iana",compressible:!0,extensions:["sru"]},"application/ssdl+xml":{source:"apache",compressible:!0,extensions:["ssdl"]},"application/sslkeylogfile":{source:"iana"},"application/ssml+xml":{source:"iana",compressible:!0,extensions:["ssml"]},"application/st2110-41":{source:"iana"},"application/stix+json":{source:"iana",compressible:!0},"application/stratum":{source:"iana"},"application/swid+cbor":{source:"iana"},"application/swid+xml":{source:"iana",compressible:!0,extensions:["swidtag"]},"application/tamp-apex-update":{source:"iana"},"application/tamp-apex-update-confirm":{source:"iana"},"application/tamp-community-update":{source:"iana"},"application/tamp-community-update-confirm":{source:"iana"},"application/tamp-error":{source:"iana"},"application/tamp-sequence-adjust":{source:"iana"},"application/tamp-sequence-adjust-confirm":{source:"iana"},"application/tamp-status-query":{source:"iana"},"application/tamp-status-response":{source:"iana"},"application/tamp-update":{source:"iana"},"application/tamp-update-confirm":{source:"iana"},"application/tar":{compressible:!0},"application/taxii+json":{source:"iana",compressible:!0},"application/td+json":{source:"iana",compressible:!0},"application/tei+xml":{source:"iana",compressible:!0,extensions:["tei","teicorpus"]},"application/tetra_isi":{source:"iana"},"application/thraud+xml":{source:"iana",compressible:!0,extensions:["tfi"]},"application/timestamp-query":{source:"iana"},"application/timestamp-reply":{source:"iana"},"application/timestamped-data":{source:"iana",extensions:["tsd"]},"application/tlsrpt+gzip":{source:"iana"},"application/tlsrpt+json":{source:"iana",compressible:!0},"application/tm+json":{source:"iana",compressible:!0},"application/tnauthlist":{source:"iana"},"application/toc+cbor":{source:"iana"},"application/token-introspection+jwt":{source:"iana"},"application/toml":{source:"iana",compressible:!0,extensions:["toml"]},"application/trickle-ice-sdpfrag":{source:"iana"},"application/trig":{source:"iana",extensions:["trig"]},"application/trust-chain+json":{source:"iana",compressible:!0},"application/trust-mark+jwt":{source:"iana"},"application/trust-mark-delegation+jwt":{source:"iana"},"application/ttml+xml":{source:"iana",compressible:!0,extensions:["ttml"]},"application/tve-trigger":{source:"iana"},"application/tzif":{source:"iana"},"application/tzif-leap":{source:"iana"},"application/ubjson":{compressible:!1,extensions:["ubj"]},"application/uccs+cbor":{source:"iana"},"application/ujcs+json":{source:"iana",compressible:!0},"application/ulpfec":{source:"iana"},"application/urc-grpsheet+xml":{source:"iana",compressible:!0},"application/urc-ressheet+xml":{source:"iana",compressible:!0,extensions:["rsheet"]},"application/urc-targetdesc+xml":{source:"iana",compressible:!0,extensions:["td"]},"application/urc-uisocketdesc+xml":{source:"iana",compressible:!0},"application/vc":{source:"iana"},"application/vc+cose":{source:"iana"},"application/vc+jwt":{source:"iana"},"application/vcard+json":{source:"iana",compressible:!0},"application/vcard+xml":{source:"iana",compressible:!0},"application/vemmi":{source:"iana"},"application/vividence.scriptfile":{source:"apache"},"application/vnd.1000minds.decision-model+xml":{source:"iana",compressible:!0,extensions:["1km"]},"application/vnd.1ob":{source:"iana"},"application/vnd.3gpp-prose+xml":{source:"iana",compressible:!0},"application/vnd.3gpp-prose-pc3a+xml":{source:"iana",compressible:!0},"application/vnd.3gpp-prose-pc3ach+xml":{source:"iana",compressible:!0},"application/vnd.3gpp-prose-pc3ch+xml":{source:"iana",compressible:!0},"application/vnd.3gpp-prose-pc8+xml":{source:"iana",compressible:!0},"application/vnd.3gpp-v2x-local-service-information":{source:"iana"},"application/vnd.3gpp.5gnas":{source:"iana"},"application/vnd.3gpp.5gsa2x":{source:"iana"},"application/vnd.3gpp.5gsa2x-local-service-information":{source:"iana"},"application/vnd.3gpp.5gsv2x":{source:"iana"},"application/vnd.3gpp.5gsv2x-local-service-information":{source:"iana"},"application/vnd.3gpp.access-transfer-events+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.bsf+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.crs+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.current-location-discovery+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.gmop+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.gtpc":{source:"iana"},"application/vnd.3gpp.interworking-data":{source:"iana"},"application/vnd.3gpp.lpp":{source:"iana"},"application/vnd.3gpp.mc-signalling-ear":{source:"iana"},"application/vnd.3gpp.mcdata-affiliation-command+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-msgstore-ctrl-request+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-payload":{source:"iana"},"application/vnd.3gpp.mcdata-regroup+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-service-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-signalling":{source:"iana"},"application/vnd.3gpp.mcdata-ue-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-user-profile+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-affiliation-command+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-floor-request+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-location-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-mbms-usage-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-regroup+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-service-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-signed+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-ue-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-ue-init-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-user-profile+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-affiliation-command+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-location-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-mbms-usage-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-regroup+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-service-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-transmission-request+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-ue-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-user-profile+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mid-call+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.ngap":{source:"iana"},"application/vnd.3gpp.pfcp":{source:"iana"},"application/vnd.3gpp.pic-bw-large":{source:"iana",extensions:["plb"]},"application/vnd.3gpp.pic-bw-small":{source:"iana",extensions:["psb"]},"application/vnd.3gpp.pic-bw-var":{source:"iana",extensions:["pvb"]},"application/vnd.3gpp.pinapp-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.s1ap":{source:"iana"},"application/vnd.3gpp.seal-group-doc+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.seal-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.seal-location-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.seal-mbms-usage-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.seal-network-qos-management-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.seal-ue-config-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.seal-unicast-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.seal-user-profile-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.sms":{source:"iana"},"application/vnd.3gpp.sms+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.srvcc-ext+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.srvcc-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.state-and-event-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.ussd+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.v2x":{source:"iana"},"application/vnd.3gpp.vae-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp2.bcmcsinfo+xml":{source:"iana",compressible:!0},"application/vnd.3gpp2.sms":{source:"iana"},"application/vnd.3gpp2.tcap":{source:"iana",extensions:["tcap"]},"application/vnd.3lightssoftware.imagescal":{source:"iana"},"application/vnd.3m.post-it-notes":{source:"iana",extensions:["pwn"]},"application/vnd.accpac.simply.aso":{source:"iana",extensions:["aso"]},"application/vnd.accpac.simply.imp":{source:"iana",extensions:["imp"]},"application/vnd.acm.addressxfer+json":{source:"iana",compressible:!0},"application/vnd.acm.chatbot+json":{source:"iana",compressible:!0},"application/vnd.acucobol":{source:"iana",extensions:["acu"]},"application/vnd.acucorp":{source:"iana",extensions:["atc","acutc"]},"application/vnd.adobe.air-application-installer-package+zip":{source:"apache",compressible:!1,extensions:["air"]},"application/vnd.adobe.flash.movie":{source:"iana"},"application/vnd.adobe.formscentral.fcdt":{source:"iana",extensions:["fcdt"]},"application/vnd.adobe.fxp":{source:"iana",extensions:["fxp","fxpl"]},"application/vnd.adobe.partial-upload":{source:"iana"},"application/vnd.adobe.xdp+xml":{source:"iana",compressible:!0,extensions:["xdp"]},"application/vnd.adobe.xfdf":{source:"apache",extensions:["xfdf"]},"application/vnd.aether.imp":{source:"iana"},"application/vnd.afpc.afplinedata":{source:"iana"},"application/vnd.afpc.afplinedata-pagedef":{source:"iana"},"application/vnd.afpc.cmoca-cmresource":{source:"iana"},"application/vnd.afpc.foca-charset":{source:"iana"},"application/vnd.afpc.foca-codedfont":{source:"iana"},"application/vnd.afpc.foca-codepage":{source:"iana"},"application/vnd.afpc.modca":{source:"iana"},"application/vnd.afpc.modca-cmtable":{source:"iana"},"application/vnd.afpc.modca-formdef":{source:"iana"},"application/vnd.afpc.modca-mediummap":{source:"iana"},"application/vnd.afpc.modca-objectcontainer":{source:"iana"},"application/vnd.afpc.modca-overlay":{source:"iana"},"application/vnd.afpc.modca-pagesegment":{source:"iana"},"application/vnd.age":{source:"iana",extensions:["age"]},"application/vnd.ah-barcode":{source:"apache"},"application/vnd.ahead.space":{source:"iana",extensions:["ahead"]},"application/vnd.airzip.filesecure.azf":{source:"iana",extensions:["azf"]},"application/vnd.airzip.filesecure.azs":{source:"iana",extensions:["azs"]},"application/vnd.amadeus+json":{source:"iana",compressible:!0},"application/vnd.amazon.ebook":{source:"apache",extensions:["azw"]},"application/vnd.amazon.mobi8-ebook":{source:"iana"},"application/vnd.americandynamics.acc":{source:"iana",extensions:["acc"]},"application/vnd.amiga.ami":{source:"iana",extensions:["ami"]},"application/vnd.amundsen.maze+xml":{source:"iana",compressible:!0},"application/vnd.android.ota":{source:"iana"},"application/vnd.android.package-archive":{source:"apache",compressible:!1,extensions:["apk"]},"application/vnd.anki":{source:"iana"},"application/vnd.anser-web-certificate-issue-initiation":{source:"iana",extensions:["cii"]},"application/vnd.anser-web-funds-transfer-initiation":{source:"apache",extensions:["fti"]},"application/vnd.antix.game-component":{source:"iana",extensions:["atx"]},"application/vnd.apache.arrow.file":{source:"iana"},"application/vnd.apache.arrow.stream":{source:"iana"},"application/vnd.apache.parquet":{source:"iana"},"application/vnd.apache.thrift.binary":{source:"iana"},"application/vnd.apache.thrift.compact":{source:"iana"},"application/vnd.apache.thrift.json":{source:"iana"},"application/vnd.apexlang":{source:"iana"},"application/vnd.api+json":{source:"iana",compressible:!0},"application/vnd.aplextor.warrp+json":{source:"iana",compressible:!0},"application/vnd.apothekende.reservation+json":{source:"iana",compressible:!0},"application/vnd.apple.installer+xml":{source:"iana",compressible:!0,extensions:["mpkg"]},"application/vnd.apple.keynote":{source:"iana",extensions:["key"]},"application/vnd.apple.mpegurl":{source:"iana",extensions:["m3u8"]},"application/vnd.apple.numbers":{source:"iana",extensions:["numbers"]},"application/vnd.apple.pages":{source:"iana",extensions:["pages"]},"application/vnd.apple.pkpass":{compressible:!1,extensions:["pkpass"]},"application/vnd.arastra.swi":{source:"apache"},"application/vnd.aristanetworks.swi":{source:"iana",extensions:["swi"]},"application/vnd.artisan+json":{source:"iana",compressible:!0},"application/vnd.artsquare":{source:"iana"},"application/vnd.astraea-software.iota":{source:"iana",extensions:["iota"]},"application/vnd.audiograph":{source:"iana",extensions:["aep"]},"application/vnd.autodesk.fbx":{extensions:["fbx"]},"application/vnd.autopackage":{source:"iana"},"application/vnd.avalon+json":{source:"iana",compressible:!0},"application/vnd.avistar+xml":{source:"iana",compressible:!0},"application/vnd.balsamiq.bmml+xml":{source:"iana",compressible:!0,extensions:["bmml"]},"application/vnd.balsamiq.bmpr":{source:"iana"},"application/vnd.banana-accounting":{source:"iana"},"application/vnd.bbf.usp.error":{source:"iana"},"application/vnd.bbf.usp.msg":{source:"iana"},"application/vnd.bbf.usp.msg+json":{source:"iana",compressible:!0},"application/vnd.bekitzur-stech+json":{source:"iana",compressible:!0},"application/vnd.belightsoft.lhzd+zip":{source:"iana",compressible:!1},"application/vnd.belightsoft.lhzl+zip":{source:"iana",compressible:!1},"application/vnd.bint.med-content":{source:"iana"},"application/vnd.biopax.rdf+xml":{source:"iana",compressible:!0},"application/vnd.blink-idb-value-wrapper":{source:"iana"},"application/vnd.blueice.multipass":{source:"iana",extensions:["mpm"]},"application/vnd.bluetooth.ep.oob":{source:"iana"},"application/vnd.bluetooth.le.oob":{source:"iana"},"application/vnd.bmi":{source:"iana",extensions:["bmi"]},"application/vnd.bpf":{source:"iana"},"application/vnd.bpf3":{source:"iana"},"application/vnd.businessobjects":{source:"iana",extensions:["rep"]},"application/vnd.byu.uapi+json":{source:"iana",compressible:!0},"application/vnd.bzip3":{source:"iana"},"application/vnd.c3voc.schedule+xml":{source:"iana",compressible:!0},"application/vnd.cab-jscript":{source:"iana"},"application/vnd.canon-cpdl":{source:"iana"},"application/vnd.canon-lips":{source:"iana"},"application/vnd.capasystems-pg+json":{source:"iana",compressible:!0},"application/vnd.cendio.thinlinc.clientconf":{source:"iana"},"application/vnd.century-systems.tcp_stream":{source:"iana"},"application/vnd.chemdraw+xml":{source:"iana",compressible:!0,extensions:["cdxml"]},"application/vnd.chess-pgn":{source:"iana"},"application/vnd.chipnuts.karaoke-mmd":{source:"iana",extensions:["mmd"]},"application/vnd.ciedi":{source:"iana"},"application/vnd.cinderella":{source:"iana",extensions:["cdy"]},"application/vnd.cirpack.isdn-ext":{source:"iana"},"application/vnd.citationstyles.style+xml":{source:"iana",compressible:!0,extensions:["csl"]},"application/vnd.claymore":{source:"iana",extensions:["cla"]},"application/vnd.cloanto.rp9":{source:"iana",extensions:["rp9"]},"application/vnd.clonk.c4group":{source:"iana",extensions:["c4g","c4d","c4f","c4p","c4u"]},"application/vnd.cluetrust.cartomobile-config":{source:"iana",extensions:["c11amc"]},"application/vnd.cluetrust.cartomobile-config-pkg":{source:"iana",extensions:["c11amz"]},"application/vnd.cncf.helm.chart.content.v1.tar+gzip":{source:"iana"},"application/vnd.cncf.helm.chart.provenance.v1.prov":{source:"iana"},"application/vnd.cncf.helm.config.v1+json":{source:"iana",compressible:!0},"application/vnd.coffeescript":{source:"iana"},"application/vnd.collabio.xodocuments.document":{source:"iana"},"application/vnd.collabio.xodocuments.document-template":{source:"iana"},"application/vnd.collabio.xodocuments.presentation":{source:"iana"},"application/vnd.collabio.xodocuments.presentation-template":{source:"iana"},"application/vnd.collabio.xodocuments.spreadsheet":{source:"iana"},"application/vnd.collabio.xodocuments.spreadsheet-template":{source:"iana"},"application/vnd.collection+json":{source:"iana",compressible:!0},"application/vnd.collection.doc+json":{source:"iana",compressible:!0},"application/vnd.collection.next+json":{source:"iana",compressible:!0},"application/vnd.comicbook+zip":{source:"iana",compressible:!1},"application/vnd.comicbook-rar":{source:"iana"},"application/vnd.commerce-battelle":{source:"iana"},"application/vnd.commonspace":{source:"iana",extensions:["csp"]},"application/vnd.contact.cmsg":{source:"iana",extensions:["cdbcmsg"]},"application/vnd.coreos.ignition+json":{source:"iana",compressible:!0},"application/vnd.cosmocaller":{source:"iana",extensions:["cmc"]},"application/vnd.crick.clicker":{source:"iana",extensions:["clkx"]},"application/vnd.crick.clicker.keyboard":{source:"iana",extensions:["clkk"]},"application/vnd.crick.clicker.palette":{source:"iana",extensions:["clkp"]},"application/vnd.crick.clicker.template":{source:"iana",extensions:["clkt"]},"application/vnd.crick.clicker.wordbank":{source:"iana",extensions:["clkw"]},"application/vnd.criticaltools.wbs+xml":{source:"iana",compressible:!0,extensions:["wbs"]},"application/vnd.cryptii.pipe+json":{source:"iana",compressible:!0},"application/vnd.crypto-shade-file":{source:"iana"},"application/vnd.cryptomator.encrypted":{source:"iana"},"application/vnd.cryptomator.vault":{source:"iana"},"application/vnd.ctc-posml":{source:"iana",extensions:["pml"]},"application/vnd.ctct.ws+xml":{source:"iana",compressible:!0},"application/vnd.cups-pdf":{source:"iana"},"application/vnd.cups-postscript":{source:"iana"},"application/vnd.cups-ppd":{source:"iana",extensions:["ppd"]},"application/vnd.cups-raster":{source:"iana"},"application/vnd.cups-raw":{source:"iana"},"application/vnd.curl":{source:"iana"},"application/vnd.curl.car":{source:"apache",extensions:["car"]},"application/vnd.curl.pcurl":{source:"apache",extensions:["pcurl"]},"application/vnd.cyan.dean.root+xml":{source:"iana",compressible:!0},"application/vnd.cybank":{source:"iana"},"application/vnd.cyclonedx+json":{source:"iana",compressible:!0},"application/vnd.cyclonedx+xml":{source:"iana",compressible:!0},"application/vnd.d2l.coursepackage1p0+zip":{source:"iana",compressible:!1},"application/vnd.d3m-dataset":{source:"iana"},"application/vnd.d3m-problem":{source:"iana"},"application/vnd.dart":{source:"iana",compressible:!0,extensions:["dart"]},"application/vnd.data-vision.rdz":{source:"iana",extensions:["rdz"]},"application/vnd.datalog":{source:"iana"},"application/vnd.datapackage+json":{source:"iana",compressible:!0},"application/vnd.dataresource+json":{source:"iana",compressible:!0},"application/vnd.dbf":{source:"iana",extensions:["dbf"]},"application/vnd.dcmp+xml":{source:"iana",compressible:!0,extensions:["dcmp"]},"application/vnd.debian.binary-package":{source:"iana"},"application/vnd.dece.data":{source:"iana",extensions:["uvf","uvvf","uvd","uvvd"]},"application/vnd.dece.ttml+xml":{source:"iana",compressible:!0,extensions:["uvt","uvvt"]},"application/vnd.dece.unspecified":{source:"iana",extensions:["uvx","uvvx"]},"application/vnd.dece.zip":{source:"iana",extensions:["uvz","uvvz"]},"application/vnd.denovo.fcselayout-link":{source:"iana",extensions:["fe_launch"]},"application/vnd.desmume.movie":{source:"iana"},"application/vnd.dir-bi.plate-dl-nosuffix":{source:"iana"},"application/vnd.dm.delegation+xml":{source:"iana",compressible:!0},"application/vnd.dna":{source:"iana",extensions:["dna"]},"application/vnd.document+json":{source:"iana",compressible:!0},"application/vnd.dolby.mlp":{source:"apache",extensions:["mlp"]},"application/vnd.dolby.mobile.1":{source:"iana"},"application/vnd.dolby.mobile.2":{source:"iana"},"application/vnd.doremir.scorecloud-binary-document":{source:"iana"},"application/vnd.dpgraph":{source:"iana",extensions:["dpg"]},"application/vnd.dreamfactory":{source:"iana",extensions:["dfac"]},"application/vnd.drive+json":{source:"iana",compressible:!0},"application/vnd.ds-keypoint":{source:"apache",extensions:["kpxx"]},"application/vnd.dtg.local":{source:"iana"},"application/vnd.dtg.local.flash":{source:"iana"},"application/vnd.dtg.local.html":{source:"iana"},"application/vnd.dvb.ait":{source:"iana",extensions:["ait"]},"application/vnd.dvb.dvbisl+xml":{source:"iana",compressible:!0},"application/vnd.dvb.dvbj":{source:"iana"},"application/vnd.dvb.esgcontainer":{source:"iana"},"application/vnd.dvb.ipdcdftnotifaccess":{source:"iana"},"application/vnd.dvb.ipdcesgaccess":{source:"iana"},"application/vnd.dvb.ipdcesgaccess2":{source:"iana"},"application/vnd.dvb.ipdcesgpdd":{source:"iana"},"application/vnd.dvb.ipdcroaming":{source:"iana"},"application/vnd.dvb.iptv.alfec-base":{source:"iana"},"application/vnd.dvb.iptv.alfec-enhancement":{source:"iana"},"application/vnd.dvb.notif-aggregate-root+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-container+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-generic+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-ia-msglist+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-ia-registration-request+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-ia-registration-response+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-init+xml":{source:"iana",compressible:!0},"application/vnd.dvb.pfr":{source:"iana"},"application/vnd.dvb.service":{source:"iana",extensions:["svc"]},"application/vnd.dxr":{source:"iana"},"application/vnd.dynageo":{source:"iana",extensions:["geo"]},"application/vnd.dzr":{source:"iana"},"application/vnd.easykaraoke.cdgdownload":{source:"iana"},"application/vnd.ecdis-update":{source:"iana"},"application/vnd.ecip.rlp":{source:"iana"},"application/vnd.eclipse.ditto+json":{source:"iana",compressible:!0},"application/vnd.ecowin.chart":{source:"iana",extensions:["mag"]},"application/vnd.ecowin.filerequest":{source:"iana"},"application/vnd.ecowin.fileupdate":{source:"iana"},"application/vnd.ecowin.series":{source:"iana"},"application/vnd.ecowin.seriesrequest":{source:"iana"},"application/vnd.ecowin.seriesupdate":{source:"iana"},"application/vnd.efi.img":{source:"iana"},"application/vnd.efi.iso":{source:"iana"},"application/vnd.eln+zip":{source:"iana",compressible:!1},"application/vnd.emclient.accessrequest+xml":{source:"iana",compressible:!0},"application/vnd.enliven":{source:"iana",extensions:["nml"]},"application/vnd.enphase.envoy":{source:"iana"},"application/vnd.eprints.data+xml":{source:"iana",compressible:!0},"application/vnd.epson.esf":{source:"iana",extensions:["esf"]},"application/vnd.epson.msf":{source:"iana",extensions:["msf"]},"application/vnd.epson.quickanime":{source:"iana",extensions:["qam"]},"application/vnd.epson.salt":{source:"iana",extensions:["slt"]},"application/vnd.epson.ssf":{source:"iana",extensions:["ssf"]},"application/vnd.ericsson.quickcall":{source:"iana"},"application/vnd.erofs":{source:"iana"},"application/vnd.espass-espass+zip":{source:"iana",compressible:!1},"application/vnd.eszigno3+xml":{source:"iana",compressible:!0,extensions:["es3","et3"]},"application/vnd.etsi.aoc+xml":{source:"iana",compressible:!0},"application/vnd.etsi.asic-e+zip":{source:"iana",compressible:!1},"application/vnd.etsi.asic-s+zip":{source:"iana",compressible:!1},"application/vnd.etsi.cug+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvcommand+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvdiscovery+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvprofile+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsad-bc+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsad-cod+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsad-npvr+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvservice+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsync+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvueprofile+xml":{source:"iana",compressible:!0},"application/vnd.etsi.mcid+xml":{source:"iana",compressible:!0},"application/vnd.etsi.mheg5":{source:"iana"},"application/vnd.etsi.overload-control-policy-dataset+xml":{source:"iana",compressible:!0},"application/vnd.etsi.pstn+xml":{source:"iana",compressible:!0},"application/vnd.etsi.sci+xml":{source:"iana",compressible:!0},"application/vnd.etsi.simservs+xml":{source:"iana",compressible:!0},"application/vnd.etsi.timestamp-token":{source:"iana"},"application/vnd.etsi.tsl+xml":{source:"iana",compressible:!0},"application/vnd.etsi.tsl.der":{source:"iana"},"application/vnd.eu.kasparian.car+json":{source:"iana",compressible:!0},"application/vnd.eudora.data":{source:"iana"},"application/vnd.evolv.ecig.profile":{source:"iana"},"application/vnd.evolv.ecig.settings":{source:"iana"},"application/vnd.evolv.ecig.theme":{source:"iana"},"application/vnd.exstream-empower+zip":{source:"iana",compressible:!1},"application/vnd.exstream-package":{source:"iana"},"application/vnd.ezpix-album":{source:"iana",extensions:["ez2"]},"application/vnd.ezpix-package":{source:"iana",extensions:["ez3"]},"application/vnd.f-secure.mobile":{source:"iana"},"application/vnd.familysearch.gedcom+zip":{source:"iana",compressible:!1},"application/vnd.fastcopy-disk-image":{source:"iana"},"application/vnd.fdf":{source:"apache",extensions:["fdf"]},"application/vnd.fdsn.mseed":{source:"iana",extensions:["mseed"]},"application/vnd.fdsn.seed":{source:"iana",extensions:["seed","dataless"]},"application/vnd.fdsn.stationxml+xml":{source:"iana",charset:"XML-BASED",compressible:!0},"application/vnd.ffsns":{source:"iana"},"application/vnd.ficlab.flb+zip":{source:"iana",compressible:!1},"application/vnd.filmit.zfc":{source:"iana"},"application/vnd.fints":{source:"iana"},"application/vnd.firemonkeys.cloudcell":{source:"iana"},"application/vnd.flographit":{source:"iana",extensions:["gph"]},"application/vnd.fluxtime.clip":{source:"iana",extensions:["ftc"]},"application/vnd.font-fontforge-sfd":{source:"iana"},"application/vnd.framemaker":{source:"iana",extensions:["fm","frame","maker","book"]},"application/vnd.freelog.comic":{source:"iana"},"application/vnd.frogans.fnc":{source:"apache",extensions:["fnc"]},"application/vnd.frogans.ltf":{source:"apache",extensions:["ltf"]},"application/vnd.fsc.weblaunch":{source:"iana",extensions:["fsc"]},"application/vnd.fujifilm.fb.docuworks":{source:"iana"},"application/vnd.fujifilm.fb.docuworks.binder":{source:"iana"},"application/vnd.fujifilm.fb.docuworks.container":{source:"iana"},"application/vnd.fujifilm.fb.jfi+xml":{source:"iana",compressible:!0},"application/vnd.fujitsu.oasys":{source:"iana",extensions:["oas"]},"application/vnd.fujitsu.oasys2":{source:"iana",extensions:["oa2"]},"application/vnd.fujitsu.oasys3":{source:"iana",extensions:["oa3"]},"application/vnd.fujitsu.oasysgp":{source:"iana",extensions:["fg5"]},"application/vnd.fujitsu.oasysprs":{source:"iana",extensions:["bh2"]},"application/vnd.fujixerox.art-ex":{source:"iana"},"application/vnd.fujixerox.art4":{source:"iana"},"application/vnd.fujixerox.ddd":{source:"iana",extensions:["ddd"]},"application/vnd.fujixerox.docuworks":{source:"iana",extensions:["xdw"]},"application/vnd.fujixerox.docuworks.binder":{source:"iana",extensions:["xbd"]},"application/vnd.fujixerox.docuworks.container":{source:"iana"},"application/vnd.fujixerox.hbpl":{source:"iana"},"application/vnd.fut-misnet":{source:"iana"},"application/vnd.futoin+cbor":{source:"iana"},"application/vnd.futoin+json":{source:"iana",compressible:!0},"application/vnd.fuzzysheet":{source:"iana",extensions:["fzs"]},"application/vnd.ga4gh.passport+jwt":{source:"iana"},"application/vnd.genomatix.tuxedo":{source:"iana",extensions:["txd"]},"application/vnd.genozip":{source:"iana"},"application/vnd.gentics.grd+json":{source:"iana",compressible:!0},"application/vnd.gentoo.catmetadata+xml":{source:"iana",compressible:!0},"application/vnd.gentoo.ebuild":{source:"iana"},"application/vnd.gentoo.eclass":{source:"iana"},"application/vnd.gentoo.gpkg":{source:"iana"},"application/vnd.gentoo.manifest":{source:"iana"},"application/vnd.gentoo.pkgmetadata+xml":{source:"iana",compressible:!0},"application/vnd.gentoo.xpak":{source:"iana"},"application/vnd.geo+json":{source:"apache",compressible:!0},"application/vnd.geocube+xml":{source:"apache",compressible:!0},"application/vnd.geogebra.file":{source:"iana",extensions:["ggb"]},"application/vnd.geogebra.pinboard":{source:"iana"},"application/vnd.geogebra.slides":{source:"iana",extensions:["ggs"]},"application/vnd.geogebra.tool":{source:"iana",extensions:["ggt"]},"application/vnd.geometry-explorer":{source:"iana",extensions:["gex","gre"]},"application/vnd.geonext":{source:"iana",extensions:["gxt"]},"application/vnd.geoplan":{source:"iana",extensions:["g2w"]},"application/vnd.geospace":{source:"iana",extensions:["g3w"]},"application/vnd.gerber":{source:"iana"},"application/vnd.globalplatform.card-content-mgt":{source:"iana"},"application/vnd.globalplatform.card-content-mgt-response":{source:"iana"},"application/vnd.gmx":{source:"iana",extensions:["gmx"]},"application/vnd.gnu.taler.exchange+json":{source:"iana",compressible:!0},"application/vnd.gnu.taler.merchant+json":{source:"iana",compressible:!0},"application/vnd.google-apps.audio":{},"application/vnd.google-apps.document":{compressible:!1,extensions:["gdoc"]},"application/vnd.google-apps.drawing":{compressible:!1,extensions:["gdraw"]},"application/vnd.google-apps.drive-sdk":{compressible:!1},"application/vnd.google-apps.file":{},"application/vnd.google-apps.folder":{compressible:!1},"application/vnd.google-apps.form":{compressible:!1,extensions:["gform"]},"application/vnd.google-apps.fusiontable":{},"application/vnd.google-apps.jam":{compressible:!1,extensions:["gjam"]},"application/vnd.google-apps.mail-layout":{},"application/vnd.google-apps.map":{compressible:!1,extensions:["gmap"]},"application/vnd.google-apps.photo":{},"application/vnd.google-apps.presentation":{compressible:!1,extensions:["gslides"]},"application/vnd.google-apps.script":{compressible:!1,extensions:["gscript"]},"application/vnd.google-apps.shortcut":{},"application/vnd.google-apps.site":{compressible:!1,extensions:["gsite"]},"application/vnd.google-apps.spreadsheet":{compressible:!1,extensions:["gsheet"]},"application/vnd.google-apps.unknown":{},"application/vnd.google-apps.video":{},"application/vnd.google-earth.kml+xml":{source:"iana",compressible:!0,extensions:["kml"]},"application/vnd.google-earth.kmz":{source:"iana",compressible:!1,extensions:["kmz"]},"application/vnd.gov.sk.e-form+xml":{source:"apache",compressible:!0},"application/vnd.gov.sk.e-form+zip":{source:"iana",compressible:!1},"application/vnd.gov.sk.xmldatacontainer+xml":{source:"iana",compressible:!0,extensions:["xdcf"]},"application/vnd.gpxsee.map+xml":{source:"iana",compressible:!0},"application/vnd.grafeq":{source:"iana",extensions:["gqf","gqs"]},"application/vnd.gridmp":{source:"iana"},"application/vnd.groove-account":{source:"iana",extensions:["gac"]},"application/vnd.groove-help":{source:"iana",extensions:["ghf"]},"application/vnd.groove-identity-message":{source:"iana",extensions:["gim"]},"application/vnd.groove-injector":{source:"iana",extensions:["grv"]},"application/vnd.groove-tool-message":{source:"iana",extensions:["gtm"]},"application/vnd.groove-tool-template":{source:"iana",extensions:["tpl"]},"application/vnd.groove-vcard":{source:"iana",extensions:["vcg"]},"application/vnd.hal+json":{source:"iana",compressible:!0},"application/vnd.hal+xml":{source:"iana",compressible:!0,extensions:["hal"]},"application/vnd.handheld-entertainment+xml":{source:"iana",compressible:!0,extensions:["zmm"]},"application/vnd.hbci":{source:"iana",extensions:["hbci"]},"application/vnd.hc+json":{source:"iana",compressible:!0},"application/vnd.hcl-bireports":{source:"iana"},"application/vnd.hdt":{source:"iana"},"application/vnd.heroku+json":{source:"iana",compressible:!0},"application/vnd.hhe.lesson-player":{source:"iana",extensions:["les"]},"application/vnd.hp-hpgl":{source:"iana",extensions:["hpgl"]},"application/vnd.hp-hpid":{source:"iana",extensions:["hpid"]},"application/vnd.hp-hps":{source:"iana",extensions:["hps"]},"application/vnd.hp-jlyt":{source:"iana",extensions:["jlt"]},"application/vnd.hp-pcl":{source:"iana",extensions:["pcl"]},"application/vnd.hp-pclxl":{source:"iana",extensions:["pclxl"]},"application/vnd.hsl":{source:"iana"},"application/vnd.httphone":{source:"iana"},"application/vnd.hydrostatix.sof-data":{source:"iana",extensions:["sfd-hdstx"]},"application/vnd.hyper+json":{source:"iana",compressible:!0},"application/vnd.hyper-item+json":{source:"iana",compressible:!0},"application/vnd.hyperdrive+json":{source:"iana",compressible:!0},"application/vnd.hzn-3d-crossword":{source:"iana"},"application/vnd.ibm.afplinedata":{source:"apache"},"application/vnd.ibm.electronic-media":{source:"iana"},"application/vnd.ibm.minipay":{source:"iana",extensions:["mpy"]},"application/vnd.ibm.modcap":{source:"apache",extensions:["afp","listafp","list3820"]},"application/vnd.ibm.rights-management":{source:"iana",extensions:["irm"]},"application/vnd.ibm.secure-container":{source:"iana",extensions:["sc"]},"application/vnd.iccprofile":{source:"iana",extensions:["icc","icm"]},"application/vnd.ieee.1905":{source:"iana"},"application/vnd.igloader":{source:"iana",extensions:["igl"]},"application/vnd.imagemeter.folder+zip":{source:"iana",compressible:!1},"application/vnd.imagemeter.image+zip":{source:"iana",compressible:!1},"application/vnd.immervision-ivp":{source:"iana",extensions:["ivp"]},"application/vnd.immervision-ivu":{source:"iana",extensions:["ivu"]},"application/vnd.ims.imsccv1p1":{source:"iana"},"application/vnd.ims.imsccv1p2":{source:"iana"},"application/vnd.ims.imsccv1p3":{source:"iana"},"application/vnd.ims.lis.v2.result+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolconsumerprofile+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolproxy+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolproxy.id+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolsettings+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolsettings.simple+json":{source:"iana",compressible:!0},"application/vnd.informedcontrol.rms+xml":{source:"iana",compressible:!0},"application/vnd.informix-visionary":{source:"apache"},"application/vnd.infotech.project":{source:"iana"},"application/vnd.infotech.project+xml":{source:"iana",compressible:!0},"application/vnd.innopath.wamp.notification":{source:"iana"},"application/vnd.insors.igm":{source:"iana",extensions:["igm"]},"application/vnd.intercon.formnet":{source:"iana",extensions:["xpw","xpx"]},"application/vnd.intergeo":{source:"iana",extensions:["i2g"]},"application/vnd.intertrust.digibox":{source:"iana"},"application/vnd.intertrust.nncp":{source:"iana"},"application/vnd.intu.qbo":{source:"iana",extensions:["qbo"]},"application/vnd.intu.qfx":{source:"iana",extensions:["qfx"]},"application/vnd.ipfs.ipns-record":{source:"iana"},"application/vnd.ipld.car":{source:"iana"},"application/vnd.ipld.dag-cbor":{source:"iana"},"application/vnd.ipld.dag-json":{source:"iana"},"application/vnd.ipld.raw":{source:"iana"},"application/vnd.iptc.g2.catalogitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.conceptitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.knowledgeitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.newsitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.newsmessage+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.packageitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.planningitem+xml":{source:"iana",compressible:!0},"application/vnd.ipunplugged.rcprofile":{source:"iana",extensions:["rcprofile"]},"application/vnd.irepository.package+xml":{source:"iana",compressible:!0,extensions:["irp"]},"application/vnd.is-xpr":{source:"iana",extensions:["xpr"]},"application/vnd.isac.fcs":{source:"iana",extensions:["fcs"]},"application/vnd.iso11783-10+zip":{source:"iana",compressible:!1},"application/vnd.jam":{source:"iana",extensions:["jam"]},"application/vnd.japannet-directory-service":{source:"iana"},"application/vnd.japannet-jpnstore-wakeup":{source:"iana"},"application/vnd.japannet-payment-wakeup":{source:"iana"},"application/vnd.japannet-registration":{source:"iana"},"application/vnd.japannet-registration-wakeup":{source:"iana"},"application/vnd.japannet-setstore-wakeup":{source:"iana"},"application/vnd.japannet-verification":{source:"iana"},"application/vnd.japannet-verification-wakeup":{source:"iana"},"application/vnd.jcp.javame.midlet-rms":{source:"iana",extensions:["rms"]},"application/vnd.jisp":{source:"iana",extensions:["jisp"]},"application/vnd.joost.joda-archive":{source:"iana",extensions:["joda"]},"application/vnd.jsk.isdn-ngn":{source:"iana"},"application/vnd.kahootz":{source:"iana",extensions:["ktz","ktr"]},"application/vnd.kde.karbon":{source:"iana",extensions:["karbon"]},"application/vnd.kde.kchart":{source:"iana",extensions:["chrt"]},"application/vnd.kde.kformula":{source:"iana",extensions:["kfo"]},"application/vnd.kde.kivio":{source:"iana",extensions:["flw"]},"application/vnd.kde.kontour":{source:"iana",extensions:["kon"]},"application/vnd.kde.kpresenter":{source:"iana",extensions:["kpr","kpt"]},"application/vnd.kde.kspread":{source:"iana",extensions:["ksp"]},"application/vnd.kde.kword":{source:"iana",extensions:["kwd","kwt"]},"application/vnd.kdl":{source:"iana"},"application/vnd.kenameaapp":{source:"iana",extensions:["htke"]},"application/vnd.keyman.kmp+zip":{source:"iana",compressible:!1},"application/vnd.keyman.kmx":{source:"iana"},"application/vnd.kidspiration":{source:"iana",extensions:["kia"]},"application/vnd.kinar":{source:"iana",extensions:["kne","knp"]},"application/vnd.koan":{source:"iana",extensions:["skp","skd","skt","skm"]},"application/vnd.kodak-descriptor":{source:"iana",extensions:["sse"]},"application/vnd.las":{source:"iana"},"application/vnd.las.las+json":{source:"iana",compressible:!0},"application/vnd.las.las+xml":{source:"iana",compressible:!0,extensions:["lasxml"]},"application/vnd.laszip":{source:"iana"},"application/vnd.ldev.productlicensing":{source:"iana"},"application/vnd.leap+json":{source:"iana",compressible:!0},"application/vnd.liberty-request+xml":{source:"iana",compressible:!0},"application/vnd.llamagraphics.life-balance.desktop":{source:"iana",extensions:["lbd"]},"application/vnd.llamagraphics.life-balance.exchange+xml":{source:"iana",compressible:!0,extensions:["lbe"]},"application/vnd.logipipe.circuit+zip":{source:"iana",compressible:!1},"application/vnd.loom":{source:"iana"},"application/vnd.lotus-1-2-3":{source:"iana",extensions:["123"]},"application/vnd.lotus-approach":{source:"iana",extensions:["apr"]},"application/vnd.lotus-freelance":{source:"iana",extensions:["pre"]},"application/vnd.lotus-notes":{source:"iana",extensions:["nsf"]},"application/vnd.lotus-organizer":{source:"iana",extensions:["org"]},"application/vnd.lotus-screencam":{source:"iana",extensions:["scm"]},"application/vnd.lotus-wordpro":{source:"iana",extensions:["lwp"]},"application/vnd.macports.portpkg":{source:"iana",extensions:["portpkg"]},"application/vnd.mapbox-vector-tile":{source:"iana",extensions:["mvt"]},"application/vnd.marlin.drm.actiontoken+xml":{source:"iana",compressible:!0},"application/vnd.marlin.drm.conftoken+xml":{source:"iana",compressible:!0},"application/vnd.marlin.drm.license+xml":{source:"iana",compressible:!0},"application/vnd.marlin.drm.mdcf":{source:"iana"},"application/vnd.mason+json":{source:"iana",compressible:!0},"application/vnd.maxar.archive.3tz+zip":{source:"iana",compressible:!1},"application/vnd.maxmind.maxmind-db":{source:"iana"},"application/vnd.mcd":{source:"iana",extensions:["mcd"]},"application/vnd.mdl":{source:"iana"},"application/vnd.mdl-mbsdf":{source:"iana"},"application/vnd.medcalcdata":{source:"iana",extensions:["mc1"]},"application/vnd.mediastation.cdkey":{source:"iana",extensions:["cdkey"]},"application/vnd.medicalholodeck.recordxr":{source:"iana"},"application/vnd.meridian-slingshot":{source:"iana"},"application/vnd.mermaid":{source:"iana"},"application/vnd.mfer":{source:"iana",extensions:["mwf"]},"application/vnd.mfmp":{source:"iana",extensions:["mfm"]},"application/vnd.micro+json":{source:"iana",compressible:!0},"application/vnd.micrografx.flo":{source:"iana",extensions:["flo"]},"application/vnd.micrografx.igx":{source:"iana",extensions:["igx"]},"application/vnd.microsoft.portable-executable":{source:"iana"},"application/vnd.microsoft.windows.thumbnail-cache":{source:"iana"},"application/vnd.miele+json":{source:"iana",compressible:!0},"application/vnd.mif":{source:"iana",extensions:["mif"]},"application/vnd.minisoft-hp3000-save":{source:"iana"},"application/vnd.mitsubishi.misty-guard.trustweb":{source:"iana"},"application/vnd.mobius.daf":{source:"iana",extensions:["daf"]},"application/vnd.mobius.dis":{source:"iana",extensions:["dis"]},"application/vnd.mobius.mbk":{source:"iana",extensions:["mbk"]},"application/vnd.mobius.mqy":{source:"iana",extensions:["mqy"]},"application/vnd.mobius.msl":{source:"iana",extensions:["msl"]},"application/vnd.mobius.plc":{source:"iana",extensions:["plc"]},"application/vnd.mobius.txf":{source:"iana",extensions:["txf"]},"application/vnd.modl":{source:"iana"},"application/vnd.mophun.application":{source:"iana",extensions:["mpn"]},"application/vnd.mophun.certificate":{source:"iana",extensions:["mpc"]},"application/vnd.motorola.flexsuite":{source:"iana"},"application/vnd.motorola.flexsuite.adsi":{source:"iana"},"application/vnd.motorola.flexsuite.fis":{source:"iana"},"application/vnd.motorola.flexsuite.gotap":{source:"iana"},"application/vnd.motorola.flexsuite.kmr":{source:"iana"},"application/vnd.motorola.flexsuite.ttc":{source:"iana"},"application/vnd.motorola.flexsuite.wem":{source:"iana"},"application/vnd.motorola.iprm":{source:"iana"},"application/vnd.mozilla.xul+xml":{source:"iana",compressible:!0,extensions:["xul"]},"application/vnd.ms-3mfdocument":{source:"iana"},"application/vnd.ms-artgalry":{source:"iana",extensions:["cil"]},"application/vnd.ms-asf":{source:"iana"},"application/vnd.ms-cab-compressed":{source:"iana",extensions:["cab"]},"application/vnd.ms-color.iccprofile":{source:"apache"},"application/vnd.ms-excel":{source:"iana",compressible:!1,extensions:["xls","xlm","xla","xlc","xlt","xlw"]},"application/vnd.ms-excel.addin.macroenabled.12":{source:"iana",extensions:["xlam"]},"application/vnd.ms-excel.sheet.binary.macroenabled.12":{source:"iana",extensions:["xlsb"]},"application/vnd.ms-excel.sheet.macroenabled.12":{source:"iana",extensions:["xlsm"]},"application/vnd.ms-excel.template.macroenabled.12":{source:"iana",extensions:["xltm"]},"application/vnd.ms-fontobject":{source:"iana",compressible:!0,extensions:["eot"]},"application/vnd.ms-htmlhelp":{source:"iana",extensions:["chm"]},"application/vnd.ms-ims":{source:"iana",extensions:["ims"]},"application/vnd.ms-lrm":{source:"iana",extensions:["lrm"]},"application/vnd.ms-office.activex+xml":{source:"iana",compressible:!0},"application/vnd.ms-officetheme":{source:"iana",extensions:["thmx"]},"application/vnd.ms-opentype":{source:"apache",compressible:!0},"application/vnd.ms-outlook":{compressible:!1,extensions:["msg"]},"application/vnd.ms-package.obfuscated-opentype":{source:"apache"},"application/vnd.ms-pki.seccat":{source:"apache",extensions:["cat"]},"application/vnd.ms-pki.stl":{source:"apache",extensions:["stl"]},"application/vnd.ms-playready.initiator+xml":{source:"iana",compressible:!0},"application/vnd.ms-powerpoint":{source:"iana",compressible:!1,extensions:["ppt","pps","pot"]},"application/vnd.ms-powerpoint.addin.macroenabled.12":{source:"iana",extensions:["ppam"]},"application/vnd.ms-powerpoint.presentation.macroenabled.12":{source:"iana",extensions:["pptm"]},"application/vnd.ms-powerpoint.slide.macroenabled.12":{source:"iana",extensions:["sldm"]},"application/vnd.ms-powerpoint.slideshow.macroenabled.12":{source:"iana",extensions:["ppsm"]},"application/vnd.ms-powerpoint.template.macroenabled.12":{source:"iana",extensions:["potm"]},"application/vnd.ms-printdevicecapabilities+xml":{source:"iana",compressible:!0},"application/vnd.ms-printing.printticket+xml":{source:"apache",compressible:!0},"application/vnd.ms-printschematicket+xml":{source:"iana",compressible:!0},"application/vnd.ms-project":{source:"iana",extensions:["mpp","mpt"]},"application/vnd.ms-tnef":{source:"iana"},"application/vnd.ms-visio.viewer":{extensions:["vdx"]},"application/vnd.ms-windows.devicepairing":{source:"iana"},"application/vnd.ms-windows.nwprinting.oob":{source:"iana"},"application/vnd.ms-windows.printerpairing":{source:"iana"},"application/vnd.ms-windows.wsd.oob":{source:"iana"},"application/vnd.ms-wmdrm.lic-chlg-req":{source:"iana"},"application/vnd.ms-wmdrm.lic-resp":{source:"iana"},"application/vnd.ms-wmdrm.meter-chlg-req":{source:"iana"},"application/vnd.ms-wmdrm.meter-resp":{source:"iana"},"application/vnd.ms-word.document.macroenabled.12":{source:"iana",extensions:["docm"]},"application/vnd.ms-word.template.macroenabled.12":{source:"iana",extensions:["dotm"]},"application/vnd.ms-works":{source:"iana",extensions:["wps","wks","wcm","wdb"]},"application/vnd.ms-wpl":{source:"iana",extensions:["wpl"]},"application/vnd.ms-xpsdocument":{source:"iana",compressible:!1,extensions:["xps"]},"application/vnd.msa-disk-image":{source:"iana"},"application/vnd.mseq":{source:"iana",extensions:["mseq"]},"application/vnd.msgpack":{source:"iana"},"application/vnd.msign":{source:"iana"},"application/vnd.multiad.creator":{source:"iana"},"application/vnd.multiad.creator.cif":{source:"iana"},"application/vnd.music-niff":{source:"iana"},"application/vnd.musician":{source:"iana",extensions:["mus"]},"application/vnd.muvee.style":{source:"iana",extensions:["msty"]},"application/vnd.mynfc":{source:"iana",extensions:["taglet"]},"application/vnd.nacamar.ybrid+json":{source:"iana",compressible:!0},"application/vnd.nato.bindingdataobject+cbor":{source:"iana"},"application/vnd.nato.bindingdataobject+json":{source:"iana",compressible:!0},"application/vnd.nato.bindingdataobject+xml":{source:"iana",compressible:!0,extensions:["bdo"]},"application/vnd.nato.openxmlformats-package.iepd+zip":{source:"iana",compressible:!1},"application/vnd.ncd.control":{source:"iana"},"application/vnd.ncd.reference":{source:"iana"},"application/vnd.nearst.inv+json":{source:"iana",compressible:!0},"application/vnd.nebumind.line":{source:"iana"},"application/vnd.nervana":{source:"iana"},"application/vnd.netfpx":{source:"iana"},"application/vnd.neurolanguage.nlu":{source:"iana",extensions:["nlu"]},"application/vnd.nimn":{source:"iana"},"application/vnd.nintendo.nitro.rom":{source:"iana"},"application/vnd.nintendo.snes.rom":{source:"iana"},"application/vnd.nitf":{source:"iana",extensions:["ntf","nitf"]},"application/vnd.noblenet-directory":{source:"iana",extensions:["nnd"]},"application/vnd.noblenet-sealer":{source:"iana",extensions:["nns"]},"application/vnd.noblenet-web":{source:"iana",extensions:["nnw"]},"application/vnd.nokia.catalogs":{source:"iana"},"application/vnd.nokia.conml+wbxml":{source:"iana"},"application/vnd.nokia.conml+xml":{source:"iana",compressible:!0},"application/vnd.nokia.iptv.config+xml":{source:"iana",compressible:!0},"application/vnd.nokia.isds-radio-presets":{source:"iana"},"application/vnd.nokia.landmark+wbxml":{source:"iana"},"application/vnd.nokia.landmark+xml":{source:"iana",compressible:!0},"application/vnd.nokia.landmarkcollection+xml":{source:"iana",compressible:!0},"application/vnd.nokia.n-gage.ac+xml":{source:"iana",compressible:!0,extensions:["ac"]},"application/vnd.nokia.n-gage.data":{source:"iana",extensions:["ngdat"]},"application/vnd.nokia.n-gage.symbian.install":{source:"apache",extensions:["n-gage"]},"application/vnd.nokia.ncd":{source:"iana"},"application/vnd.nokia.pcd+wbxml":{source:"iana"},"application/vnd.nokia.pcd+xml":{source:"iana",compressible:!0},"application/vnd.nokia.radio-preset":{source:"iana",extensions:["rpst"]},"application/vnd.nokia.radio-presets":{source:"iana",extensions:["rpss"]},"application/vnd.novadigm.edm":{source:"iana",extensions:["edm"]},"application/vnd.novadigm.edx":{source:"iana",extensions:["edx"]},"application/vnd.novadigm.ext":{source:"iana",extensions:["ext"]},"application/vnd.ntt-local.content-share":{source:"iana"},"application/vnd.ntt-local.file-transfer":{source:"iana"},"application/vnd.ntt-local.ogw_remote-access":{source:"iana"},"application/vnd.ntt-local.sip-ta_remote":{source:"iana"},"application/vnd.ntt-local.sip-ta_tcp_stream":{source:"iana"},"application/vnd.oai.workflows":{source:"iana"},"application/vnd.oai.workflows+json":{source:"iana",compressible:!0},"application/vnd.oai.workflows+yaml":{source:"iana"},"application/vnd.oasis.opendocument.base":{source:"iana"},"application/vnd.oasis.opendocument.chart":{source:"iana",extensions:["odc"]},"application/vnd.oasis.opendocument.chart-template":{source:"iana",extensions:["otc"]},"application/vnd.oasis.opendocument.database":{source:"apache",extensions:["odb"]},"application/vnd.oasis.opendocument.formula":{source:"iana",extensions:["odf"]},"application/vnd.oasis.opendocument.formula-template":{source:"iana",extensions:["odft"]},"application/vnd.oasis.opendocument.graphics":{source:"iana",compressible:!1,extensions:["odg"]},"application/vnd.oasis.opendocument.graphics-template":{source:"iana",extensions:["otg"]},"application/vnd.oasis.opendocument.image":{source:"iana",extensions:["odi"]},"application/vnd.oasis.opendocument.image-template":{source:"iana",extensions:["oti"]},"application/vnd.oasis.opendocument.presentation":{source:"iana",compressible:!1,extensions:["odp"]},"application/vnd.oasis.opendocument.presentation-template":{source:"iana",extensions:["otp"]},"application/vnd.oasis.opendocument.spreadsheet":{source:"iana",compressible:!1,extensions:["ods"]},"application/vnd.oasis.opendocument.spreadsheet-template":{source:"iana",extensions:["ots"]},"application/vnd.oasis.opendocument.text":{source:"iana",compressible:!1,extensions:["odt"]},"application/vnd.oasis.opendocument.text-master":{source:"iana",extensions:["odm"]},"application/vnd.oasis.opendocument.text-master-template":{source:"iana"},"application/vnd.oasis.opendocument.text-template":{source:"iana",extensions:["ott"]},"application/vnd.oasis.opendocument.text-web":{source:"iana",extensions:["oth"]},"application/vnd.obn":{source:"iana"},"application/vnd.ocf+cbor":{source:"iana"},"application/vnd.oci.image.manifest.v1+json":{source:"iana",compressible:!0},"application/vnd.oftn.l10n+json":{source:"iana",compressible:!0},"application/vnd.oipf.contentaccessdownload+xml":{source:"iana",compressible:!0},"application/vnd.oipf.contentaccessstreaming+xml":{source:"iana",compressible:!0},"application/vnd.oipf.cspg-hexbinary":{source:"iana"},"application/vnd.oipf.dae.svg+xml":{source:"iana",compressible:!0},"application/vnd.oipf.dae.xhtml+xml":{source:"iana",compressible:!0},"application/vnd.oipf.mippvcontrolmessage+xml":{source:"iana",compressible:!0},"application/vnd.oipf.pae.gem":{source:"iana"},"application/vnd.oipf.spdiscovery+xml":{source:"iana",compressible:!0},"application/vnd.oipf.spdlist+xml":{source:"iana",compressible:!0},"application/vnd.oipf.ueprofile+xml":{source:"iana",compressible:!0},"application/vnd.oipf.userprofile+xml":{source:"iana",compressible:!0},"application/vnd.olpc-sugar":{source:"iana",extensions:["xo"]},"application/vnd.oma-scws-config":{source:"iana"},"application/vnd.oma-scws-http-request":{source:"iana"},"application/vnd.oma-scws-http-response":{source:"iana"},"application/vnd.oma.bcast.associated-procedure-parameter+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.drm-trigger+xml":{source:"apache",compressible:!0},"application/vnd.oma.bcast.imd+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.ltkm":{source:"iana"},"application/vnd.oma.bcast.notification+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.provisioningtrigger":{source:"iana"},"application/vnd.oma.bcast.sgboot":{source:"iana"},"application/vnd.oma.bcast.sgdd+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.sgdu":{source:"iana"},"application/vnd.oma.bcast.simple-symbol-container":{source:"iana"},"application/vnd.oma.bcast.smartcard-trigger+xml":{source:"apache",compressible:!0},"application/vnd.oma.bcast.sprov+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.stkm":{source:"iana"},"application/vnd.oma.cab-address-book+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-feature-handler+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-pcc+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-subs-invite+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-user-prefs+xml":{source:"iana",compressible:!0},"application/vnd.oma.dcd":{source:"iana"},"application/vnd.oma.dcdc":{source:"iana"},"application/vnd.oma.dd2+xml":{source:"iana",compressible:!0,extensions:["dd2"]},"application/vnd.oma.drm.risd+xml":{source:"iana",compressible:!0},"application/vnd.oma.group-usage-list+xml":{source:"iana",compressible:!0},"application/vnd.oma.lwm2m+cbor":{source:"iana"},"application/vnd.oma.lwm2m+json":{source:"iana",compressible:!0},"application/vnd.oma.lwm2m+tlv":{source:"iana"},"application/vnd.oma.pal+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.detailed-progress-report+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.final-report+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.groups+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.invocation-descriptor+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.optimized-progress-report+xml":{source:"iana",compressible:!0},"application/vnd.oma.push":{source:"iana"},"application/vnd.oma.scidm.messages+xml":{source:"iana",compressible:!0},"application/vnd.oma.xcap-directory+xml":{source:"iana",compressible:!0},"application/vnd.omads-email+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.omads-file+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.omads-folder+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.omaloc-supl-init":{source:"iana"},"application/vnd.onepager":{source:"iana"},"application/vnd.onepagertamp":{source:"iana"},"application/vnd.onepagertamx":{source:"iana"},"application/vnd.onepagertat":{source:"iana"},"application/vnd.onepagertatp":{source:"iana"},"application/vnd.onepagertatx":{source:"iana"},"application/vnd.onvif.metadata":{source:"iana"},"application/vnd.openblox.game+xml":{source:"iana",compressible:!0,extensions:["obgx"]},"application/vnd.openblox.game-binary":{source:"iana"},"application/vnd.openeye.oeb":{source:"iana"},"application/vnd.openofficeorg.extension":{source:"apache",extensions:["oxt"]},"application/vnd.openstreetmap.data+xml":{source:"iana",compressible:!0,extensions:["osm"]},"application/vnd.opentimestamps.ots":{source:"iana"},"application/vnd.openvpi.dspx+json":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.custom-properties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.customxmlproperties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawing+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.chart+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramcolors+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramdata+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramlayout+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramstyle+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.extended-properties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.commentauthors+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.comments+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.handoutmaster+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.notesmaster+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.notesslide+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.presentation":{source:"iana",compressible:!1,extensions:["pptx"]},"application/vnd.openxmlformats-officedocument.presentationml.presentation.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.presprops+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slide":{source:"iana",extensions:["sldx"]},"application/vnd.openxmlformats-officedocument.presentationml.slide+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slidelayout+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slidemaster+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slideshow":{source:"iana",extensions:["ppsx"]},"application/vnd.openxmlformats-officedocument.presentationml.slideshow.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slideupdateinfo+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.tablestyles+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.tags+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.template":{source:"iana",extensions:["potx"]},"application/vnd.openxmlformats-officedocument.presentationml.template.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.viewprops+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.calcchain+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.externallink+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.pivotcachedefinition+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.pivotcacherecords+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.pivottable+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.querytable+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.revisionheaders+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.revisionlog+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedstrings+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":{source:"iana",compressible:!1,extensions:["xlsx"]},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheetmetadata+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.tablesinglecells+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.template":{source:"iana",extensions:["xltx"]},"application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.usernames+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.volatiledependencies+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.theme+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.themeoverride+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.vmldrawing":{source:"iana"},"application/vnd.openxmlformats-officedocument.wordprocessingml.comments+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.document":{source:"iana",compressible:!1,extensions:["docx"]},"application/vnd.openxmlformats-officedocument.wordprocessingml.document.glossary+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.document.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.endnotes+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.fonttable+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.footer+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.footnotes+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.numbering+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.settings+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.styles+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.template":{source:"iana",extensions:["dotx"]},"application/vnd.openxmlformats-officedocument.wordprocessingml.template.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.websettings+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-package.core-properties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-package.digital-signature-xmlsignature+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-package.relationships+xml":{source:"iana",compressible:!0},"application/vnd.oracle.resource+json":{source:"iana",compressible:!0},"application/vnd.orange.indata":{source:"iana"},"application/vnd.osa.netdeploy":{source:"iana"},"application/vnd.osgeo.mapguide.package":{source:"iana",extensions:["mgp"]},"application/vnd.osgi.bundle":{source:"iana"},"application/vnd.osgi.dp":{source:"iana",extensions:["dp"]},"application/vnd.osgi.subsystem":{source:"iana",extensions:["esa"]},"application/vnd.otps.ct-kip+xml":{source:"iana",compressible:!0},"application/vnd.oxli.countgraph":{source:"iana"},"application/vnd.pagerduty+json":{source:"iana",compressible:!0},"application/vnd.palm":{source:"iana",extensions:["pdb","pqa","oprc"]},"application/vnd.panoply":{source:"iana"},"application/vnd.paos.xml":{source:"iana"},"application/vnd.patentdive":{source:"iana"},"application/vnd.patientecommsdoc":{source:"iana"},"application/vnd.pawaafile":{source:"iana",extensions:["paw"]},"application/vnd.pcos":{source:"iana"},"application/vnd.pg.format":{source:"iana",extensions:["str"]},"application/vnd.pg.osasli":{source:"iana",extensions:["ei6"]},"application/vnd.piaccess.application-licence":{source:"iana"},"application/vnd.picsel":{source:"iana",extensions:["efif"]},"application/vnd.pmi.widget":{source:"iana",extensions:["wg"]},"application/vnd.poc.group-advertisement+xml":{source:"iana",compressible:!0},"application/vnd.pocketlearn":{source:"iana",extensions:["plf"]},"application/vnd.powerbuilder6":{source:"iana",extensions:["pbd"]},"application/vnd.powerbuilder6-s":{source:"iana"},"application/vnd.powerbuilder7":{source:"iana"},"application/vnd.powerbuilder7-s":{source:"iana"},"application/vnd.powerbuilder75":{source:"iana"},"application/vnd.powerbuilder75-s":{source:"iana"},"application/vnd.preminet":{source:"iana"},"application/vnd.previewsystems.box":{source:"iana",extensions:["box"]},"application/vnd.procrate.brushset":{extensions:["brushset"]},"application/vnd.procreate.brush":{extensions:["brush"]},"application/vnd.procreate.dream":{extensions:["drm"]},"application/vnd.proteus.magazine":{source:"iana",extensions:["mgz"]},"application/vnd.psfs":{source:"iana"},"application/vnd.pt.mundusmundi":{source:"iana"},"application/vnd.publishare-delta-tree":{source:"iana",extensions:["qps"]},"application/vnd.pvi.ptid1":{source:"iana",extensions:["ptid"]},"application/vnd.pwg-multiplexed":{source:"iana"},"application/vnd.pwg-xhtml-print+xml":{source:"iana",compressible:!0,extensions:["xhtm"]},"application/vnd.qualcomm.brew-app-res":{source:"iana"},"application/vnd.quarantainenet":{source:"iana"},"application/vnd.quark.quarkxpress":{source:"iana",extensions:["qxd","qxt","qwd","qwt","qxl","qxb"]},"application/vnd.quobject-quoxdocument":{source:"iana"},"application/vnd.radisys.moml+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-conf+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-conn+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-dialog+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-stream+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-conf+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-base+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-fax-detect+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-fax-sendrecv+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-group+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-speech+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-transform+xml":{source:"iana",compressible:!0},"application/vnd.rainstor.data":{source:"iana"},"application/vnd.rapid":{source:"iana"},"application/vnd.rar":{source:"iana",extensions:["rar"]},"application/vnd.realvnc.bed":{source:"iana",extensions:["bed"]},"application/vnd.recordare.musicxml":{source:"iana",extensions:["mxl"]},"application/vnd.recordare.musicxml+xml":{source:"iana",compressible:!0,extensions:["musicxml"]},"application/vnd.relpipe":{source:"iana"},"application/vnd.renlearn.rlprint":{source:"iana"},"application/vnd.resilient.logic":{source:"iana"},"application/vnd.restful+json":{source:"iana",compressible:!0},"application/vnd.rig.cryptonote":{source:"iana",extensions:["cryptonote"]},"application/vnd.rim.cod":{source:"apache",extensions:["cod"]},"application/vnd.rn-realmedia":{source:"apache",extensions:["rm"]},"application/vnd.rn-realmedia-vbr":{source:"apache",extensions:["rmvb"]},"application/vnd.route66.link66+xml":{source:"iana",compressible:!0,extensions:["link66"]},"application/vnd.rs-274x":{source:"iana"},"application/vnd.ruckus.download":{source:"iana"},"application/vnd.s3sms":{source:"iana"},"application/vnd.sailingtracker.track":{source:"iana",extensions:["st"]},"application/vnd.sar":{source:"iana"},"application/vnd.sbm.cid":{source:"iana"},"application/vnd.sbm.mid2":{source:"iana"},"application/vnd.scribus":{source:"iana"},"application/vnd.sealed.3df":{source:"iana"},"application/vnd.sealed.csf":{source:"iana"},"application/vnd.sealed.doc":{source:"iana"},"application/vnd.sealed.eml":{source:"iana"},"application/vnd.sealed.mht":{source:"iana"},"application/vnd.sealed.net":{source:"iana"},"application/vnd.sealed.ppt":{source:"iana"},"application/vnd.sealed.tiff":{source:"iana"},"application/vnd.sealed.xls":{source:"iana"},"application/vnd.sealedmedia.softseal.html":{source:"iana"},"application/vnd.sealedmedia.softseal.pdf":{source:"iana"},"application/vnd.seemail":{source:"iana",extensions:["see"]},"application/vnd.seis+json":{source:"iana",compressible:!0},"application/vnd.sema":{source:"iana",extensions:["sema"]},"application/vnd.semd":{source:"iana",extensions:["semd"]},"application/vnd.semf":{source:"iana",extensions:["semf"]},"application/vnd.shade-save-file":{source:"iana"},"application/vnd.shana.informed.formdata":{source:"iana",extensions:["ifm"]},"application/vnd.shana.informed.formtemplate":{source:"iana",extensions:["itp"]},"application/vnd.shana.informed.interchange":{source:"iana",extensions:["iif"]},"application/vnd.shana.informed.package":{source:"iana",extensions:["ipk"]},"application/vnd.shootproof+json":{source:"iana",compressible:!0},"application/vnd.shopkick+json":{source:"iana",compressible:!0},"application/vnd.shp":{source:"iana"},"application/vnd.shx":{source:"iana"},"application/vnd.sigrok.session":{source:"iana"},"application/vnd.simtech-mindmapper":{source:"iana",extensions:["twd","twds"]},"application/vnd.siren+json":{source:"iana",compressible:!0},"application/vnd.sketchometry":{source:"iana"},"application/vnd.smaf":{source:"iana",extensions:["mmf"]},"application/vnd.smart.notebook":{source:"iana"},"application/vnd.smart.teacher":{source:"iana",extensions:["teacher"]},"application/vnd.smintio.portals.archive":{source:"iana"},"application/vnd.snesdev-page-table":{source:"iana"},"application/vnd.software602.filler.form+xml":{source:"iana",compressible:!0,extensions:["fo"]},"application/vnd.software602.filler.form-xml-zip":{source:"iana"},"application/vnd.solent.sdkm+xml":{source:"iana",compressible:!0,extensions:["sdkm","sdkd"]},"application/vnd.spotfire.dxp":{source:"iana",extensions:["dxp"]},"application/vnd.spotfire.sfs":{source:"iana",extensions:["sfs"]},"application/vnd.sqlite3":{source:"iana"},"application/vnd.sss-cod":{source:"iana"},"application/vnd.sss-dtf":{source:"iana"},"application/vnd.sss-ntf":{source:"iana"},"application/vnd.stardivision.calc":{source:"apache",extensions:["sdc"]},"application/vnd.stardivision.draw":{source:"apache",extensions:["sda"]},"application/vnd.stardivision.impress":{source:"apache",extensions:["sdd"]},"application/vnd.stardivision.math":{source:"apache",extensions:["smf"]},"application/vnd.stardivision.writer":{source:"apache",extensions:["sdw","vor"]},"application/vnd.stardivision.writer-global":{source:"apache",extensions:["sgl"]},"application/vnd.stepmania.package":{source:"iana",extensions:["smzip"]},"application/vnd.stepmania.stepchart":{source:"iana",extensions:["sm"]},"application/vnd.street-stream":{source:"iana"},"application/vnd.sun.wadl+xml":{source:"iana",compressible:!0,extensions:["wadl"]},"application/vnd.sun.xml.calc":{source:"apache",extensions:["sxc"]},"application/vnd.sun.xml.calc.template":{source:"apache",extensions:["stc"]},"application/vnd.sun.xml.draw":{source:"apache",extensions:["sxd"]},"application/vnd.sun.xml.draw.template":{source:"apache",extensions:["std"]},"application/vnd.sun.xml.impress":{source:"apache",extensions:["sxi"]},"application/vnd.sun.xml.impress.template":{source:"apache",extensions:["sti"]},"application/vnd.sun.xml.math":{source:"apache",extensions:["sxm"]},"application/vnd.sun.xml.writer":{source:"apache",extensions:["sxw"]},"application/vnd.sun.xml.writer.global":{source:"apache",extensions:["sxg"]},"application/vnd.sun.xml.writer.template":{source:"apache",extensions:["stw"]},"application/vnd.sus-calendar":{source:"iana",extensions:["sus","susp"]},"application/vnd.svd":{source:"iana",extensions:["svd"]},"application/vnd.swiftview-ics":{source:"iana"},"application/vnd.sybyl.mol2":{source:"iana"},"application/vnd.sycle+xml":{source:"iana",compressible:!0},"application/vnd.syft+json":{source:"iana",compressible:!0},"application/vnd.symbian.install":{source:"apache",extensions:["sis","sisx"]},"application/vnd.syncml+xml":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["xsm"]},"application/vnd.syncml.dm+wbxml":{source:"iana",charset:"UTF-8",extensions:["bdm"]},"application/vnd.syncml.dm+xml":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["xdm"]},"application/vnd.syncml.dm.notification":{source:"iana"},"application/vnd.syncml.dmddf+wbxml":{source:"iana"},"application/vnd.syncml.dmddf+xml":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["ddf"]},"application/vnd.syncml.dmtnds+wbxml":{source:"iana"},"application/vnd.syncml.dmtnds+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.syncml.ds.notification":{source:"iana"},"application/vnd.tableschema+json":{source:"iana",compressible:!0},"application/vnd.tao.intent-module-archive":{source:"iana",extensions:["tao"]},"application/vnd.tcpdump.pcap":{source:"iana",extensions:["pcap","cap","dmp"]},"application/vnd.think-cell.ppttc+json":{source:"iana",compressible:!0},"application/vnd.tmd.mediaflex.api+xml":{source:"iana",compressible:!0},"application/vnd.tml":{source:"iana"},"application/vnd.tmobile-livetv":{source:"iana",extensions:["tmo"]},"application/vnd.tri.onesource":{source:"iana"},"application/vnd.trid.tpt":{source:"iana",extensions:["tpt"]},"application/vnd.triscape.mxs":{source:"iana",extensions:["mxs"]},"application/vnd.trueapp":{source:"iana",extensions:["tra"]},"application/vnd.truedoc":{source:"iana"},"application/vnd.ubisoft.webplayer":{source:"iana"},"application/vnd.ufdl":{source:"iana",extensions:["ufd","ufdl"]},"application/vnd.uic.osdm+json":{source:"iana",compressible:!0},"application/vnd.uiq.theme":{source:"iana",extensions:["utz"]},"application/vnd.umajin":{source:"iana",extensions:["umj"]},"application/vnd.unity":{source:"iana",extensions:["unityweb"]},"application/vnd.uoml+xml":{source:"iana",compressible:!0,extensions:["uoml","uo"]},"application/vnd.uplanet.alert":{source:"iana"},"application/vnd.uplanet.alert-wbxml":{source:"iana"},"application/vnd.uplanet.bearer-choice":{source:"iana"},"application/vnd.uplanet.bearer-choice-wbxml":{source:"iana"},"application/vnd.uplanet.cacheop":{source:"iana"},"application/vnd.uplanet.cacheop-wbxml":{source:"iana"},"application/vnd.uplanet.channel":{source:"iana"},"application/vnd.uplanet.channel-wbxml":{source:"iana"},"application/vnd.uplanet.list":{source:"iana"},"application/vnd.uplanet.list-wbxml":{source:"iana"},"application/vnd.uplanet.listcmd":{source:"iana"},"application/vnd.uplanet.listcmd-wbxml":{source:"iana"},"application/vnd.uplanet.signal":{source:"iana"},"application/vnd.uri-map":{source:"iana"},"application/vnd.valve.source.material":{source:"iana"},"application/vnd.vcx":{source:"iana",extensions:["vcx"]},"application/vnd.vd-study":{source:"iana"},"application/vnd.vectorworks":{source:"iana"},"application/vnd.vel+json":{source:"iana",compressible:!0},"application/vnd.veraison.tsm-report+cbor":{source:"iana"},"application/vnd.veraison.tsm-report+json":{source:"iana",compressible:!0},"application/vnd.verimatrix.vcas":{source:"iana"},"application/vnd.veritone.aion+json":{source:"iana",compressible:!0},"application/vnd.veryant.thin":{source:"iana"},"application/vnd.ves.encrypted":{source:"iana"},"application/vnd.vidsoft.vidconference":{source:"iana"},"application/vnd.visio":{source:"iana",extensions:["vsd","vst","vss","vsw","vsdx","vtx"]},"application/vnd.visionary":{source:"iana",extensions:["vis"]},"application/vnd.vividence.scriptfile":{source:"iana"},"application/vnd.vocalshaper.vsp4":{source:"iana"},"application/vnd.vsf":{source:"iana",extensions:["vsf"]},"application/vnd.wap.sic":{source:"iana"},"application/vnd.wap.slc":{source:"iana"},"application/vnd.wap.wbxml":{source:"iana",charset:"UTF-8",extensions:["wbxml"]},"application/vnd.wap.wmlc":{source:"iana",extensions:["wmlc"]},"application/vnd.wap.wmlscriptc":{source:"iana",extensions:["wmlsc"]},"application/vnd.wasmflow.wafl":{source:"iana"},"application/vnd.webturbo":{source:"iana",extensions:["wtb"]},"application/vnd.wfa.dpp":{source:"iana"},"application/vnd.wfa.p2p":{source:"iana"},"application/vnd.wfa.wsc":{source:"iana"},"application/vnd.windows.devicepairing":{source:"iana"},"application/vnd.wmc":{source:"iana"},"application/vnd.wmf.bootstrap":{source:"iana"},"application/vnd.wolfram.mathematica":{source:"iana"},"application/vnd.wolfram.mathematica.package":{source:"iana"},"application/vnd.wolfram.player":{source:"iana",extensions:["nbp"]},"application/vnd.wordlift":{source:"iana"},"application/vnd.wordperfect":{source:"iana",extensions:["wpd"]},"application/vnd.wqd":{source:"iana",extensions:["wqd"]},"application/vnd.wrq-hp3000-labelled":{source:"iana"},"application/vnd.wt.stf":{source:"iana",extensions:["stf"]},"application/vnd.wv.csp+wbxml":{source:"iana"},"application/vnd.wv.csp+xml":{source:"iana",compressible:!0},"application/vnd.wv.ssp+xml":{source:"iana",compressible:!0},"application/vnd.xacml+json":{source:"iana",compressible:!0},"application/vnd.xara":{source:"iana",extensions:["xar"]},"application/vnd.xarin.cpj":{source:"iana"},"application/vnd.xecrets-encrypted":{source:"iana"},"application/vnd.xfdl":{source:"iana",extensions:["xfdl"]},"application/vnd.xfdl.webform":{source:"iana"},"application/vnd.xmi+xml":{source:"iana",compressible:!0},"application/vnd.xmpie.cpkg":{source:"iana"},"application/vnd.xmpie.dpkg":{source:"iana"},"application/vnd.xmpie.plan":{source:"iana"},"application/vnd.xmpie.ppkg":{source:"iana"},"application/vnd.xmpie.xlim":{source:"iana"},"application/vnd.yamaha.hv-dic":{source:"iana",extensions:["hvd"]},"application/vnd.yamaha.hv-script":{source:"iana",extensions:["hvs"]},"application/vnd.yamaha.hv-voice":{source:"iana",extensions:["hvp"]},"application/vnd.yamaha.openscoreformat":{source:"iana",extensions:["osf"]},"application/vnd.yamaha.openscoreformat.osfpvg+xml":{source:"iana",compressible:!0,extensions:["osfpvg"]},"application/vnd.yamaha.remote-setup":{source:"iana"},"application/vnd.yamaha.smaf-audio":{source:"iana",extensions:["saf"]},"application/vnd.yamaha.smaf-phrase":{source:"iana",extensions:["spf"]},"application/vnd.yamaha.through-ngn":{source:"iana"},"application/vnd.yamaha.tunnel-udpencap":{source:"iana"},"application/vnd.yaoweme":{source:"iana"},"application/vnd.yellowriver-custom-menu":{source:"iana",extensions:["cmp"]},"application/vnd.zul":{source:"iana",extensions:["zir","zirz"]},"application/vnd.zzazz.deck+xml":{source:"iana",compressible:!0,extensions:["zaz"]},"application/voicexml+xml":{source:"iana",compressible:!0,extensions:["vxml"]},"application/voucher-cms+json":{source:"iana",compressible:!0},"application/voucher-jws+json":{source:"iana",compressible:!0},"application/vp":{source:"iana"},"application/vp+cose":{source:"iana"},"application/vp+jwt":{source:"iana"},"application/vq-rtcpxr":{source:"iana"},"application/wasm":{source:"iana",compressible:!0,extensions:["wasm"]},"application/watcherinfo+xml":{source:"iana",compressible:!0,extensions:["wif"]},"application/webpush-options+json":{source:"iana",compressible:!0},"application/whoispp-query":{source:"iana"},"application/whoispp-response":{source:"iana"},"application/widget":{source:"iana",extensions:["wgt"]},"application/winhlp":{source:"apache",extensions:["hlp"]},"application/wita":{source:"iana"},"application/wordperfect5.1":{source:"iana"},"application/wsdl+xml":{source:"iana",compressible:!0,extensions:["wsdl"]},"application/wspolicy+xml":{source:"iana",compressible:!0,extensions:["wspolicy"]},"application/x-7z-compressed":{source:"apache",compressible:!1,extensions:["7z"]},"application/x-abiword":{source:"apache",extensions:["abw"]},"application/x-ace-compressed":{source:"apache",extensions:["ace"]},"application/x-amf":{source:"apache"},"application/x-apple-diskimage":{source:"apache",extensions:["dmg"]},"application/x-arj":{compressible:!1,extensions:["arj"]},"application/x-authorware-bin":{source:"apache",extensions:["aab","x32","u32","vox"]},"application/x-authorware-map":{source:"apache",extensions:["aam"]},"application/x-authorware-seg":{source:"apache",extensions:["aas"]},"application/x-bcpio":{source:"apache",extensions:["bcpio"]},"application/x-bdoc":{compressible:!1,extensions:["bdoc"]},"application/x-bittorrent":{source:"apache",extensions:["torrent"]},"application/x-blender":{extensions:["blend"]},"application/x-blorb":{source:"apache",extensions:["blb","blorb"]},"application/x-bzip":{source:"apache",compressible:!1,extensions:["bz"]},"application/x-bzip2":{source:"apache",compressible:!1,extensions:["bz2","boz"]},"application/x-cbr":{source:"apache",extensions:["cbr","cba","cbt","cbz","cb7"]},"application/x-cdlink":{source:"apache",extensions:["vcd"]},"application/x-cfs-compressed":{source:"apache",extensions:["cfs"]},"application/x-chat":{source:"apache",extensions:["chat"]},"application/x-chess-pgn":{source:"apache",extensions:["pgn"]},"application/x-chrome-extension":{extensions:["crx"]},"application/x-cocoa":{source:"nginx",extensions:["cco"]},"application/x-compress":{source:"apache"},"application/x-compressed":{extensions:["rar"]},"application/x-conference":{source:"apache",extensions:["nsc"]},"application/x-cpio":{source:"apache",extensions:["cpio"]},"application/x-csh":{source:"apache",extensions:["csh"]},"application/x-deb":{compressible:!1},"application/x-debian-package":{source:"apache",extensions:["deb","udeb"]},"application/x-dgc-compressed":{source:"apache",extensions:["dgc"]},"application/x-director":{source:"apache",extensions:["dir","dcr","dxr","cst","cct","cxt","w3d","fgd","swa"]},"application/x-doom":{source:"apache",extensions:["wad"]},"application/x-dtbncx+xml":{source:"apache",compressible:!0,extensions:["ncx"]},"application/x-dtbook+xml":{source:"apache",compressible:!0,extensions:["dtb"]},"application/x-dtbresource+xml":{source:"apache",compressible:!0,extensions:["res"]},"application/x-dvi":{source:"apache",compressible:!1,extensions:["dvi"]},"application/x-envoy":{source:"apache",extensions:["evy"]},"application/x-eva":{source:"apache",extensions:["eva"]},"application/x-font-bdf":{source:"apache",extensions:["bdf"]},"application/x-font-dos":{source:"apache"},"application/x-font-framemaker":{source:"apache"},"application/x-font-ghostscript":{source:"apache",extensions:["gsf"]},"application/x-font-libgrx":{source:"apache"},"application/x-font-linux-psf":{source:"apache",extensions:["psf"]},"application/x-font-pcf":{source:"apache",extensions:["pcf"]},"application/x-font-snf":{source:"apache",extensions:["snf"]},"application/x-font-speedo":{source:"apache"},"application/x-font-sunos-news":{source:"apache"},"application/x-font-type1":{source:"apache",extensions:["pfa","pfb","pfm","afm"]},"application/x-font-vfont":{source:"apache"},"application/x-freearc":{source:"apache",extensions:["arc"]},"application/x-futuresplash":{source:"apache",extensions:["spl"]},"application/x-gca-compressed":{source:"apache",extensions:["gca"]},"application/x-glulx":{source:"apache",extensions:["ulx"]},"application/x-gnumeric":{source:"apache",extensions:["gnumeric"]},"application/x-gramps-xml":{source:"apache",extensions:["gramps"]},"application/x-gtar":{source:"apache",extensions:["gtar"]},"application/x-gzip":{source:"apache"},"application/x-hdf":{source:"apache",extensions:["hdf"]},"application/x-httpd-php":{compressible:!0,extensions:["php"]},"application/x-install-instructions":{source:"apache",extensions:["install"]},"application/x-ipynb+json":{compressible:!0,extensions:["ipynb"]},"application/x-iso9660-image":{source:"apache",extensions:["iso"]},"application/x-iwork-keynote-sffkey":{extensions:["key"]},"application/x-iwork-numbers-sffnumbers":{extensions:["numbers"]},"application/x-iwork-pages-sffpages":{extensions:["pages"]},"application/x-java-archive-diff":{source:"nginx",extensions:["jardiff"]},"application/x-java-jnlp-file":{source:"apache",compressible:!1,extensions:["jnlp"]},"application/x-javascript":{compressible:!0},"application/x-keepass2":{extensions:["kdbx"]},"application/x-latex":{source:"apache",compressible:!1,extensions:["latex"]},"application/x-lua-bytecode":{extensions:["luac"]},"application/x-lzh-compressed":{source:"apache",extensions:["lzh","lha"]},"application/x-makeself":{source:"nginx",extensions:["run"]},"application/x-mie":{source:"apache",extensions:["mie"]},"application/x-mobipocket-ebook":{source:"apache",extensions:["prc","mobi"]},"application/x-mpegurl":{compressible:!1},"application/x-ms-application":{source:"apache",extensions:["application"]},"application/x-ms-shortcut":{source:"apache",extensions:["lnk"]},"application/x-ms-wmd":{source:"apache",extensions:["wmd"]},"application/x-ms-wmz":{source:"apache",extensions:["wmz"]},"application/x-ms-xbap":{source:"apache",extensions:["xbap"]},"application/x-msaccess":{source:"apache",extensions:["mdb"]},"application/x-msbinder":{source:"apache",extensions:["obd"]},"application/x-mscardfile":{source:"apache",extensions:["crd"]},"application/x-msclip":{source:"apache",extensions:["clp"]},"application/x-msdos-program":{extensions:["exe"]},"application/x-msdownload":{source:"apache",extensions:["exe","dll","com","bat","msi"]},"application/x-msmediaview":{source:"apache",extensions:["mvb","m13","m14"]},"application/x-msmetafile":{source:"apache",extensions:["wmf","wmz","emf","emz"]},"application/x-msmoney":{source:"apache",extensions:["mny"]},"application/x-mspublisher":{source:"apache",extensions:["pub"]},"application/x-msschedule":{source:"apache",extensions:["scd"]},"application/x-msterminal":{source:"apache",extensions:["trm"]},"application/x-mswrite":{source:"apache",extensions:["wri"]},"application/x-netcdf":{source:"apache",extensions:["nc","cdf"]},"application/x-ns-proxy-autoconfig":{compressible:!0,extensions:["pac"]},"application/x-nzb":{source:"apache",extensions:["nzb"]},"application/x-perl":{source:"nginx",extensions:["pl","pm"]},"application/x-pilot":{source:"nginx",extensions:["prc","pdb"]},"application/x-pkcs12":{source:"apache",compressible:!1,extensions:["p12","pfx"]},"application/x-pkcs7-certificates":{source:"apache",extensions:["p7b","spc"]},"application/x-pkcs7-certreqresp":{source:"apache",extensions:["p7r"]},"application/x-pki-message":{source:"iana"},"application/x-rar-compressed":{source:"apache",compressible:!1,extensions:["rar"]},"application/x-redhat-package-manager":{source:"nginx",extensions:["rpm"]},"application/x-research-info-systems":{source:"apache",extensions:["ris"]},"application/x-sea":{source:"nginx",extensions:["sea"]},"application/x-sh":{source:"apache",compressible:!0,extensions:["sh"]},"application/x-shar":{source:"apache",extensions:["shar"]},"application/x-shockwave-flash":{source:"apache",compressible:!1,extensions:["swf"]},"application/x-silverlight-app":{source:"apache",extensions:["xap"]},"application/x-sql":{source:"apache",extensions:["sql"]},"application/x-stuffit":{source:"apache",compressible:!1,extensions:["sit"]},"application/x-stuffitx":{source:"apache",extensions:["sitx"]},"application/x-subrip":{source:"apache",extensions:["srt"]},"application/x-sv4cpio":{source:"apache",extensions:["sv4cpio"]},"application/x-sv4crc":{source:"apache",extensions:["sv4crc"]},"application/x-t3vm-image":{source:"apache",extensions:["t3"]},"application/x-tads":{source:"apache",extensions:["gam"]},"application/x-tar":{source:"apache",compressible:!0,extensions:["tar"]},"application/x-tcl":{source:"apache",extensions:["tcl","tk"]},"application/x-tex":{source:"apache",extensions:["tex"]},"application/x-tex-tfm":{source:"apache",extensions:["tfm"]},"application/x-texinfo":{source:"apache",extensions:["texinfo","texi"]},"application/x-tgif":{source:"apache",extensions:["obj"]},"application/x-ustar":{source:"apache",extensions:["ustar"]},"application/x-virtualbox-hdd":{compressible:!0,extensions:["hdd"]},"application/x-virtualbox-ova":{compressible:!0,extensions:["ova"]},"application/x-virtualbox-ovf":{compressible:!0,extensions:["ovf"]},"application/x-virtualbox-vbox":{compressible:!0,extensions:["vbox"]},"application/x-virtualbox-vbox-extpack":{compressible:!1,extensions:["vbox-extpack"]},"application/x-virtualbox-vdi":{compressible:!0,extensions:["vdi"]},"application/x-virtualbox-vhd":{compressible:!0,extensions:["vhd"]},"application/x-virtualbox-vmdk":{compressible:!0,extensions:["vmdk"]},"application/x-wais-source":{source:"apache",extensions:["src"]},"application/x-web-app-manifest+json":{compressible:!0,extensions:["webapp"]},"application/x-www-form-urlencoded":{source:"iana",compressible:!0},"application/x-x509-ca-cert":{source:"iana",extensions:["der","crt","pem"]},"application/x-x509-ca-ra-cert":{source:"iana"},"application/x-x509-next-ca-cert":{source:"iana"},"application/x-xfig":{source:"apache",extensions:["fig"]},"application/x-xliff+xml":{source:"apache",compressible:!0,extensions:["xlf"]},"application/x-xpinstall":{source:"apache",compressible:!1,extensions:["xpi"]},"application/x-xz":{source:"apache",extensions:["xz"]},"application/x-zip-compressed":{extensions:["zip"]},"application/x-zmachine":{source:"apache",extensions:["z1","z2","z3","z4","z5","z6","z7","z8"]},"application/x400-bp":{source:"iana"},"application/xacml+xml":{source:"iana",compressible:!0},"application/xaml+xml":{source:"apache",compressible:!0,extensions:["xaml"]},"application/xcap-att+xml":{source:"iana",compressible:!0,extensions:["xav"]},"application/xcap-caps+xml":{source:"iana",compressible:!0,extensions:["xca"]},"application/xcap-diff+xml":{source:"iana",compressible:!0,extensions:["xdf"]},"application/xcap-el+xml":{source:"iana",compressible:!0,extensions:["xel"]},"application/xcap-error+xml":{source:"iana",compressible:!0},"application/xcap-ns+xml":{source:"iana",compressible:!0,extensions:["xns"]},"application/xcon-conference-info+xml":{source:"iana",compressible:!0},"application/xcon-conference-info-diff+xml":{source:"iana",compressible:!0},"application/xenc+xml":{source:"iana",compressible:!0,extensions:["xenc"]},"application/xfdf":{source:"iana",extensions:["xfdf"]},"application/xhtml+xml":{source:"iana",compressible:!0,extensions:["xhtml","xht"]},"application/xhtml-voice+xml":{source:"apache",compressible:!0},"application/xliff+xml":{source:"iana",compressible:!0,extensions:["xlf"]},"application/xml":{source:"iana",compressible:!0,extensions:["xml","xsl","xsd","rng"]},"application/xml-dtd":{source:"iana",compressible:!0,extensions:["dtd"]},"application/xml-external-parsed-entity":{source:"iana"},"application/xml-patch+xml":{source:"iana",compressible:!0},"application/xmpp+xml":{source:"iana",compressible:!0},"application/xop+xml":{source:"iana",compressible:!0,extensions:["xop"]},"application/xproc+xml":{source:"apache",compressible:!0,extensions:["xpl"]},"application/xslt+xml":{source:"iana",compressible:!0,extensions:["xsl","xslt"]},"application/xspf+xml":{source:"apache",compressible:!0,extensions:["xspf"]},"application/xv+xml":{source:"iana",compressible:!0,extensions:["mxml","xhvml","xvml","xvm"]},"application/yaml":{source:"iana"},"application/yang":{source:"iana",extensions:["yang"]},"application/yang-data+cbor":{source:"iana"},"application/yang-data+json":{source:"iana",compressible:!0},"application/yang-data+xml":{source:"iana",compressible:!0},"application/yang-patch+json":{source:"iana",compressible:!0},"application/yang-patch+xml":{source:"iana",compressible:!0},"application/yang-sid+json":{source:"iana",compressible:!0},"application/yin+xml":{source:"iana",compressible:!0,extensions:["yin"]},"application/zip":{source:"iana",compressible:!1,extensions:["zip"]},"application/zip+dotlottie":{extensions:["lottie"]},"application/zlib":{source:"iana"},"application/zstd":{source:"iana"},"audio/1d-interleaved-parityfec":{source:"iana"},"audio/32kadpcm":{source:"iana"},"audio/3gpp":{source:"iana",compressible:!1,extensions:["3gpp"]},"audio/3gpp2":{source:"iana"},"audio/aac":{source:"iana",extensions:["adts","aac"]},"audio/ac3":{source:"iana"},"audio/adpcm":{source:"apache",extensions:["adp"]},"audio/amr":{source:"iana",extensions:["amr"]},"audio/amr-wb":{source:"iana"},"audio/amr-wb+":{source:"iana"},"audio/aptx":{source:"iana"},"audio/asc":{source:"iana"},"audio/atrac-advanced-lossless":{source:"iana"},"audio/atrac-x":{source:"iana"},"audio/atrac3":{source:"iana"},"audio/basic":{source:"iana",compressible:!1,extensions:["au","snd"]},"audio/bv16":{source:"iana"},"audio/bv32":{source:"iana"},"audio/clearmode":{source:"iana"},"audio/cn":{source:"iana"},"audio/dat12":{source:"iana"},"audio/dls":{source:"iana"},"audio/dsr-es201108":{source:"iana"},"audio/dsr-es202050":{source:"iana"},"audio/dsr-es202211":{source:"iana"},"audio/dsr-es202212":{source:"iana"},"audio/dv":{source:"iana"},"audio/dvi4":{source:"iana"},"audio/eac3":{source:"iana"},"audio/encaprtp":{source:"iana"},"audio/evrc":{source:"iana"},"audio/evrc-qcp":{source:"iana"},"audio/evrc0":{source:"iana"},"audio/evrc1":{source:"iana"},"audio/evrcb":{source:"iana"},"audio/evrcb0":{source:"iana"},"audio/evrcb1":{source:"iana"},"audio/evrcnw":{source:"iana"},"audio/evrcnw0":{source:"iana"},"audio/evrcnw1":{source:"iana"},"audio/evrcwb":{source:"iana"},"audio/evrcwb0":{source:"iana"},"audio/evrcwb1":{source:"iana"},"audio/evs":{source:"iana"},"audio/flac":{source:"iana"},"audio/flexfec":{source:"iana"},"audio/fwdred":{source:"iana"},"audio/g711-0":{source:"iana"},"audio/g719":{source:"iana"},"audio/g722":{source:"iana"},"audio/g7221":{source:"iana"},"audio/g723":{source:"iana"},"audio/g726-16":{source:"iana"},"audio/g726-24":{source:"iana"},"audio/g726-32":{source:"iana"},"audio/g726-40":{source:"iana"},"audio/g728":{source:"iana"},"audio/g729":{source:"iana"},"audio/g7291":{source:"iana"},"audio/g729d":{source:"iana"},"audio/g729e":{source:"iana"},"audio/gsm":{source:"iana"},"audio/gsm-efr":{source:"iana"},"audio/gsm-hr-08":{source:"iana"},"audio/ilbc":{source:"iana"},"audio/ip-mr_v2.5":{source:"iana"},"audio/isac":{source:"apache"},"audio/l16":{source:"iana"},"audio/l20":{source:"iana"},"audio/l24":{source:"iana",compressible:!1},"audio/l8":{source:"iana"},"audio/lpc":{source:"iana"},"audio/matroska":{source:"iana"},"audio/melp":{source:"iana"},"audio/melp1200":{source:"iana"},"audio/melp2400":{source:"iana"},"audio/melp600":{source:"iana"},"audio/mhas":{source:"iana"},"audio/midi":{source:"apache",extensions:["mid","midi","kar","rmi"]},"audio/midi-clip":{source:"iana"},"audio/mobile-xmf":{source:"iana",extensions:["mxmf"]},"audio/mp3":{compressible:!1,extensions:["mp3"]},"audio/mp4":{source:"iana",compressible:!1,extensions:["m4a","mp4a","m4b"]},"audio/mp4a-latm":{source:"iana"},"audio/mpa":{source:"iana"},"audio/mpa-robust":{source:"iana"},"audio/mpeg":{source:"iana",compressible:!1,extensions:["mpga","mp2","mp2a","mp3","m2a","m3a"]},"audio/mpeg4-generic":{source:"iana"},"audio/musepack":{source:"apache"},"audio/ogg":{source:"iana",compressible:!1,extensions:["oga","ogg","spx","opus"]},"audio/opus":{source:"iana"},"audio/parityfec":{source:"iana"},"audio/pcma":{source:"iana"},"audio/pcma-wb":{source:"iana"},"audio/pcmu":{source:"iana"},"audio/pcmu-wb":{source:"iana"},"audio/prs.sid":{source:"iana"},"audio/qcelp":{source:"iana"},"audio/raptorfec":{source:"iana"},"audio/red":{source:"iana"},"audio/rtp-enc-aescm128":{source:"iana"},"audio/rtp-midi":{source:"iana"},"audio/rtploopback":{source:"iana"},"audio/rtx":{source:"iana"},"audio/s3m":{source:"apache",extensions:["s3m"]},"audio/scip":{source:"iana"},"audio/silk":{source:"apache",extensions:["sil"]},"audio/smv":{source:"iana"},"audio/smv-qcp":{source:"iana"},"audio/smv0":{source:"iana"},"audio/sofa":{source:"iana"},"audio/sp-midi":{source:"iana"},"audio/speex":{source:"iana"},"audio/t140c":{source:"iana"},"audio/t38":{source:"iana"},"audio/telephone-event":{source:"iana"},"audio/tetra_acelp":{source:"iana"},"audio/tetra_acelp_bb":{source:"iana"},"audio/tone":{source:"iana"},"audio/tsvcis":{source:"iana"},"audio/uemclip":{source:"iana"},"audio/ulpfec":{source:"iana"},"audio/usac":{source:"iana"},"audio/vdvi":{source:"iana"},"audio/vmr-wb":{source:"iana"},"audio/vnd.3gpp.iufp":{source:"iana"},"audio/vnd.4sb":{source:"iana"},"audio/vnd.audiokoz":{source:"iana"},"audio/vnd.celp":{source:"iana"},"audio/vnd.cisco.nse":{source:"iana"},"audio/vnd.cmles.radio-events":{source:"iana"},"audio/vnd.cns.anp1":{source:"iana"},"audio/vnd.cns.inf1":{source:"iana"},"audio/vnd.dece.audio":{source:"iana",extensions:["uva","uvva"]},"audio/vnd.digital-winds":{source:"iana",extensions:["eol"]},"audio/vnd.dlna.adts":{source:"iana"},"audio/vnd.dolby.heaac.1":{source:"iana"},"audio/vnd.dolby.heaac.2":{source:"iana"},"audio/vnd.dolby.mlp":{source:"iana"},"audio/vnd.dolby.mps":{source:"iana"},"audio/vnd.dolby.pl2":{source:"iana"},"audio/vnd.dolby.pl2x":{source:"iana"},"audio/vnd.dolby.pl2z":{source:"iana"},"audio/vnd.dolby.pulse.1":{source:"iana"},"audio/vnd.dra":{source:"iana",extensions:["dra"]},"audio/vnd.dts":{source:"iana",extensions:["dts"]},"audio/vnd.dts.hd":{source:"iana",extensions:["dtshd"]},"audio/vnd.dts.uhd":{source:"iana"},"audio/vnd.dvb.file":{source:"iana"},"audio/vnd.everad.plj":{source:"iana"},"audio/vnd.hns.audio":{source:"iana"},"audio/vnd.lucent.voice":{source:"iana",extensions:["lvp"]},"audio/vnd.ms-playready.media.pya":{source:"iana",extensions:["pya"]},"audio/vnd.nokia.mobile-xmf":{source:"iana"},"audio/vnd.nortel.vbk":{source:"iana"},"audio/vnd.nuera.ecelp4800":{source:"iana",extensions:["ecelp4800"]},"audio/vnd.nuera.ecelp7470":{source:"iana",extensions:["ecelp7470"]},"audio/vnd.nuera.ecelp9600":{source:"iana",extensions:["ecelp9600"]},"audio/vnd.octel.sbc":{source:"iana"},"audio/vnd.presonus.multitrack":{source:"iana"},"audio/vnd.qcelp":{source:"apache"},"audio/vnd.rhetorex.32kadpcm":{source:"iana"},"audio/vnd.rip":{source:"iana",extensions:["rip"]},"audio/vnd.rn-realaudio":{compressible:!1},"audio/vnd.sealedmedia.softseal.mpeg":{source:"iana"},"audio/vnd.vmx.cvsd":{source:"iana"},"audio/vnd.wave":{compressible:!1},"audio/vorbis":{source:"iana",compressible:!1},"audio/vorbis-config":{source:"iana"},"audio/wav":{compressible:!1,extensions:["wav"]},"audio/wave":{compressible:!1,extensions:["wav"]},"audio/webm":{source:"apache",compressible:!1,extensions:["weba"]},"audio/x-aac":{source:"apache",compressible:!1,extensions:["aac"]},"audio/x-aiff":{source:"apache",extensions:["aif","aiff","aifc"]},"audio/x-caf":{source:"apache",compressible:!1,extensions:["caf"]},"audio/x-flac":{source:"apache",extensions:["flac"]},"audio/x-m4a":{source:"nginx",extensions:["m4a"]},"audio/x-matroska":{source:"apache",extensions:["mka"]},"audio/x-mpegurl":{source:"apache",extensions:["m3u"]},"audio/x-ms-wax":{source:"apache",extensions:["wax"]},"audio/x-ms-wma":{source:"apache",extensions:["wma"]},"audio/x-pn-realaudio":{source:"apache",extensions:["ram","ra"]},"audio/x-pn-realaudio-plugin":{source:"apache",extensions:["rmp"]},"audio/x-realaudio":{source:"nginx",extensions:["ra"]},"audio/x-tta":{source:"apache"},"audio/x-wav":{source:"apache",extensions:["wav"]},"audio/xm":{source:"apache",extensions:["xm"]},"chemical/x-cdx":{source:"apache",extensions:["cdx"]},"chemical/x-cif":{source:"apache",extensions:["cif"]},"chemical/x-cmdf":{source:"apache",extensions:["cmdf"]},"chemical/x-cml":{source:"apache",extensions:["cml"]},"chemical/x-csml":{source:"apache",extensions:["csml"]},"chemical/x-pdb":{source:"apache"},"chemical/x-xyz":{source:"apache",extensions:["xyz"]},"font/collection":{source:"iana",extensions:["ttc"]},"font/otf":{source:"iana",compressible:!0,extensions:["otf"]},"font/sfnt":{source:"iana"},"font/ttf":{source:"iana",compressible:!0,extensions:["ttf"]},"font/woff":{source:"iana",extensions:["woff"]},"font/woff2":{source:"iana",extensions:["woff2"]},"image/aces":{source:"iana",extensions:["exr"]},"image/apng":{source:"iana",compressible:!1,extensions:["apng"]},"image/avci":{source:"iana",extensions:["avci"]},"image/avcs":{source:"iana",extensions:["avcs"]},"image/avif":{source:"iana",compressible:!1,extensions:["avif"]},"image/bmp":{source:"iana",compressible:!0,extensions:["bmp","dib"]},"image/cgm":{source:"iana",extensions:["cgm"]},"image/dicom-rle":{source:"iana",extensions:["drle"]},"image/dpx":{source:"iana",extensions:["dpx"]},"image/emf":{source:"iana",extensions:["emf"]},"image/fits":{source:"iana",extensions:["fits"]},"image/g3fax":{source:"iana",extensions:["g3"]},"image/gif":{source:"iana",compressible:!1,extensions:["gif"]},"image/heic":{source:"iana",extensions:["heic"]},"image/heic-sequence":{source:"iana",extensions:["heics"]},"image/heif":{source:"iana",extensions:["heif"]},"image/heif-sequence":{source:"iana",extensions:["heifs"]},"image/hej2k":{source:"iana",extensions:["hej2"]},"image/ief":{source:"iana",extensions:["ief"]},"image/j2c":{source:"iana"},"image/jaii":{source:"iana",extensions:["jaii"]},"image/jais":{source:"iana",extensions:["jais"]},"image/jls":{source:"iana",extensions:["jls"]},"image/jp2":{source:"iana",compressible:!1,extensions:["jp2","jpg2"]},"image/jpeg":{source:"iana",compressible:!1,extensions:["jpg","jpeg","jpe"]},"image/jph":{source:"iana",extensions:["jph"]},"image/jphc":{source:"iana",extensions:["jhc"]},"image/jpm":{source:"iana",compressible:!1,extensions:["jpm","jpgm"]},"image/jpx":{source:"iana",compressible:!1,extensions:["jpx","jpf"]},"image/jxl":{source:"iana",extensions:["jxl"]},"image/jxr":{source:"iana",extensions:["jxr"]},"image/jxra":{source:"iana",extensions:["jxra"]},"image/jxrs":{source:"iana",extensions:["jxrs"]},"image/jxs":{source:"iana",extensions:["jxs"]},"image/jxsc":{source:"iana",extensions:["jxsc"]},"image/jxsi":{source:"iana",extensions:["jxsi"]},"image/jxss":{source:"iana",extensions:["jxss"]},"image/ktx":{source:"iana",extensions:["ktx"]},"image/ktx2":{source:"iana",extensions:["ktx2"]},"image/naplps":{source:"iana"},"image/pjpeg":{compressible:!1,extensions:["jfif"]},"image/png":{source:"iana",compressible:!1,extensions:["png"]},"image/prs.btif":{source:"iana",extensions:["btif","btf"]},"image/prs.pti":{source:"iana",extensions:["pti"]},"image/pwg-raster":{source:"iana"},"image/sgi":{source:"apache",extensions:["sgi"]},"image/svg+xml":{source:"iana",compressible:!0,extensions:["svg","svgz"]},"image/t38":{source:"iana",extensions:["t38"]},"image/tiff":{source:"iana",compressible:!1,extensions:["tif","tiff"]},"image/tiff-fx":{source:"iana",extensions:["tfx"]},"image/vnd.adobe.photoshop":{source:"iana",compressible:!0,extensions:["psd"]},"image/vnd.airzip.accelerator.azv":{source:"iana",extensions:["azv"]},"image/vnd.clip":{source:"iana"},"image/vnd.cns.inf2":{source:"iana"},"image/vnd.dece.graphic":{source:"iana",extensions:["uvi","uvvi","uvg","uvvg"]},"image/vnd.djvu":{source:"iana",extensions:["djvu","djv"]},"image/vnd.dvb.subtitle":{source:"iana",extensions:["sub"]},"image/vnd.dwg":{source:"iana",extensions:["dwg"]},"image/vnd.dxf":{source:"iana",extensions:["dxf"]},"image/vnd.fastbidsheet":{source:"iana",extensions:["fbs"]},"image/vnd.fpx":{source:"iana",extensions:["fpx"]},"image/vnd.fst":{source:"iana",extensions:["fst"]},"image/vnd.fujixerox.edmics-mmr":{source:"iana",extensions:["mmr"]},"image/vnd.fujixerox.edmics-rlc":{source:"iana",extensions:["rlc"]},"image/vnd.globalgraphics.pgb":{source:"iana"},"image/vnd.microsoft.icon":{source:"iana",compressible:!0,extensions:["ico"]},"image/vnd.mix":{source:"iana"},"image/vnd.mozilla.apng":{source:"iana"},"image/vnd.ms-dds":{compressible:!0,extensions:["dds"]},"image/vnd.ms-modi":{source:"iana",extensions:["mdi"]},"image/vnd.ms-photo":{source:"apache",extensions:["wdp"]},"image/vnd.net-fpx":{source:"iana",extensions:["npx"]},"image/vnd.pco.b16":{source:"iana",extensions:["b16"]},"image/vnd.radiance":{source:"iana"},"image/vnd.sealed.png":{source:"iana"},"image/vnd.sealedmedia.softseal.gif":{source:"iana"},"image/vnd.sealedmedia.softseal.jpg":{source:"iana"},"image/vnd.svf":{source:"iana"},"image/vnd.tencent.tap":{source:"iana",extensions:["tap"]},"image/vnd.valve.source.texture":{source:"iana",extensions:["vtf"]},"image/vnd.wap.wbmp":{source:"iana",extensions:["wbmp"]},"image/vnd.xiff":{source:"iana",extensions:["xif"]},"image/vnd.zbrush.pcx":{source:"iana",extensions:["pcx"]},"image/webp":{source:"iana",extensions:["webp"]},"image/wmf":{source:"iana",extensions:["wmf"]},"image/x-3ds":{source:"apache",extensions:["3ds"]},"image/x-adobe-dng":{extensions:["dng"]},"image/x-cmu-raster":{source:"apache",extensions:["ras"]},"image/x-cmx":{source:"apache",extensions:["cmx"]},"image/x-emf":{source:"iana"},"image/x-freehand":{source:"apache",extensions:["fh","fhc","fh4","fh5","fh7"]},"image/x-icon":{source:"apache",compressible:!0,extensions:["ico"]},"image/x-jng":{source:"nginx",extensions:["jng"]},"image/x-mrsid-image":{source:"apache",extensions:["sid"]},"image/x-ms-bmp":{source:"nginx",compressible:!0,extensions:["bmp"]},"image/x-pcx":{source:"apache",extensions:["pcx"]},"image/x-pict":{source:"apache",extensions:["pic","pct"]},"image/x-portable-anymap":{source:"apache",extensions:["pnm"]},"image/x-portable-bitmap":{source:"apache",extensions:["pbm"]},"image/x-portable-graymap":{source:"apache",extensions:["pgm"]},"image/x-portable-pixmap":{source:"apache",extensions:["ppm"]},"image/x-rgb":{source:"apache",extensions:["rgb"]},"image/x-tga":{source:"apache",extensions:["tga"]},"image/x-wmf":{source:"iana"},"image/x-xbitmap":{source:"apache",extensions:["xbm"]},"image/x-xcf":{compressible:!1},"image/x-xpixmap":{source:"apache",extensions:["xpm"]},"image/x-xwindowdump":{source:"apache",extensions:["xwd"]},"message/bhttp":{source:"iana"},"message/cpim":{source:"iana"},"message/delivery-status":{source:"iana"},"message/disposition-notification":{source:"iana",extensions:["disposition-notification"]},"message/external-body":{source:"iana"},"message/feedback-report":{source:"iana"},"message/global":{source:"iana",extensions:["u8msg"]},"message/global-delivery-status":{source:"iana",extensions:["u8dsn"]},"message/global-disposition-notification":{source:"iana",extensions:["u8mdn"]},"message/global-headers":{source:"iana",extensions:["u8hdr"]},"message/http":{source:"iana",compressible:!1},"message/imdn+xml":{source:"iana",compressible:!0},"message/mls":{source:"iana"},"message/news":{source:"apache"},"message/ohttp-req":{source:"iana"},"message/ohttp-res":{source:"iana"},"message/partial":{source:"iana",compressible:!1},"message/rfc822":{source:"iana",compressible:!0,extensions:["eml","mime","mht","mhtml"]},"message/s-http":{source:"apache"},"message/sip":{source:"iana"},"message/sipfrag":{source:"iana"},"message/tracking-status":{source:"iana"},"message/vnd.si.simp":{source:"apache"},"message/vnd.wfa.wsc":{source:"iana",extensions:["wsc"]},"model/3mf":{source:"iana",extensions:["3mf"]},"model/e57":{source:"iana"},"model/gltf+json":{source:"iana",compressible:!0,extensions:["gltf"]},"model/gltf-binary":{source:"iana",compressible:!0,extensions:["glb"]},"model/iges":{source:"iana",compressible:!1,extensions:["igs","iges"]},"model/jt":{source:"iana",extensions:["jt"]},"model/mesh":{source:"iana",compressible:!1,extensions:["msh","mesh","silo"]},"model/mtl":{source:"iana",extensions:["mtl"]},"model/obj":{source:"iana",extensions:["obj"]},"model/prc":{source:"iana",extensions:["prc"]},"model/step":{source:"iana",extensions:["step","stp","stpnc","p21","210"]},"model/step+xml":{source:"iana",compressible:!0,extensions:["stpx"]},"model/step+zip":{source:"iana",compressible:!1,extensions:["stpz"]},"model/step-xml+zip":{source:"iana",compressible:!1,extensions:["stpxz"]},"model/stl":{source:"iana",extensions:["stl"]},"model/u3d":{source:"iana",extensions:["u3d"]},"model/vnd.bary":{source:"iana",extensions:["bary"]},"model/vnd.cld":{source:"iana",extensions:["cld"]},"model/vnd.collada+xml":{source:"iana",compressible:!0,extensions:["dae"]},"model/vnd.dwf":{source:"iana",extensions:["dwf"]},"model/vnd.flatland.3dml":{source:"iana"},"model/vnd.gdl":{source:"iana",extensions:["gdl"]},"model/vnd.gs-gdl":{source:"apache"},"model/vnd.gs.gdl":{source:"iana"},"model/vnd.gtw":{source:"iana",extensions:["gtw"]},"model/vnd.moml+xml":{source:"iana",compressible:!0},"model/vnd.mts":{source:"iana",extensions:["mts"]},"model/vnd.opengex":{source:"iana",extensions:["ogex"]},"model/vnd.parasolid.transmit.binary":{source:"iana",extensions:["x_b"]},"model/vnd.parasolid.transmit.text":{source:"iana",extensions:["x_t"]},"model/vnd.pytha.pyox":{source:"iana",extensions:["pyo","pyox"]},"model/vnd.rosette.annotated-data-model":{source:"iana"},"model/vnd.sap.vds":{source:"iana",extensions:["vds"]},"model/vnd.usda":{source:"iana",extensions:["usda"]},"model/vnd.usdz+zip":{source:"iana",compressible:!1,extensions:["usdz"]},"model/vnd.valve.source.compiled-map":{source:"iana",extensions:["bsp"]},"model/vnd.vtu":{source:"iana",extensions:["vtu"]},"model/vrml":{source:"iana",compressible:!1,extensions:["wrl","vrml"]},"model/x3d+binary":{source:"apache",compressible:!1,extensions:["x3db","x3dbz"]},"model/x3d+fastinfoset":{source:"iana",extensions:["x3db"]},"model/x3d+vrml":{source:"apache",compressible:!1,extensions:["x3dv","x3dvz"]},"model/x3d+xml":{source:"iana",compressible:!0,extensions:["x3d","x3dz"]},"model/x3d-vrml":{source:"iana",extensions:["x3dv"]},"multipart/alternative":{source:"iana",compressible:!1},"multipart/appledouble":{source:"iana"},"multipart/byteranges":{source:"iana"},"multipart/digest":{source:"iana"},"multipart/encrypted":{source:"iana",compressible:!1},"multipart/form-data":{source:"iana",compressible:!1},"multipart/header-set":{source:"iana"},"multipart/mixed":{source:"iana"},"multipart/multilingual":{source:"iana"},"multipart/parallel":{source:"iana"},"multipart/related":{source:"iana",compressible:!1},"multipart/report":{source:"iana"},"multipart/signed":{source:"iana",compressible:!1},"multipart/vnd.bint.med-plus":{source:"iana"},"multipart/voice-message":{source:"iana"},"multipart/x-mixed-replace":{source:"iana"},"text/1d-interleaved-parityfec":{source:"iana"},"text/cache-manifest":{source:"iana",compressible:!0,extensions:["appcache","manifest"]},"text/calendar":{source:"iana",extensions:["ics","ifb"]},"text/calender":{compressible:!0},"text/cmd":{compressible:!0},"text/coffeescript":{extensions:["coffee","litcoffee"]},"text/cql":{source:"iana"},"text/cql-expression":{source:"iana"},"text/cql-identifier":{source:"iana"},"text/css":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["css"]},"text/csv":{source:"iana",compressible:!0,extensions:["csv"]},"text/csv-schema":{source:"iana"},"text/directory":{source:"iana"},"text/dns":{source:"iana"},"text/ecmascript":{source:"apache"},"text/encaprtp":{source:"iana"},"text/enriched":{source:"iana"},"text/fhirpath":{source:"iana"},"text/flexfec":{source:"iana"},"text/fwdred":{source:"iana"},"text/gff3":{source:"iana"},"text/grammar-ref-list":{source:"iana"},"text/hl7v2":{source:"iana"},"text/html":{source:"iana",compressible:!0,extensions:["html","htm","shtml"]},"text/jade":{extensions:["jade"]},"text/javascript":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["js","mjs"]},"text/jcr-cnd":{source:"iana"},"text/jsx":{compressible:!0,extensions:["jsx"]},"text/less":{compressible:!0,extensions:["less"]},"text/markdown":{source:"iana",compressible:!0,extensions:["md","markdown"]},"text/mathml":{source:"nginx",extensions:["mml"]},"text/mdx":{compressible:!0,extensions:["mdx"]},"text/mizar":{source:"iana"},"text/n3":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["n3"]},"text/parameters":{source:"iana",charset:"UTF-8"},"text/parityfec":{source:"iana"},"text/plain":{source:"iana",compressible:!0,extensions:["txt","text","conf","def","list","log","in","ini"]},"text/provenance-notation":{source:"iana",charset:"UTF-8"},"text/prs.fallenstein.rst":{source:"iana"},"text/prs.lines.tag":{source:"iana",extensions:["dsc"]},"text/prs.prop.logic":{source:"iana"},"text/prs.texi":{source:"iana"},"text/raptorfec":{source:"iana"},"text/red":{source:"iana"},"text/rfc822-headers":{source:"iana"},"text/richtext":{source:"iana",compressible:!0,extensions:["rtx"]},"text/rtf":{source:"iana",compressible:!0,extensions:["rtf"]},"text/rtp-enc-aescm128":{source:"iana"},"text/rtploopback":{source:"iana"},"text/rtx":{source:"iana"},"text/sgml":{source:"iana",extensions:["sgml","sgm"]},"text/shaclc":{source:"iana"},"text/shex":{source:"iana",extensions:["shex"]},"text/slim":{extensions:["slim","slm"]},"text/spdx":{source:"iana",extensions:["spdx"]},"text/strings":{source:"iana"},"text/stylus":{extensions:["stylus","styl"]},"text/t140":{source:"iana"},"text/tab-separated-values":{source:"iana",compressible:!0,extensions:["tsv"]},"text/troff":{source:"iana",extensions:["t","tr","roff","man","me","ms"]},"text/turtle":{source:"iana",charset:"UTF-8",extensions:["ttl"]},"text/ulpfec":{source:"iana"},"text/uri-list":{source:"iana",compressible:!0,extensions:["uri","uris","urls"]},"text/vcard":{source:"iana",compressible:!0,extensions:["vcard"]},"text/vnd.a":{source:"iana"},"text/vnd.abc":{source:"iana"},"text/vnd.ascii-art":{source:"iana"},"text/vnd.curl":{source:"iana",extensions:["curl"]},"text/vnd.curl.dcurl":{source:"apache",extensions:["dcurl"]},"text/vnd.curl.mcurl":{source:"apache",extensions:["mcurl"]},"text/vnd.curl.scurl":{source:"apache",extensions:["scurl"]},"text/vnd.debian.copyright":{source:"iana",charset:"UTF-8"},"text/vnd.dmclientscript":{source:"iana"},"text/vnd.dvb.subtitle":{source:"iana",extensions:["sub"]},"text/vnd.esmertec.theme-descriptor":{source:"iana",charset:"UTF-8"},"text/vnd.exchangeable":{source:"iana"},"text/vnd.familysearch.gedcom":{source:"iana",extensions:["ged"]},"text/vnd.ficlab.flt":{source:"iana"},"text/vnd.fly":{source:"iana",extensions:["fly"]},"text/vnd.fmi.flexstor":{source:"iana",extensions:["flx"]},"text/vnd.gml":{source:"iana"},"text/vnd.graphviz":{source:"iana",extensions:["gv"]},"text/vnd.hans":{source:"iana"},"text/vnd.hgl":{source:"iana"},"text/vnd.in3d.3dml":{source:"iana",extensions:["3dml"]},"text/vnd.in3d.spot":{source:"iana",extensions:["spot"]},"text/vnd.iptc.newsml":{source:"iana"},"text/vnd.iptc.nitf":{source:"iana"},"text/vnd.latex-z":{source:"iana"},"text/vnd.motorola.reflex":{source:"iana"},"text/vnd.ms-mediapackage":{source:"iana"},"text/vnd.net2phone.commcenter.command":{source:"iana"},"text/vnd.radisys.msml-basic-layout":{source:"iana"},"text/vnd.senx.warpscript":{source:"iana"},"text/vnd.si.uricatalogue":{source:"apache"},"text/vnd.sosi":{source:"iana"},"text/vnd.sun.j2me.app-descriptor":{source:"iana",charset:"UTF-8",extensions:["jad"]},"text/vnd.trolltech.linguist":{source:"iana",charset:"UTF-8"},"text/vnd.vcf":{source:"iana"},"text/vnd.wap.si":{source:"iana"},"text/vnd.wap.sl":{source:"iana"},"text/vnd.wap.wml":{source:"iana",extensions:["wml"]},"text/vnd.wap.wmlscript":{source:"iana",extensions:["wmls"]},"text/vnd.zoo.kcl":{source:"iana"},"text/vtt":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["vtt"]},"text/wgsl":{source:"iana",extensions:["wgsl"]},"text/x-asm":{source:"apache",extensions:["s","asm"]},"text/x-c":{source:"apache",extensions:["c","cc","cxx","cpp","h","hh","dic"]},"text/x-component":{source:"nginx",extensions:["htc"]},"text/x-fortran":{source:"apache",extensions:["f","for","f77","f90"]},"text/x-gwt-rpc":{compressible:!0},"text/x-handlebars-template":{extensions:["hbs"]},"text/x-java-source":{source:"apache",extensions:["java"]},"text/x-jquery-tmpl":{compressible:!0},"text/x-lua":{extensions:["lua"]},"text/x-markdown":{compressible:!0,extensions:["mkd"]},"text/x-nfo":{source:"apache",extensions:["nfo"]},"text/x-opml":{source:"apache",extensions:["opml"]},"text/x-org":{compressible:!0,extensions:["org"]},"text/x-pascal":{source:"apache",extensions:["p","pas"]},"text/x-processing":{compressible:!0,extensions:["pde"]},"text/x-sass":{extensions:["sass"]},"text/x-scss":{extensions:["scss"]},"text/x-setext":{source:"apache",extensions:["etx"]},"text/x-sfv":{source:"apache",extensions:["sfv"]},"text/x-suse-ymp":{compressible:!0,extensions:["ymp"]},"text/x-uuencode":{source:"apache",extensions:["uu"]},"text/x-vcalendar":{source:"apache",extensions:["vcs"]},"text/x-vcard":{source:"apache",extensions:["vcf"]},"text/xml":{source:"iana",compressible:!0,extensions:["xml"]},"text/xml-external-parsed-entity":{source:"iana"},"text/yaml":{compressible:!0,extensions:["yaml","yml"]},"video/1d-interleaved-parityfec":{source:"iana"},"video/3gpp":{source:"iana",extensions:["3gp","3gpp"]},"video/3gpp-tt":{source:"iana"},"video/3gpp2":{source:"iana",extensions:["3g2"]},"video/av1":{source:"iana"},"video/bmpeg":{source:"iana"},"video/bt656":{source:"iana"},"video/celb":{source:"iana"},"video/dv":{source:"iana"},"video/encaprtp":{source:"iana"},"video/evc":{source:"iana"},"video/ffv1":{source:"iana"},"video/flexfec":{source:"iana"},"video/h261":{source:"iana",extensions:["h261"]},"video/h263":{source:"iana",extensions:["h263"]},"video/h263-1998":{source:"iana"},"video/h263-2000":{source:"iana"},"video/h264":{source:"iana",extensions:["h264"]},"video/h264-rcdo":{source:"iana"},"video/h264-svc":{source:"iana"},"video/h265":{source:"iana"},"video/h266":{source:"iana"},"video/iso.segment":{source:"iana",extensions:["m4s"]},"video/jpeg":{source:"iana",extensions:["jpgv"]},"video/jpeg2000":{source:"iana"},"video/jpm":{source:"apache",extensions:["jpm","jpgm"]},"video/jxsv":{source:"iana"},"video/lottie+json":{source:"iana",compressible:!0},"video/matroska":{source:"iana"},"video/matroska-3d":{source:"iana"},"video/mj2":{source:"iana",extensions:["mj2","mjp2"]},"video/mp1s":{source:"iana"},"video/mp2p":{source:"iana"},"video/mp2t":{source:"iana",extensions:["ts","m2t","m2ts","mts"]},"video/mp4":{source:"iana",compressible:!1,extensions:["mp4","mp4v","mpg4"]},"video/mp4v-es":{source:"iana"},"video/mpeg":{source:"iana",compressible:!1,extensions:["mpeg","mpg","mpe","m1v","m2v"]},"video/mpeg4-generic":{source:"iana"},"video/mpv":{source:"iana"},"video/nv":{source:"iana"},"video/ogg":{source:"iana",compressible:!1,extensions:["ogv"]},"video/parityfec":{source:"iana"},"video/pointer":{source:"iana"},"video/quicktime":{source:"iana",compressible:!1,extensions:["qt","mov"]},"video/raptorfec":{source:"iana"},"video/raw":{source:"iana"},"video/rtp-enc-aescm128":{source:"iana"},"video/rtploopback":{source:"iana"},"video/rtx":{source:"iana"},"video/scip":{source:"iana"},"video/smpte291":{source:"iana"},"video/smpte292m":{source:"iana"},"video/ulpfec":{source:"iana"},"video/vc1":{source:"iana"},"video/vc2":{source:"iana"},"video/vnd.cctv":{source:"iana"},"video/vnd.dece.hd":{source:"iana",extensions:["uvh","uvvh"]},"video/vnd.dece.mobile":{source:"iana",extensions:["uvm","uvvm"]},"video/vnd.dece.mp4":{source:"iana"},"video/vnd.dece.pd":{source:"iana",extensions:["uvp","uvvp"]},"video/vnd.dece.sd":{source:"iana",extensions:["uvs","uvvs"]},"video/vnd.dece.video":{source:"iana",extensions:["uvv","uvvv"]},"video/vnd.directv.mpeg":{source:"iana"},"video/vnd.directv.mpeg-tts":{source:"iana"},"video/vnd.dlna.mpeg-tts":{source:"iana"},"video/vnd.dvb.file":{source:"iana",extensions:["dvb"]},"video/vnd.fvt":{source:"iana",extensions:["fvt"]},"video/vnd.hns.video":{source:"iana"},"video/vnd.iptvforum.1dparityfec-1010":{source:"iana"},"video/vnd.iptvforum.1dparityfec-2005":{source:"iana"},"video/vnd.iptvforum.2dparityfec-1010":{source:"iana"},"video/vnd.iptvforum.2dparityfec-2005":{source:"iana"},"video/vnd.iptvforum.ttsavc":{source:"iana"},"video/vnd.iptvforum.ttsmpeg2":{source:"iana"},"video/vnd.motorola.video":{source:"iana"},"video/vnd.motorola.videop":{source:"iana"},"video/vnd.mpegurl":{source:"iana",extensions:["mxu","m4u"]},"video/vnd.ms-playready.media.pyv":{source:"iana",extensions:["pyv"]},"video/vnd.nokia.interleaved-multimedia":{source:"iana"},"video/vnd.nokia.mp4vr":{source:"iana"},"video/vnd.nokia.videovoip":{source:"iana"},"video/vnd.objectvideo":{source:"iana"},"video/vnd.planar":{source:"iana"},"video/vnd.radgamettools.bink":{source:"iana"},"video/vnd.radgamettools.smacker":{source:"apache"},"video/vnd.sealed.mpeg1":{source:"iana"},"video/vnd.sealed.mpeg4":{source:"iana"},"video/vnd.sealed.swf":{source:"iana"},"video/vnd.sealedmedia.softseal.mov":{source:"iana"},"video/vnd.uvvu.mp4":{source:"iana",extensions:["uvu","uvvu"]},"video/vnd.vivo":{source:"iana",extensions:["viv"]},"video/vnd.youtube.yt":{source:"iana"},"video/vp8":{source:"iana"},"video/vp9":{source:"iana"},"video/webm":{source:"apache",compressible:!1,extensions:["webm"]},"video/x-f4v":{source:"apache",extensions:["f4v"]},"video/x-fli":{source:"apache",extensions:["fli"]},"video/x-flv":{source:"apache",compressible:!1,extensions:["flv"]},"video/x-m4v":{source:"apache",extensions:["m4v"]},"video/x-matroska":{source:"apache",compressible:!1,extensions:["mkv","mk3d","mks"]},"video/x-mng":{source:"apache",extensions:["mng"]},"video/x-ms-asf":{source:"apache",extensions:["asf","asx"]},"video/x-ms-vob":{source:"apache",extensions:["vob"]},"video/x-ms-wm":{source:"apache",extensions:["wm"]},"video/x-ms-wmv":{source:"apache",compressible:!1,extensions:["wmv"]},"video/x-ms-wmx":{source:"apache",extensions:["wmx"]},"video/x-ms-wvx":{source:"apache",extensions:["wvx"]},"video/x-msvideo":{source:"apache",extensions:["avi"]},"video/x-sgi-movie":{source:"apache",extensions:["movie"]},"video/x-smv":{source:"apache",extensions:["smv"]},"x-conference/x-cooltalk":{source:"apache",extensions:["ice"]},"x-shader/x-fragment":{compressible:!0},"x-shader/x-vertex":{compressible:!0}};function requireMimeDb(){return hasRequiredMimeDb?mimeDb:(hasRequiredMimeDb=1,mimeDb=require$$0)}function requireMimeScore(){if(hasRequiredMimeScore)return mimeScore;hasRequiredMimeScore=1;var e={"prs.":100,"x-":200,"x.":300,"vnd.":400,default:900},t={nginx:10,apache:20,iana:40,default:30},i={application:1,font:2,default:0};return mimeScore=function(s,n="default"){if("application/octet-stream"===s)return 0;let[a,l]=s.split("/"),r=e[l.replace(/(\.|x-).*/,"$1")]||e.default,o=t[n]||t.default;return r+o+(i[a]||i.default)+(1-s.length/100)}}function requireMimeTypes(){return hasRequiredMimeTypes||(hasRequiredMimeTypes=1,!function(e){var t=requireMimeDb(),i=$59kwG.extname,s=requireMimeScore(),n=/^\s*([^;\s]*)(?:;|\s|$)/,a=/^text\//i;function l(e){if(!e||"string"!=typeof e)return!1;var i=n.exec(e),s=i&&t[i[1].toLowerCase()];return s&&s.charset?s.charset:!!(i&&a.test(i[1]))&&"UTF-8"}function r(t){if(!t||"string"!=typeof t)return!1;var i=-1===t.indexOf("/")?e.lookup(t):t;if(!i)return!1;if(-1===i.indexOf("charset")){var s=e.charset(i);s&&(i+="; charset="+s.toLowerCase())}return i}function o(t){if(!t||"string"!=typeof t)return!1;var i=n.exec(t),s=i&&e.extensions[i[1].toLowerCase()];return!!s&&!!s.length&&s[0]}function h(t){if(!t||"string"!=typeof t)return!1;var s=i("x."+t).toLowerCase().slice(1);return!!s&&(e.types[s]||!1)}function c(i,s){Object.keys(t).forEach(function(n){var a=t[n].extensions;if(a&&a.length){i[n]=a;for(var l=0;l<a.length;l++){var r=a[l];s[r]=d(r,s[r],n);let t=u(r,s[r],n);t!==s[r]&&e._extensionConflicts.push([r,t,s[r]])}}})}function d(e,i,n){return(i?s(i,t[i].source):0)>(n?s(n,t[n].source):0)?i:n}function u(i,s,n){var a,l=["nginx","apache",void 0,"iana"],r=s?l.indexOf(t[s].source):0,h=n?l.indexOf(t[n].source):0;return"application/octet-stream"!==e.types[o]&&(r>h||r===h&&(null==(a=e.types[o])?void 0:a.slice(0,12))==="application/")||r>h?s:n}e.charset=l,e.charsets={lookup:l},e.contentType=r,e.extension=o,e.extensions=Object.create(null),e.lookup=h,e.types=Object.create(null),e._extensionConflicts=[],c(e.extensions,e.types)}(mimeTypes)),mimeTypes}var mimeTypesExports=requireMimeTypes();let mime=getDefaultExportFromCjs(mimeTypesExports),inlineImage=async e=>{let t,i=e.getAttribute("xlink:href")??"",s=!1;try{let e=new URL(i);s="file:"===e.protocol}catch(e){}if(s)t=await $kjyEk.readFile(i.slice(7));else{let e=await fetch(i);t=await e.arrayBuffer()}let n=$4b85347d9a00227f$require$Buffer.from(t).toString("base64"),a=mime.lookup(i)||"",l=`data:${a};base64, ${n}`;e.setAttribute("xlink:href",l)},maxGraphToSvg=async(e,t)=>{let i=e.container,s=i.innerHTML;if((t??{inlineImages:!1}).inlineImages)for(let e of Array.from(i.querySelectorAll("image")))await inlineImage(e);let n=i.firstElementChild;n.setAttribute("xmlns","http://www.w3.org/2000/svg"),n.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");let a=['<?xml version="1.0" standalone="no"?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">',i.innerHTML].join("\n");return i.innerHTML=s,a};exports.AbstractCanvas2D=AbstractCanvas2D,exports.ActorShape=ActorShape,exports.Animation=Animation,exports.ArrowConnectorShape=ArrowConnectorShape,exports.ArrowShape=ArrowShape,exports.AutoSaveManager=AutoSaveManager,exports.Cell=Cell,exports.CellAttributeChange=CellAttributeChange,exports.CellCodec=CellCodec,exports.CellEditorHandler=CellEditorHandler,exports.CellHighlight=CellHighlight,exports.CellMarker=CellMarker,exports.CellOverlay=CellOverlay,exports.CellPath=CellPath,exports.CellRenderer=CellRenderer,exports.CellState=CellState,exports.CellStatePreview=CellStatePreview,exports.CellTracker=CellTracker,exports.ChildChange=ChildChange,exports.ChildChangeCodec=ChildChangeCodec,exports.CircleLayout=CircleLayout,exports.Client=Client,exports.Clipboard=Clipboard,exports.CloudShape=CloudShape,exports.Codec=Codec,exports.CodecRegistry=CodecRegistry,exports.CollapseChange=CollapseChange,exports.CompactTreeLayout=CompactTreeLayout,exports.CompositeLayout=CompositeLayout,exports.ConnectionConstraint=ConnectionConstraint,exports.ConnectionHandler=ConnectionHandler,exports.ConnectorShape=ConnectorShape,exports.ConsoleLogger=ConsoleLogger,exports.ConstraintHandler=ConstraintHandler,exports.CoordinateAssignment=CoordinateAssignment,exports.CurrentRootChange=CurrentRootChange,exports.CylinderShape=CylinderShape,exports.Dictionary=Dictionary,exports.DomHelpers=domHelpers,exports.DoubleEllipseShape=DoubleEllipseShape,exports.DragSource=DragSource,exports.EdgeHandler=EdgeHandler,exports.EdgeHandlerConfig=EdgeHandlerConfig,exports.EdgeLabelLayout=EdgeLabelLayout,exports.EdgeSegmentHandler=EdgeSegmentHandler,exports.EdgeStyle=EdgeStyle,exports.Editor=Editor,exports.EditorCodec=EditorCodec,exports.EditorKeyHandler=EditorKeyHandler,exports.EditorKeyHandlerCodec=EditorKeyHandlerCodec,exports.EditorPopupMenu=EditorPopupMenu,exports.EditorPopupMenuCodec=EditorPopupMenuCodec,exports.EditorToolbar=EditorToolbar,exports.EditorToolbarCodec=EditorToolbarCodec,exports.Effects=Effects,exports.ElbowEdgeHandler=ElbowEdgeHandler,exports.EllipseShape=EllipseShape,exports.EntityRelationConnectorConfig=EntityRelationConnectorConfig,exports.EventObject=EventObject,exports.EventSource=EventSource,exports.FastOrganicLayout=MxFastOrganicLayout,exports.FitPlugin=FitPlugin,exports.GenericChangeCodec=GenericChangeCodec,exports.Geometry=Geometry,exports.GeometryChange=GeometryChange,exports.GlobalConfig=GlobalConfig,exports.Graph=Graph,exports.GraphAbstractHierarchyCell=GraphAbstractHierarchyCell,exports.GraphCodec=GraphCodec,exports.GraphDataModel=GraphDataModel,exports.GraphHierarchyEdge=GraphHierarchyEdge,exports.GraphHierarchyModel=GraphHierarchyModel,exports.GraphHierarchyNode=GraphHierarchyNode,exports.GraphLayout=GraphLayout,exports.GraphView=GraphView,exports.GraphViewCodec=GraphViewCodec,exports.Guide=Guide,exports.HandleConfig=HandleConfig,exports.HexagonShape=HexagonShape,exports.HierarchicalEdgeStyle=HierarchicalEdgeStyle,exports.HierarchicalLayout=HierarchicalLayout,exports.HierarchicalLayoutStage=HierarchicalLayoutStage,exports.ImageBox=ImageBox,exports.ImageBundle=ImageBundle,exports.ImageExport=ImageExport,exports.ImageShape=ImageShape,exports.InternalEvent=InternalEvent,exports.InternalMouseEvent=InternalMouseEvent,exports.KeyHandler=KeyHandler,exports.LabelShape=LabelShape,exports.LayoutManager=LayoutManager,exports.LineShape=LineShape,exports.ManhattanConnectorConfig=ManhattanConnectorConfig,exports.MarkerShape=MarkerShape,exports.MaxForm=MaxForm,exports.MaxLog=MaxLog,exports.MaxLogAsLogger=MaxLogAsLogger,exports.MaxPopupMenu=MaxPopupMenu,exports.MaxToolbar=MaxToolbar,exports.MaxWindow=MaxWindow,exports.MaxXmlRequest=MaxXmlRequest,exports.MedianHybridCrossingReduction=MedianHybridCrossingReduction,exports.MinimumCycleRemover=MinimumCycleRemover,exports.ModelCodec=ModelCodec,exports.ModelXmlSerializer=ModelXmlSerializer,exports.Morphing=Morphing,exports.Multiplicity=Multiplicity,exports.NoOpI18n=NoOpI18n,exports.NoOpLogger=NoOpLogger,exports.ObjectCodec=ObjectCodec,exports.ObjectIdentity=ObjectIdentity,exports.OrthogonalConnectorConfig=OrthogonalConnectorConfig,exports.Outline=Outline,exports.PanningHandler=PanningHandler,exports.PanningManager=PanningManager,exports.ParallelEdgeLayout=ParallelEdgeLayout,exports.PartitionLayout=PartitionLayout,exports.Perimeter=Perimeter,exports.Point=Point,exports.PolylineShape=PolylineShape,exports.PopupMenuHandler=PopupMenuHandler,exports.PrintPreview=PrintPreview,exports.RadialTreeLayout=RadialTreeLayout,exports.Rectangle=Rectangle,exports.RectangleShape=RectangleShape,exports.RhombusShape=RhombusShape,exports.RootChange=RootChange,exports.RootChangeCodec=RootChangeCodec,exports.RubberBandHandler=RubberBandHandler,exports.SelectionCellsHandler=SelectionCellsHandler,exports.SelectionChange=SelectionChange,exports.SelectionHandler=SelectionHandler,exports.Shape=Shape,exports.StackLayout=StackLayout,exports.StencilShape=StencilShape,exports.StencilShapeConfig=StencilShapeConfig,exports.StencilShapeRegistry=StencilShapeRegistry,exports.StyleChange=StyleChange,exports.StyleDefaultsConfig=StyleDefaultsConfig,exports.StyleRegistry=StyleRegistry,exports.Stylesheet=Stylesheet,exports.StylesheetCodec=StylesheetCodec,exports.SvgCanvas2D=SvgCanvas2D,exports.SwimlaneLayout=SwimlaneLayout,exports.SwimlaneManager=SwimlaneManager,exports.SwimlaneModel=SwimlaneModel,exports.SwimlaneOrdering=SwimlaneOrdering,exports.SwimlaneShape=SwimlaneShape,exports.TemporaryCellStates=TemporaryCellStates,exports.TerminalChange=TerminalChange,exports.TerminalChangeCodec=TerminalChangeCodec,exports.TextShape=TextShape,exports.TooltipHandler=TooltipHandler,exports.Translations=Translations,exports.TranslationsAsI18n=TranslationsAsI18n,exports.TranslationsConfig=TranslationsConfig,exports.TriangleShape=TriangleShape,exports.UndoManager=UndoManager,exports.UndoableEdit=UndoableEdit,exports.UrlConverter=UrlConverter,exports.ValueChange=ValueChange,exports.VertexHandle=VertexHandle,exports.VertexHandler=VertexHandler,exports.VertexHandlerConfig=VertexHandlerConfig,exports.VisibleChange=VisibleChange,exports.XmlCanvas2D=XmlCanvas2D,exports.cellArrayUtils=cellArrayUtils,exports.cloneUtils=cloneUtils,exports.constants=Constants,exports.domUtils=domUtils,exports.eventUtils=EventUtils,exports.gestureUtils=gestureUtils,exports.getDefaultPlugins=getDefaultPlugins,exports.guiUtils=guiUtils,exports.mathUtils=mathUtils,exports.maxGraphToSvg=maxGraphToSvg,exports.mxCellCodec=mxCellCodec,exports.mxGeometryCodec=mxGeometryCodec,exports.printUtils=printUtils,exports.registerAllCodecs=registerAllCodecs,exports.registerCoreCodecs=registerCoreCodecs,exports.registerEditorCodecs=registerEditorCodecs,exports.registerModelCodecs=registerModelCodecs,exports.requestUtils=requestUtils,exports.resetEdgeHandlerConfig=resetEdgeHandlerConfig,exports.resetEntityRelationConnectorConfig=resetEntityRelationConnectorConfig,exports.resetHandleConfig=resetHandleConfig,exports.resetManhattanConnectorConfig=resetManhattanConnectorConfig,exports.resetOrthogonalConnectorConfig=resetOrthogonalConnectorConfig,exports.resetStyleDefaultsConfig=resetStyleDefaultsConfig,exports.resetTranslationsConfig=resetTranslationsConfig,exports.resetVertexHandlerConfig=resetVertexHandlerConfig,exports.stringUtils=StringUtils,exports.styleUtils=styleUtils,exports.xmlUtils=xmlUtils}),parcelRegister("6ZWSX",function(e,t){$parcel$export(e.exports,"Buffer",()=>i,e=>i=e),$parcel$export(e.exports,"INSPECT_MAX_BYTES",()=>s,e=>s=e);var i,s,n=parcelRequire("kuxul"),a=parcelRequire("9NvM5");let l="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;i=h,s=50;let r=0x7fffffff;function o(e){if(e>r)throw RangeError('The value "'+e+'" is invalid for option "size"');let t=new Uint8Array(e);return Object.setPrototypeOf(t,h.prototype),t}function h(e,t,i){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return p(e)}return c(e,t,i)}function c(e,t,i){if("string"==typeof e)return g(e,t);if(ArrayBuffer.isView(e))return f(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(ea(e,ArrayBuffer)||e&&ea(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(ea(e,SharedArrayBuffer)||e&&ea(e.buffer,SharedArrayBuffer)))return x(e,t,i);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');let s=e.valueOf&&e.valueOf();if(null!=s&&s!==e)return h.from(s,t,i);let n=v(e);if(n)return n;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return h.from(e[Symbol.toPrimitive]("string"),t,i);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function d(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function u(e,t,i){return(d(e),e<=0)?o(e):void 0!==t?"string"==typeof i?o(e).fill(t,i):o(e).fill(t):o(e)}function p(e){return d(e),o(e<0?0:0|b(e))}function g(e,t){if(("string"!=typeof t||""===t)&&(t="utf8"),!h.isEncoding(t))throw TypeError("Unknown encoding: "+t);let i=0|y(e,t),s=o(i),n=s.write(e,t);return n!==i&&(s=s.slice(0,n)),s}function m(e){let t=e.length<0?0:0|b(e.length),i=o(t);for(let s=0;s<t;s+=1)i[s]=255&e[s];return i}function f(e){if(ea(e,Uint8Array)){let t=new Uint8Array(e);return x(t.buffer,t.byteOffset,t.byteLength)}return m(e)}function x(e,t,i){let s;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(i||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(s=void 0===t&&void 0===i?new Uint8Array(e):void 0===i?new Uint8Array(e,t):new Uint8Array(e,t,i),h.prototype),s}function v(e){if(h.isBuffer(e)){let t=0|b(e.length),i=o(t);return 0===i.length||e.copy(i,0,0,t),i}return void 0!==e.length?"number"!=typeof e.length||el(e.length)?o(0):m(e):"Buffer"===e.type&&Array.isArray(e.data)?m(e.data):void 0}function b(e){if(e>=r)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r.toString(16)+" bytes");return 0|e}function y(e,t){if(h.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||ea(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);let i=e.length,s=arguments.length>2&&!0===arguments[2];if(!s&&0===i)return 0;let n=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":return ee(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return es(e).length;default:if(n)return s?-1:ee(e).length;t=(""+t).toLowerCase(),n=!0}}function w(e,t,i){let s=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===i||i>this.length)&&(i=this.length),i<=0||(i>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return N(this,t,i);case"utf8":case"utf-8":return H(this,t,i);case"ascii":return I(this,t,i);case"latin1":case"binary":return D(this,t,i);case"base64":return k(this,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return V(this,t,i);default:if(s)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),s=!0}}function C(e,t,i){let s=e[t];e[t]=e[i],e[i]=s}function E(e,t,i,s,n){if(0===e.length)return -1;if("string"==typeof i?(s=i,i=0):i>0x7fffffff?i=0x7fffffff:i<-0x80000000&&(i=-0x80000000),el(i*=1)&&(i=n?0:e.length-1),i<0&&(i=e.length+i),i>=e.length)if(n)return -1;else i=e.length-1;else if(i<0)if(!n)return -1;else i=0;if("string"==typeof t&&(t=h.from(t,s)),h.isBuffer(t))return 0===t.length?-1:S(e,t,i,s,n);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(n)return Uint8Array.prototype.indexOf.call(e,t,i);else return Uint8Array.prototype.lastIndexOf.call(e,t,i);return S(e,[t],i,s,n)}throw TypeError("val must be string, number or Buffer")}function S(e,t,i,s,n){let a,l=1,r=e.length,o=t.length;if(void 0!==s&&("ucs2"===(s=String(s).toLowerCase())||"ucs-2"===s||"utf16le"===s||"utf-16le"===s)){if(e.length<2||t.length<2)return -1;l=2,r/=2,o/=2,i/=2}function h(e,t){return 1===l?e[t]:e.readUInt16BE(t*l)}if(n){let s=-1;for(a=i;a<r;a++)if(h(e,a)===h(t,-1===s?0:a-s)){if(-1===s&&(s=a),a-s+1===o)return s*l}else -1!==s&&(a-=a-s),s=-1}else for(i+o>r&&(i=r-o),a=i;a>=0;a--){let i=!0;for(let s=0;s<o;s++)if(h(e,a+s)!==h(t,s)){i=!1;break}if(i)return a}return -1}function T(e,t,i,s){let n;i=Number(i)||0;let a=e.length-i;s?(s=Number(s))>a&&(s=a):s=a;let l=t.length;for(s>l/2&&(s=l/2),n=0;n<s;++n){let s=parseInt(t.substr(2*n,2),16);if(el(s))break;e[i+n]=s}return n}function M(e,t,i,s){return en(ee(t,e.length-i),e,i,s)}function A(e,t,i,s){return en(et(t),e,i,s)}function P(e,t,i,s){return en(es(t),e,i,s)}function L(e,t,i,s){return en(ei(t,e.length-i),e,i,s)}function k(e,t,i){return 0===t&&i===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,i))}function H(e,t,i){i=Math.min(e.length,i);let s=[],n=t;for(;n<i;){let t=e[n],a=null,l=t>239?4:t>223?3:t>191?2:1;if(n+l<=i){let i,s,r,o;switch(l){case 1:t<128&&(a=t);break;case 2:(192&(i=e[n+1]))==128&&(o=(31&t)<<6|63&i)>127&&(a=o);break;case 3:i=e[n+1],s=e[n+2],(192&i)==128&&(192&s)==128&&(o=(15&t)<<12|(63&i)<<6|63&s)>2047&&(o<55296||o>57343)&&(a=o);break;case 4:i=e[n+1],s=e[n+2],r=e[n+3],(192&i)==128&&(192&s)==128&&(192&r)==128&&(o=(15&t)<<18|(63&i)<<12|(63&s)<<6|63&r)>65535&&o<1114112&&(a=o)}}null===a?(a=65533,l=1):a>65535&&(a-=65536,s.push(a>>>10&1023|55296),a=56320|1023&a),s.push(a),n+=l}return R(s)}h.TYPED_ARRAY_SUPPORT=function e(){try{let e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),h.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(h.prototype,"parent",{enumerable:!0,get:function(){if(h.isBuffer(this))return this.buffer}}),Object.defineProperty(h.prototype,"offset",{enumerable:!0,get:function(){if(h.isBuffer(this))return this.byteOffset}}),h.poolSize=8192,h.from=function(e,t,i){return c(e,t,i)},Object.setPrototypeOf(h.prototype,Uint8Array.prototype),Object.setPrototypeOf(h,Uint8Array),h.alloc=function(e,t,i){return u(e,t,i)},h.allocUnsafe=function(e){return p(e)},h.allocUnsafeSlow=function(e){return p(e)},h.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==h.prototype},h.compare=function(e,t){if(ea(e,Uint8Array)&&(e=h.from(e,e.offset,e.byteLength)),ea(t,Uint8Array)&&(t=h.from(t,t.offset,t.byteLength)),!h.isBuffer(e)||!h.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let i=e.length,s=t.length;for(let n=0,a=Math.min(i,s);n<a;++n)if(e[n]!==t[n]){i=e[n],s=t[n];break}return i<s?-1:+(s<i)},h.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},h.concat=function(e,t){let i;if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return h.alloc(0);if(void 0===t)for(i=0,t=0;i<e.length;++i)t+=e[i].length;let s=h.allocUnsafe(t),n=0;for(i=0;i<e.length;++i){let t=e[i];if(ea(t,Uint8Array))n+t.length>s.length?(h.isBuffer(t)||(t=h.from(t)),t.copy(s,n)):Uint8Array.prototype.set.call(s,t,n);else if(h.isBuffer(t))t.copy(s,n);else throw TypeError('"list" argument must be an Array of Buffers');n+=t.length}return s},h.byteLength=y,h.prototype._isBuffer=!0,h.prototype.swap16=function(){let e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)C(this,t,t+1);return this},h.prototype.swap32=function(){let e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)C(this,t,t+3),C(this,t+1,t+2);return this},h.prototype.swap64=function(){let e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)C(this,t,t+7),C(this,t+1,t+6),C(this,t+2,t+5),C(this,t+3,t+4);return this},h.prototype.toString=function(){let e=this.length;return 0===e?"":0==arguments.length?H(this,0,e):w.apply(this,arguments)},h.prototype.toLocaleString=h.prototype.toString,h.prototype.equals=function(e){if(!h.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===h.compare(this,e)},h.prototype.inspect=function(){let e="",t=s;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},l&&(h.prototype[l]=h.prototype.inspect),h.prototype.compare=function(e,t,i,s,n){if(ea(e,Uint8Array)&&(e=h.from(e,e.offset,e.byteLength)),!h.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===i&&(i=e?e.length:0),void 0===s&&(s=0),void 0===n&&(n=this.length),t<0||i>e.length||s<0||n>this.length)throw RangeError("out of range index");if(s>=n&&t>=i)return 0;if(s>=n)return -1;if(t>=i)return 1;if(t>>>=0,i>>>=0,s>>>=0,n>>>=0,this===e)return 0;let a=n-s,l=i-t,r=Math.min(a,l),o=this.slice(s,n),c=e.slice(t,i);for(let e=0;e<r;++e)if(o[e]!==c[e]){a=o[e],l=c[e];break}return a<l?-1:+(l<a)},h.prototype.includes=function(e,t,i){return -1!==this.indexOf(e,t,i)},h.prototype.indexOf=function(e,t,i){return E(this,e,t,i,!0)},h.prototype.lastIndexOf=function(e,t,i){return E(this,e,t,i,!1)},h.prototype.write=function(e,t,i,s){if(void 0===t)s="utf8",i=this.length,t=0;else if(void 0===i&&"string"==typeof t)s=t,i=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(i)?(i>>>=0,void 0===s&&(s="utf8")):(s=i,i=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let n=this.length-t;if((void 0===i||i>n)&&(i=n),e.length>0&&(i<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");s||(s="utf8");let a=!1;for(;;)switch(s){case"hex":return T(this,e,t,i);case"utf8":case"utf-8":return M(this,e,t,i);case"ascii":case"latin1":case"binary":return A(this,e,t,i);case"base64":return P(this,e,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return L(this,e,t,i);default:if(a)throw TypeError("Unknown encoding: "+s);s=(""+s).toLowerCase(),a=!0}},h.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};let O=4096;function R(e){let t=e.length;if(t<=O)return String.fromCharCode.apply(String,e);let i="",s=0;for(;s<t;)i+=String.fromCharCode.apply(String,e.slice(s,s+=O));return i}function I(e,t,i){let s="";i=Math.min(e.length,i);for(let n=t;n<i;++n)s+=String.fromCharCode(127&e[n]);return s}function D(e,t,i){let s="";i=Math.min(e.length,i);for(let n=t;n<i;++n)s+=String.fromCharCode(e[n]);return s}function N(e,t,i){let s=e.length;(!t||t<0)&&(t=0),(!i||i<0||i>s)&&(i=s);let n="";for(let s=t;s<i;++s)n+=er[e[s]];return n}function V(e,t,i){let s=e.slice(t,i),n="";for(let e=0;e<s.length-1;e+=2)n+=String.fromCharCode(s[e]+256*s[e+1]);return n}function B(e,t,i){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>i)throw RangeError("Trying to access beyond buffer length")}function z(e,t,i,s,n,a){if(!h.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>n||t<a)throw RangeError('"value" argument is out of bounds');if(i+s>e.length)throw RangeError("Index out of range")}function G(e,t,i,s,n){q(t,s,n,e,i,7);let a=Number(t&BigInt(0xffffffff));e[i++]=a,a>>=8,e[i++]=a,a>>=8,e[i++]=a,a>>=8,e[i++]=a;let l=Number(t>>BigInt(32)&BigInt(0xffffffff));return e[i++]=l,l>>=8,e[i++]=l,l>>=8,e[i++]=l,l>>=8,e[i++]=l,i}function F(e,t,i,s,n){q(t,s,n,e,i,7);let a=Number(t&BigInt(0xffffffff));e[i+7]=a,a>>=8,e[i+6]=a,a>>=8,e[i+5]=a,a>>=8,e[i+4]=a;let l=Number(t>>BigInt(32)&BigInt(0xffffffff));return e[i+3]=l,l>>=8,e[i+2]=l,l>>=8,e[i+1]=l,l>>=8,e[i]=l,i+8}function U(e,t,i,s,n,a){if(i+s>e.length||i<0)throw RangeError("Index out of range")}function _(e,t,i,s,n){return t*=1,i>>>=0,n||U(e,t,i,4,34028234663852886e22,-34028234663852886e22),a.write(e,t,i,s,23,4),i+4}function j(e,t,i,s,n){return t*=1,i>>>=0,n||U(e,t,i,8,17976931348623157e292,-17976931348623157e292),a.write(e,t,i,s,52,8),i+8}h.prototype.slice=function(e,t){let i=this.length;e=~~e,t=void 0===t?i:~~t,e<0?(e+=i)<0&&(e=0):e>i&&(e=i),t<0?(t+=i)<0&&(t=0):t>i&&(t=i),t<e&&(t=e);let s=this.subarray(e,t);return Object.setPrototypeOf(s,h.prototype),s},h.prototype.readUintLE=h.prototype.readUIntLE=function(e,t,i){e>>>=0,t>>>=0,i||B(e,t,this.length);let s=this[e],n=1,a=0;for(;++a<t&&(n*=256);)s+=this[e+a]*n;return s},h.prototype.readUintBE=h.prototype.readUIntBE=function(e,t,i){e>>>=0,t>>>=0,i||B(e,t,this.length);let s=this[e+--t],n=1;for(;t>0&&(n*=256);)s+=this[e+--t]*n;return s},h.prototype.readUint8=h.prototype.readUInt8=function(e,t){return e>>>=0,t||B(e,1,this.length),this[e]},h.prototype.readUint16LE=h.prototype.readUInt16LE=function(e,t){return e>>>=0,t||B(e,2,this.length),this[e]|this[e+1]<<8},h.prototype.readUint16BE=h.prototype.readUInt16BE=function(e,t){return e>>>=0,t||B(e,2,this.length),this[e]<<8|this[e+1]},h.prototype.readUint32LE=h.prototype.readUInt32LE=function(e,t){return e>>>=0,t||B(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},h.prototype.readUint32BE=h.prototype.readUInt32BE=function(e,t){return e>>>=0,t||B(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},h.prototype.readBigUInt64LE=eo(function(e){K(e>>>=0,"offset");let t=this[e],i=this[e+7];(void 0===t||void 0===i)&&Z(e,this.length-8);let s=t+256*this[++e]+65536*this[++e]+0x1000000*this[++e],n=this[++e]+256*this[++e]+65536*this[++e]+0x1000000*i;return BigInt(s)+(BigInt(n)<<BigInt(32))}),h.prototype.readBigUInt64BE=eo(function(e){K(e>>>=0,"offset");let t=this[e],i=this[e+7];(void 0===t||void 0===i)&&Z(e,this.length-8);let s=0x1000000*t+65536*this[++e]+256*this[++e]+this[++e],n=0x1000000*this[++e]+65536*this[++e]+256*this[++e]+i;return(BigInt(s)<<BigInt(32))+BigInt(n)}),h.prototype.readIntLE=function(e,t,i){e>>>=0,t>>>=0,i||B(e,t,this.length);let s=this[e],n=1,a=0;for(;++a<t&&(n*=256);)s+=this[e+a]*n;return s>=(n*=128)&&(s-=Math.pow(2,8*t)),s},h.prototype.readIntBE=function(e,t,i){e>>>=0,t>>>=0,i||B(e,t,this.length);let s=t,n=1,a=this[e+--s];for(;s>0&&(n*=256);)a+=this[e+--s]*n;return a>=(n*=128)&&(a-=Math.pow(2,8*t)),a},h.prototype.readInt8=function(e,t){return(e>>>=0,t||B(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},h.prototype.readInt16LE=function(e,t){e>>>=0,t||B(e,2,this.length);let i=this[e]|this[e+1]<<8;return 32768&i?0xffff0000|i:i},h.prototype.readInt16BE=function(e,t){e>>>=0,t||B(e,2,this.length);let i=this[e+1]|this[e]<<8;return 32768&i?0xffff0000|i:i},h.prototype.readInt32LE=function(e,t){return e>>>=0,t||B(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},h.prototype.readInt32BE=function(e,t){return e>>>=0,t||B(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},h.prototype.readBigInt64LE=eo(function(e){K(e>>>=0,"offset");let t=this[e],i=this[e+7];return(void 0===t||void 0===i)&&Z(e,this.length-8),(BigInt(this[e+4]+256*this[e+5]+65536*this[e+6]+(i<<24))<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+0x1000000*this[++e])}),h.prototype.readBigInt64BE=eo(function(e){K(e>>>=0,"offset");let t=this[e],i=this[e+7];return(void 0===t||void 0===i)&&Z(e,this.length-8),(BigInt((t<<24)+65536*this[++e]+256*this[++e]+this[++e])<<BigInt(32))+BigInt(0x1000000*this[++e]+65536*this[++e]+256*this[++e]+i)}),h.prototype.readFloatLE=function(e,t){return e>>>=0,t||B(e,4,this.length),a.read(this,e,!0,23,4)},h.prototype.readFloatBE=function(e,t){return e>>>=0,t||B(e,4,this.length),a.read(this,e,!1,23,4)},h.prototype.readDoubleLE=function(e,t){return e>>>=0,t||B(e,8,this.length),a.read(this,e,!0,52,8)},h.prototype.readDoubleBE=function(e,t){return e>>>=0,t||B(e,8,this.length),a.read(this,e,!1,52,8)},h.prototype.writeUintLE=h.prototype.writeUIntLE=function(e,t,i,s){if(e*=1,t>>>=0,i>>>=0,!s){let s=Math.pow(2,8*i)-1;z(this,e,t,i,s,0)}let n=1,a=0;for(this[t]=255&e;++a<i&&(n*=256);)this[t+a]=e/n&255;return t+i},h.prototype.writeUintBE=h.prototype.writeUIntBE=function(e,t,i,s){if(e*=1,t>>>=0,i>>>=0,!s){let s=Math.pow(2,8*i)-1;z(this,e,t,i,s,0)}let n=i-1,a=1;for(this[t+n]=255&e;--n>=0&&(a*=256);)this[t+n]=e/a&255;return t+i},h.prototype.writeUint8=h.prototype.writeUInt8=function(e,t,i){return e*=1,t>>>=0,i||z(this,e,t,1,255,0),this[t]=255&e,t+1},h.prototype.writeUint16LE=h.prototype.writeUInt16LE=function(e,t,i){return e*=1,t>>>=0,i||z(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},h.prototype.writeUint16BE=h.prototype.writeUInt16BE=function(e,t,i){return e*=1,t>>>=0,i||z(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},h.prototype.writeUint32LE=h.prototype.writeUInt32LE=function(e,t,i){return e*=1,t>>>=0,i||z(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},h.prototype.writeUint32BE=h.prototype.writeUInt32BE=function(e,t,i){return e*=1,t>>>=0,i||z(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},h.prototype.writeBigUInt64LE=eo(function(e,t=0){return G(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),h.prototype.writeBigUInt64BE=eo(function(e,t=0){return F(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),h.prototype.writeIntLE=function(e,t,i,s){if(e*=1,t>>>=0,!s){let s=Math.pow(2,8*i-1);z(this,e,t,i,s-1,-s)}let n=0,a=1,l=0;for(this[t]=255&e;++n<i&&(a*=256);)e<0&&0===l&&0!==this[t+n-1]&&(l=1),this[t+n]=(e/a>>0)-l&255;return t+i},h.prototype.writeIntBE=function(e,t,i,s){if(e*=1,t>>>=0,!s){let s=Math.pow(2,8*i-1);z(this,e,t,i,s-1,-s)}let n=i-1,a=1,l=0;for(this[t+n]=255&e;--n>=0&&(a*=256);)e<0&&0===l&&0!==this[t+n+1]&&(l=1),this[t+n]=(e/a>>0)-l&255;return t+i},h.prototype.writeInt8=function(e,t,i){return e*=1,t>>>=0,i||z(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},h.prototype.writeInt16LE=function(e,t,i){return e*=1,t>>>=0,i||z(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},h.prototype.writeInt16BE=function(e,t,i){return e*=1,t>>>=0,i||z(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},h.prototype.writeInt32LE=function(e,t,i){return e*=1,t>>>=0,i||z(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},h.prototype.writeInt32BE=function(e,t,i){return e*=1,t>>>=0,i||z(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},h.prototype.writeBigInt64LE=eo(function(e,t=0){return G(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),h.prototype.writeBigInt64BE=eo(function(e,t=0){return F(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),h.prototype.writeFloatLE=function(e,t,i){return _(this,e,t,!0,i)},h.prototype.writeFloatBE=function(e,t,i){return _(this,e,t,!1,i)},h.prototype.writeDoubleLE=function(e,t,i){return j(this,e,t,!0,i)},h.prototype.writeDoubleBE=function(e,t,i){return j(this,e,t,!1,i)},h.prototype.copy=function(e,t,i,s){if(!h.isBuffer(e))throw TypeError("argument should be a Buffer");if(i||(i=0),s||0===s||(s=this.length),t>=e.length&&(t=e.length),t||(t=0),s>0&&s<i&&(s=i),s===i||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw RangeError("Index out of range");if(s<0)throw RangeError("sourceEnd out of bounds");s>this.length&&(s=this.length),e.length-t<s-i&&(s=e.length-t+i);let n=s-i;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,i,s):Uint8Array.prototype.set.call(e,this.subarray(i,s),t),n},h.prototype.fill=function(e,t,i,s){let n;if("string"==typeof e){if("string"==typeof t?(s=t,t=0,i=this.length):"string"==typeof i&&(s=i,i=this.length),void 0!==s&&"string"!=typeof s)throw TypeError("encoding must be a string");if("string"==typeof s&&!h.isEncoding(s))throw TypeError("Unknown encoding: "+s);if(1===e.length){let t=e.charCodeAt(0);("utf8"===s&&t<128||"latin1"===s)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<i)throw RangeError("Out of range index");if(i<=t)return this;if(t>>>=0,i=void 0===i?this.length:i>>>0,e||(e=0),"number"==typeof e)for(n=t;n<i;++n)this[n]=e;else{let a=h.isBuffer(e)?e:h.from(e,s),l=a.length;if(0===l)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(n=0;n<i-t;++n)this[n+t]=a[n%l]}return this};let X={};function $(e,t,i){X[e]=class extends i{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function W(e){let t="",i=e.length,s=+("-"===e[0]);for(;i>=s+4;i-=3)t=`_${e.slice(i-3,i)}${t}`;return`${e.slice(0,i)}${t}`}function Y(e,t,i){K(t,"offset"),(void 0===e[t]||void 0===e[t+i])&&Z(t,e.length-(i+1))}function q(e,t,i,s,n,a){if(e>i||e<t){let s,n="bigint"==typeof t?"n":"";throw s=a>3?0===t||t===BigInt(0)?`>= 0${n} and < 2${n} ** ${(a+1)*8}${n}`:`>= -(2${n} ** ${(a+1)*8-1}${n}) and < 2 ** ${(a+1)*8-1}${n}`:`>= ${t}${n} and <= ${i}${n}`,new X.ERR_OUT_OF_RANGE("value",s,e)}Y(s,n,a)}function K(e,t){if("number"!=typeof e)throw new X.ERR_INVALID_ARG_TYPE(t,"number",e)}function Z(e,t,i){if(Math.floor(e)!==e)throw K(e,i),new X.ERR_OUT_OF_RANGE(i||"offset","an integer",e);if(t<0)throw new X.ERR_BUFFER_OUT_OF_BOUNDS;throw new X.ERR_OUT_OF_RANGE(i||"offset",`>= ${+!!i} and <= ${t}`,e)}$("ERR_BUFFER_OUT_OF_BOUNDS",function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),$("ERR_INVALID_ARG_TYPE",function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`},TypeError),$("ERR_OUT_OF_RANGE",function(e,t,i){let s=`The value of "${e}" is out of range.`,n=i;return Number.isInteger(i)&&Math.abs(i)>0x100000000?n=W(String(i)):"bigint"==typeof i&&(n=String(i),(i>BigInt(2)**BigInt(32)||i<-(BigInt(2)**BigInt(32)))&&(n=W(n)),n+="n"),s+=` It must be ${t}. Received ${n}`},RangeError);let J=/[^+/0-9A-Za-z-_]/g;function Q(e){if((e=(e=e.split("=")[0]).trim().replace(J,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}function ee(e,t){let i;t=t||1/0;let s=e.length,n=null,a=[];for(let l=0;l<s;++l){if((i=e.charCodeAt(l))>55295&&i<57344){if(!n){if(i>56319||l+1===s){(t-=3)>-1&&a.push(239,191,189);continue}n=i;continue}if(i<56320){(t-=3)>-1&&a.push(239,191,189),n=i;continue}i=(n-55296<<10|i-56320)+65536}else n&&(t-=3)>-1&&a.push(239,191,189);if(n=null,i<128){if((t-=1)<0)break;a.push(i)}else if(i<2048){if((t-=2)<0)break;a.push(i>>6|192,63&i|128)}else if(i<65536){if((t-=3)<0)break;a.push(i>>12|224,i>>6&63|128,63&i|128)}else if(i<1114112){if((t-=4)<0)break;a.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}else throw Error("Invalid code point")}return a}function et(e){let t=[];for(let i=0;i<e.length;++i)t.push(255&e.charCodeAt(i));return t}function ei(e,t){let i,s,n=[];for(let a=0;a<e.length&&!((t-=2)<0);++a)s=(i=e.charCodeAt(a))>>8,n.push(i%256),n.push(s);return n}function es(e){return n.toByteArray(Q(e))}function en(e,t,i,s){let n;for(n=0;n<s&&!(n+i>=t.length)&&!(n>=e.length);++n)t[n+i]=e[n];return n}function ea(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function el(e){return e!=e}let er=function(){let e="0123456789abcdef",t=Array(256);for(let i=0;i<16;++i){let s=16*i;for(let n=0;n<16;++n)t[s+n]=e[i]+e[n]}return t}();function eo(e){return"undefined"==typeof BigInt?eh:e}function eh(){throw Error("BigInt not supported")}}),parcelRegister("kuxul",function(e,t){$parcel$export(e.exports,"toByteArray",()=>i,e=>i=e),$parcel$export(e.exports,"fromByteArray",()=>s,e=>s=e);for(var i=u,s=m,n=[],a=[],l="undefined"!=typeof Uint8Array?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,h=r.length;o<h;++o)n[o]=r[o],a[r.charCodeAt(o)]=o;function c(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var i=e.indexOf("=");-1===i&&(i=t);var s=i===t?0:4-i%4;return[i,s]}function d(e,t,i){return(t+i)*3/4-i}function u(e){var t,i,s=c(e),n=s[0],r=s[1],o=new l(d(e,n,r)),h=0,u=r>0?n-4:n;for(i=0;i<u;i+=4)t=a[e.charCodeAt(i)]<<18|a[e.charCodeAt(i+1)]<<12|a[e.charCodeAt(i+2)]<<6|a[e.charCodeAt(i+3)],o[h++]=t>>16&255,o[h++]=t>>8&255,o[h++]=255&t;return 2===r&&(t=a[e.charCodeAt(i)]<<2|a[e.charCodeAt(i+1)]>>4,o[h++]=255&t),1===r&&(t=a[e.charCodeAt(i)]<<10|a[e.charCodeAt(i+1)]<<4|a[e.charCodeAt(i+2)]>>2,o[h++]=t>>8&255,o[h++]=255&t),o}function p(e){return n[e>>18&63]+n[e>>12&63]+n[e>>6&63]+n[63&e]}function g(e,t,i){for(var s=[],n=t;n<i;n+=3)s.push(p((e[n]<<16&0xff0000)+(e[n+1]<<8&65280)+(255&e[n+2])));return s.join("")}function m(e){for(var t,i=e.length,s=i%3,a=[],l=16383,r=0,o=i-s;r<o;r+=l)a.push(g(e,r,r+l>o?o:r+l));return 1===s?a.push(n[(t=e[i-1])>>2]+n[t<<4&63]+"=="):2===s&&a.push(n[(t=(e[i-2]<<8)+e[i-1])>>10]+n[t>>4&63]+n[t<<2&63]+"="),a.join("")}a[45]=62,a[95]=63}),parcelRegister("9NvM5",function(e,t){var i,s;$parcel$export(e.exports,"read",()=>i,e=>i=e),$parcel$export(e.exports,"write",()=>s,e=>s=e),i=function(e,t,i,s,n){var a,l,r=8*n-s-1,o=(1<<r)-1,h=o>>1,c=-7,d=i?n-1:0,u=i?-1:1,p=e[t+d];for(d+=u,a=p&(1<<-c)-1,p>>=-c,c+=r;c>0;a=256*a+e[t+d],d+=u,c-=8);for(l=a&(1<<-c)-1,a>>=-c,c+=s;c>0;l=256*l+e[t+d],d+=u,c-=8);if(0===a)a=1-h;else{if(a===o)return l?NaN:1/0*(p?-1:1);l+=Math.pow(2,s),a-=h}return(p?-1:1)*l*Math.pow(2,a-s)},s=function(e,t,i,s,n,a){var l,r,o,h=8*a-n-1,c=(1<<h)-1,d=c>>1,u=5960464477539062e-23*(23===n),p=s?0:a-1,g=s?1:-1,m=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(r=+!!isNaN(t),l=c):(l=Math.floor(Math.log(t)/Math.LN2),t*(o=Math.pow(2,-l))<1&&(l--,o*=2),l+d>=1?t+=u/o:t+=u*Math.pow(2,1-d),t*o>=2&&(l++,o/=2),l+d>=c?(r=0,l=c):l+d>=1?(r=(t*o-1)*Math.pow(2,n),l+=d):(r=t*Math.pow(2,d-1)*Math.pow(2,n),l=0));n>=8;e[i+p]=255&r,p+=g,r/=256,n-=8);for(l=l<<n|r,h+=n;h>0;e[i+p]=255&l,p+=g,l/=256,h-=8);e[i+p-g]|=128*m}}),parcelRegister("kjyEk",function(e,t){}),parcelRegister("59kwG",function(e,t){var i=parcelRequire("hPtJY");function s(e){if("string"!=typeof e)throw TypeError("Path must be a string. Received "+JSON.stringify(e))}function n(e,t){for(var i,s="",n=0,a=-1,l=0,r=0;r<=e.length;++r){if(r<e.length)i=e.charCodeAt(r);else if(47===i)break;else i=47;if(47===i){if(a===r-1||1===l);else if(a!==r-1&&2===l){if(s.length<2||2!==n||46!==s.charCodeAt(s.length-1)||46!==s.charCodeAt(s.length-2)){if(s.length>2){var o=s.lastIndexOf("/");if(o!==s.length-1){-1===o?(s="",n=0):n=(s=s.slice(0,o)).length-1-s.lastIndexOf("/"),a=r,l=0;continue}}else if(2===s.length||1===s.length){s="",n=0,a=r,l=0;continue}}t&&(s.length>0?s+="/..":s="..",n=2)}else s.length>0?s+="/"+e.slice(a+1,r):s=e.slice(a+1,r),n=r-a-1;a=r,l=0}else 46===i&&-1!==l?++l:l=-1}return s}function a(e,t){var i=t.dir||t.root,s=t.base||(t.name||"")+(t.ext||"");return i?i===t.root?i+s:i+e+s:s}var l={resolve:function(){for(var e,t,a="",l=!1,r=arguments.length-1;r>=-1&&!l;r--)r>=0?t=arguments[r]:(void 0===e&&(e=i.cwd()),t=e),s(t),0!==t.length&&(a=t+"/"+a,l=47===t.charCodeAt(0));if(a=n(a,!l),l)if(a.length>0)return"/"+a;else return"/";return a.length>0?a:"."},normalize:function(e){if(s(e),0===e.length)return".";var t=47===e.charCodeAt(0),i=47===e.charCodeAt(e.length-1);return(0!==(e=n(e,!t)).length||t||(e="."),e.length>0&&i&&(e+="/"),t)?"/"+e:e},isAbsolute:function(e){return s(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0==arguments.length)return".";for(var e,t=0;t<arguments.length;++t){var i=arguments[t];s(i),i.length>0&&(void 0===e?e=i:e+="/"+i)}return void 0===e?".":l.normalize(e)},relative:function(e,t){if(s(e),s(t),e===t||(e=l.resolve(e))===(t=l.resolve(t)))return"";for(var i=1;i<e.length&&47===e.charCodeAt(i);++i);for(var n=e.length,a=n-i,r=1;r<t.length&&47===t.charCodeAt(r);++r);for(var o=t.length-r,h=a<o?a:o,c=-1,d=0;d<=h;++d){if(d===h){if(o>h){if(47===t.charCodeAt(r+d))return t.slice(r+d+1);else if(0===d)return t.slice(r+d)}else a>h&&(47===e.charCodeAt(i+d)?c=d:0===d&&(c=0));break}var u=e.charCodeAt(i+d);if(u!==t.charCodeAt(r+d))break;47===u&&(c=d)}var p="";for(d=i+c+1;d<=n;++d)(d===n||47===e.charCodeAt(d))&&(0===p.length?p+="..":p+="/..");return p.length>0?p+t.slice(r+c):(r+=c,47===t.charCodeAt(r)&&++r,t.slice(r))},_makeLong:function(e){return e},dirname:function(e){if(s(e),0===e.length)return".";for(var t=e.charCodeAt(0),i=47===t,n=-1,a=!0,l=e.length-1;l>=1;--l)if(47===(t=e.charCodeAt(l))){if(!a){n=l;break}}else a=!1;return -1===n?i?"/":".":i&&1===n?"//":e.slice(0,n)},basename:function(e,t){if(void 0!==t&&"string"!=typeof t)throw TypeError('"ext" argument must be a string');s(e);var i,n=0,a=-1,l=!0;if(void 0!==t&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var r=t.length-1,o=-1;for(i=e.length-1;i>=0;--i){var h=e.charCodeAt(i);if(47===h){if(!l){n=i+1;break}}else -1===o&&(l=!1,o=i+1),r>=0&&(h===t.charCodeAt(r)?-1==--r&&(a=i):(r=-1,a=o))}return n===a?a=o:-1===a&&(a=e.length),e.slice(n,a)}for(i=e.length-1;i>=0;--i)if(47===e.charCodeAt(i)){if(!l){n=i+1;break}}else -1===a&&(l=!1,a=i+1);return -1===a?"":e.slice(n,a)},extname:function(e){s(e);for(var t=-1,i=0,n=-1,a=!0,l=0,r=e.length-1;r>=0;--r){var o=e.charCodeAt(r);if(47===o){if(!a){i=r+1;break}continue}-1===n&&(a=!1,n=r+1),46===o?-1===t?t=r:1!==l&&(l=1):-1!==t&&(l=-1)}return -1===t||-1===n||0===l||1===l&&t===n-1&&t===i+1?"":e.slice(t,n)},format:function(e){if(null===e||"object"!=typeof e)throw TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return a("/",e)},parse:function(e){s(e);var t,i={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return i;var n=e.charCodeAt(0),a=47===n;a?(i.root="/",t=1):t=0;for(var l=-1,r=0,o=-1,h=!0,c=e.length-1,d=0;c>=t;--c){if(47===(n=e.charCodeAt(c))){if(!h){r=c+1;break}continue}-1===o&&(h=!1,o=c+1),46===n?-1===l?l=c:1!==d&&(d=1):-1!==l&&(d=-1)}return -1===l||-1===o||0===d||1===d&&l===o-1&&l===r+1?-1!==o&&(0===r&&a?i.base=i.name=e.slice(1,o):i.base=i.name=e.slice(r,o)):(0===r&&a?(i.name=e.slice(1,l),i.base=e.slice(1,o)):(i.name=e.slice(r,l),i.base=e.slice(r,o)),i.ext=e.slice(l,o)),r>0?i.dir=e.slice(0,r-1):a&&(i.dir="/"),i},sep:"/",delimiter:":",win32:null,posix:null};l.posix=l,e.exports=l}),parcelRegister("hPtJY",function(e,t){var i,s,n,a=e.exports={};function l(){throw Error("setTimeout has not been defined")}function r(){throw Error("clearTimeout has not been defined")}function o(e){if(i===setTimeout)return setTimeout(e,0);if((i===l||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}function h(e){if(s===clearTimeout)return clearTimeout(e);if((s===r||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(e);try{return s(e)}catch(t){try{return s.call(null,e)}catch(t){return s.call(this,e)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:l}catch(e){i=l}try{s="function"==typeof clearTimeout?clearTimeout:r}catch(e){s=r}}();var c=[],d=!1,u=-1;function p(){d&&n&&(d=!1,n.length?c=n.concat(c):u=-1,c.length&&g())}function g(){if(!d){var e=o(p);d=!0;for(var t=c.length;t;){for(n=c,c=[];++u<t;)n&&n[u].run();u=-1,t=c.length}n=null,d=!1,h(e)}}function m(e,t){this.fun=e,this.array=t}function f(){}a.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];c.push(new m(e,t)),1!==c.length||d||o(g)},m.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=f,a.addListener=f,a.once=f,a.off=f,a.removeListener=f,a.removeAllListeners=f,a.emit=f,a.prependListener=f,a.prependOnceListener=f,a.listeners=function(e){return[]},a.binding=function(e){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw Error("process.chdir is not supported")},a.umask=function(){return 0}});var $6tZyV=parcelRequire("6tZyV"),$6tZyV=parcelRequire("6tZyV");function $accbbbdd2b659699$var$normalize(e){var t=[];if(0===e.length)return"";if("string"!=typeof e[0])throw TypeError("Url must be a string. Received "+e[0]);if(e[0].match(/^[^/:]+:\/*$/)&&e.length>1){var i=e.shift();e[0]=i+e[0]}e[0].match(/^file:\/\/\//)?e[0]=e[0].replace(/^([^/:]+):\/*/,"$1:///"):e[0]=e[0].replace(/^([^/:]+):\/*/,"$1://");for(var s=0;s<e.length;s++){var n=e[s];if("string"!=typeof n)throw TypeError("Url must be a string. Received "+n);""!==n&&(s>0&&(n=n.replace(/^[\/]+/,"")),n=s<e.length-1?n.replace(/[\/]+$/,""):n.replace(/[\/]+$/,"/"),t.push(n))}var a=t.join("/"),l=(a=a.replace(/\/(\?|&|#[^!])/g,"$1")).split("?");return l.shift()+(l.length>0?"?":"")+l.join("&")}function $accbbbdd2b659699$export$2e2bcd8739ae039(){var e;return e="object"==typeof arguments[0]?arguments[0]:[].slice.call(arguments),$accbbbdd2b659699$var$normalize(e)}const $df5bef30413a053b$export$d8a26495d8243461=(e,t)=>[e[0]-t[0],e[1]-t[1]],$df5bef30413a053b$export$76d2ca8755a66aab=(e,t)=>[e[0]/t,e[1]/t],$df5bef30413a053b$export$4da97a1b662f8a88=e=>({...e,position:$df5bef30413a053b$export$d8a26495d8243461(e.position,$df5bef30413a053b$export$76d2ca8755a66aab(e.size,2))}),$df5bef30413a053b$export$c6ccdd35ddcb5cc8=({position:e,size:t})=>[e[0],e[1]+t[1]],$cfbd948ec4437e14$export$218965a8516def57=(e,t,i,s)=>{e.style.width=`${t}`,e.style.height=`${i}`;let n=new(0,$6tZyV.Graph)(e),a=n.getDefaultParent(),l=55,r=105,o=i-110-55+10,h=75,c=t-110+10,d=t/2,u=(105+o)/2,p=180,g=117;return n.batchUpdate(()=>{n.cellsLocked=!0,n.cellsSelectable=!1;let e={parent:a,size:[g,p]},t=$df5bef30413a053b$export$4da97a1b662f8a88({...e,position:[d,r],style:{image:$accbbbdd2b659699$export$2e2bcd8739ae039(s,"TheKingOfElflandsDaughter.jpg"),shape:"image"}}),i=$df5bef30413a053b$export$4da97a1b662f8a88({...e,position:[h,u+20],style:{image:$accbbbdd2b659699$export$2e2bcd8739ae039(s,"The_Lord_of_the_Rings.gif"),shape:"image"}}),m=$df5bef30413a053b$export$4da97a1b662f8a88({...e,position:[c,u+10],size:[p,.65*p],style:{image:$accbbbdd2b659699$export$2e2bcd8739ae039(s,"TheShadowKingdom-1.png"),shape:"image",imageBorder:"black"}}),f=$df5bef30413a053b$export$4da97a1b662f8a88({...e,position:[d,o],size:[.6*p,p],style:{image:$accbbbdd2b659699$export$2e2bcd8739ae039(s,"The_Black_Company.jpg"),shape:"image"}}),x=n.insertVertex(t),v=n.insertVertex(i),b=n.insertVertex(m),y=n.insertVertex(f),w={parent:a,size:[g,l],style:{fillOpacity:0,strokeOpacity:0,fontColor:"black",verticalAlign:"top",fontSize:14}};n.insertVertex({...w,value:"Lord Dunsany, 1924.",position:$df5bef30413a053b$export$c6ccdd35ddcb5cc8(t)});let C=n.insertVertex({...w,value:"JRR Tolkien, 1954-5.\nBecame known as\nHigh Fantasy.",position:$df5bef30413a053b$export$c6ccdd35ddcb5cc8(i)}),E=n.insertVertex({...w,size:[p,l],value:"Robert E Howard, 1929.\nBecame known as\nSword and Sorcery.",position:$df5bef30413a053b$export$c6ccdd35ddcb5cc8(m)});n.insertVertex({...w,value:"Glen Cook, 1984.\nBecame known\nas Grimdark.",position:$df5bef30413a053b$export$c6ccdd35ddcb5cc8(f)});let S={edgeStyle:"orthogonalEdgeStyle",rounded:!0,strokeWidth:10,strokeColor:"black",arcSize:50,endArrow:"block"},T="north",M="east",A="south",P="west";n.insertEdge({parent:a,source:x,target:v,style:{...S,sourcePortConstraint:P,targetPortConstraint:T}}),n.insertEdge({parent:a,source:x,target:b,style:{...S,sourcePortConstraint:M,targetPortConstraint:T}}),n.insertEdge({parent:a,source:C,target:y,style:{...S,sourcePortConstraint:A,targetPortConstraint:P}}),n.insertEdge({parent:a,source:E,target:y,style:{...S,sourcePortConstraint:A,targetPortConstraint:M}})}),n},$b4e14b6b8da86996$var$container=document.getElementById("graph-container");if(!$b4e14b6b8da86996$var$container)throw Error("Element graph-container not found");const $b4e14b6b8da86996$var$width=480,$b4e14b6b8da86996$var$height=600;$6tZyV.InternalEvent.disableContextMenu($b4e14b6b8da86996$var$container);const $b4e14b6b8da86996$var$graph=$cfbd948ec4437e14$export$218965a8516def57($b4e14b6b8da86996$var$container,$b4e14b6b8da86996$var$width,$b4e14b6b8da86996$var$height,"/dist/"),$b4e14b6b8da86996$var$button=document.getElementById("download-button");if(!$b4e14b6b8da86996$var$button)throw Error("Element download-button not found");$b4e14b6b8da86996$var$button.addEventListener("click",async()=>{let e=new Blob([await (0,$6tZyV.maxGraphToSvg)($b4e14b6b8da86996$var$graph,{inlineImages:!0})],{type:"image/svg+xml"}),t=URL.createObjectURL(e),i=document.createElement("a");i.href=t,i.download="evolution-of-fantasy.svg",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(t)});
//# sourceMappingURL=evolution-of-fantasy.201f450b.js.map
